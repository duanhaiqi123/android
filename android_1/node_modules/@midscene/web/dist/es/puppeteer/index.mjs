import { Agent } from "@midscene/core/agent";
import { getDebug } from "@midscene/shared/logger";
import semver from "semver";
import { getWebpackRequire } from "../utils.mjs";
import { forceChromeSelectRendering as external_base_page_mjs_forceChromeSelectRendering, forceClosePopup } from "./base-page.mjs";
import { PuppeteerWebPage } from "./page.mjs";
import { overrideAIConfig } from "@midscene/shared/env";
const debug = getDebug('puppeteer:agent');
function getPuppeteerVersion() {
    try {
        const puppeteerPkg = getWebpackRequire()('puppeteer/package.json');
        return puppeteerPkg.version || null;
    } catch (error) {
        console.error('[midscene:error] Failed to get Puppeteer version', error);
        return null;
    }
}
class PuppeteerAgent extends Agent {
    constructor(page, opts){
        const webPage = new PuppeteerWebPage(page, opts);
        super(webPage, opts);
        const { forceSameTabNavigation = true, forceChromeSelectRendering } = opts ?? {};
        if (forceSameTabNavigation) forceClosePopup(page, debug);
        if (forceChromeSelectRendering) {
            const puppeteerVersion = getPuppeteerVersion();
            if (puppeteerVersion && !semver.gte(puppeteerVersion, '24.6.0')) console.warn(`[midscene:error] forceChromeSelectRendering requires Puppeteer > 24.6.0, but current version is ${puppeteerVersion}. This feature may not work correctly.`);
            external_base_page_mjs_forceChromeSelectRendering(page);
        }
    }
}
export { PuppeteerAgent, PuppeteerWebPage, overrideAIConfig };

//# sourceMappingURL=index.mjs.map