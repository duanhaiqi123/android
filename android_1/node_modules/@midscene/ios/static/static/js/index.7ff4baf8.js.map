{"version":3,"file":"static/js/index.7ff4baf8.js","sources":["webpack/runtime/create_fake_namespace_object","webpack/runtime/load_script","webpack/runtime/on_chunk_loaded","webpack/runtime/jsonp_chunk_loading","../../../../../packages/core/dist/es/ai-model/service-caller|lazy|referencedExports: ProxyAgent|groupOptions: {}|namespace object","../../../../../packages/core/dist/es/ai-model/service-caller|lazy|referencedExports: observeOpenAI|groupOptions: {}|namespace object","../../../../../packages/core/dist/es/ai-model/service-caller|lazy|referencedExports: socksDispatcher|groupOptions: {}|namespace object","../../../../../packages/core/dist/es/ai-model/service-caller|lazy|referencedExports: wrapOpenAI|groupOptions: {}|namespace object","../../../../../packages/shared/dist/es/env/types.mjs","../../../../../packages/shared/dist/es/utils.mjs","../../../../../packages/shared/dist/es/env/basic.mjs","../../../../../packages/shared/dist/es/common.mjs","../../../../../packages/shared/dist/es/logger.mjs","../../../../../packages/shared/dist/es/env/init-debug.mjs","../../../../../packages/shared/dist/es/env/global-config-manager.mjs","../../../../../packages/shared/dist/es/env/helper.mjs","../../../../../packages/shared/dist/es/env/parse-model-config.mjs","../../../../../packages/shared/dist/es/env/constants.mjs","../../../../../packages/shared/dist/es/env/model-config-manager.mjs","../../../../../packages/shared/dist/es/env/utils.mjs","../../../../../packages/shared/dist/es/img/transform.mjs","../../../../../packages/core/src/common.ts","../../../../../packages/core/src/ai-model/inspect.ts","../../../../../packages/core/src/ai-model/llm-planning.ts","../../../../../packages/shared/dist/es/us-keyboard-layout.mjs","../../../../../packages/core/src/ai-model/ui-tars-planning.ts","../../../../../packages/core/src/yaml/utils.ts","../../../../../packages/core/src/yaml/player.ts","../../../../../packages/playground/src/common.ts","../../../../../packages/playground/src/adapters/base.ts","../../../../../packages/playground/src/adapters/local-execution.ts","../../../../../packages/playground/src/adapters/remote-execution.ts","../../../../../packages/playground/src/sdk/index.ts","../../../../../packages/visualizer/dist/es/utils/color.mjs","../../../../../packages/visualizer/dist/es/component/logo/index.mjs","../../../../../packages/visualizer/dist/es/hooks/useTheme.mjs","../../../../../packages/visualizer/dist/es/store/store.mjs","../../../../../packages/visualizer/dist/es/component/env-config/index.mjs","../../../../../packages/visualizer/dist/es/component/nav-actions/index.mjs","../../../../../packages/core/src/agent/ui-utils.ts","../../../../../packages/core/src/service/index.ts","../../../../../packages/core/src/task-runner.ts","../../../../../packages/core/src/device/index.ts","../../../../../packages/core/src/agent/utils.ts","../../../../../packages/core/src/agent/task-cache.ts","../../../../../packages/core/src/agent/task-builder.ts","../../../../../packages/core/src/agent/tasks.ts","../../../../../packages/core/src/agent/agent.ts","../../../../../packages/visualizer/dist/es/utils/constants.mjs","../../../../../packages/visualizer/dist/es/utils/index.mjs","../../../../../packages/visualizer/dist/es/utils/replay-scripts.mjs","../../../../../packages/visualizer/dist/es/hooks/usePlaygroundExecution.mjs","../../../../../packages/shared/dist/es/baseDB.mjs","../../../../../packages/visualizer/dist/es/component/universal-playground/providers/indexeddb-storage-provider.mjs","../../../../../packages/visualizer/dist/es/component/universal-playground/providers/storage-provider.mjs","../../../../../packages/visualizer/dist/es/hooks/usePlaygroundState.mjs","../../../../../packages/visualizer/dist/es/component/blackboard/index.mjs","../../../../../packages/visualizer/dist/es/component/shiny-text/index.mjs","../../../../../packages/visualizer/dist/es/component/misc/index.mjs","../../../../../packages/visualizer/dist/es/component/context-preview/index.mjs","../../../../../packages/visualizer/dist/es/component/env-config-reminder/index.mjs","../../../../../packages/visualizer/dist/es/icons/global-perspective.mjs","../../../../../packages/visualizer/dist/es/icons/player-setting.mjs","../../../../../packages/visualizer/dist/es/utils/pixi-loader.mjs","../../../../../packages/visualizer/dist/es/component/player/index.mjs","../../../../../packages/visualizer/dist/es/component/playground-result/index.mjs","../../../../../packages/visualizer/dist/es/icons/avatar.mjs","../../../../../packages/visualizer/dist/es/store/history.mjs","../../../../../packages/visualizer/dist/es/types.mjs","../../../../../packages/visualizer/dist/es/utils/playground-utils.mjs","../../../../../packages/visualizer/dist/es/icons/setting.mjs","../../../../../packages/visualizer/dist/es/component/config-selector/index.mjs","../../../../../packages/visualizer/dist/es/component/form-field/index.mjs","../../../../../packages/visualizer/dist/es/icons/close.mjs","../../../../../packages/visualizer/dist/es/icons/history.mjs","../../../../../packages/visualizer/dist/es/icons/magnifying-glass.mjs","../../../../../packages/visualizer/dist/es/component/history-selector/index.mjs","../../../../../packages/visualizer/dist/es/component/prompt-input/index.mjs","../../../../../packages/visualizer/dist/es/component/universal-playground/index.mjs","../../../../../packages/visualizer/dist/es/component/screenshot-viewer/index.mjs","../../../src/App.tsx","../../../src/index.tsx","webpack/runtime/compat_get_default_export","webpack/runtime/define_property_getters","webpack/runtime/ensure_chunk","webpack/runtime/get javascript chunk filename","webpack/runtime/get mini-css chunk filename","webpack/runtime/global","webpack/runtime/has_own_property","webpack/runtime/make_namespace_object","webpack/runtime/public_path"],"sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n  __webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; (typeof current == 'object' || typeof current == 'function') && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => { def[key] = () => (value[key]) });\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var inProgress = {};\n\nvar uniqueName = \"playground:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = function (url, done, key, chunkId) {\n\tif (inProgress[url]) {\n\t\tinProgress[url].push(done);\n\t\treturn;\n\t}\n\tvar script, needAttach;\n\tif (key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor (var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif (s.getAttribute(\"src\") == url || s.getAttribute(\"data-rspack\") == uniqueName + key) {\n\t\t\t\tscript = s;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\nscript.timeout = 120;\nif (__webpack_require__.nc) {\n  script.setAttribute(\"nonce\", __webpack_require__.nc);\n}\n\nscript.setAttribute(\"data-rspack\", uniqueName + key);\n\n\n\nscript.src = url;\n\n\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = function (prev, event) {\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns &&\n\t\t\tdoneFns.forEach(function (fn) {\n\t\t\t\treturn fn(event);\n\t\t\t});\n\t\tif (prev) return prev(event);\n\t};\n\tvar timeout = setTimeout(\n\t\tonScriptComplete.bind(null, undefined, {\n\t\t\ttype: 'timeout',\n\t\t\ttarget: script\n\t\t}),\n\t\t120000\n\t);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif (chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor (var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--)\n\t\t\tdeferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif (\n\t\t\t\t(priority & (1 === 0) || notFulfilled >= priority) &&\n\t\t\t\tObject.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))\n\t\t\t) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif (priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif (fulfilled) {\n\t\t\tdeferred.splice(i--, 1);\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};\n","__webpack_require__.b = document.baseURI || self.location.href;\n\n      // object to store loaded and loading chunks\n      // undefined = chunk not loaded, null = chunk preloaded/prefetched\n      // [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\n      var installedChunks = {\"410\": 0,};\n      \n        __webpack_require__.f.j = function (chunkId, promises) {\n          // JSONP chunk loading for javascript\nvar installedChunkData = __webpack_require__.o(installedChunks, chunkId)\n\t? installedChunks[chunkId]\n\t: undefined;\nif (installedChunkData !== 0) {\n\t// 0 means \"already installed\".\n\n\t// a Promise means \"currently loading\".\n\tif (installedChunkData) {\n\t\tpromises.push(installedChunkData[2]);\n\t} else {\n\t\tif (true) {\n\t\t\t// setup Promise in chunk cache\n\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\tpromises.push((installedChunkData[2] = promise));\n\n\t\t\t// start chunk loading\n\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\tvar error = new Error();\n\t\t\tvar loadingEnded = function (event) {\n\t\t\t\tif (__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\tif (installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\tif (installedChunkData) {\n\t\t\t\t\t\tvar errorType =\n\t\t\t\t\t\t\tevent && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\terror.message =\n\t\t\t\t\t\t\t'Loading chunk ' +\n\t\t\t\t\t\t\tchunkId +\n\t\t\t\t\t\t\t' failed.\\n(' +\n\t\t\t\t\t\t\terrorType +\n\t\t\t\t\t\t\t': ' +\n\t\t\t\t\t\t\trealSrc +\n\t\t\t\t\t\t\t')';\n\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t} \n\t}\n}\n\n        }\n        __webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n// install a JSONP callback for chunk loading\nvar __rspack_jsonp = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif (chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor (moduleId in moreModules) {\n\t\t\tif (__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif (runtime) var result = runtime(__webpack_require__);\n\t}\n\tif (parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor (; i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif (\n\t\t\t__webpack_require__.o(installedChunks, chunkId) &&\n\t\t\tinstalledChunks[chunkId]\n\t\t) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\t\n\treturn __webpack_require__.O(result);\n\t\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunkplayground\"] = self[\"webpackChunkplayground\"] || [];\nchunkLoadingGlobal.forEach(__rspack_jsonp.bind(null, 0));\nchunkLoadingGlobal.push = __rspack_jsonp.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n","function webpackEmptyAsyncContext(req) {\n  // Here Promise.resolve().then() is used instead of new Promise() to prevent\n  // uncaught exception popping up in devtools\n  return Promise.resolve().then(function() {\n    var e = new Error(\"Cannot find module '\" + req + \"'\");\n    e.code = 'MODULE_NOT_FOUND';\n    throw e;\n  });\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 5737;\nmodule.exports = webpackEmptyAsyncContext;\n","function webpackEmptyAsyncContext(req) {\n  // Here Promise.resolve().then() is used instead of new Promise() to prevent\n  // uncaught exception popping up in devtools\n  return Promise.resolve().then(function() {\n    var e = new Error(\"Cannot find module '\" + req + \"'\");\n    e.code = 'MODULE_NOT_FOUND';\n    throw e;\n  });\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 9998;\nmodule.exports = webpackEmptyAsyncContext;\n","function webpackEmptyAsyncContext(req) {\n  // Here Promise.resolve().then() is used instead of new Promise() to prevent\n  // uncaught exception popping up in devtools\n  return Promise.resolve().then(function() {\n    var e = new Error(\"Cannot find module '\" + req + \"'\");\n    e.code = 'MODULE_NOT_FOUND';\n    throw e;\n  });\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 3348;\nmodule.exports = webpackEmptyAsyncContext;\n","function webpackEmptyAsyncContext(req) {\n  // Here Promise.resolve().then() is used instead of new Promise() to prevent\n  // uncaught exception popping up in devtools\n  return Promise.resolve().then(function() {\n    var e = new Error(\"Cannot find module '\" + req + \"'\");\n    e.code = 'MODULE_NOT_FOUND';\n    throw e;\n  });\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 1560;\nmodule.exports = webpackEmptyAsyncContext;\n","const MIDSCENE_MODEL_INIT_CONFIG_JSON = 'MIDSCENE_MODEL_INIT_CONFIG_JSON';\nconst MIDSCENE_MODEL_NAME = 'MIDSCENE_MODEL_NAME';\nconst MIDSCENE_DEBUG_MODEL_PROFILE = 'MIDSCENE_DEBUG_MODEL_PROFILE';\nconst MIDSCENE_DEBUG_MODEL_RESPONSE = 'MIDSCENE_DEBUG_MODEL_RESPONSE';\nconst MIDSCENE_DANGEROUSLY_PRINT_ALL_CONFIG = 'MIDSCENE_DANGEROUSLY_PRINT_ALL_CONFIG';\nconst MIDSCENE_DEBUG_MODE = 'MIDSCENE_DEBUG_MODE';\nconst MIDSCENE_MCP_USE_PUPPETEER_MODE = 'MIDSCENE_MCP_USE_PUPPETEER_MODE';\nconst MIDSCENE_MCP_CHROME_PATH = 'MIDSCENE_MCP_CHROME_PATH';\nconst MIDSCENE_MCP_ANDROID_MODE = 'MIDSCENE_MCP_ANDROID_MODE';\nconst DOCKER_CONTAINER = 'DOCKER_CONTAINER';\nconst MIDSCENE_FORCE_DEEP_THINK = 'MIDSCENE_FORCE_DEEP_THINK';\nconst MIDSCENE_LANGSMITH_DEBUG = 'MIDSCENE_LANGSMITH_DEBUG';\nconst MIDSCENE_LANGFUSE_DEBUG = 'MIDSCENE_LANGFUSE_DEBUG';\nconst MIDSCENE_MODEL_SOCKS_PROXY = 'MIDSCENE_MODEL_SOCKS_PROXY';\nconst MIDSCENE_MODEL_HTTP_PROXY = 'MIDSCENE_MODEL_HTTP_PROXY';\nconst MIDSCENE_MODEL_API_KEY = 'MIDSCENE_MODEL_API_KEY';\nconst MIDSCENE_MODEL_BASE_URL = 'MIDSCENE_MODEL_BASE_URL';\nconst MIDSCENE_MODEL_MAX_TOKENS = 'MIDSCENE_MODEL_MAX_TOKENS';\nconst MIDSCENE_MODEL_TIMEOUT = 'MIDSCENE_MODEL_TIMEOUT';\nconst MIDSCENE_MODEL_TEMPERATURE = 'MIDSCENE_MODEL_TEMPERATURE';\nconst OPENAI_API_KEY = 'OPENAI_API_KEY';\nconst OPENAI_BASE_URL = 'OPENAI_BASE_URL';\nconst MIDSCENE_OPENAI_INIT_CONFIG_JSON = 'MIDSCENE_OPENAI_INIT_CONFIG_JSON';\nconst MIDSCENE_OPENAI_HTTP_PROXY = 'MIDSCENE_OPENAI_HTTP_PROXY';\nconst MIDSCENE_OPENAI_SOCKS_PROXY = 'MIDSCENE_OPENAI_SOCKS_PROXY';\nconst OPENAI_MAX_TOKENS = 'OPENAI_MAX_TOKENS';\nconst MIDSCENE_ADB_PATH = 'MIDSCENE_ADB_PATH';\nconst MIDSCENE_ADB_REMOTE_HOST = 'MIDSCENE_ADB_REMOTE_HOST';\nconst MIDSCENE_ADB_REMOTE_PORT = 'MIDSCENE_ADB_REMOTE_PORT';\nconst MIDSCENE_ANDROID_IME_STRATEGY = 'MIDSCENE_ANDROID_IME_STRATEGY';\nconst MIDSCENE_IOS_DEVICE_UDID = 'MIDSCENE_IOS_DEVICE_UDID';\nconst MIDSCENE_IOS_SIMULATOR_UDID = 'MIDSCENE_IOS_SIMULATOR_UDID';\nconst MIDSCENE_CACHE = 'MIDSCENE_CACHE';\nconst MIDSCENE_USE_VLM_UI_TARS = 'MIDSCENE_USE_VLM_UI_TARS';\nconst MIDSCENE_USE_QWEN_VL = 'MIDSCENE_USE_QWEN_VL';\nconst MIDSCENE_USE_QWEN3_VL = 'MIDSCENE_USE_QWEN3_VL';\nconst MIDSCENE_USE_DOUBAO_VISION = 'MIDSCENE_USE_DOUBAO_VISION';\nconst MIDSCENE_USE_GEMINI = 'MIDSCENE_USE_GEMINI';\nconst MIDSCENE_USE_VL_MODEL = 'MIDSCENE_USE_VL_MODEL';\nconst MATCH_BY_POSITION = 'MATCH_BY_POSITION';\nconst MIDSCENE_REPORT_TAG_NAME = 'MIDSCENE_REPORT_TAG_NAME';\nconst MIDSCENE_PREFERRED_LANGUAGE = 'MIDSCENE_PREFERRED_LANGUAGE';\nconst MIDSCENE_CACHE_MAX_FILENAME_LENGTH = 'MIDSCENE_CACHE_MAX_FILENAME_LENGTH';\nconst MIDSCENE_REPLANNING_CYCLE_LIMIT = 'MIDSCENE_REPLANNING_CYCLE_LIMIT';\nconst MIDSCENE_RUN_DIR = 'MIDSCENE_RUN_DIR';\nconst MIDSCENE_INSIGHT_MODEL_NAME = 'MIDSCENE_INSIGHT_MODEL_NAME';\nconst MIDSCENE_INSIGHT_MODEL_SOCKS_PROXY = 'MIDSCENE_INSIGHT_MODEL_SOCKS_PROXY';\nconst MIDSCENE_INSIGHT_MODEL_HTTP_PROXY = 'MIDSCENE_INSIGHT_MODEL_HTTP_PROXY';\nconst MIDSCENE_INSIGHT_MODEL_BASE_URL = 'MIDSCENE_INSIGHT_MODEL_BASE_URL';\nconst MIDSCENE_INSIGHT_MODEL_API_KEY = 'MIDSCENE_INSIGHT_MODEL_API_KEY';\nconst MIDSCENE_INSIGHT_MODEL_INIT_CONFIG_JSON = 'MIDSCENE_INSIGHT_MODEL_INIT_CONFIG_JSON';\nconst MIDSCENE_INSIGHT_MODEL_TIMEOUT = 'MIDSCENE_INSIGHT_MODEL_TIMEOUT';\nconst MIDSCENE_INSIGHT_MODEL_TEMPERATURE = 'MIDSCENE_INSIGHT_MODEL_TEMPERATURE';\nconst MIDSCENE_PLANNING_MODEL_NAME = 'MIDSCENE_PLANNING_MODEL_NAME';\nconst MIDSCENE_PLANNING_MODEL_SOCKS_PROXY = 'MIDSCENE_PLANNING_MODEL_SOCKS_PROXY';\nconst MIDSCENE_PLANNING_MODEL_HTTP_PROXY = 'MIDSCENE_PLANNING_MODEL_HTTP_PROXY';\nconst MIDSCENE_PLANNING_MODEL_BASE_URL = 'MIDSCENE_PLANNING_MODEL_BASE_URL';\nconst MIDSCENE_PLANNING_MODEL_API_KEY = 'MIDSCENE_PLANNING_MODEL_API_KEY';\nconst MIDSCENE_PLANNING_MODEL_INIT_CONFIG_JSON = 'MIDSCENE_PLANNING_MODEL_INIT_CONFIG_JSON';\nconst MIDSCENE_PLANNING_MODEL_TIMEOUT = 'MIDSCENE_PLANNING_MODEL_TIMEOUT';\nconst MIDSCENE_PLANNING_MODEL_TEMPERATURE = 'MIDSCENE_PLANNING_MODEL_TEMPERATURE';\nconst MIDSCENE_MODEL_FAMILY = 'MIDSCENE_MODEL_FAMILY';\nconst UNUSED_ENV_KEYS = [\n    MIDSCENE_DANGEROUSLY_PRINT_ALL_CONFIG\n];\nconst BASIC_ENV_KEYS = [\n    MIDSCENE_DEBUG_MODE,\n    MIDSCENE_DEBUG_MODEL_PROFILE,\n    MIDSCENE_DEBUG_MODEL_RESPONSE,\n    MIDSCENE_RUN_DIR\n];\nconst BOOLEAN_ENV_KEYS = [\n    MIDSCENE_CACHE,\n    MIDSCENE_FORCE_DEEP_THINK,\n    MIDSCENE_MCP_USE_PUPPETEER_MODE,\n    MIDSCENE_MCP_ANDROID_MODE,\n    MIDSCENE_LANGSMITH_DEBUG,\n    MIDSCENE_LANGFUSE_DEBUG\n];\nconst NUMBER_ENV_KEYS = [\n    MIDSCENE_CACHE_MAX_FILENAME_LENGTH,\n    MIDSCENE_REPLANNING_CYCLE_LIMIT\n];\nconst STRING_ENV_KEYS = [\n    MIDSCENE_MODEL_MAX_TOKENS,\n    OPENAI_MAX_TOKENS,\n    MIDSCENE_ADB_PATH,\n    MIDSCENE_ADB_REMOTE_HOST,\n    MIDSCENE_ADB_REMOTE_PORT,\n    MIDSCENE_ANDROID_IME_STRATEGY,\n    MIDSCENE_IOS_DEVICE_UDID,\n    MIDSCENE_IOS_SIMULATOR_UDID,\n    MIDSCENE_REPORT_TAG_NAME,\n    MIDSCENE_PREFERRED_LANGUAGE,\n    MATCH_BY_POSITION,\n    MIDSCENE_MCP_CHROME_PATH,\n    DOCKER_CONTAINER\n];\nconst GLOBAL_ENV_KEYS = [\n    ...BOOLEAN_ENV_KEYS,\n    ...NUMBER_ENV_KEYS,\n    ...STRING_ENV_KEYS\n];\nconst MODEL_ENV_KEYS = [\n    MIDSCENE_MODEL_NAME,\n    MIDSCENE_MODEL_INIT_CONFIG_JSON,\n    MIDSCENE_MODEL_API_KEY,\n    MIDSCENE_MODEL_BASE_URL,\n    MIDSCENE_MODEL_SOCKS_PROXY,\n    MIDSCENE_MODEL_HTTP_PROXY,\n    MIDSCENE_MODEL_TIMEOUT,\n    MIDSCENE_MODEL_TEMPERATURE,\n    MIDSCENE_USE_VLM_UI_TARS,\n    MIDSCENE_USE_QWEN_VL,\n    MIDSCENE_USE_QWEN3_VL,\n    MIDSCENE_USE_DOUBAO_VISION,\n    MIDSCENE_USE_GEMINI,\n    MIDSCENE_USE_VL_MODEL,\n    OPENAI_API_KEY,\n    OPENAI_BASE_URL,\n    MIDSCENE_OPENAI_INIT_CONFIG_JSON,\n    MIDSCENE_OPENAI_HTTP_PROXY,\n    MIDSCENE_OPENAI_SOCKS_PROXY,\n    MIDSCENE_INSIGHT_MODEL_NAME,\n    MIDSCENE_INSIGHT_MODEL_SOCKS_PROXY,\n    MIDSCENE_INSIGHT_MODEL_HTTP_PROXY,\n    MIDSCENE_INSIGHT_MODEL_BASE_URL,\n    MIDSCENE_INSIGHT_MODEL_API_KEY,\n    MIDSCENE_INSIGHT_MODEL_INIT_CONFIG_JSON,\n    MIDSCENE_INSIGHT_MODEL_TIMEOUT,\n    MIDSCENE_INSIGHT_MODEL_TEMPERATURE,\n    MIDSCENE_PLANNING_MODEL_NAME,\n    MIDSCENE_PLANNING_MODEL_SOCKS_PROXY,\n    MIDSCENE_PLANNING_MODEL_HTTP_PROXY,\n    MIDSCENE_PLANNING_MODEL_BASE_URL,\n    MIDSCENE_PLANNING_MODEL_API_KEY,\n    MIDSCENE_PLANNING_MODEL_INIT_CONFIG_JSON,\n    MIDSCENE_PLANNING_MODEL_TIMEOUT,\n    MIDSCENE_PLANNING_MODEL_TEMPERATURE,\n    MIDSCENE_MODEL_FAMILY\n];\nconst ALL_ENV_KEYS = [\n    ...UNUSED_ENV_KEYS,\n    ...BASIC_ENV_KEYS,\n    ...GLOBAL_ENV_KEYS,\n    ...MODEL_ENV_KEYS\n];\nconst VL_MODE_RAW_VALID_VALUES = [\n    'doubao-vision',\n    'gemini',\n    'qwen2.5-vl',\n    'qwen3-vl',\n    'vlm-ui-tars',\n    'vlm-ui-tars-doubao',\n    'vlm-ui-tars-doubao-1.5'\n];\nconst MODEL_FAMILY_VALUES = [\n    ...VL_MODE_RAW_VALID_VALUES\n];\nvar types_UITarsModelVersion = /*#__PURE__*/ function(UITarsModelVersion) {\n    UITarsModelVersion[\"V1_0\"] = \"1.0\";\n    UITarsModelVersion[\"V1_5\"] = \"1.5\";\n    UITarsModelVersion[\"DOUBAO_1_5_15B\"] = \"doubao-1.5-15B\";\n    UITarsModelVersion[\"DOUBAO_1_5_20B\"] = \"doubao-1.5-20B\";\n    return UITarsModelVersion;\n}({});\nexport { ALL_ENV_KEYS, BASIC_ENV_KEYS, BOOLEAN_ENV_KEYS, DOCKER_CONTAINER, GLOBAL_ENV_KEYS, MATCH_BY_POSITION, MIDSCENE_ADB_PATH, MIDSCENE_ADB_REMOTE_HOST, MIDSCENE_ADB_REMOTE_PORT, MIDSCENE_ANDROID_IME_STRATEGY, MIDSCENE_CACHE, MIDSCENE_CACHE_MAX_FILENAME_LENGTH, MIDSCENE_DANGEROUSLY_PRINT_ALL_CONFIG, MIDSCENE_DEBUG_MODE, MIDSCENE_DEBUG_MODEL_PROFILE, MIDSCENE_DEBUG_MODEL_RESPONSE, MIDSCENE_FORCE_DEEP_THINK, MIDSCENE_INSIGHT_MODEL_API_KEY, MIDSCENE_INSIGHT_MODEL_BASE_URL, MIDSCENE_INSIGHT_MODEL_HTTP_PROXY, MIDSCENE_INSIGHT_MODEL_INIT_CONFIG_JSON, MIDSCENE_INSIGHT_MODEL_NAME, MIDSCENE_INSIGHT_MODEL_SOCKS_PROXY, MIDSCENE_INSIGHT_MODEL_TEMPERATURE, MIDSCENE_INSIGHT_MODEL_TIMEOUT, MIDSCENE_IOS_DEVICE_UDID, MIDSCENE_IOS_SIMULATOR_UDID, MIDSCENE_LANGFUSE_DEBUG, MIDSCENE_LANGSMITH_DEBUG, MIDSCENE_MCP_ANDROID_MODE, MIDSCENE_MCP_CHROME_PATH, MIDSCENE_MCP_USE_PUPPETEER_MODE, MIDSCENE_MODEL_API_KEY, MIDSCENE_MODEL_BASE_URL, MIDSCENE_MODEL_FAMILY, MIDSCENE_MODEL_HTTP_PROXY, MIDSCENE_MODEL_INIT_CONFIG_JSON, MIDSCENE_MODEL_MAX_TOKENS, MIDSCENE_MODEL_NAME, MIDSCENE_MODEL_SOCKS_PROXY, MIDSCENE_MODEL_TEMPERATURE, MIDSCENE_MODEL_TIMEOUT, MIDSCENE_OPENAI_HTTP_PROXY, MIDSCENE_OPENAI_INIT_CONFIG_JSON, MIDSCENE_OPENAI_SOCKS_PROXY, MIDSCENE_PLANNING_MODEL_API_KEY, MIDSCENE_PLANNING_MODEL_BASE_URL, MIDSCENE_PLANNING_MODEL_HTTP_PROXY, MIDSCENE_PLANNING_MODEL_INIT_CONFIG_JSON, MIDSCENE_PLANNING_MODEL_NAME, MIDSCENE_PLANNING_MODEL_SOCKS_PROXY, MIDSCENE_PLANNING_MODEL_TEMPERATURE, MIDSCENE_PLANNING_MODEL_TIMEOUT, MIDSCENE_PREFERRED_LANGUAGE, MIDSCENE_REPLANNING_CYCLE_LIMIT, MIDSCENE_REPORT_TAG_NAME, MIDSCENE_RUN_DIR, MIDSCENE_USE_DOUBAO_VISION, MIDSCENE_USE_GEMINI, MIDSCENE_USE_QWEN3_VL, MIDSCENE_USE_QWEN_VL, MIDSCENE_USE_VLM_UI_TARS, MIDSCENE_USE_VL_MODEL, MODEL_ENV_KEYS, MODEL_FAMILY_VALUES, NUMBER_ENV_KEYS, OPENAI_API_KEY, OPENAI_BASE_URL, OPENAI_MAX_TOKENS, STRING_ENV_KEYS, types_UITarsModelVersion as UITarsModelVersion, UNUSED_ENV_KEYS, VL_MODE_RAW_VALID_VALUES };\n","import { sha256 } from \"js-sha256\";\nimport { v4 } from \"uuid\";\nconst ifInBrowser = 'undefined' != typeof window;\nconst ifInWorker = 'undefined' != typeof WorkerGlobalScope;\nconst ifInNode = 'undefined' != typeof process && process.versions?.node;\nfunction uuid() {\n    return v4();\n}\nconst hashMap = {};\nfunction generateHashId(rect, content = '') {\n    const combined = JSON.stringify({\n        content,\n        rect\n    });\n    let sliceLength = 5;\n    let slicedHash = '';\n    const hashHex = sha256.create().update(combined).hex();\n    const toLetters = (hex)=>hex.split('').map((char)=>{\n            const code = Number.parseInt(char, 16);\n            return String.fromCharCode(97 + code % 26);\n        }).join('');\n    const hashLetters = toLetters(hashHex);\n    while(sliceLength < hashLetters.length - 1){\n        slicedHash = hashLetters.slice(0, sliceLength);\n        if (hashMap[slicedHash] && hashMap[slicedHash] !== combined) {\n            sliceLength++;\n            continue;\n        }\n        hashMap[slicedHash] = combined;\n        break;\n    }\n    return slicedHash;\n}\nfunction assert(condition, message) {\n    if (!condition) throw new Error(message || 'Assertion failed');\n}\nfunction getGlobalScope() {\n    if ('undefined' != typeof window) return window;\n    if ('undefined' != typeof globalThis) return globalThis;\n    if ('undefined' != typeof self) return self;\n}\nlet isMcp = false;\nfunction setIsMcp(value) {\n    isMcp = value;\n}\nfunction logMsg(...message) {\n    if (!isMcp) console.log(...message);\n}\nasync function repeat(times, fn) {\n    for(let i = 0; i < times; i++)await fn(i);\n}\nconst utils_REGEXP_LT = /</g;\nconst utils_REGEXP_GT = />/g;\nconst REGEXP_LT_ESCAPE = '__midscene_lt__';\nconst REGEXP_GT_ESCAPE = '__midscene_gt__';\nconst escapeScriptTag = (html)=>html.replace(utils_REGEXP_LT, REGEXP_LT_ESCAPE).replace(utils_REGEXP_GT, REGEXP_GT_ESCAPE);\nconst antiEscapeScriptTag = (html)=>{\n    const REGEXP_LT = new RegExp(REGEXP_LT_ESCAPE, 'g');\n    const REGEXP_GT = new RegExp(REGEXP_GT_ESCAPE, 'g');\n    return html.replace(REGEXP_LT, '<').replace(REGEXP_GT, '>');\n};\nfunction replaceIllegalPathCharsAndSpace(str) {\n    return str.replace(/[:*?\"<>|# ]/g, '-');\n}\nexport { antiEscapeScriptTag, assert, escapeScriptTag, generateHashId, getGlobalScope, ifInBrowser, ifInNode, ifInWorker, logMsg, repeat, replaceIllegalPathCharsAndSpace, setIsMcp, uuid };\n","import { BASIC_ENV_KEYS } from \"./types.mjs\";\nconst getBasicEnvValue = (key)=>{\n    if (!BASIC_ENV_KEYS.includes(key)) throw new Error(`getBasicEnvValue with key ${key} is not supported.`);\n    return process.env[key];\n};\nexport { getBasicEnvValue };\n","import { existsSync, mkdirSync } from \"node:fs\";\nimport { tmpdir } from \"node:os\";\nimport node_path from \"node:path\";\nimport { getBasicEnvValue } from \"./env/basic.mjs\";\nimport { MIDSCENE_RUN_DIR } from \"./env/types.mjs\";\nimport { ifInNode } from \"./utils.mjs\";\nconst defaultRunDirName = 'midscene_run';\nconst getMidsceneRunDir = ()=>{\n    if (!ifInNode) return '';\n    return getBasicEnvValue(MIDSCENE_RUN_DIR) || defaultRunDirName;\n};\nconst getMidsceneRunBaseDir = ()=>{\n    if (!ifInNode) return '';\n    let basePath = node_path.resolve(process.cwd(), getMidsceneRunDir());\n    if (!existsSync(basePath)) try {\n        mkdirSync(basePath, {\n            recursive: true\n        });\n    } catch (error) {\n        basePath = node_path.join(tmpdir(), defaultRunDirName);\n        mkdirSync(basePath, {\n            recursive: true\n        });\n    }\n    return basePath;\n};\nconst getMidsceneRunSubDir = (subdir)=>{\n    if (!ifInNode) return '';\n    const basePath = getMidsceneRunBaseDir();\n    const logPath = node_path.join(basePath, subdir);\n    if (!existsSync(logPath)) mkdirSync(logPath, {\n        recursive: true\n    });\n    return logPath;\n};\nconst ERROR_CODE_NOT_IMPLEMENTED_AS_DESIGNED = 'NOT_IMPLEMENTED_AS_DESIGNED';\nexport { ERROR_CODE_NOT_IMPLEMENTED_AS_DESIGNED, defaultRunDirName, getMidsceneRunBaseDir, getMidsceneRunDir, getMidsceneRunSubDir };\n","import node_fs from \"node:fs\";\nimport node_path from \"node:path\";\nimport node_util from \"node:util\";\nimport debug from \"debug\";\nimport { getMidsceneRunSubDir } from \"./common.mjs\";\nimport { ifInNode } from \"./utils.mjs\";\nconst topicPrefix = 'midscene';\nconst logStreams = new Map();\nconst debugInstances = new Map();\nfunction getLogStream(topic) {\n    const topicFileName = topic.replace(/:/g, '-');\n    if (!logStreams.has(topicFileName)) {\n        const logFile = node_path.join(getMidsceneRunSubDir('log'), `${topicFileName}.log`);\n        const stream = node_fs.createWriteStream(logFile, {\n            flags: 'a'\n        });\n        logStreams.set(topicFileName, stream);\n    }\n    return logStreams.get(topicFileName);\n}\nfunction writeLogToFile(topic, message) {\n    if (!ifInNode) return;\n    const stream = getLogStream(topic);\n    const now = new Date();\n    const isoDate = now.toLocaleDateString('sv-SE');\n    const isoTime = now.toLocaleTimeString('sv-SE');\n    const milliseconds = now.getMilliseconds().toString().padStart(3, '0');\n    const timezoneOffsetMinutes = now.getTimezoneOffset();\n    const sign = timezoneOffsetMinutes <= 0 ? '+' : '-';\n    const hours = Math.floor(Math.abs(timezoneOffsetMinutes) / 60).toString().padStart(2, '0');\n    const minutes = (Math.abs(timezoneOffsetMinutes) % 60).toString().padStart(2, '0');\n    const timezoneString = `${sign}${hours}:${minutes}`;\n    const localISOTime = `${isoDate}T${isoTime}.${milliseconds}${timezoneString}`;\n    stream.write(`[${localISOTime}] ${message}\\n`);\n}\nfunction getDebug(topic) {\n    const fullTopic = `${topicPrefix}:${topic}`;\n    if (!debugInstances.has(fullTopic)) {\n        const debugFn = debug(fullTopic);\n        const wrapper = (...args)=>{\n            if (ifInNode) {\n                const message = node_util.format(...args);\n                writeLogToFile(topic, message);\n            }\n            debugFn(...args);\n        };\n        debugInstances.set(fullTopic, wrapper);\n    }\n    return debugInstances.get(fullTopic);\n}\nfunction enableDebug(topic) {\n    if (ifInNode) return;\n    debug.enable(`${topicPrefix}:${topic}`);\n}\nfunction cleanupLogStreams() {\n    if (!ifInNode) return;\n    for (const stream of logStreams.values())stream.end();\n    logStreams.clear();\n    debugInstances.clear();\n}\nexport { cleanupLogStreams, enableDebug, getDebug };\n","import { enableDebug } from \"../logger.mjs\";\nimport { getBasicEnvValue } from \"./basic.mjs\";\nimport { MIDSCENE_DEBUG_MODEL_PROFILE, MIDSCENE_DEBUG_MODEL_RESPONSE } from \"./types.mjs\";\nconst initDebugConfig = ()=>{\n    const shouldPrintTiming = getBasicEnvValue(MIDSCENE_DEBUG_MODEL_PROFILE);\n    let debugConfig = '';\n    if (shouldPrintTiming) {\n        console.warn('MIDSCENE_DEBUG_MODEL_PROFILE is deprecated, use DEBUG=midscene:ai:profile instead');\n        debugConfig = 'ai:profile';\n    }\n    const shouldPrintModelResponse = getBasicEnvValue(MIDSCENE_DEBUG_MODEL_RESPONSE);\n    if (shouldPrintModelResponse) {\n        console.warn('MIDSCENE_DEBUG_MODEL_RESPONSE is deprecated, use DEBUG=midscene:ai:response instead');\n        debugConfig = debugConfig ? 'ai:*' : 'ai:call';\n    }\n    if (debugConfig) enableDebug(debugConfig);\n};\nexport { initDebugConfig };\n","import { initDebugConfig } from \"./init-debug.mjs\";\nimport { ALL_ENV_KEYS, BOOLEAN_ENV_KEYS, GLOBAL_ENV_KEYS, MATCH_BY_POSITION, MODEL_ENV_KEYS, NUMBER_ENV_KEYS, STRING_ENV_KEYS } from \"./types.mjs\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nclass GlobalConfigManager {\n    getAllEnvConfig() {\n        const envConfig = ALL_ENV_KEYS.reduce((p, name)=>{\n            p[name] = process.env[name];\n            return p;\n        }, Object.create(null));\n        if (!this.override) return envConfig;\n        {\n            const { newConfig, extendMode } = this.override;\n            if (extendMode) return {\n                ...envConfig,\n                ...newConfig\n            };\n            return {\n                ...newConfig\n            };\n        }\n    }\n    getEnvConfigValue(key) {\n        const allConfig = this.getAllEnvConfig();\n        if (key === MATCH_BY_POSITION) throw new Error('MATCH_BY_POSITION is discarded, use MIDSCENE_MODEL_FAMILY instead');\n        if (!STRING_ENV_KEYS.includes(key)) throw new Error(`getEnvConfigValue with key ${key} is not supported.`);\n        const value = allConfig[key];\n        this.keysHaveBeenRead[key] = true;\n        if ('string' == typeof value) return value.trim();\n        return value;\n    }\n    getEnvConfigInNumber(key) {\n        const allConfig = this.getAllEnvConfig();\n        if (!NUMBER_ENV_KEYS.includes(key)) throw new Error(`getEnvConfigInNumber with key ${key} is not supported`);\n        const value = allConfig[key];\n        this.keysHaveBeenRead[key] = true;\n        return Number(value || '');\n    }\n    getEnvConfigInBoolean(key) {\n        const allConfig = this.getAllEnvConfig();\n        if (!BOOLEAN_ENV_KEYS.includes(key)) throw new Error(`getEnvConfigInBoolean with key ${key} is not supported`);\n        const value = allConfig[key];\n        this.keysHaveBeenRead[key] = true;\n        if (!value) return false;\n        if (/^(true|1)$/i.test(value)) return true;\n        if (/^(false|0)$/i.test(value)) return false;\n        return !!value.trim();\n    }\n    registerModelConfigManager(globalModelConfigManager) {\n        this.globalModelConfigManager = globalModelConfigManager;\n    }\n    overrideAIConfig(newConfig, extendMode = false) {\n        for(const key in newConfig){\n            if (![\n                ...GLOBAL_ENV_KEYS,\n                ...MODEL_ENV_KEYS\n            ].includes(key)) throw new Error(`Failed to override AI config, invalid key: ${key}`);\n            const value = newConfig[key];\n            if ('string' != typeof value) throw new Error(`Failed to override AI config, value for key ${key} must be a string, but got with type ${typeof value}`);\n            if (this.keysHaveBeenRead[key]) console.warn(`Warning: try to override AI config with key ${key} ,but it has been read.`);\n        }\n        const savedNewConfig = extendMode ? {\n            ...this.override?.newConfig,\n            ...newConfig\n        } : newConfig;\n        this.override = {\n            newConfig: {\n                ...savedNewConfig\n            },\n            extendMode\n        };\n        if (!this.globalModelConfigManager) throw new Error('globalModelConfigManager is not registered, which should not happen');\n        this.globalModelConfigManager.clearModelConfigMap();\n    }\n    constructor(){\n        _define_property(this, \"override\", void 0);\n        _define_property(this, \"keysHaveBeenRead\", {});\n        _define_property(this, \"globalModelConfigManager\", void 0);\n        initDebugConfig();\n    }\n}\nexport { GlobalConfigManager };\n","const maskKey = (key, maskChar = '*')=>{\n    if ('string' != typeof key || 0 === key.length) return key;\n    const prefixLen = 3;\n    const suffixLen = 3;\n    const keepLength = prefixLen + suffixLen;\n    if (key.length <= keepLength) return key;\n    const prefix = key.substring(0, prefixLen);\n    const suffix = key.substring(key.length - suffixLen);\n    const maskLength = key.length - keepLength;\n    const mask = maskChar.repeat(maskLength);\n    return `${prefix}${mask}${suffix}`;\n};\nconst maskConfig = (config)=>Object.fromEntries(Object.entries(config).map(([key, value])=>{\n        if (!value) return [\n            key,\n            value\n        ];\n        if ('string' == typeof value && /key/i.test(key)) return [\n            key,\n            maskKey(value)\n        ];\n        if ('object' == typeof value) {\n            const valueStr = JSON.stringify(value);\n            if (/key/i.test(valueStr)) return [\n                key,\n                maskKey(valueStr)\n            ];\n        }\n        return [\n            key,\n            value\n        ];\n    }));\nconst parseJson = (key, value)=>{\n    if (value) try {\n        return JSON.parse(value);\n    } catch (e) {\n        throw new Error(`Failed to parse ${key} as a JSON. ${e.message}`, {\n            cause: e\n        });\n    }\n};\nexport { maskConfig, parseJson };\n","import { DEFAULT_MODEL_CONFIG_KEYS, INSIGHT_MODEL_CONFIG_KEYS, PLANNING_MODEL_CONFIG_KEYS } from \"./constants.mjs\";\nimport { MIDSCENE_OPENAI_HTTP_PROXY, MIDSCENE_OPENAI_INIT_CONFIG_JSON, MIDSCENE_OPENAI_SOCKS_PROXY, MIDSCENE_USE_DOUBAO_VISION, MIDSCENE_USE_GEMINI, MIDSCENE_USE_QWEN3_VL, MIDSCENE_USE_QWEN_VL, MIDSCENE_USE_VLM_UI_TARS, MODEL_FAMILY_VALUES, OPENAI_API_KEY, OPENAI_BASE_URL, UITarsModelVersion } from \"./types.mjs\";\nimport { getDebug } from \"../logger.mjs\";\nimport { assert } from \"../utils.mjs\";\nimport { maskConfig, parseJson } from \"./helper.mjs\";\nimport { initDebugConfig } from \"./init-debug.mjs\";\nconst KEYS_MAP = {\n    insight: INSIGHT_MODEL_CONFIG_KEYS,\n    planning: PLANNING_MODEL_CONFIG_KEYS,\n    default: DEFAULT_MODEL_CONFIG_KEYS\n};\nconst modelFamilyToVLConfig = (modelFamily)=>{\n    if (!modelFamily) return {\n        vlMode: void 0,\n        uiTarsVersion: void 0\n    };\n    if ('vlm-ui-tars' === modelFamily) return {\n        vlMode: 'vlm-ui-tars',\n        uiTarsVersion: UITarsModelVersion.V1_0\n    };\n    if ('vlm-ui-tars-doubao' === modelFamily || 'vlm-ui-tars-doubao-1.5' === modelFamily) return {\n        vlMode: 'vlm-ui-tars',\n        uiTarsVersion: UITarsModelVersion.DOUBAO_1_5_20B\n    };\n    if (!MODEL_FAMILY_VALUES.includes(modelFamily)) throw new Error(`Invalid MIDSCENE_MODEL_FAMILY value: ${modelFamily}`);\n    return {\n        vlMode: modelFamily,\n        uiTarsVersion: void 0\n    };\n};\nconst legacyConfigToModelFamily = (provider)=>{\n    const isDoubao = provider[MIDSCENE_USE_DOUBAO_VISION];\n    const isQwen = provider[MIDSCENE_USE_QWEN_VL];\n    const isQwen3 = provider[MIDSCENE_USE_QWEN3_VL];\n    const isUiTars = provider[MIDSCENE_USE_VLM_UI_TARS];\n    const isGemini = provider[MIDSCENE_USE_GEMINI];\n    const enabledModes = [\n        isDoubao && MIDSCENE_USE_DOUBAO_VISION,\n        isQwen && MIDSCENE_USE_QWEN_VL,\n        isQwen3 && MIDSCENE_USE_QWEN3_VL,\n        isUiTars && MIDSCENE_USE_VLM_UI_TARS,\n        isGemini && MIDSCENE_USE_GEMINI\n    ].filter(Boolean);\n    if (enabledModes.length > 1) throw new Error(`Only one vision mode can be enabled at a time. Currently enabled modes: ${enabledModes.join(', ')}. Please disable all but one mode.`);\n    if (isQwen3) return 'qwen3-vl';\n    if (isQwen) return 'qwen2.5-vl';\n    if (isDoubao) return 'doubao-vision';\n    if (isGemini) return 'gemini';\n    if (isUiTars) if ('1' === isUiTars) return 'vlm-ui-tars';\n    else if ('DOUBAO' === isUiTars || 'DOUBAO-1.5' === isUiTars) return 'vlm-ui-tars-doubao-1.5';\n    else return 'vlm-ui-tars-doubao';\n};\nconst parseOpenaiSdkConfig = ({ keys, provider, useLegacyLogic = false })=>{\n    initDebugConfig();\n    const debugLog = getDebug('ai:config');\n    debugLog('enter parseOpenaiSdkConfig with keys:', keys);\n    const legacyAPIKey = useLegacyLogic ? provider[OPENAI_API_KEY] : void 0;\n    const legacyBaseURL = useLegacyLogic ? provider[OPENAI_BASE_URL] : void 0;\n    const legacySocksProxy = useLegacyLogic ? provider[MIDSCENE_OPENAI_SOCKS_PROXY] : void 0;\n    const legacyHttpProxy = useLegacyLogic ? provider[MIDSCENE_OPENAI_HTTP_PROXY] : void 0;\n    const legacyOpenaiExtraConfig = useLegacyLogic ? provider[MIDSCENE_OPENAI_INIT_CONFIG_JSON] : void 0;\n    const legacyModelFamily = useLegacyLogic ? legacyConfigToModelFamily(provider) : void 0;\n    const modelFamilyRaw = provider[keys.modelFamily] || legacyModelFamily;\n    const openaiApiKey = provider[keys.openaiApiKey] || legacyAPIKey;\n    const openaiBaseURL = provider[keys.openaiBaseURL] || legacyBaseURL;\n    const socksProxy = provider[keys.socksProxy] || legacySocksProxy;\n    const httpProxy = provider[keys.httpProxy] || legacyHttpProxy;\n    const modelName = provider[keys.modelName];\n    const openaiExtraConfigStr = provider[keys.openaiExtraConfig];\n    const openaiExtraConfig = parseJson(keys.openaiExtraConfig, openaiExtraConfigStr || legacyOpenaiExtraConfig);\n    const temperature = provider[keys.temperature] ? Number(provider[keys.temperature]) : 0;\n    const { vlMode, uiTarsVersion } = modelFamilyToVLConfig(modelFamilyRaw);\n    const getModelDescription = (vlMode, uiTarsVersion)=>{\n        if (vlMode) if (uiTarsVersion) return `UI-TARS=${uiTarsVersion}`;\n        else return `${vlMode} mode`;\n        return '';\n    };\n    const modelDescription = getModelDescription(vlMode, uiTarsVersion);\n    return {\n        socksProxy,\n        httpProxy,\n        vlModeRaw: vlMode,\n        openaiBaseURL,\n        openaiApiKey,\n        openaiExtraConfig,\n        vlMode,\n        uiTarsModelVersion: uiTarsVersion,\n        modelName: modelName,\n        modelDescription,\n        intent: '-',\n        timeout: provider[keys.timeout] ? Number(provider[keys.timeout]) : void 0,\n        temperature\n    };\n};\nconst decideModelConfigFromIntentConfig = (intent, configMap)=>{\n    const debugLog = getDebug('ai:config');\n    debugLog('will decideModelConfig base on agent.modelConfig()', intent, maskConfig(configMap));\n    const keysForFn = KEYS_MAP[intent];\n    const modelName = configMap[keysForFn.modelName];\n    if (!modelName) return void debugLog('no modelName found for intent', intent);\n    const finalResult = parseOpenaiSdkConfig({\n        keys: keysForFn,\n        provider: configMap,\n        useLegacyLogic: 'default' === intent\n    });\n    finalResult.intent = intent;\n    debugLog('decideModelConfig result by agent.modelConfig() with intent', intent, maskConfig({\n        ...finalResult\n    }));\n    assert(finalResult.openaiBaseURL, `failed to get base URL of model (intent=${intent}). See https://midscenejs.com/model-strategy`);\n    if (!finalResult.modelName) console.warn(`modelName is not set for intent ${intent}, this may cause unexpected behavior. See https://midscenejs.com/model-strategy`);\n    return finalResult;\n};\nexport { decideModelConfigFromIntentConfig, legacyConfigToModelFamily, modelFamilyToVLConfig, parseOpenaiSdkConfig };\n","import { MIDSCENE_INSIGHT_MODEL_API_KEY, MIDSCENE_INSIGHT_MODEL_BASE_URL, MIDSCENE_INSIGHT_MODEL_HTTP_PROXY, MIDSCENE_INSIGHT_MODEL_INIT_CONFIG_JSON, MIDSCENE_INSIGHT_MODEL_NAME, MIDSCENE_INSIGHT_MODEL_SOCKS_PROXY, MIDSCENE_INSIGHT_MODEL_TEMPERATURE, MIDSCENE_INSIGHT_MODEL_TIMEOUT, MIDSCENE_MODEL_API_KEY, MIDSCENE_MODEL_BASE_URL, MIDSCENE_MODEL_FAMILY, MIDSCENE_MODEL_HTTP_PROXY, MIDSCENE_MODEL_INIT_CONFIG_JSON, MIDSCENE_MODEL_NAME, MIDSCENE_MODEL_SOCKS_PROXY, MIDSCENE_MODEL_TEMPERATURE, MIDSCENE_MODEL_TIMEOUT, MIDSCENE_OPENAI_HTTP_PROXY, MIDSCENE_OPENAI_INIT_CONFIG_JSON, MIDSCENE_OPENAI_SOCKS_PROXY, MIDSCENE_PLANNING_MODEL_API_KEY, MIDSCENE_PLANNING_MODEL_BASE_URL, MIDSCENE_PLANNING_MODEL_HTTP_PROXY, MIDSCENE_PLANNING_MODEL_INIT_CONFIG_JSON, MIDSCENE_PLANNING_MODEL_NAME, MIDSCENE_PLANNING_MODEL_SOCKS_PROXY, MIDSCENE_PLANNING_MODEL_TEMPERATURE, MIDSCENE_PLANNING_MODEL_TIMEOUT, OPENAI_API_KEY, OPENAI_BASE_URL } from \"./types.mjs\";\nconst INSIGHT_MODEL_CONFIG_KEYS = {\n    modelName: MIDSCENE_INSIGHT_MODEL_NAME,\n    socksProxy: MIDSCENE_INSIGHT_MODEL_SOCKS_PROXY,\n    httpProxy: MIDSCENE_INSIGHT_MODEL_HTTP_PROXY,\n    openaiBaseURL: MIDSCENE_INSIGHT_MODEL_BASE_URL,\n    openaiApiKey: MIDSCENE_INSIGHT_MODEL_API_KEY,\n    openaiExtraConfig: MIDSCENE_INSIGHT_MODEL_INIT_CONFIG_JSON,\n    modelFamily: 'THERE_IS_NO_MODEL_FAMILY_FOR_INSIGHT',\n    timeout: MIDSCENE_INSIGHT_MODEL_TIMEOUT,\n    temperature: MIDSCENE_INSIGHT_MODEL_TEMPERATURE\n};\nconst PLANNING_MODEL_CONFIG_KEYS = {\n    modelName: MIDSCENE_PLANNING_MODEL_NAME,\n    socksProxy: MIDSCENE_PLANNING_MODEL_SOCKS_PROXY,\n    httpProxy: MIDSCENE_PLANNING_MODEL_HTTP_PROXY,\n    openaiBaseURL: MIDSCENE_PLANNING_MODEL_BASE_URL,\n    openaiApiKey: MIDSCENE_PLANNING_MODEL_API_KEY,\n    openaiExtraConfig: MIDSCENE_PLANNING_MODEL_INIT_CONFIG_JSON,\n    modelFamily: 'THERE_IS_NO_MODEL_FAMILY_FOR_PLANNING',\n    timeout: MIDSCENE_PLANNING_MODEL_TIMEOUT,\n    temperature: MIDSCENE_PLANNING_MODEL_TEMPERATURE\n};\nconst DEFAULT_MODEL_CONFIG_KEYS = {\n    modelName: MIDSCENE_MODEL_NAME,\n    socksProxy: MIDSCENE_MODEL_SOCKS_PROXY,\n    httpProxy: MIDSCENE_MODEL_HTTP_PROXY,\n    openaiBaseURL: MIDSCENE_MODEL_BASE_URL,\n    openaiApiKey: MIDSCENE_MODEL_API_KEY,\n    openaiExtraConfig: MIDSCENE_MODEL_INIT_CONFIG_JSON,\n    modelFamily: MIDSCENE_MODEL_FAMILY,\n    timeout: MIDSCENE_MODEL_TIMEOUT,\n    temperature: MIDSCENE_MODEL_TEMPERATURE\n};\nconst DEFAULT_MODEL_CONFIG_KEYS_LEGACY = {\n    modelName: MIDSCENE_MODEL_NAME,\n    socksProxy: MIDSCENE_OPENAI_SOCKS_PROXY,\n    httpProxy: MIDSCENE_OPENAI_HTTP_PROXY,\n    openaiBaseURL: OPENAI_BASE_URL,\n    openaiApiKey: OPENAI_API_KEY,\n    openaiExtraConfig: MIDSCENE_OPENAI_INIT_CONFIG_JSON,\n    modelFamily: 'DEFAULT_MODEL_CONFIG_KEYS has no modelFamily key',\n    timeout: MIDSCENE_MODEL_TIMEOUT,\n    temperature: MIDSCENE_MODEL_TEMPERATURE\n};\nexport { DEFAULT_MODEL_CONFIG_KEYS, DEFAULT_MODEL_CONFIG_KEYS_LEGACY, INSIGHT_MODEL_CONFIG_KEYS, PLANNING_MODEL_CONFIG_KEYS };\n","import { decideModelConfigFromIntentConfig } from \"./parse-model-config.mjs\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nclass ModelConfigManager {\n    initialize() {\n        if (this.isInitialized) return;\n        let configMap;\n        if (this.modelConfig) {\n            this.isolatedMode = true;\n            configMap = this.normalizeModelConfig(this.modelConfig);\n        } else configMap = this.globalConfigManager?.getAllEnvConfig() || {};\n        const defaultConfig = decideModelConfigFromIntentConfig('default', configMap);\n        if (!defaultConfig) throw new Error('default model config is not found, which should not happen');\n        const insightConfig = decideModelConfigFromIntentConfig('insight', configMap);\n        const planningConfig = decideModelConfigFromIntentConfig('planning', configMap);\n        this.modelConfigMap = {\n            default: {\n                ...defaultConfig,\n                createOpenAIClient: this.createOpenAIClientFn\n            },\n            insight: {\n                ...insightConfig || defaultConfig,\n                createOpenAIClient: this.createOpenAIClientFn\n            },\n            planning: {\n                ...planningConfig || defaultConfig,\n                createOpenAIClient: this.createOpenAIClientFn\n            }\n        };\n        this.isInitialized = true;\n    }\n    normalizeModelConfig(config) {\n        return Object.entries(config).reduce((acc, [key, value])=>{\n            if (null == value) return acc;\n            acc[key] = String(value);\n            return acc;\n        }, Object.create(null));\n    }\n    clearModelConfigMap() {\n        if (this.isolatedMode) throw new Error('ModelConfigManager work in isolated mode, so clearModelConfigMap should not be called');\n        this.isInitialized = false;\n    }\n    getModelConfig(intent) {\n        if (!this.isInitialized) this.initialize();\n        if (!this.modelConfigMap) throw new Error('modelConfigMap is not initialized, which should not happen');\n        return this.modelConfigMap[intent];\n    }\n    getUploadTestServerUrl() {\n        const { openaiExtraConfig } = this.getModelConfig('default');\n        const serverUrl = openaiExtraConfig?.REPORT_SERVER_URL;\n        return serverUrl;\n    }\n    registerGlobalConfigManager(globalConfigManager) {\n        this.globalConfigManager = globalConfigManager;\n    }\n    throwErrorIfNonVLModel() {\n        const modelConfig = this.getModelConfig('default');\n        if (!modelConfig.vlMode) throw new Error('MIDSCENE_MODEL_FAMILY is not set to a visual language model (VL model), the element localization can not be achieved. Check your model configuration. See https://midscenejs.com/model-strategy.html');\n    }\n    constructor(modelConfig, createOpenAIClientFn){\n        _define_property(this, \"modelConfigMap\", void 0);\n        _define_property(this, \"isInitialized\", false);\n        _define_property(this, \"isolatedMode\", false);\n        _define_property(this, \"globalConfigManager\", void 0);\n        _define_property(this, \"modelConfig\", void 0);\n        _define_property(this, \"createOpenAIClientFn\", void 0);\n        this.modelConfig = modelConfig;\n        this.createOpenAIClientFn = createOpenAIClientFn;\n    }\n}\nexport { ModelConfigManager };\n","import { GlobalConfigManager } from \"./global-config-manager.mjs\";\nimport { ModelConfigManager } from \"./model-config-manager.mjs\";\nimport { MIDSCENE_PREFERRED_LANGUAGE } from \"./types.mjs\";\nconst globalModelConfigManager = new ModelConfigManager();\nconst globalConfigManager = new GlobalConfigManager();\nglobalConfigManager.registerModelConfigManager(globalModelConfigManager);\nglobalModelConfigManager.registerGlobalConfigManager(globalConfigManager);\nconst getPreferredLanguage = ()=>{\n    const prefer = globalConfigManager.getEnvConfigValue(MIDSCENE_PREFERRED_LANGUAGE);\n    if (prefer) return prefer;\n    const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n    const isChina = 'Asia/Shanghai' === timeZone;\n    return isChina ? 'Chinese' : 'English';\n};\nconst overrideAIConfig = (newConfig, extendMode = false)=>{\n    globalConfigManager.overrideAIConfig(newConfig, extendMode);\n};\nexport { getPreferredLanguage, globalConfigManager, globalModelConfigManager, overrideAIConfig };\n","import node_assert from \"node:assert\";\nimport { Buffer } from \"node:buffer\";\nimport { readFileSync } from \"node:fs\";\nimport node_path from \"node:path\";\nimport { getDebug } from \"../logger.mjs\";\nimport { ifInNode } from \"../utils.mjs\";\nimport get_jimp from \"./get-jimp.mjs\";\nimport get_photon from \"./get-photon.mjs\";\nimport get_sharp from \"./get-sharp.mjs\";\nconst imgDebug = getDebug('img');\nasync function saveBase64Image(options) {\n    const { base64Data, outputPath } = options;\n    const { body } = parseBase64(base64Data);\n    const imageBuffer = Buffer.from(body, 'base64');\n    const Jimp = await get_jimp();\n    const image = await Jimp.read(imageBuffer);\n    await image.writeAsync(outputPath);\n}\nasync function resizeAndConvertImgBuffer(inputFormat, inputData, newSize) {\n    if ('string' == typeof inputData) throw Error('inputData is base64, use resizeImgBase64 instead');\n    node_assert(newSize && newSize.width > 0 && newSize.height > 0, 'newSize must be positive');\n    const resizeStartTime = Date.now();\n    imgDebug(`resizeImg start, target size: ${newSize.width}x${newSize.height}`);\n    if (ifInNode) try {\n        const Sharp = await get_sharp();\n        const metadata = await Sharp(inputData).metadata();\n        const { width: originalWidth, height: originalHeight } = metadata;\n        if (!originalWidth || !originalHeight) throw Error('Undefined width or height from the input image.');\n        if (newSize.width === originalWidth && newSize.height === originalHeight) return {\n            buffer: inputData,\n            format: inputFormat\n        };\n        const resizedBuffer = await Sharp(inputData).resize(newSize.width, newSize.height).jpeg({\n            quality: 90\n        }).toBuffer();\n        const resizeEndTime = Date.now();\n        imgDebug(`resizeImg done (Sharp), target size: ${newSize.width}x${newSize.height}, cost: ${resizeEndTime - resizeStartTime}ms`);\n        return {\n            buffer: resizedBuffer,\n            format: 'jpeg'\n        };\n    } catch (error) {\n        imgDebug('Sharp failed, falling back to Photon:', error);\n    }\n    const { PhotonImage, SamplingFilter, resize } = await get_photon();\n    const inputBytes = new Uint8Array(inputData);\n    const inputImage = PhotonImage.new_from_byteslice(inputBytes);\n    const originalWidth = inputImage.get_width();\n    const originalHeight = inputImage.get_height();\n    if (!originalWidth || !originalHeight) {\n        inputImage.free();\n        throw Error('Undefined width or height from the input image.');\n    }\n    if (newSize.width === originalWidth && newSize.height === originalHeight) {\n        inputImage.free();\n        return {\n            buffer: inputData,\n            format: inputFormat\n        };\n    }\n    const outputImage = resize(inputImage, newSize.width, newSize.height, SamplingFilter.CatmullRom);\n    const outputBytes = outputImage.get_bytes_jpeg(90);\n    const resizedBuffer = Buffer.from(outputBytes);\n    inputImage.free();\n    outputImage.free();\n    const resizeEndTime = Date.now();\n    imgDebug(`resizeImg done (Photon), target size: ${newSize.width}x${newSize.height}, cost: ${resizeEndTime - resizeStartTime}ms`);\n    return {\n        buffer: resizedBuffer,\n        format: 'jpeg'\n    };\n}\nconst createImgBase64ByFormat = (format, body)=>`data:image/${format};base64,${body}`;\nasync function resizeImgBase64(inputBase64, newSize) {\n    const { body, mimeType } = parseBase64(inputBase64);\n    const imageBuffer = Buffer.from(body, 'base64');\n    const { buffer, format } = await resizeAndConvertImgBuffer(mimeType.split('/')[1], imageBuffer, newSize);\n    return createImgBase64ByFormat(format, buffer.toString('base64'));\n}\nfunction zoomForGPT4o(originalWidth, originalHeight) {\n    const maxWidth = 2048;\n    const maxHeight = 768;\n    let newWidth = originalWidth;\n    let newHeight = originalHeight;\n    const aspectRatio = originalWidth / originalHeight;\n    if (originalWidth > maxWidth) {\n        newWidth = maxWidth;\n        newHeight = newWidth / aspectRatio;\n    }\n    if (newHeight > maxHeight) {\n        newHeight = maxHeight;\n        newWidth = newHeight * aspectRatio;\n    }\n    return {\n        width: Math.round(newWidth),\n        height: Math.round(newHeight)\n    };\n}\nasync function jimpFromBase64(base64) {\n    const Jimp = await get_jimp();\n    const { body } = parseBase64(base64);\n    const imageBuffer = Buffer.from(body, 'base64');\n    return Jimp.read(imageBuffer);\n}\nasync function paddingToMatchBlock(image, blockSize = 28) {\n    const { width, height } = image.bitmap;\n    const targetWidth = Math.ceil(width / blockSize) * blockSize;\n    const targetHeight = Math.ceil(height / blockSize) * blockSize;\n    if (targetWidth === width && targetHeight === height) return {\n        width,\n        height,\n        image\n    };\n    const Jimp = await get_jimp();\n    const paddedImage = new Jimp(targetWidth, targetHeight, 0xffffffff);\n    paddedImage.composite(image, 0, 0);\n    return {\n        width: targetWidth,\n        height: targetHeight,\n        image: paddedImage\n    };\n}\nasync function paddingToMatchBlockByBase64(imageBase64, blockSize = 28) {\n    const jimpImage = await jimpFromBase64(imageBase64);\n    const paddedResult = await paddingToMatchBlock(jimpImage, blockSize);\n    return {\n        width: paddedResult.width,\n        height: paddedResult.height,\n        imageBase64: await jimpToBase64(paddedResult.image)\n    };\n}\nasync function cropByRect(imageBase64, rect, paddingImage) {\n    const jimpImage = await jimpFromBase64(imageBase64);\n    const { left, top, width, height } = rect;\n    jimpImage.crop(left, top, width, height);\n    if (paddingImage) {\n        const paddedResult = await paddingToMatchBlock(jimpImage);\n        return {\n            width: paddedResult.width,\n            height: paddedResult.height,\n            imageBase64: await jimpToBase64(paddedResult.image)\n        };\n    }\n    return {\n        width: jimpImage.bitmap.width,\n        height: jimpImage.bitmap.height,\n        imageBase64: await jimpToBase64(jimpImage)\n    };\n}\nasync function jimpToBase64(image) {\n    const Jimp = await get_jimp();\n    return image.getBase64Async(Jimp.MIME_JPEG);\n}\nconst httpImg2Base64 = async (url)=>{\n    const response = await fetch(url);\n    if (!response.ok) throw new Error(`Failed to fetch image: ${url}`);\n    const contentType = response.headers.get('content-type');\n    if (!contentType) throw new Error(`Failed to fetch image: ${url}`);\n    node_assert(contentType.startsWith('image/'), `The url ${url} is not a image, because of content-type in header is ${contentType}.`);\n    const buffer = Buffer.from(await response.arrayBuffer());\n    return `data:${contentType};base64,${buffer.toString('base64')}`;\n};\nconst localImg2Base64 = (imgPath, withoutHeader = false)=>{\n    const body = readFileSync(imgPath).toString('base64');\n    if (withoutHeader) return body;\n    const type = node_path.extname(imgPath).slice(1);\n    const finalType = 'svg' === type ? 'svg+xml' : type || 'jpg';\n    return `data:image/${finalType};base64,${body}`;\n};\nconst preProcessImageUrl = async (url, convertHttpImage2Base64)=>{\n    if ('string' != typeof url) throw new Error(`url must be a string, but got ${url} with type ${typeof url}`);\n    if (url.startsWith('data:')) return url;\n    if (!(url.startsWith('http://') || url.startsWith('https://'))) return await localImg2Base64(url);\n    if (!convertHttpImage2Base64) return url;\n    return await httpImg2Base64(url);\n};\nconst parseBase64 = (fullBase64String)=>{\n    try {\n        const separator = ';base64,';\n        const index = fullBase64String.indexOf(separator);\n        if (-1 === index) throw new Error('Invalid base64 string');\n        return {\n            mimeType: fullBase64String.slice(5, index),\n            body: fullBase64String.slice(index + separator.length)\n        };\n    } catch (e) {\n        throw new Error(`parseBase64 fail because intput is not a valid base64 string: ${fullBase64String}`, {\n            cause: e\n        });\n    }\n};\nexport { createImgBase64ByFormat, cropByRect, httpImg2Base64, jimpFromBase64, jimpToBase64, localImg2Base64, paddingToMatchBlock, paddingToMatchBlockByBase64, parseBase64, preProcessImageUrl, resizeAndConvertImgBuffer, resizeImgBase64, saveBase64Image, zoomForGPT4o };\n","import type {\n  BaseElement,\n  DeviceAction,\n  ElementTreeNode,\n  MidsceneYamlFlowItem,\n  PlanningAction,\n  Rect,\n  Size,\n} from '@/types';\nimport { assert } from '@midscene/shared/utils';\n\nimport type { ChatCompletionMessageParam } from 'openai/resources/index';\n\nimport type { PlanningLocateParam } from '@/types';\nimport { NodeType } from '@midscene/shared/constants';\nimport type { TVlModeTypes } from '@midscene/shared/env';\nimport { treeToList } from '@midscene/shared/extractor';\nimport { compositeElementInfoImg } from '@midscene/shared/img';\nimport { getDebug } from '@midscene/shared/logger';\nimport { z } from 'zod';\n\nexport type AIArgs = ChatCompletionMessageParam[];\n\nexport enum AIActionType {\n  ASSERT = 0,\n  INSPECT_ELEMENT = 1,\n  EXTRACT_DATA = 2,\n  PLAN = 3,\n  DESCRIBE_ELEMENT = 4,\n  TEXT = 5,\n}\n\nconst defaultBboxSize = 20; // must be even number\nconst debugInspectUtils = getDebug('ai:common');\ntype AdaptBboxInput = number[] | string[] | string | (number[] | string[])[];\n\n// transform the param of locate from qwen mode\nexport function fillBboxParam(\n  locate: PlanningLocateParam,\n  width: number,\n  height: number,\n  rightLimit: number,\n  bottomLimit: number,\n  vlMode: TVlModeTypes | undefined,\n) {\n  // The Qwen model might have hallucinations of naming bbox as bbox_2d.\n  if ((locate as any).bbox_2d && !locate?.bbox) {\n    locate.bbox = (locate as any).bbox_2d;\n    // biome-ignore lint/performance/noDelete: <explanation>\n    delete (locate as any).bbox_2d;\n  }\n\n  if (locate?.bbox) {\n    locate.bbox = adaptBbox(\n      locate.bbox,\n      width,\n      height,\n      rightLimit,\n      bottomLimit,\n      vlMode,\n    );\n  }\n\n  return locate;\n}\n\nexport function adaptQwen2_5Bbox(\n  bbox: number[],\n): [number, number, number, number] {\n  if (bbox.length < 2) {\n    const msg = `invalid bbox data for qwen-vl mode: ${JSON.stringify(bbox)} `;\n    throw new Error(msg);\n  }\n\n  const result: [number, number, number, number] = [\n    Math.round(bbox[0]),\n    Math.round(bbox[1]),\n    typeof bbox[2] === 'number'\n      ? Math.round(bbox[2])\n      : Math.round(bbox[0] + defaultBboxSize),\n    typeof bbox[3] === 'number'\n      ? Math.round(bbox[3])\n      : Math.round(bbox[1] + defaultBboxSize),\n  ];\n  return result;\n}\n\nexport function adaptDoubaoBbox(\n  bbox: string[] | number[] | string,\n  width: number,\n  height: number,\n): [number, number, number, number] {\n  assert(\n    width > 0 && height > 0,\n    'width and height must be greater than 0 in doubao mode',\n  );\n\n  if (typeof bbox === 'string') {\n    assert(\n      /^(\\d+)\\s(\\d+)\\s(\\d+)\\s(\\d+)$/.test(bbox.trim()),\n      `invalid bbox data string for doubao-vision mode: ${bbox}`,\n    );\n    const splitted = bbox.split(' ');\n    if (splitted.length === 4) {\n      return [\n        Math.round((Number(splitted[0]) * width) / 1000),\n        Math.round((Number(splitted[1]) * height) / 1000),\n        Math.round((Number(splitted[2]) * width) / 1000),\n        Math.round((Number(splitted[3]) * height) / 1000),\n      ];\n    }\n    throw new Error(`invalid bbox data string for doubao-vision mode: ${bbox}`);\n  }\n\n  let bboxList: number[] = [];\n  if (Array.isArray(bbox) && typeof bbox[0] === 'string') {\n    bbox.forEach((item) => {\n      if (typeof item === 'string' && item.includes(',')) {\n        const [x, y] = item.split(',');\n        bboxList.push(Number(x.trim()), Number(y.trim()));\n      } else if (typeof item === 'string' && item.includes(' ')) {\n        const [x, y] = item.split(' ');\n        bboxList.push(Number(x.trim()), Number(y.trim()));\n      } else {\n        bboxList.push(Number(item));\n      }\n    });\n  } else {\n    bboxList = bbox as any;\n  }\n\n  if (bboxList.length === 4 || bboxList.length === 5) {\n    return [\n      Math.round((bboxList[0] * width) / 1000),\n      Math.round((bboxList[1] * height) / 1000),\n      Math.round((bboxList[2] * width) / 1000),\n      Math.round((bboxList[3] * height) / 1000),\n    ];\n  }\n\n  // treat the bbox as a center point\n  if (\n    bboxList.length === 6 ||\n    bboxList.length === 2 ||\n    bboxList.length === 3 ||\n    bboxList.length === 7\n  ) {\n    return [\n      Math.max(\n        0,\n        Math.round((bboxList[0] * width) / 1000) - defaultBboxSize / 2,\n      ),\n      Math.max(\n        0,\n        Math.round((bboxList[1] * height) / 1000) - defaultBboxSize / 2,\n      ),\n      Math.min(\n        width,\n        Math.round((bboxList[0] * width) / 1000) + defaultBboxSize / 2,\n      ),\n      Math.min(\n        height,\n        Math.round((bboxList[1] * height) / 1000) + defaultBboxSize / 2,\n      ),\n    ];\n  }\n\n  if (bbox.length === 8) {\n    return [\n      Math.round((bboxList[0] * width) / 1000),\n      Math.round((bboxList[1] * height) / 1000),\n      Math.round((bboxList[4] * width) / 1000),\n      Math.round((bboxList[5] * height) / 1000),\n    ];\n  }\n\n  const msg = `invalid bbox data for doubao-vision mode: ${JSON.stringify(bbox)} `;\n  throw new Error(msg);\n}\n\nfunction normalizeBboxInput(\n  bbox: AdaptBboxInput,\n): number[] | string[] | string {\n  if (Array.isArray(bbox)) {\n    if (Array.isArray(bbox[0])) {\n      return bbox[0] as number[] | string[];\n    }\n    return bbox as number[] | string[];\n  }\n  return bbox as string;\n}\n\nexport function adaptBbox(\n  bbox: AdaptBboxInput,\n  width: number,\n  height: number,\n  rightLimit: number,\n  bottomLimit: number,\n  vlMode: TVlModeTypes | undefined,\n): [number, number, number, number] {\n  const normalizedBbox = normalizeBboxInput(bbox);\n\n  let result: [number, number, number, number] = [0, 0, 0, 0];\n  if (vlMode === 'doubao-vision' || vlMode === 'vlm-ui-tars') {\n    result = adaptDoubaoBbox(normalizedBbox, width, height);\n  } else if (vlMode === 'gemini') {\n    result = adaptGeminiBbox(normalizedBbox as number[], width, height);\n  } else if (vlMode === 'qwen3-vl') {\n    result = normalized01000(normalizedBbox as number[], width, height);\n  } else {\n    result = adaptQwen2_5Bbox(normalizedBbox as number[]);\n  }\n\n  result[2] = Math.min(result[2], rightLimit);\n  result[3] = Math.min(result[3], bottomLimit);\n\n  return result;\n}\n\n// x1, y1, x2, y2 -> 0-1000\nexport function normalized01000(\n  bbox: number[],\n  width: number,\n  height: number,\n): [number, number, number, number] {\n  return [\n    Math.round((bbox[0] * width) / 1000),\n    Math.round((bbox[1] * height) / 1000),\n    Math.round((bbox[2] * width) / 1000),\n    Math.round((bbox[3] * height) / 1000),\n  ];\n}\n\n// y1, x1, y2, x2 -> 0-1000\nexport function adaptGeminiBbox(\n  bbox: number[],\n  width: number,\n  height: number,\n): [number, number, number, number] {\n  const left = Math.round((bbox[1] * width) / 1000);\n  const top = Math.round((bbox[0] * height) / 1000);\n  const right = Math.round((bbox[3] * width) / 1000);\n  const bottom = Math.round((bbox[2] * height) / 1000);\n  return [left, top, right, bottom];\n}\n\nexport function adaptBboxToRect(\n  bbox: number[],\n  width: number,\n  height: number,\n  offsetX = 0,\n  offsetY = 0,\n  rightLimit = width,\n  bottomLimit = height,\n  vlMode?: TVlModeTypes | undefined,\n): Rect {\n  debugInspectUtils(\n    'adaptBboxToRect',\n    bbox,\n    width,\n    height,\n    'offset',\n    offsetX,\n    offsetY,\n    'limit',\n    rightLimit,\n    bottomLimit,\n    'vlMode',\n    vlMode,\n  );\n  const [left, top, right, bottom] = adaptBbox(\n    bbox,\n    width,\n    height,\n    rightLimit,\n    bottomLimit,\n    vlMode,\n  );\n\n  // Calculate initial rect dimensions\n  const rectLeft = left;\n  const rectTop = top;\n  let rectWidth = right - left;\n  let rectHeight = bottom - top;\n\n  // Ensure the rect doesn't exceed image boundaries\n  // If right edge exceeds width, adjust the width\n  if (rectLeft + rectWidth > width) {\n    rectWidth = width - rectLeft;\n  }\n\n  // If bottom edge exceeds height, adjust the height\n  if (rectTop + rectHeight > height) {\n    rectHeight = height - rectTop;\n  }\n\n  // Ensure minimum dimensions (width and height should be at least 1)\n  rectWidth = Math.max(1, rectWidth);\n  rectHeight = Math.max(1, rectHeight);\n\n  const rect = {\n    left: rectLeft + offsetX,\n    top: rectTop + offsetY,\n    width: rectWidth,\n    height: rectHeight,\n  };\n  debugInspectUtils('adaptBboxToRect, result=', rect);\n\n  return rect;\n}\n\nexport function mergeRects(rects: Rect[]) {\n  const minLeft = Math.min(...rects.map((r) => r.left));\n  const minTop = Math.min(...rects.map((r) => r.top));\n  const maxRight = Math.max(...rects.map((r) => r.left + r.width));\n  const maxBottom = Math.max(...rects.map((r) => r.top + r.height));\n  return {\n    left: minLeft,\n    top: minTop,\n    width: maxRight - minLeft,\n    height: maxBottom - minTop,\n  };\n}\n\n// expand the search area to at least 300 x 300, or add a default padding\nexport function expandSearchArea(\n  rect: Rect,\n  screenSize: Size,\n  vlMode: TVlModeTypes | undefined,\n) {\n  let minEdgeSize = 500;\n  if (vlMode === 'qwen3-vl') {\n    minEdgeSize = 700;\n  }\n  const defaultPadding = 160;\n\n  // Calculate padding needed to reach minimum edge size\n  const paddingSizeHorizontal =\n    rect.width < minEdgeSize\n      ? Math.ceil((minEdgeSize - rect.width) / 2)\n      : defaultPadding;\n  const paddingSizeVertical =\n    rect.height < minEdgeSize\n      ? Math.ceil((minEdgeSize - rect.height) / 2)\n      : defaultPadding;\n\n  // Calculate new dimensions (ensure minimum edge size)\n  let newWidth = Math.max(minEdgeSize, rect.width + paddingSizeHorizontal * 2);\n  let newHeight = Math.max(minEdgeSize, rect.height + paddingSizeVertical * 2);\n\n  // Calculate initial position with padding\n  let newLeft = rect.left - paddingSizeHorizontal;\n  let newTop = rect.top - paddingSizeVertical;\n\n  // Ensure the rect doesn't exceed screen boundaries by adjusting position\n  // If the rect goes beyond the right edge, shift it left\n  if (newLeft + newWidth > screenSize.width) {\n    newLeft = screenSize.width - newWidth;\n  }\n\n  // If the rect goes beyond the bottom edge, shift it up\n  if (newTop + newHeight > screenSize.height) {\n    newTop = screenSize.height - newHeight;\n  }\n\n  // Ensure the rect doesn't go beyond the left/top edges\n  newLeft = Math.max(0, newLeft);\n  newTop = Math.max(0, newTop);\n\n  // If after position adjustment, the rect still exceeds screen boundaries,\n  // clamp the dimensions to fit within screen\n  if (newLeft + newWidth > screenSize.width) {\n    newWidth = screenSize.width - newLeft;\n  }\n  if (newTop + newHeight > screenSize.height) {\n    newHeight = screenSize.height - newTop;\n  }\n\n  rect.left = newLeft;\n  rect.top = newTop;\n  rect.width = newWidth;\n  rect.height = newHeight;\n\n  return rect;\n}\n\nexport async function markupImageForLLM(\n  screenshotBase64: string,\n  tree: ElementTreeNode<BaseElement>,\n  size: Size,\n) {\n  const elementsInfo = treeToList(tree);\n  const elementsPositionInfoWithoutText = elementsInfo!.filter(\n    (elementInfo) => {\n      if (elementInfo.attributes.nodeType === NodeType.TEXT) {\n        return false;\n      }\n      return true;\n    },\n  );\n\n  const imagePayload = await compositeElementInfoImg({\n    inputImgBase64: screenshotBase64,\n    elementsPositionInfo: elementsPositionInfoWithoutText,\n    size,\n  });\n  return imagePayload;\n}\n\nexport function buildYamlFlowFromPlans(\n  plans: PlanningAction[],\n  actionSpace: DeviceAction<any>[],\n  sleep?: number,\n): MidsceneYamlFlowItem[] {\n  const flow: MidsceneYamlFlowItem[] = [];\n\n  for (const plan of plans) {\n    const verb = plan.type;\n\n    const action = actionSpace.find((action) => action.name === verb);\n    if (!action) {\n      console.warn(\n        `Cannot convert action ${verb} to yaml flow. Will ignore it.`,\n      );\n      continue;\n    }\n\n    const flowKey = action.interfaceAlias || verb;\n    const flowParam = action.paramSchema\n      ? dumpActionParam(plan.param || {}, action.paramSchema)\n      : {};\n\n    const flowItem: MidsceneYamlFlowItem = {\n      [flowKey]: '',\n      ...flowParam,\n    };\n\n    flow.push(flowItem);\n  }\n\n  if (sleep) {\n    flow.push({\n      sleep,\n    });\n  }\n\n  return flow;\n}\n\n// Zod schemas for shared types\nexport const PointSchema = z.object({\n  left: z.number(),\n  top: z.number(),\n});\n\nexport const SizeSchema = z.object({\n  width: z.number(),\n  height: z.number(),\n  dpr: z.number().optional(),\n});\n\nexport const RectSchema = PointSchema.and(SizeSchema).and(\n  z.object({\n    zoom: z.number().optional(),\n  }),\n);\n\n// Zod schema for TMultimodalPrompt\nexport const TMultimodalPromptSchema = z.object({\n  images: z\n    .array(\n      z.object({\n        name: z.string(),\n        url: z.string(),\n      }),\n    )\n    .optional(),\n  convertHttpImage2Base64: z.boolean().optional(),\n});\n\n// Zod schema for TUserPrompt\nexport const TUserPromptSchema = z.union([\n  z.string(),\n  z\n    .object({\n      prompt: z.string(),\n    })\n    .and(TMultimodalPromptSchema.partial()),\n]);\n\n// Generate TypeScript types from Zod schemas\nexport type TMultimodalPrompt = z.infer<typeof TMultimodalPromptSchema>;\nexport type TUserPrompt = z.infer<typeof TUserPromptSchema>;\n\nconst locateFieldFlagName = 'midscene_location_field_flag';\n\n// Schema for locator field input (when users provide locate parameters)\nconst MidsceneLocationInput = z\n  .object({\n    prompt: TUserPromptSchema,\n    deepThink: z.boolean().optional(),\n    cacheable: z.boolean().optional(),\n    xpath: z.union([z.string(), z.boolean()]).optional(),\n  })\n  .passthrough();\n\n// Schema for locator field result (when AI returns locate results)\nconst MidsceneLocationResult = z\n  .object({\n    [locateFieldFlagName]: z.literal(true),\n    prompt: TUserPromptSchema,\n\n    // optional fields\n    deepThink: z.boolean().optional(), // only available in vl model\n    cacheable: z.boolean().optional(),\n    xpath: z.boolean().optional(), // preset result for xpath\n\n    // these two fields will only appear in the result\n    center: z.tuple([z.number(), z.number()]),\n    rect: RectSchema,\n  })\n  .passthrough();\n\n// Export the result type - this is used for runtime results that include center and rect\nexport type MidsceneLocationResultType = z.infer<typeof MidsceneLocationResult>;\n\n// Export the input type - this is the inferred type from getMidsceneLocationSchema()\nexport type MidsceneLocationInputType = z.infer<typeof MidsceneLocationInput>;\n\n/**\n * Returns the schema for locator fields.\n * This now returns the input schema which is more permissive and suitable for validation.\n */\nexport const getMidsceneLocationSchema = () => {\n  return MidsceneLocationInput;\n};\n\nexport const ifMidsceneLocatorField = (field: any): boolean => {\n  // Handle optional fields by getting the inner type\n  let actualField = field;\n  if (actualField._def?.typeName === 'ZodOptional') {\n    actualField = actualField._def.innerType;\n  }\n\n  // Check if this is a ZodObject\n  if (actualField._def?.typeName === 'ZodObject') {\n    const shape = actualField._def.shape();\n\n    // Method 1: Check for the location field flag (for result schema)\n    if (locateFieldFlagName in shape) {\n      return true;\n    }\n\n    // Method 2: Check if it's the input schema by checking for 'prompt' field\n    // Input schema has 'prompt' as a required field\n    if ('prompt' in shape && shape.prompt) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nexport const dumpMidsceneLocatorField = (field: any): string => {\n  assert(\n    ifMidsceneLocatorField(field),\n    'field is not a midscene locator field',\n  );\n\n  // If field is a string, return it directly\n  if (typeof field === 'string') {\n    return field;\n  }\n\n  // If field is an object with prompt property\n  if (field && typeof field === 'object' && field.prompt) {\n    // If prompt is a string, return it directly\n    if (typeof field.prompt === 'string') {\n      return field.prompt;\n    }\n    // If prompt is a TUserPrompt object, extract the prompt string\n    if (typeof field.prompt === 'object' && field.prompt.prompt) {\n      return field.prompt.prompt; // TODO: dump images if necessary\n    }\n  }\n\n  // Fallback: try to convert to string\n  return String(field);\n};\n\nexport const findAllMidsceneLocatorField = (\n  zodType?: z.ZodType<any>,\n  requiredOnly?: boolean,\n): string[] => {\n  if (!zodType) {\n    return [];\n  }\n\n  // Check if this is a ZodObject by checking if it has a shape property\n  const zodObject = zodType as any;\n  if (zodObject._def?.typeName === 'ZodObject' && zodObject.shape) {\n    const keys = Object.keys(zodObject.shape);\n    return keys.filter((key) => {\n      const field = zodObject.shape[key];\n      if (!ifMidsceneLocatorField(field)) {\n        return false;\n      }\n\n      // If requiredOnly is true, filter out optional fields\n      if (requiredOnly) {\n        return field._def?.typeName !== 'ZodOptional';\n      }\n\n      return true;\n    });\n  }\n\n  // For other ZodType instances, we can't extract field names\n  return [];\n};\n\nexport const dumpActionParam = (\n  jsonObject: Record<string, any>,\n  zodSchema: z.ZodType<any>,\n): Record<string, any> => {\n  const locatorFields = findAllMidsceneLocatorField(zodSchema);\n  const result = { ...jsonObject };\n\n  for (const fieldName of locatorFields) {\n    const fieldValue = result[fieldName];\n    if (fieldValue) {\n      // If it's already a string, keep it as is\n      if (typeof fieldValue === 'string') {\n        result[fieldName] = fieldValue;\n      } else if (typeof fieldValue === 'object') {\n        // Check if this field is actually a MidsceneLocationType object\n        if (fieldValue.prompt) {\n          // If prompt is a string, use it directly\n          if (typeof fieldValue.prompt === 'string') {\n            result[fieldName] = fieldValue.prompt;\n          } else if (\n            typeof fieldValue.prompt === 'object' &&\n            fieldValue.prompt.prompt\n          ) {\n            // If prompt is a TUserPrompt object, extract the prompt string\n            result[fieldName] = fieldValue.prompt.prompt;\n          }\n        }\n      }\n    }\n  }\n\n  return result;\n};\n\nexport const loadActionParam = (\n  jsonObject: Record<string, any>,\n  zodSchema: z.ZodType<any>,\n): Record<string, any> => {\n  const locatorFields = findAllMidsceneLocatorField(zodSchema);\n  const result = { ...jsonObject };\n\n  for (const fieldName of locatorFields) {\n    const fieldValue = result[fieldName];\n    if (fieldValue && typeof fieldValue === 'string') {\n      result[fieldName] = {\n        [locateFieldFlagName]: true,\n        prompt: fieldValue,\n      };\n    }\n  }\n\n  return result;\n};\n\n/**\n * Parse and validate action parameters using Zod schema.\n * All fields are validated through Zod, EXCEPT locator fields which are skipped.\n * Default values defined in the schema are automatically applied.\n *\n * Locator fields are special business logic fields with complex validation requirements,\n * so they are intentionally excluded from Zod parsing and use existing validation logic.\n */\nexport const parseActionParam = (\n  rawParam: Record<string, any> | undefined,\n  zodSchema?: z.ZodType<any>,\n): Record<string, any> | undefined => {\n  // If no schema is provided, return undefined (action takes no parameters)\n  if (!zodSchema) {\n    return undefined;\n  }\n\n  // Handle undefined or null rawParam by providing an empty object\n  const param = rawParam ?? {};\n\n  // Find all locate fields in the schema\n  const locateFields = findAllMidsceneLocatorField(zodSchema);\n\n  // If there are no locate fields, just do normal validation\n  if (locateFields.length === 0) {\n    return zodSchema.parse(param);\n  }\n\n  // Extract locate field values to restore later\n  const locateFieldValues: Record<string, any> = {};\n  for (const fieldName of locateFields) {\n    if (fieldName in param) {\n      locateFieldValues[fieldName] = param[fieldName];\n    }\n  }\n\n  // Build params for validation - skip locate fields and use dummy values\n  const paramsForValidation: Record<string, any> = {};\n  for (const key in param) {\n    if (locateFields.includes(key)) {\n      // Use dummy value to satisfy schema validation\n      paramsForValidation[key] = { prompt: '_dummy_' };\n    } else {\n      paramsForValidation[key] = param[key];\n    }\n  }\n\n  // Validate with dummy locate values\n  const validated = zodSchema.parse(paramsForValidation);\n\n  // Restore the actual locate field values (unvalidated, as per business requirement)\n  for (const fieldName in locateFieldValues) {\n    validated[fieldName] = locateFieldValues[fieldName];\n  }\n\n  return validated;\n};\n","import type {\n  AIDataExtractionResponse,\n  AIElementResponse,\n  AISectionLocatorResponse,\n  AIUsageInfo,\n  Rect,\n  ReferenceImage,\n  ServiceExtractOption,\n  UIContext,\n} from '@/types';\nimport type { IModelConfig } from '@midscene/shared/env';\nimport { generateElementByPosition } from '@midscene/shared/extractor/dom-util';\nimport {\n  cropByRect,\n  paddingToMatchBlockByBase64,\n  preProcessImageUrl,\n} from '@midscene/shared/img';\nimport { getDebug } from '@midscene/shared/logger';\nimport type { LocateResultElement } from '@midscene/shared/types';\nimport { assert } from '@midscene/shared/utils';\nimport type {\n  ChatCompletionSystemMessageParam,\n  ChatCompletionUserMessageParam,\n} from 'openai/resources/index';\nimport type { TMultimodalPrompt, TUserPrompt } from '../common';\nimport {\n  AIActionType,\n  adaptBboxToRect,\n  expandSearchArea,\n  mergeRects,\n} from '../common';\nimport {\n  extractDataQueryPrompt,\n  systemPromptToExtract,\n} from './prompt/extraction';\nimport {\n  findElementPrompt,\n  systemPromptToLocateElement,\n} from './prompt/llm-locator';\nimport {\n  sectionLocatorInstruction,\n  systemPromptToLocateSection,\n} from './prompt/llm-section-locator';\nimport {\n  orderSensitiveJudgePrompt,\n  systemPromptToJudgeOrderSensitive,\n} from './prompt/order-sensitive-judge';\nimport { callAIWithObjectResponse } from './service-caller/index';\n\nexport type AIArgs = [\n  ChatCompletionSystemMessageParam,\n  ...ChatCompletionUserMessageParam[],\n];\n\nconst debugInspect = getDebug('ai:inspect');\nconst debugSection = getDebug('ai:section');\n\nconst extraTextFromUserPrompt = (prompt: TUserPrompt): string => {\n  if (typeof prompt === 'string') {\n    return prompt;\n  } else {\n    return prompt.prompt;\n  }\n};\n\nconst promptsToChatParam = async (\n  multimodalPrompt: TMultimodalPrompt,\n): Promise<ChatCompletionUserMessageParam[]> => {\n  const msgs: ChatCompletionUserMessageParam[] = [];\n  if (multimodalPrompt?.images?.length) {\n    msgs.push({\n      role: 'user',\n      content: [\n        {\n          type: 'text',\n          text: 'Next, I will provide all the reference images.',\n        },\n      ],\n    });\n\n    for (const item of multimodalPrompt.images) {\n      const base64 = await preProcessImageUrl(\n        item.url,\n        !!multimodalPrompt.convertHttpImage2Base64,\n      );\n\n      msgs.push({\n        role: 'user',\n        content: [\n          {\n            type: 'text',\n            text: `this is the reference image named '${item.name}':`,\n          },\n        ],\n      });\n\n      msgs.push({\n        role: 'user',\n        content: [\n          {\n            type: 'image_url',\n            image_url: {\n              url: base64,\n              detail: 'high',\n            },\n          },\n        ],\n      });\n    }\n  }\n  return msgs;\n};\n\nexport async function AiLocateElement(options: {\n  context: UIContext;\n  targetElementDescription: TUserPrompt;\n  referenceImage?: ReferenceImage;\n  callAIFn: typeof callAIWithObjectResponse<\n    AIElementResponse | [number, number]\n  >;\n  searchConfig?: Awaited<ReturnType<typeof AiLocateSection>>;\n  modelConfig: IModelConfig;\n}): Promise<{\n  parseResult: {\n    elements: LocateResultElement[];\n    errors?: string[];\n  };\n  rect?: Rect;\n  rawResponse: string;\n  usage?: AIUsageInfo;\n}> {\n  const { context, targetElementDescription, callAIFn, modelConfig } = options;\n  const { vlMode } = modelConfig;\n  const { screenshotBase64 } = context;\n\n  assert(\n    targetElementDescription,\n    'cannot find the target element description',\n  );\n  const targetElementDescriptionText = extraTextFromUserPrompt(\n    targetElementDescription,\n  );\n  const userInstructionPrompt = findElementPrompt(targetElementDescriptionText);\n  const systemPrompt = systemPromptToLocateElement(vlMode);\n\n  let imagePayload = screenshotBase64;\n  let imageWidth = context.size.width;\n  let imageHeight = context.size.height;\n  let originalImageWidth = imageWidth;\n  let originalImageHeight = imageHeight;\n\n  if (options.searchConfig) {\n    assert(\n      options.searchConfig.rect,\n      'searchArea is provided but its rect cannot be found. Failed to locate element',\n    );\n    assert(\n      options.searchConfig.imageBase64,\n      'searchArea is provided but its imageBase64 cannot be found. Failed to locate element',\n    );\n\n    imagePayload = options.searchConfig.imageBase64;\n    imageWidth = options.searchConfig.rect?.width;\n    imageHeight = options.searchConfig.rect?.height;\n    originalImageWidth = imageWidth;\n    originalImageHeight = imageHeight;\n  } else if (vlMode === 'qwen2.5-vl') {\n    const paddedResult = await paddingToMatchBlockByBase64(imagePayload);\n    imageWidth = paddedResult.width;\n    imageHeight = paddedResult.height;\n    imagePayload = paddedResult.imageBase64;\n  }\n\n  const msgs: AIArgs = [\n    { role: 'system', content: systemPrompt },\n    {\n      role: 'user',\n      content: [\n        {\n          type: 'image_url',\n          image_url: {\n            url: imagePayload,\n            detail: 'high',\n          },\n        },\n        {\n          type: 'text',\n          text: userInstructionPrompt,\n        },\n      ],\n    },\n  ];\n\n  if (typeof targetElementDescription !== 'string') {\n    const addOns = await promptsToChatParam({\n      images: targetElementDescription.images,\n      convertHttpImage2Base64: targetElementDescription.convertHttpImage2Base64,\n    });\n    msgs.push(...addOns);\n  }\n\n  const res = await callAIFn(msgs, AIActionType.INSPECT_ELEMENT, modelConfig);\n\n  const rawResponse = JSON.stringify(res.content);\n\n  let resRect: Rect | undefined;\n  let matchedElements = 'elements' in res.content ? res.content.elements : [];\n  let errors: string[] | undefined =\n    'errors' in res.content ? res.content.errors : [];\n  try {\n    if (\n      'bbox' in res.content &&\n      Array.isArray(res.content.bbox) &&\n      res.content.bbox.length >= 1\n    ) {\n      resRect = adaptBboxToRect(\n        res.content.bbox,\n        imageWidth,\n        imageHeight,\n        options.searchConfig?.rect?.left,\n        options.searchConfig?.rect?.top,\n        originalImageWidth,\n        originalImageHeight,\n        vlMode,\n      );\n\n      debugInspect('resRect', resRect);\n\n      const rectCenter = {\n        x: resRect.left + resRect.width / 2,\n        y: resRect.top + resRect.height / 2,\n      };\n\n      const element: LocateResultElement = generateElementByPosition(\n        rectCenter,\n        targetElementDescriptionText as string,\n      );\n      errors = [];\n\n      if (element) {\n        matchedElements = [element];\n      }\n    }\n  } catch (e) {\n    const msg =\n      e instanceof Error\n        ? `Failed to parse bbox: ${e.message}`\n        : 'unknown error in locate';\n    if (!errors || errors?.length === 0) {\n      errors = [msg];\n    } else {\n      errors.push(`(${msg})`);\n    }\n  }\n\n  return {\n    rect: resRect,\n    parseResult: {\n      elements: matchedElements as LocateResultElement[],\n      errors: errors as string[],\n    },\n    rawResponse,\n    usage: res.usage,\n  };\n}\n\nexport async function AiLocateSection(options: {\n  context: UIContext;\n  sectionDescription: TUserPrompt;\n  modelConfig: IModelConfig;\n}): Promise<{\n  rect?: Rect;\n  imageBase64?: string;\n  error?: string;\n  rawResponse: string;\n  usage?: AIUsageInfo;\n}> {\n  const { context, sectionDescription, modelConfig } = options;\n  const { vlMode } = modelConfig;\n  const { screenshotBase64 } = context;\n\n  const systemPrompt = systemPromptToLocateSection(vlMode);\n  const sectionLocatorInstructionText = sectionLocatorInstruction(\n    extraTextFromUserPrompt(sectionDescription),\n  );\n  const msgs: AIArgs = [\n    { role: 'system', content: systemPrompt },\n    {\n      role: 'user',\n      content: [\n        {\n          type: 'image_url',\n          image_url: {\n            url: screenshotBase64,\n            detail: 'high',\n          },\n        },\n        {\n          type: 'text',\n          text: sectionLocatorInstructionText,\n        },\n      ],\n    },\n  ];\n\n  if (typeof sectionDescription !== 'string') {\n    const addOns = await promptsToChatParam({\n      images: sectionDescription.images,\n      convertHttpImage2Base64: sectionDescription.convertHttpImage2Base64,\n    });\n    msgs.push(...addOns);\n  }\n\n  const result = await callAIWithObjectResponse<AISectionLocatorResponse>(\n    msgs,\n    AIActionType.EXTRACT_DATA,\n    modelConfig,\n  );\n\n  let sectionRect: Rect | undefined;\n  const sectionBbox = result.content.bbox;\n  if (sectionBbox) {\n    const targetRect = adaptBboxToRect(\n      sectionBbox,\n      context.size.width,\n      context.size.height,\n      0,\n      0,\n      context.size.width,\n      context.size.height,\n      vlMode,\n    );\n    debugSection('original targetRect %j', targetRect);\n\n    const referenceBboxList = result.content.references_bbox || [];\n    debugSection('referenceBboxList %j', referenceBboxList);\n\n    const referenceRects = referenceBboxList\n      .filter((bbox) => Array.isArray(bbox))\n      .map((bbox) => {\n        return adaptBboxToRect(\n          bbox,\n          context.size.width,\n          context.size.height,\n          0,\n          0,\n          context.size.width,\n          context.size.height,\n          vlMode,\n        );\n      });\n    debugSection('referenceRects %j', referenceRects);\n\n    // merge the sectionRect and referenceRects\n    const mergedRect = mergeRects([targetRect, ...referenceRects]);\n    debugSection('mergedRect %j', mergedRect);\n\n    // expand search area to at least 200 x 200\n    sectionRect = expandSearchArea(mergedRect, context.size, vlMode);\n    debugSection('expanded sectionRect %j', sectionRect);\n  }\n\n  let imageBase64 = screenshotBase64;\n  if (sectionRect) {\n    const croppedResult = await cropByRect(\n      screenshotBase64,\n      sectionRect,\n      vlMode === 'qwen2.5-vl',\n    );\n    imageBase64 = croppedResult.imageBase64;\n    sectionRect.width = croppedResult.width;\n    sectionRect.height = croppedResult.height;\n  }\n\n  return {\n    rect: sectionRect,\n    imageBase64,\n    error: result.content.error,\n    rawResponse: JSON.stringify(result.content),\n    usage: result.usage,\n  };\n}\n\nexport async function AiExtractElementInfo<T>(options: {\n  dataQuery: string | Record<string, string>;\n  multimodalPrompt?: TMultimodalPrompt;\n  context: UIContext;\n  pageDescription?: string;\n  extractOption?: ServiceExtractOption;\n  modelConfig: IModelConfig;\n}) {\n  const { dataQuery, context, extractOption, multimodalPrompt, modelConfig } =\n    options;\n  const systemPrompt = systemPromptToExtract();\n  const { screenshotBase64 } = context;\n\n  const extractDataPromptText = extractDataQueryPrompt(\n    options.pageDescription || '',\n    dataQuery,\n  );\n\n  const userContent: ChatCompletionUserMessageParam['content'] = [];\n\n  if (extractOption?.screenshotIncluded !== false) {\n    userContent.push({\n      type: 'image_url',\n      image_url: {\n        url: screenshotBase64,\n        detail: 'high',\n      },\n    });\n  }\n\n  userContent.push({\n    type: 'text',\n    text: extractDataPromptText,\n  });\n\n  const msgs: AIArgs = [\n    { role: 'system', content: systemPrompt },\n    {\n      role: 'user',\n      content: userContent,\n    },\n  ];\n\n  if (multimodalPrompt) {\n    const addOns = await promptsToChatParam({\n      images: multimodalPrompt.images,\n      convertHttpImage2Base64: multimodalPrompt.convertHttpImage2Base64,\n    });\n    msgs.push(...addOns);\n  }\n\n  const result = await callAIWithObjectResponse<AIDataExtractionResponse<T>>(\n    msgs,\n    AIActionType.EXTRACT_DATA,\n    modelConfig,\n  );\n  return {\n    parseResult: result.content,\n    usage: result.usage,\n  };\n}\n\nexport async function AiJudgeOrderSensitive(\n  description: string,\n  callAIFn: typeof callAIWithObjectResponse<{ isOrderSensitive: boolean }>,\n  modelConfig: IModelConfig,\n): Promise<{\n  isOrderSensitive: boolean;\n  usage?: AIUsageInfo;\n}> {\n  const systemPrompt = systemPromptToJudgeOrderSensitive();\n  const userPrompt = orderSensitiveJudgePrompt(description);\n\n  const msgs: AIArgs = [\n    { role: 'system', content: systemPrompt },\n    {\n      role: 'user',\n      content: userPrompt,\n    },\n  ];\n\n  const result = await callAIFn(\n    msgs,\n    AIActionType.INSPECT_ELEMENT, // Reuse existing action type for now\n    modelConfig,\n  );\n\n  return {\n    isOrderSensitive: result.content.isOrderSensitive ?? false,\n    usage: result.usage,\n  };\n}\n","import type {\n  DeviceAction,\n  InterfaceType,\n  PlanningAIResponse,\n  RawResponsePlanningAIResponse,\n  UIContext,\n} from '@/types';\nimport type { IModelConfig } from '@midscene/shared/env';\nimport { paddingToMatchBlockByBase64 } from '@midscene/shared/img';\nimport { getDebug } from '@midscene/shared/logger';\nimport { assert } from '@midscene/shared/utils';\nimport type { ChatCompletionMessageParam } from 'openai/resources/index';\nimport {\n  AIActionType,\n  buildYamlFlowFromPlans,\n  fillBboxParam,\n  findAllMidsceneLocatorField,\n} from '../common';\nimport type { ConversationHistory } from './conversation-history';\nimport { systemPromptToTaskPlanning } from './prompt/llm-planning';\nimport { callAIWithObjectResponse } from './service-caller/index';\n\nconst debug = getDebug('planning');\n\nexport async function plan(\n  userInstruction: string,\n  opts: {\n    context: UIContext;\n    interfaceType: InterfaceType;\n    actionSpace: DeviceAction<any>[];\n    actionContext?: string;\n    modelConfig: IModelConfig;\n    conversationHistory: ConversationHistory;\n    includeBbox: boolean;\n    imagesIncludeCount?: number;\n  },\n): Promise<PlanningAIResponse> {\n  const { context, modelConfig, conversationHistory } = opts;\n  const { screenshotBase64, size } = context;\n\n  const { vlMode } = modelConfig;\n\n  const systemPrompt = await systemPromptToTaskPlanning({\n    actionSpace: opts.actionSpace,\n    vlMode,\n    includeBbox: opts.includeBbox,\n  });\n\n  let imagePayload = screenshotBase64;\n  let imageWidth = size.width;\n  let imageHeight = size.height;\n  const rightLimit = imageWidth;\n  const bottomLimit = imageHeight;\n\n  // Process image based on VL mode requirements\n  if (vlMode === 'qwen2.5-vl') {\n    const paddedResult = await paddingToMatchBlockByBase64(imagePayload);\n    imageWidth = paddedResult.width;\n    imageHeight = paddedResult.height;\n    imagePayload = paddedResult.imageBase64;\n  }\n\n  const actionContext = opts.actionContext\n    ? `<high_priority_knowledge>${opts.actionContext}</high_priority_knowledge>\\n`\n    : '';\n\n  const instruction: ChatCompletionMessageParam[] = [\n    {\n      role: 'user',\n      content: [\n        {\n          type: 'text',\n          text: `${actionContext}<user_instruction>${userInstruction}</user_instruction>`,\n        },\n      ],\n    },\n  ];\n\n  let latestFeedbackMessage: ChatCompletionMessageParam;\n\n  if (conversationHistory.pendingFeedbackMessage) {\n    latestFeedbackMessage = {\n      role: 'user',\n      content: [\n        {\n          type: 'text',\n          text: `${conversationHistory.pendingFeedbackMessage}. The last screenshot is attached. Please going on according to the instruction.`,\n        },\n        {\n          type: 'image_url',\n          image_url: {\n            url: imagePayload,\n            detail: 'high',\n          },\n        },\n      ],\n    };\n\n    conversationHistory.resetPendingFeedbackMessageIfExists();\n  } else {\n    latestFeedbackMessage = {\n      role: 'user',\n      content: [\n        {\n          type: 'text',\n          text: 'this is the latest screenshot',\n        },\n        {\n          type: 'image_url',\n          image_url: {\n            url: imagePayload,\n            detail: 'high',\n          },\n        },\n      ],\n    };\n  }\n  conversationHistory.append(latestFeedbackMessage);\n  const historyLog = conversationHistory.snapshot(opts.imagesIncludeCount);\n\n  const msgs: ChatCompletionMessageParam[] = [\n    { role: 'system', content: systemPrompt },\n    ...instruction,\n    ...historyLog,\n  ];\n\n  const {\n    content: planFromAI,\n    contentString: rawResponse,\n    usage,\n  } = await callAIWithObjectResponse<RawResponsePlanningAIResponse>(\n    msgs,\n    AIActionType.PLAN,\n    modelConfig,\n  );\n\n  const actions = planFromAI.action ? [planFromAI.action] : [];\n  const returnValue: PlanningAIResponse = {\n    ...planFromAI,\n    actions,\n    rawResponse,\n    usage,\n    yamlFlow: buildYamlFlowFromPlans(\n      actions,\n      opts.actionSpace,\n      planFromAI.sleep,\n    ),\n  };\n\n  assert(planFromAI, \"can't get plans from AI\");\n\n  actions.forEach((action) => {\n    const type = action.type;\n    const actionInActionSpace = opts.actionSpace.find(\n      (action) => action.name === type,\n    );\n\n    debug('actionInActionSpace matched', actionInActionSpace);\n    const locateFields = actionInActionSpace\n      ? findAllMidsceneLocatorField(actionInActionSpace.paramSchema)\n      : [];\n\n    debug('locateFields', locateFields);\n\n    locateFields.forEach((field) => {\n      const locateResult = action.param[field];\n      if (locateResult && vlMode !== undefined) {\n        // Always use VL mode to fill bbox parameters\n        action.param[field] = fillBboxParam(\n          locateResult,\n          imageWidth,\n          imageHeight,\n          rightLimit,\n          bottomLimit,\n          vlMode,\n        );\n      }\n    });\n  });\n\n  if (\n    actions.length === 0 &&\n    returnValue.more_actions_needed_by_instruction &&\n    !returnValue.sleep\n  ) {\n    console.warn(\n      'No actions planned for the prompt, but model said more actions are needed:',\n      userInstruction,\n    );\n  }\n\n  conversationHistory.append({\n    role: 'assistant',\n    content: [\n      {\n        type: 'text',\n        text: rawResponse,\n      },\n    ],\n  });\n\n  return returnValue;\n}\n","/*! For license information please see us-keyboard-layout.mjs.LICENSE.txt */\n/**\n * @license\n * Copyright 2017 Google Inc.\n * SPDX-License-Identifier: Apache-2.0\n */ const _keyDefinitions = {\n    0: {\n        keyCode: 48,\n        key: '0',\n        code: 'Digit0'\n    },\n    1: {\n        keyCode: 49,\n        key: '1',\n        code: 'Digit1'\n    },\n    2: {\n        keyCode: 50,\n        key: '2',\n        code: 'Digit2'\n    },\n    3: {\n        keyCode: 51,\n        key: '3',\n        code: 'Digit3'\n    },\n    4: {\n        keyCode: 52,\n        key: '4',\n        code: 'Digit4'\n    },\n    5: {\n        keyCode: 53,\n        key: '5',\n        code: 'Digit5'\n    },\n    6: {\n        keyCode: 54,\n        key: '6',\n        code: 'Digit6'\n    },\n    7: {\n        keyCode: 55,\n        key: '7',\n        code: 'Digit7'\n    },\n    8: {\n        keyCode: 56,\n        key: '8',\n        code: 'Digit8'\n    },\n    9: {\n        keyCode: 57,\n        key: '9',\n        code: 'Digit9'\n    },\n    Power: {\n        key: 'Power',\n        code: 'Power'\n    },\n    Eject: {\n        key: 'Eject',\n        code: 'Eject'\n    },\n    Abort: {\n        keyCode: 3,\n        code: 'Abort',\n        key: 'Cancel'\n    },\n    Help: {\n        keyCode: 6,\n        code: 'Help',\n        key: 'Help'\n    },\n    Backspace: {\n        keyCode: 8,\n        code: 'Backspace',\n        key: 'Backspace'\n    },\n    Tab: {\n        keyCode: 9,\n        code: 'Tab',\n        key: 'Tab'\n    },\n    Numpad5: {\n        keyCode: 12,\n        shiftKeyCode: 101,\n        key: 'Clear',\n        code: 'Numpad5',\n        shiftKey: '5',\n        location: 3\n    },\n    NumpadEnter: {\n        keyCode: 13,\n        code: 'NumpadEnter',\n        key: 'Enter',\n        text: '\\r',\n        location: 3\n    },\n    Enter: {\n        keyCode: 13,\n        code: 'Enter',\n        key: 'Enter',\n        text: '\\r'\n    },\n    '\\r': {\n        keyCode: 13,\n        code: 'Enter',\n        key: 'Enter',\n        text: '\\r'\n    },\n    '\\n': {\n        keyCode: 13,\n        code: 'Enter',\n        key: 'Enter',\n        text: '\\r'\n    },\n    ShiftLeft: {\n        keyCode: 16,\n        code: 'ShiftLeft',\n        key: 'Shift',\n        location: 1\n    },\n    ShiftRight: {\n        keyCode: 16,\n        code: 'ShiftRight',\n        key: 'Shift',\n        location: 2\n    },\n    ControlLeft: {\n        keyCode: 17,\n        code: 'ControlLeft',\n        key: 'Control',\n        location: 1\n    },\n    ControlRight: {\n        keyCode: 17,\n        code: 'ControlRight',\n        key: 'Control',\n        location: 2\n    },\n    AltLeft: {\n        keyCode: 18,\n        code: 'AltLeft',\n        key: 'Alt',\n        location: 1\n    },\n    AltRight: {\n        keyCode: 18,\n        code: 'AltRight',\n        key: 'Alt',\n        location: 2\n    },\n    Pause: {\n        keyCode: 19,\n        code: 'Pause',\n        key: 'Pause'\n    },\n    CapsLock: {\n        keyCode: 20,\n        code: 'CapsLock',\n        key: 'CapsLock'\n    },\n    Escape: {\n        keyCode: 27,\n        code: 'Escape',\n        key: 'Escape'\n    },\n    Convert: {\n        keyCode: 28,\n        code: 'Convert',\n        key: 'Convert'\n    },\n    NonConvert: {\n        keyCode: 29,\n        code: 'NonConvert',\n        key: 'NonConvert'\n    },\n    Space: {\n        keyCode: 32,\n        code: 'Space',\n        key: ' '\n    },\n    Numpad9: {\n        keyCode: 33,\n        shiftKeyCode: 105,\n        key: 'PageUp',\n        code: 'Numpad9',\n        shiftKey: '9',\n        location: 3\n    },\n    PageUp: {\n        keyCode: 33,\n        code: 'PageUp',\n        key: 'PageUp'\n    },\n    Numpad3: {\n        keyCode: 34,\n        shiftKeyCode: 99,\n        key: 'PageDown',\n        code: 'Numpad3',\n        shiftKey: '3',\n        location: 3\n    },\n    PageDown: {\n        keyCode: 34,\n        code: 'PageDown',\n        key: 'PageDown'\n    },\n    End: {\n        keyCode: 35,\n        code: 'End',\n        key: 'End'\n    },\n    Numpad1: {\n        keyCode: 35,\n        shiftKeyCode: 97,\n        key: 'End',\n        code: 'Numpad1',\n        shiftKey: '1',\n        location: 3\n    },\n    Home: {\n        keyCode: 36,\n        code: 'Home',\n        key: 'Home'\n    },\n    Numpad7: {\n        keyCode: 36,\n        shiftKeyCode: 103,\n        key: 'Home',\n        code: 'Numpad7',\n        shiftKey: '7',\n        location: 3\n    },\n    ArrowLeft: {\n        keyCode: 37,\n        code: 'ArrowLeft',\n        key: 'ArrowLeft'\n    },\n    Numpad4: {\n        keyCode: 37,\n        shiftKeyCode: 100,\n        key: 'ArrowLeft',\n        code: 'Numpad4',\n        shiftKey: '4',\n        location: 3\n    },\n    Numpad8: {\n        keyCode: 38,\n        shiftKeyCode: 104,\n        key: 'ArrowUp',\n        code: 'Numpad8',\n        shiftKey: '8',\n        location: 3\n    },\n    ArrowUp: {\n        keyCode: 38,\n        code: 'ArrowUp',\n        key: 'ArrowUp'\n    },\n    ArrowRight: {\n        keyCode: 39,\n        code: 'ArrowRight',\n        key: 'ArrowRight'\n    },\n    Numpad6: {\n        keyCode: 39,\n        shiftKeyCode: 102,\n        key: 'ArrowRight',\n        code: 'Numpad6',\n        shiftKey: '6',\n        location: 3\n    },\n    Numpad2: {\n        keyCode: 40,\n        shiftKeyCode: 98,\n        key: 'ArrowDown',\n        code: 'Numpad2',\n        shiftKey: '2',\n        location: 3\n    },\n    ArrowDown: {\n        keyCode: 40,\n        code: 'ArrowDown',\n        key: 'ArrowDown'\n    },\n    Select: {\n        keyCode: 41,\n        code: 'Select',\n        key: 'Select'\n    },\n    Open: {\n        keyCode: 43,\n        code: 'Open',\n        key: 'Execute'\n    },\n    PrintScreen: {\n        keyCode: 44,\n        code: 'PrintScreen',\n        key: 'PrintScreen'\n    },\n    Insert: {\n        keyCode: 45,\n        code: 'Insert',\n        key: 'Insert'\n    },\n    Numpad0: {\n        keyCode: 45,\n        shiftKeyCode: 96,\n        key: 'Insert',\n        code: 'Numpad0',\n        shiftKey: '0',\n        location: 3\n    },\n    Delete: {\n        keyCode: 46,\n        code: 'Delete',\n        key: 'Delete'\n    },\n    NumpadDecimal: {\n        keyCode: 46,\n        shiftKeyCode: 110,\n        code: 'NumpadDecimal',\n        key: '\\u0000',\n        shiftKey: '.',\n        location: 3\n    },\n    Digit0: {\n        keyCode: 48,\n        code: 'Digit0',\n        shiftKey: ')',\n        key: '0'\n    },\n    Digit1: {\n        keyCode: 49,\n        code: 'Digit1',\n        shiftKey: '!',\n        key: '1'\n    },\n    Digit2: {\n        keyCode: 50,\n        code: 'Digit2',\n        shiftKey: '@',\n        key: '2'\n    },\n    Digit3: {\n        keyCode: 51,\n        code: 'Digit3',\n        shiftKey: '#',\n        key: '3'\n    },\n    Digit4: {\n        keyCode: 52,\n        code: 'Digit4',\n        shiftKey: '$',\n        key: '4'\n    },\n    Digit5: {\n        keyCode: 53,\n        code: 'Digit5',\n        shiftKey: '%',\n        key: '5'\n    },\n    Digit6: {\n        keyCode: 54,\n        code: 'Digit6',\n        shiftKey: '^',\n        key: '6'\n    },\n    Digit7: {\n        keyCode: 55,\n        code: 'Digit7',\n        shiftKey: '&',\n        key: '7'\n    },\n    Digit8: {\n        keyCode: 56,\n        code: 'Digit8',\n        shiftKey: '*',\n        key: '8'\n    },\n    Digit9: {\n        keyCode: 57,\n        code: 'Digit9',\n        shiftKey: '(',\n        key: '9'\n    },\n    KeyA: {\n        keyCode: 65,\n        code: 'KeyA',\n        shiftKey: 'A',\n        key: 'a'\n    },\n    KeyB: {\n        keyCode: 66,\n        code: 'KeyB',\n        shiftKey: 'B',\n        key: 'b'\n    },\n    KeyC: {\n        keyCode: 67,\n        code: 'KeyC',\n        shiftKey: 'C',\n        key: 'c'\n    },\n    KeyD: {\n        keyCode: 68,\n        code: 'KeyD',\n        shiftKey: 'D',\n        key: 'd'\n    },\n    KeyE: {\n        keyCode: 69,\n        code: 'KeyE',\n        shiftKey: 'E',\n        key: 'e'\n    },\n    KeyF: {\n        keyCode: 70,\n        code: 'KeyF',\n        shiftKey: 'F',\n        key: 'f'\n    },\n    KeyG: {\n        keyCode: 71,\n        code: 'KeyG',\n        shiftKey: 'G',\n        key: 'g'\n    },\n    KeyH: {\n        keyCode: 72,\n        code: 'KeyH',\n        shiftKey: 'H',\n        key: 'h'\n    },\n    KeyI: {\n        keyCode: 73,\n        code: 'KeyI',\n        shiftKey: 'I',\n        key: 'i'\n    },\n    KeyJ: {\n        keyCode: 74,\n        code: 'KeyJ',\n        shiftKey: 'J',\n        key: 'j'\n    },\n    KeyK: {\n        keyCode: 75,\n        code: 'KeyK',\n        shiftKey: 'K',\n        key: 'k'\n    },\n    KeyL: {\n        keyCode: 76,\n        code: 'KeyL',\n        shiftKey: 'L',\n        key: 'l'\n    },\n    KeyM: {\n        keyCode: 77,\n        code: 'KeyM',\n        shiftKey: 'M',\n        key: 'm'\n    },\n    KeyN: {\n        keyCode: 78,\n        code: 'KeyN',\n        shiftKey: 'N',\n        key: 'n'\n    },\n    KeyO: {\n        keyCode: 79,\n        code: 'KeyO',\n        shiftKey: 'O',\n        key: 'o'\n    },\n    KeyP: {\n        keyCode: 80,\n        code: 'KeyP',\n        shiftKey: 'P',\n        key: 'p'\n    },\n    KeyQ: {\n        keyCode: 81,\n        code: 'KeyQ',\n        shiftKey: 'Q',\n        key: 'q'\n    },\n    KeyR: {\n        keyCode: 82,\n        code: 'KeyR',\n        shiftKey: 'R',\n        key: 'r'\n    },\n    KeyS: {\n        keyCode: 83,\n        code: 'KeyS',\n        shiftKey: 'S',\n        key: 's'\n    },\n    KeyT: {\n        keyCode: 84,\n        code: 'KeyT',\n        shiftKey: 'T',\n        key: 't'\n    },\n    KeyU: {\n        keyCode: 85,\n        code: 'KeyU',\n        shiftKey: 'U',\n        key: 'u'\n    },\n    KeyV: {\n        keyCode: 86,\n        code: 'KeyV',\n        shiftKey: 'V',\n        key: 'v'\n    },\n    KeyW: {\n        keyCode: 87,\n        code: 'KeyW',\n        shiftKey: 'W',\n        key: 'w'\n    },\n    KeyX: {\n        keyCode: 88,\n        code: 'KeyX',\n        shiftKey: 'X',\n        key: 'x'\n    },\n    KeyY: {\n        keyCode: 89,\n        code: 'KeyY',\n        shiftKey: 'Y',\n        key: 'y'\n    },\n    KeyZ: {\n        keyCode: 90,\n        code: 'KeyZ',\n        shiftKey: 'Z',\n        key: 'z'\n    },\n    MetaLeft: {\n        keyCode: 91,\n        code: 'MetaLeft',\n        key: 'Meta',\n        location: 1\n    },\n    MetaRight: {\n        keyCode: 92,\n        code: 'MetaRight',\n        key: 'Meta',\n        location: 2\n    },\n    ContextMenu: {\n        keyCode: 93,\n        code: 'ContextMenu',\n        key: 'ContextMenu'\n    },\n    NumpadMultiply: {\n        keyCode: 106,\n        code: 'NumpadMultiply',\n        key: '*',\n        location: 3\n    },\n    NumpadAdd: {\n        keyCode: 107,\n        code: 'NumpadAdd',\n        key: '+',\n        location: 3\n    },\n    NumpadSubtract: {\n        keyCode: 109,\n        code: 'NumpadSubtract',\n        key: '-',\n        location: 3\n    },\n    NumpadDivide: {\n        keyCode: 111,\n        code: 'NumpadDivide',\n        key: '/',\n        location: 3\n    },\n    F1: {\n        keyCode: 112,\n        code: 'F1',\n        key: 'F1'\n    },\n    F2: {\n        keyCode: 113,\n        code: 'F2',\n        key: 'F2'\n    },\n    F3: {\n        keyCode: 114,\n        code: 'F3',\n        key: 'F3'\n    },\n    F4: {\n        keyCode: 115,\n        code: 'F4',\n        key: 'F4'\n    },\n    F5: {\n        keyCode: 116,\n        code: 'F5',\n        key: 'F5'\n    },\n    F6: {\n        keyCode: 117,\n        code: 'F6',\n        key: 'F6'\n    },\n    F7: {\n        keyCode: 118,\n        code: 'F7',\n        key: 'F7'\n    },\n    F8: {\n        keyCode: 119,\n        code: 'F8',\n        key: 'F8'\n    },\n    F9: {\n        keyCode: 120,\n        code: 'F9',\n        key: 'F9'\n    },\n    F10: {\n        keyCode: 121,\n        code: 'F10',\n        key: 'F10'\n    },\n    F11: {\n        keyCode: 122,\n        code: 'F11',\n        key: 'F11'\n    },\n    F12: {\n        keyCode: 123,\n        code: 'F12',\n        key: 'F12'\n    },\n    F13: {\n        keyCode: 124,\n        code: 'F13',\n        key: 'F13'\n    },\n    F14: {\n        keyCode: 125,\n        code: 'F14',\n        key: 'F14'\n    },\n    F15: {\n        keyCode: 126,\n        code: 'F15',\n        key: 'F15'\n    },\n    F16: {\n        keyCode: 127,\n        code: 'F16',\n        key: 'F16'\n    },\n    F17: {\n        keyCode: 128,\n        code: 'F17',\n        key: 'F17'\n    },\n    F18: {\n        keyCode: 129,\n        code: 'F18',\n        key: 'F18'\n    },\n    F19: {\n        keyCode: 130,\n        code: 'F19',\n        key: 'F19'\n    },\n    F20: {\n        keyCode: 131,\n        code: 'F20',\n        key: 'F20'\n    },\n    F21: {\n        keyCode: 132,\n        code: 'F21',\n        key: 'F21'\n    },\n    F22: {\n        keyCode: 133,\n        code: 'F22',\n        key: 'F22'\n    },\n    F23: {\n        keyCode: 134,\n        code: 'F23',\n        key: 'F23'\n    },\n    F24: {\n        keyCode: 135,\n        code: 'F24',\n        key: 'F24'\n    },\n    NumLock: {\n        keyCode: 144,\n        code: 'NumLock',\n        key: 'NumLock'\n    },\n    ScrollLock: {\n        keyCode: 145,\n        code: 'ScrollLock',\n        key: 'ScrollLock'\n    },\n    AudioVolumeMute: {\n        keyCode: 173,\n        code: 'AudioVolumeMute',\n        key: 'AudioVolumeMute'\n    },\n    AudioVolumeDown: {\n        keyCode: 174,\n        code: 'AudioVolumeDown',\n        key: 'AudioVolumeDown'\n    },\n    AudioVolumeUp: {\n        keyCode: 175,\n        code: 'AudioVolumeUp',\n        key: 'AudioVolumeUp'\n    },\n    MediaTrackNext: {\n        keyCode: 176,\n        code: 'MediaTrackNext',\n        key: 'MediaTrackNext'\n    },\n    MediaTrackPrevious: {\n        keyCode: 177,\n        code: 'MediaTrackPrevious',\n        key: 'MediaTrackPrevious'\n    },\n    MediaStop: {\n        keyCode: 178,\n        code: 'MediaStop',\n        key: 'MediaStop'\n    },\n    MediaPlayPause: {\n        keyCode: 179,\n        code: 'MediaPlayPause',\n        key: 'MediaPlayPause'\n    },\n    Semicolon: {\n        keyCode: 186,\n        code: 'Semicolon',\n        shiftKey: ':',\n        key: ';'\n    },\n    Equal: {\n        keyCode: 187,\n        code: 'Equal',\n        shiftKey: '+',\n        key: '='\n    },\n    NumpadEqual: {\n        keyCode: 187,\n        code: 'NumpadEqual',\n        key: '=',\n        location: 3\n    },\n    Comma: {\n        keyCode: 188,\n        code: 'Comma',\n        shiftKey: '<',\n        key: ','\n    },\n    Minus: {\n        keyCode: 189,\n        code: 'Minus',\n        shiftKey: '_',\n        key: '-'\n    },\n    Period: {\n        keyCode: 190,\n        code: 'Period',\n        shiftKey: '>',\n        key: '.'\n    },\n    Slash: {\n        keyCode: 191,\n        code: 'Slash',\n        shiftKey: '?',\n        key: '/'\n    },\n    Backquote: {\n        keyCode: 192,\n        code: 'Backquote',\n        shiftKey: '~',\n        key: '`'\n    },\n    BracketLeft: {\n        keyCode: 219,\n        code: 'BracketLeft',\n        shiftKey: '{',\n        key: '['\n    },\n    Backslash: {\n        keyCode: 220,\n        code: 'Backslash',\n        shiftKey: '|',\n        key: '\\\\'\n    },\n    BracketRight: {\n        keyCode: 221,\n        code: 'BracketRight',\n        shiftKey: '}',\n        key: ']'\n    },\n    Quote: {\n        keyCode: 222,\n        code: 'Quote',\n        shiftKey: '\"',\n        key: \"'\"\n    },\n    AltGraph: {\n        keyCode: 225,\n        code: 'AltGraph',\n        key: 'AltGraph'\n    },\n    Props: {\n        keyCode: 247,\n        code: 'Props',\n        key: 'CrSel'\n    },\n    Cancel: {\n        keyCode: 3,\n        key: 'Cancel',\n        code: 'Abort'\n    },\n    Clear: {\n        keyCode: 12,\n        key: 'Clear',\n        code: 'Numpad5',\n        location: 3\n    },\n    Shift: {\n        keyCode: 16,\n        key: 'Shift',\n        code: 'ShiftLeft',\n        location: 1\n    },\n    Control: {\n        keyCode: 17,\n        key: 'Control',\n        code: 'ControlLeft',\n        location: 1\n    },\n    Alt: {\n        keyCode: 18,\n        key: 'Alt',\n        code: 'AltLeft',\n        location: 1\n    },\n    Accept: {\n        keyCode: 30,\n        key: 'Accept'\n    },\n    ModeChange: {\n        keyCode: 31,\n        key: 'ModeChange'\n    },\n    ' ': {\n        keyCode: 32,\n        key: ' ',\n        code: 'Space'\n    },\n    Print: {\n        keyCode: 42,\n        key: 'Print'\n    },\n    Execute: {\n        keyCode: 43,\n        key: 'Execute',\n        code: 'Open'\n    },\n    '\\u0000': {\n        keyCode: 46,\n        key: '\\u0000',\n        code: 'NumpadDecimal',\n        location: 3\n    },\n    a: {\n        keyCode: 65,\n        key: 'a',\n        code: 'KeyA'\n    },\n    b: {\n        keyCode: 66,\n        key: 'b',\n        code: 'KeyB'\n    },\n    c: {\n        keyCode: 67,\n        key: 'c',\n        code: 'KeyC'\n    },\n    d: {\n        keyCode: 68,\n        key: 'd',\n        code: 'KeyD'\n    },\n    e: {\n        keyCode: 69,\n        key: 'e',\n        code: 'KeyE'\n    },\n    f: {\n        keyCode: 70,\n        key: 'f',\n        code: 'KeyF'\n    },\n    g: {\n        keyCode: 71,\n        key: 'g',\n        code: 'KeyG'\n    },\n    h: {\n        keyCode: 72,\n        key: 'h',\n        code: 'KeyH'\n    },\n    i: {\n        keyCode: 73,\n        key: 'i',\n        code: 'KeyI'\n    },\n    j: {\n        keyCode: 74,\n        key: 'j',\n        code: 'KeyJ'\n    },\n    k: {\n        keyCode: 75,\n        key: 'k',\n        code: 'KeyK'\n    },\n    l: {\n        keyCode: 76,\n        key: 'l',\n        code: 'KeyL'\n    },\n    m: {\n        keyCode: 77,\n        key: 'm',\n        code: 'KeyM'\n    },\n    n: {\n        keyCode: 78,\n        key: 'n',\n        code: 'KeyN'\n    },\n    o: {\n        keyCode: 79,\n        key: 'o',\n        code: 'KeyO'\n    },\n    p: {\n        keyCode: 80,\n        key: 'p',\n        code: 'KeyP'\n    },\n    q: {\n        keyCode: 81,\n        key: 'q',\n        code: 'KeyQ'\n    },\n    r: {\n        keyCode: 82,\n        key: 'r',\n        code: 'KeyR'\n    },\n    s: {\n        keyCode: 83,\n        key: 's',\n        code: 'KeyS'\n    },\n    t: {\n        keyCode: 84,\n        key: 't',\n        code: 'KeyT'\n    },\n    u: {\n        keyCode: 85,\n        key: 'u',\n        code: 'KeyU'\n    },\n    v: {\n        keyCode: 86,\n        key: 'v',\n        code: 'KeyV'\n    },\n    w: {\n        keyCode: 87,\n        key: 'w',\n        code: 'KeyW'\n    },\n    x: {\n        keyCode: 88,\n        key: 'x',\n        code: 'KeyX'\n    },\n    y: {\n        keyCode: 89,\n        key: 'y',\n        code: 'KeyY'\n    },\n    z: {\n        keyCode: 90,\n        key: 'z',\n        code: 'KeyZ'\n    },\n    Meta: {\n        keyCode: 91,\n        key: 'Meta',\n        code: 'MetaLeft',\n        location: 1\n    },\n    '*': {\n        keyCode: 106,\n        key: '*',\n        code: 'NumpadMultiply',\n        location: 3\n    },\n    '+': {\n        keyCode: 107,\n        key: '+',\n        code: 'NumpadAdd',\n        location: 3\n    },\n    '-': {\n        keyCode: 109,\n        key: '-',\n        code: 'NumpadSubtract',\n        location: 3\n    },\n    '/': {\n        keyCode: 111,\n        key: '/',\n        code: 'NumpadDivide',\n        location: 3\n    },\n    ';': {\n        keyCode: 186,\n        key: ';',\n        code: 'Semicolon'\n    },\n    '=': {\n        keyCode: 187,\n        key: '=',\n        code: 'Equal'\n    },\n    ',': {\n        keyCode: 188,\n        key: ',',\n        code: 'Comma'\n    },\n    '.': {\n        keyCode: 190,\n        key: '.',\n        code: 'Period'\n    },\n    '`': {\n        keyCode: 192,\n        key: '`',\n        code: 'Backquote'\n    },\n    '[': {\n        keyCode: 219,\n        key: '[',\n        code: 'BracketLeft'\n    },\n    '\\\\': {\n        keyCode: 220,\n        key: '\\\\',\n        code: 'Backslash'\n    },\n    ']': {\n        keyCode: 221,\n        key: ']',\n        code: 'BracketRight'\n    },\n    \"'\": {\n        keyCode: 222,\n        key: \"'\",\n        code: 'Quote'\n    },\n    Attn: {\n        keyCode: 246,\n        key: 'Attn'\n    },\n    CrSel: {\n        keyCode: 247,\n        key: 'CrSel',\n        code: 'Props'\n    },\n    ExSel: {\n        keyCode: 248,\n        key: 'ExSel'\n    },\n    EraseEof: {\n        keyCode: 249,\n        key: 'EraseEof'\n    },\n    Play: {\n        keyCode: 250,\n        key: 'Play'\n    },\n    ZoomOut: {\n        keyCode: 251,\n        key: 'ZoomOut'\n    },\n    ')': {\n        keyCode: 48,\n        key: ')',\n        code: 'Digit0'\n    },\n    '!': {\n        keyCode: 49,\n        key: '!',\n        code: 'Digit1'\n    },\n    '@': {\n        keyCode: 50,\n        key: '@',\n        code: 'Digit2'\n    },\n    '#': {\n        keyCode: 51,\n        key: '#',\n        code: 'Digit3'\n    },\n    $: {\n        keyCode: 52,\n        key: '$',\n        code: 'Digit4'\n    },\n    '%': {\n        keyCode: 53,\n        key: '%',\n        code: 'Digit5'\n    },\n    '^': {\n        keyCode: 54,\n        key: '^',\n        code: 'Digit6'\n    },\n    '&': {\n        keyCode: 55,\n        key: '&',\n        code: 'Digit7'\n    },\n    '(': {\n        keyCode: 57,\n        key: '(',\n        code: 'Digit9'\n    },\n    A: {\n        keyCode: 65,\n        key: 'A',\n        code: 'KeyA'\n    },\n    B: {\n        keyCode: 66,\n        key: 'B',\n        code: 'KeyB'\n    },\n    C: {\n        keyCode: 67,\n        key: 'C',\n        code: 'KeyC'\n    },\n    D: {\n        keyCode: 68,\n        key: 'D',\n        code: 'KeyD'\n    },\n    E: {\n        keyCode: 69,\n        key: 'E',\n        code: 'KeyE'\n    },\n    F: {\n        keyCode: 70,\n        key: 'F',\n        code: 'KeyF'\n    },\n    G: {\n        keyCode: 71,\n        key: 'G',\n        code: 'KeyG'\n    },\n    H: {\n        keyCode: 72,\n        key: 'H',\n        code: 'KeyH'\n    },\n    I: {\n        keyCode: 73,\n        key: 'I',\n        code: 'KeyI'\n    },\n    J: {\n        keyCode: 74,\n        key: 'J',\n        code: 'KeyJ'\n    },\n    K: {\n        keyCode: 75,\n        key: 'K',\n        code: 'KeyK'\n    },\n    L: {\n        keyCode: 76,\n        key: 'L',\n        code: 'KeyL'\n    },\n    M: {\n        keyCode: 77,\n        key: 'M',\n        code: 'KeyM'\n    },\n    N: {\n        keyCode: 78,\n        key: 'N',\n        code: 'KeyN'\n    },\n    O: {\n        keyCode: 79,\n        key: 'O',\n        code: 'KeyO'\n    },\n    P: {\n        keyCode: 80,\n        key: 'P',\n        code: 'KeyP'\n    },\n    Q: {\n        keyCode: 81,\n        key: 'Q',\n        code: 'KeyQ'\n    },\n    R: {\n        keyCode: 82,\n        key: 'R',\n        code: 'KeyR'\n    },\n    S: {\n        keyCode: 83,\n        key: 'S',\n        code: 'KeyS'\n    },\n    T: {\n        keyCode: 84,\n        key: 'T',\n        code: 'KeyT'\n    },\n    U: {\n        keyCode: 85,\n        key: 'U',\n        code: 'KeyU'\n    },\n    V: {\n        keyCode: 86,\n        key: 'V',\n        code: 'KeyV'\n    },\n    W: {\n        keyCode: 87,\n        key: 'W',\n        code: 'KeyW'\n    },\n    X: {\n        keyCode: 88,\n        key: 'X',\n        code: 'KeyX'\n    },\n    Y: {\n        keyCode: 89,\n        key: 'Y',\n        code: 'KeyY'\n    },\n    Z: {\n        keyCode: 90,\n        key: 'Z',\n        code: 'KeyZ'\n    },\n    ':': {\n        keyCode: 186,\n        key: ':',\n        code: 'Semicolon'\n    },\n    '<': {\n        keyCode: 188,\n        key: '<',\n        code: 'Comma'\n    },\n    _: {\n        keyCode: 189,\n        key: '_',\n        code: 'Minus'\n    },\n    '>': {\n        keyCode: 190,\n        key: '>',\n        code: 'Period'\n    },\n    '?': {\n        keyCode: 191,\n        key: '?',\n        code: 'Slash'\n    },\n    '~': {\n        keyCode: 192,\n        key: '~',\n        code: 'Backquote'\n    },\n    '{': {\n        keyCode: 219,\n        key: '{',\n        code: 'BracketLeft'\n    },\n    '|': {\n        keyCode: 220,\n        key: '|',\n        code: 'Backslash'\n    },\n    '}': {\n        keyCode: 221,\n        key: '}',\n        code: 'BracketRight'\n    },\n    '\"': {\n        keyCode: 222,\n        key: '\"',\n        code: 'Quote'\n    },\n    SoftLeft: {\n        key: 'SoftLeft',\n        code: 'SoftLeft',\n        location: 4\n    },\n    SoftRight: {\n        key: 'SoftRight',\n        code: 'SoftRight',\n        location: 4\n    },\n    Camera: {\n        keyCode: 44,\n        key: 'Camera',\n        code: 'Camera',\n        location: 4\n    },\n    Call: {\n        key: 'Call',\n        code: 'Call',\n        location: 4\n    },\n    EndCall: {\n        keyCode: 95,\n        key: 'EndCall',\n        code: 'EndCall',\n        location: 4\n    },\n    VolumeDown: {\n        keyCode: 182,\n        key: 'VolumeDown',\n        code: 'VolumeDown',\n        location: 4\n    },\n    VolumeUp: {\n        keyCode: 183,\n        key: 'VolumeUp',\n        code: 'VolumeUp',\n        location: 4\n    }\n};\nconst lowerCaseKeyDefinitions = Object.entries(_keyDefinitions).reduce((acc, [key, definition])=>{\n    const lowerKey = key.toLowerCase();\n    if (lowerKey !== key) acc[lowerKey] = definition;\n    return acc;\n}, {});\nconst getKeyDefinition = (key)=>{\n    const lowerKey = key.toLowerCase();\n    if (lowerCaseKeyDefinitions[lowerKey]) return lowerCaseKeyDefinitions[lowerKey].key;\n    return key;\n};\nconst isMac = 'undefined' != typeof window ? /Mac|iPod|iPhone|iPad/.test(window.navigator.platform) : 'darwin' === process.platform;\nconst keyMap = {\n    return: _keyDefinitions.Enter.key,\n    enter: _keyDefinitions.Enter.key,\n    ctrl: isMac ? _keyDefinitions.Meta.key : _keyDefinitions.Control.key,\n    shift: _keyDefinitions.Shift.key,\n    alt: _keyDefinitions.Alt.key,\n    space: _keyDefinitions.Space.key,\n    'page down': _keyDefinitions.PageDown.key,\n    pagedown: _keyDefinitions.PageDown.key,\n    'page up': _keyDefinitions.PageUp.key,\n    pageup: _keyDefinitions.PageUp.key\n};\nfunction transformHotkeyInput(keyInput) {\n    if (keyMap[keyInput.toLowerCase()]) return [\n        getKeyDefinition(keyMap[keyInput.toLowerCase()])\n    ];\n    return keyInput.split(' ').map((key)=>getKeyDefinition(keyMap[key.toLowerCase()] || key));\n}\nexport { _keyDefinitions, getKeyDefinition, isMac, transformHotkeyInput };\n","import type {\n  PlanningAIResponse,\n  PlanningAction,\n  Size,\n  UIContext,\n} from '@/types';\nimport { type IModelConfig, UITarsModelVersion } from '@midscene/shared/env';\nimport { resizeImgBase64 } from '@midscene/shared/img';\nimport { getDebug } from '@midscene/shared/logger';\nimport { transformHotkeyInput } from '@midscene/shared/us-keyboard-layout';\nimport { assert } from '@midscene/shared/utils';\nimport { actionParser } from '@ui-tars/action-parser';\nimport { AIActionType } from '../common';\nimport type { ConversationHistory } from './conversation-history';\nimport { getSummary, getUiTarsPlanningPrompt } from './prompt/ui-tars-planning';\nimport { callAIWithStringResponse } from './service-caller/index';\ntype ActionType =\n  | 'click'\n  | 'left_double'\n  | 'right_single'\n  | 'drag'\n  | 'type'\n  | 'hotkey'\n  | 'finished'\n  | 'scroll'\n  | 'wait';\n\nconst debug = getDebug('ui-tars-planning');\nconst bboxSize = 10;\nconst pointToBbox = (\n  point: { x: number; y: number },\n  width: number,\n  height: number,\n): [number, number, number, number] => {\n  return [\n    Math.round(Math.max(point.x - bboxSize / 2, 0)),\n    Math.round(Math.max(point.y - bboxSize / 2, 0)),\n    Math.round(Math.min(point.x + bboxSize / 2, width)),\n    Math.round(Math.min(point.y + bboxSize / 2, height)),\n  ];\n};\n\nexport async function uiTarsPlanning(\n  userInstruction: string,\n  options: {\n    conversationHistory: ConversationHistory;\n    context: UIContext;\n    modelConfig: IModelConfig;\n    actionContext?: string;\n  },\n): Promise<PlanningAIResponse> {\n  const { conversationHistory, context, modelConfig, actionContext } = options;\n  const { uiTarsModelVersion } = modelConfig;\n\n  let instruction = userInstruction;\n  if (actionContext) {\n    instruction = `<high_priority_knowledge>${actionContext}</high_priority_knowledge>\\n<user_instruction>${userInstruction}</user_instruction>`;\n  }\n\n  const systemPrompt = getUiTarsPlanningPrompt() + instruction;\n\n  const imagePayload = await resizeImageForUiTars(\n    context.screenshotBase64,\n    context.size,\n    uiTarsModelVersion,\n  );\n\n  conversationHistory.append({\n    role: 'user',\n    content: [\n      {\n        type: 'image_url',\n        image_url: {\n          url: imagePayload,\n        },\n      },\n    ],\n  });\n\n  const res = await callAIWithStringResponse(\n    [\n      {\n        role: 'user',\n        content: systemPrompt,\n      },\n      ...conversationHistory.snapshot(),\n    ],\n    AIActionType.INSPECT_ELEMENT,\n    modelConfig,\n  );\n  const convertedText = convertBboxToCoordinates(res.content);\n\n  const { size } = context;\n  const { parsed } = actionParser({\n    prediction: convertedText,\n    factor: [1000, 1000],\n    screenContext: {\n      width: size.width,\n      height: size.height,\n    },\n    modelVer: uiTarsModelVersion,\n  });\n\n  debug(\n    'ui-tars modelVer',\n    uiTarsModelVersion,\n    ', parsed',\n    JSON.stringify(parsed),\n  );\n\n  const transformActions: PlanningAction[] = [];\n  const unhandledActions: Array<{ type: string; thought: string }> = [];\n  let shouldContinue = true;\n  parsed.forEach((action) => {\n    const actionType = (action.action_type || '').toLowerCase();\n    if (actionType === 'click') {\n      assert(action.action_inputs.start_box, 'start_box is required');\n      const point = getPoint(action.action_inputs.start_box, size);\n      transformActions.push({\n        type: 'Tap',\n        param: {\n          locate: {\n            prompt: action.thought || '',\n            bbox: pointToBbox(\n              { x: point[0], y: point[1] },\n              size.width,\n              size.height,\n            ),\n          },\n        },\n      });\n    } else if (actionType === 'left_double') {\n      assert(action.action_inputs.start_box, 'start_box is required');\n      const point = getPoint(action.action_inputs.start_box, size);\n      transformActions.push({\n        type: 'DoubleClick',\n        param: {\n          locate: {\n            prompt: action.thought || '',\n            bbox: pointToBbox(\n              { x: point[0], y: point[1] },\n              size.width,\n              size.height,\n            ),\n          },\n        },\n        thought: action.thought || '',\n      });\n    } else if (actionType === 'right_single') {\n      assert(action.action_inputs.start_box, 'start_box is required');\n      const point = getPoint(action.action_inputs.start_box, size);\n      transformActions.push({\n        type: 'RightClick',\n        param: {\n          locate: {\n            prompt: action.thought || '',\n            bbox: pointToBbox(\n              { x: point[0], y: point[1] },\n              size.width,\n              size.height,\n            ),\n          },\n        },\n        thought: action.thought || '',\n      });\n    } else if (actionType === 'drag') {\n      assert(action.action_inputs.start_box, 'start_box is required');\n      assert(action.action_inputs.end_box, 'end_box is required');\n      const startPoint = getPoint(action.action_inputs.start_box, size);\n      const endPoint = getPoint(action.action_inputs.end_box, size);\n      transformActions.push({\n        type: 'DragAndDrop',\n        param: {\n          from: {\n            prompt: action.thought || '',\n            bbox: pointToBbox(\n              { x: startPoint[0], y: startPoint[1] },\n              size.width,\n              size.height,\n            ),\n          },\n          to: {\n            prompt: action.thought || '',\n            bbox: pointToBbox(\n              { x: endPoint[0], y: endPoint[1] },\n              size.width,\n              size.height,\n            ),\n          },\n        },\n        thought: action.thought || '',\n      });\n    } else if (actionType === 'type') {\n      transformActions.push({\n        type: 'Input',\n        param: {\n          value: action.action_inputs.content,\n        },\n        thought: action.thought || '',\n      });\n    } else if (actionType === 'scroll') {\n      transformActions.push({\n        type: 'Scroll',\n        param: {\n          direction: action.action_inputs.direction,\n        },\n        thought: action.thought || '',\n      });\n    } else if (actionType === 'finished') {\n      shouldContinue = false;\n      transformActions.push({\n        type: 'Finished',\n        param: {},\n        thought: action.thought || '',\n      });\n    } else if (actionType === 'hotkey') {\n      if (!action.action_inputs.key) {\n        console.warn(\n          'No key found in action: hotkey. Will not perform action.',\n        );\n      } else {\n        const keys = transformHotkeyInput(action.action_inputs.key);\n\n        transformActions.push({\n          type: 'KeyboardPress',\n          param: {\n            keyName: keys,\n          },\n          thought: action.thought || '',\n        });\n      }\n    } else if (actionType === 'wait') {\n      transformActions.push({\n        type: 'Sleep',\n        param: {\n          timeMs: 1000,\n        },\n        thought: action.thought || '',\n      });\n    } else if (actionType) {\n      // Track unhandled action types\n      unhandledActions.push({\n        type: actionType,\n        thought: action.thought || '',\n      });\n      debug('Unhandled action type:', actionType, 'thought:', action.thought);\n    }\n  });\n\n  if (transformActions.length === 0) {\n    const errorDetails: string[] = [];\n\n    // Check if parsing failed\n    if (parsed.length === 0) {\n      errorDetails.push('Action parser returned no actions');\n\n      // Check if response has Thought but no Action\n      if (\n        res.content.includes('Thought:') &&\n        !res.content.includes('Action:')\n      ) {\n        errorDetails.push(\n          'Response contains \"Thought:\" but missing \"Action:\" line',\n        );\n      } else {\n        errorDetails.push('Response may be malformed or empty');\n      }\n    }\n\n    // Check if we have unhandled action types\n    if (unhandledActions.length > 0) {\n      const types = unhandledActions.map((a) => a.type).join(', ');\n      errorDetails.push(`Unhandled action types: ${types}`);\n    }\n\n    const errorMessage = [\n      'No actions found in UI-TARS response.',\n      ...errorDetails,\n      `\\nRaw response: ${res.content}`,\n    ].join('\\n');\n\n    throw new Error(errorMessage, {\n      cause: {\n        prediction: res.content,\n        parsed,\n        unhandledActions,\n        convertedText,\n      },\n    });\n  }\n\n  debug('transformActions', JSON.stringify(transformActions, null, 2));\n  const log = getSummary(res.content);\n\n  conversationHistory.append({\n    role: 'assistant',\n    content: log,\n  });\n\n  return {\n    actions: transformActions,\n    log,\n    usage: res.usage,\n    rawResponse: JSON.stringify(res.content, undefined, 2),\n    more_actions_needed_by_instruction: shouldContinue,\n  };\n}\n\n/**\n * Converts bounding box notation to coordinate points\n * @param text - The text containing bbox tags to be converted\n * @returns The text with bbox tags replaced by coordinate points\n */\nfunction convertBboxToCoordinates(text: string): string {\n  // Match the four numbers after <bbox>\n  const pattern = /<bbox>(\\d+)\\s+(\\d+)\\s+(\\d+)\\s+(\\d+)<\\/bbox>/g;\n\n  function replaceMatch(\n    match: string,\n    x1: string,\n    y1: string,\n    x2: string,\n    y2: string,\n  ): string {\n    // Convert strings to numbers and calculate center point\n    const x1Num = Number.parseInt(x1, 10);\n    const y1Num = Number.parseInt(y1, 10);\n    const x2Num = Number.parseInt(x2, 10);\n    const y2Num = Number.parseInt(y2, 10);\n\n    // Use Math.floor to truncate and calculate center point\n    const x = Math.floor((x1Num + x2Num) / 2);\n    const y = Math.floor((y1Num + y2Num) / 2);\n\n    // Return formatted coordinate string\n    return `(${x},${y})`;\n  }\n\n  // Remove [EOS] and replace <bbox> coordinates\n  const cleanedText = text.replace(/\\[EOS\\]/g, '');\n  return cleanedText.replace(pattern, replaceMatch).trim();\n}\n\nfunction getPoint(startBox: string, size: { width: number; height: number }) {\n  const [x, y] = JSON.parse(startBox);\n  return [x * size.width, y * size.height];\n}\n\ninterface BaseAction {\n  action_type: ActionType;\n  action_inputs: Record<string, any>;\n  reflection: string | null;\n  thought: string | null;\n}\n\ninterface ClickAction extends BaseAction {\n  action_type: 'click';\n  action_inputs: {\n    start_box: string; // JSON string of [x, y] coordinates\n  };\n}\n\ninterface DragAction extends BaseAction {\n  action_type: 'drag';\n  action_inputs: {\n    start_box: string; // JSON string of [x, y] coordinates\n    end_box: string; // JSON string of [x, y] coordinates\n  };\n}\n\ninterface WaitAction extends BaseAction {\n  action_type: 'wait';\n  action_inputs: {\n    time: string; // JSON string of [x, y] coordinates\n  };\n}\n\ninterface LeftDoubleAction extends BaseAction {\n  action_type: 'left_double';\n  action_inputs: {\n    start_box: string; // JSON string of [x, y] coordinates\n  };\n}\n\ninterface RightSingleAction extends BaseAction {\n  action_type: 'right_single';\n  action_inputs: {\n    start_box: string; // JSON string of [x, y] coordinates\n  };\n}\n\ninterface TypeAction extends BaseAction {\n  action_type: 'type';\n  action_inputs: {\n    content: string;\n  };\n}\n\ninterface HotkeyAction extends BaseAction {\n  action_type: 'hotkey';\n  action_inputs: {\n    key: string;\n  };\n}\n\ninterface ScrollAction extends BaseAction {\n  action_type: 'scroll';\n  action_inputs: {\n    direction: 'up' | 'down';\n  };\n}\n\ninterface FinishedAction extends BaseAction {\n  action_type: 'finished';\n  action_inputs: Record<string, never>;\n}\n\nexport type Action =\n  | ClickAction\n  | LeftDoubleAction\n  | RightSingleAction\n  | DragAction\n  | TypeAction\n  | HotkeyAction\n  | ScrollAction\n  | FinishedAction\n  | WaitAction;\n\nexport async function resizeImageForUiTars(\n  imageBase64: string,\n  size: Size,\n  uiTarsVersion: UITarsModelVersion | undefined,\n) {\n  if (uiTarsVersion === UITarsModelVersion.V1_5) {\n    debug('ui-tars-v1.5, will check image size', size);\n    const currentPixels = size.width * size.height;\n    const maxPixels = 16384 * 28 * 28; //\n    if (currentPixels > maxPixels) {\n      const resizeFactor = Math.sqrt(maxPixels / currentPixels);\n      const newWidth = Math.floor(size.width * resizeFactor);\n      const newHeight = Math.floor(size.height * resizeFactor);\n      debug(\n        'resize image for ui-tars, new width: %s, new height: %s',\n        newWidth,\n        newHeight,\n      );\n      const resizedImage = await resizeImgBase64(imageBase64, {\n        width: newWidth,\n        height: newHeight,\n      });\n      return resizedImage;\n    }\n  }\n  return imageBase64;\n}\n","import type { TUserPrompt } from '@/common';\nimport type {\n  DetailedLocateParam,\n  LocateOption,\n  MidsceneYamlScript,\n} from '@/types';\nimport { getDebug } from '@midscene/shared/logger';\nimport { assert } from '@midscene/shared/utils';\nimport yaml from 'js-yaml';\n\nconst debugUtils = getDebug('yaml:utils');\n\nexport function interpolateEnvVars(content: string): string {\n  // Process line by line to skip commented lines\n  const lines = content.split('\\n');\n  const processedLines = lines.map((line) => {\n    // Check if the line is a YAML comment (starts with # after optional whitespace)\n    const trimmedLine = line.trimStart();\n    if (trimmedLine.startsWith('#')) {\n      // Skip interpolation for comment lines\n      return line;\n    }\n\n    // Process environment variables for non-comment lines\n    return line.replace(/\\$\\{([^}]+)\\}/g, (_, envVar) => {\n      const value = process.env[envVar.trim()];\n      if (value === undefined) {\n        throw new Error(\n          `Environment variable \"${envVar.trim()}\" is not defined`,\n        );\n      }\n      return value;\n    });\n  });\n\n  return processedLines.join('\\n');\n}\n\nexport function parseYamlScript(\n  content: string,\n  filePath?: string,\n): MidsceneYamlScript {\n  let processedContent = content;\n  if (content.indexOf('android') !== -1 && content.match(/deviceId:\\s*(\\d+)/)) {\n    let matchedDeviceId;\n    processedContent = content.replace(\n      /deviceId:\\s*(\\d+)/g,\n      (match, deviceId) => {\n        matchedDeviceId = deviceId;\n        return `deviceId: '${deviceId}'`;\n      },\n    );\n    console.warn(\n      `please use string-style deviceId in yaml script, for example: deviceId: \"${matchedDeviceId}\"`,\n    );\n  }\n  const interpolatedContent = interpolateEnvVars(processedContent);\n  const obj = yaml.load(interpolatedContent, {\n    schema: yaml.JSON_SCHEMA,\n  }) as MidsceneYamlScript;\n\n  const pathTip = filePath ? `, failed to load ${filePath}` : '';\n  assert(obj.tasks, `property \"tasks\" is required in yaml script ${pathTip}`);\n  assert(\n    Array.isArray(obj.tasks),\n    `property \"tasks\" must be an array in yaml script, but got ${obj.tasks}`,\n  );\n  return obj;\n}\n\nexport function buildDetailedLocateParam(\n  locatePrompt: TUserPrompt,\n  opt?: LocateOption,\n): DetailedLocateParam | undefined {\n  debugUtils('will call buildDetailedLocateParam', locatePrompt, opt);\n  let prompt = locatePrompt || opt?.prompt || (opt as any)?.locate; // as a shortcut\n  let deepThink = false;\n  let cacheable = true;\n  let xpath = undefined;\n\n  if (typeof opt === 'object' && opt !== null) {\n    deepThink = opt.deepThink ?? false;\n    cacheable = opt.cacheable ?? true;\n    xpath = opt.xpath;\n    if (locatePrompt && opt.prompt && locatePrompt !== opt.prompt) {\n      console.warn(\n        'conflict prompt for item',\n        locatePrompt,\n        opt,\n        'maybe you put the prompt in the wrong place',\n      );\n    }\n    prompt = prompt || opt.prompt;\n  }\n\n  if (!prompt) {\n    debugUtils(\n      'no prompt, will return undefined in buildDetailedLocateParam',\n      opt,\n    );\n    return undefined;\n  }\n\n  return {\n    prompt,\n    deepThink,\n    cacheable,\n    xpath,\n  };\n}\n\nexport function buildDetailedLocateParamAndRestParams(\n  locatePrompt: TUserPrompt,\n  opt: LocateOption | undefined,\n  excludeKeys: string[] = [],\n): {\n  locateParam: DetailedLocateParam | undefined;\n  restParams: Record<string, any>;\n} {\n  const locateParam = buildDetailedLocateParam(locatePrompt, opt);\n\n  // Extract all keys from opt except the ones already included in locateParam\n  const restParams: Record<string, any> = {};\n\n  if (typeof opt === 'object' && opt !== null) {\n    // Get all keys from opt\n    const allKeys = Object.keys(opt);\n\n    // Keys already included in locateParam: prompt, deepThink, cacheable, xpath\n    const locateParamKeys = Object.keys(locateParam || {});\n\n    // Extract all other keys\n    for (const key of allKeys) {\n      if (\n        !locateParamKeys.includes(key) &&\n        !excludeKeys.includes(key) &&\n        key !== 'locate'\n      ) {\n        restParams[key] = opt[key as keyof LocateOption];\n      }\n    }\n  }\n\n  return {\n    locateParam,\n    restParams,\n  };\n}\n","import { existsSync, mkdirSync, writeFileSync } from 'node:fs';\nimport { basename, dirname, join, resolve } from 'node:path';\nimport { assert, ifInBrowser, ifInWorker } from '@midscene/shared/utils';\nimport { type ZodTypeAny, z } from 'zod';\n\n// previous defined yaml flow, as a helper\ninterface MidsceneYamlFlowItemAIInput extends LocateOption {\n  // previous version\n  // aiInput: string; // value to input\n  // locate: TUserPrompt; // where to input\n  aiInput: TUserPrompt | undefined; // where to input\n  value: string | number; // value to input\n}\n\ninterface MidsceneYamlFlowItemAIKeyboardPress extends LocateOption {\n  // previous version\n  // aiKeyboardPress: string;\n  // locate?: TUserPrompt; // where to press, optional\n  aiKeyboardPress: TUserPrompt | undefined; // where to press\n  keyName: string; // key to press\n}\n\ninterface MidsceneYamlFlowItemAIScroll extends LocateOption, ScrollParam {\n  // previous version\n  // aiScroll: null;\n  // locate?: TUserPrompt; // which area to scroll, optional\n  aiScroll: TUserPrompt | undefined; // which area to scroll\n}\n\nimport type { Agent } from '@/agent/agent';\nimport type { TUserPrompt } from '@/common';\nimport type {\n  DeviceAction,\n  FreeFn,\n  LocateOption,\n  MidsceneYamlFlowItemAIAction,\n  MidsceneYamlFlowItemAIAssert,\n  MidsceneYamlFlowItemAIWaitFor,\n  MidsceneYamlFlowItemEvaluateJavaScript,\n  MidsceneYamlFlowItemLogScreenshot,\n  MidsceneYamlFlowItemSleep,\n  MidsceneYamlScript,\n  MidsceneYamlScriptEnv,\n  ScriptPlayerStatusValue,\n  ScriptPlayerTaskStatus,\n  ScrollParam,\n} from '@/types';\nimport { getMidsceneRunSubDir } from '@midscene/shared/common';\nimport { getDebug } from '@midscene/shared/logger';\nimport {\n  buildDetailedLocateParam,\n  buildDetailedLocateParamAndRestParams,\n} from './utils';\n\nconst debug = getDebug('yaml-player');\nconst aiTaskHandlerMap = {\n  aiQuery: 'aiQuery',\n  aiNumber: 'aiNumber',\n  aiString: 'aiString',\n  aiBoolean: 'aiBoolean',\n  aiAsk: 'aiAsk',\n  aiLocate: 'aiLocate',\n} as const;\n\ntype AISimpleTaskKey = keyof typeof aiTaskHandlerMap;\n\nconst isStringParamSchema = (schema?: ZodTypeAny): boolean => {\n  if (!schema) {\n    return false;\n  }\n\n  const schemaDef = (schema as any)?._def;\n  if (!schemaDef?.typeName) {\n    return false;\n  }\n\n  switch (schemaDef.typeName) {\n    case z.ZodFirstPartyTypeKind.ZodString:\n    case z.ZodFirstPartyTypeKind.ZodEnum:\n    case z.ZodFirstPartyTypeKind.ZodNativeEnum:\n      return true;\n    case z.ZodFirstPartyTypeKind.ZodLiteral:\n      return typeof schemaDef.value === 'string';\n    case z.ZodFirstPartyTypeKind.ZodOptional:\n    case z.ZodFirstPartyTypeKind.ZodNullable:\n    case z.ZodFirstPartyTypeKind.ZodDefault:\n      return isStringParamSchema(schemaDef.innerType);\n    case z.ZodFirstPartyTypeKind.ZodEffects:\n      return isStringParamSchema(schemaDef.schema);\n    case z.ZodFirstPartyTypeKind.ZodPipeline:\n      return isStringParamSchema(schemaDef.out);\n    case z.ZodFirstPartyTypeKind.ZodUnion: {\n      const options = schemaDef.options as ZodTypeAny[] | undefined;\n      return Array.isArray(options)\n        ? options.every((option) => isStringParamSchema(option))\n        : false;\n    }\n    default:\n      return false;\n  }\n};\nexport class ScriptPlayer<T extends MidsceneYamlScriptEnv> {\n  public currentTaskIndex?: number;\n  public taskStatusList: ScriptPlayerTaskStatus[] = [];\n  public status: ScriptPlayerStatusValue = 'init';\n  public reportFile?: string | null;\n  public result: Record<string, any>;\n  private unnamedResultIndex = 0;\n  public output?: string | null;\n  public unstableLogContent?: string | null;\n  public errorInSetup?: Error;\n  private interfaceAgent: Agent | null = null;\n  public agentStatusTip?: string;\n  public target?: MidsceneYamlScriptEnv;\n  private actionSpace: DeviceAction[] = [];\n  private scriptPath?: string;\n  constructor(\n    private script: MidsceneYamlScript,\n    private setupAgent: (platform: T) => Promise<{\n      agent: Agent;\n      freeFn: FreeFn[];\n    }>,\n    public onTaskStatusChange?: (taskStatus: ScriptPlayerTaskStatus) => void,\n    scriptPath?: string,\n  ) {\n    this.scriptPath = scriptPath;\n    this.result = {};\n    const resolvedAiActContext =\n      script.agent?.aiActContext ?? script.agent?.aiActionContext;\n\n    if (resolvedAiActContext !== undefined && script.agent) {\n      if (\n        script.agent.aiActContext === undefined &&\n        script.agent.aiActionContext !== undefined\n      ) {\n        console.warn(\n          'agent.aiActionContext is deprecated, please use agent.aiActContext instead. The legacy name is still accepted for backward compatibility.',\n        );\n      }\n\n      script.agent.aiActContext = resolvedAiActContext;\n    }\n\n    this.target =\n      script.target ||\n      script.web ||\n      script.android ||\n      script.ios ||\n      script.config;\n\n    if (ifInBrowser || ifInWorker) {\n      this.output = undefined;\n      debug('output is undefined in browser or worker');\n    } else if (this.target?.output) {\n      this.output = resolve(process.cwd(), this.target.output);\n      debug('setting output by config.output', this.output);\n    } else {\n      const scriptName = this.scriptPath\n        ? basename(this.scriptPath, '.yaml').replace(/\\.(ya?ml)$/i, '')\n        : 'script';\n      this.output = join(\n        getMidsceneRunSubDir('output'),\n        `${scriptName}-${Date.now()}.json`,\n      );\n      debug('setting output by script path', this.output);\n    }\n\n    if (ifInBrowser || ifInWorker) {\n      this.unstableLogContent = undefined;\n    } else if (typeof this.target?.unstableLogContent === 'string') {\n      this.unstableLogContent = resolve(\n        process.cwd(),\n        this.target.unstableLogContent,\n      );\n    } else if (this.target?.unstableLogContent === true) {\n      this.unstableLogContent = join(\n        getMidsceneRunSubDir('output'),\n        'unstableLogContent.json',\n      );\n    }\n\n    this.taskStatusList = (script.tasks || []).map((task, taskIndex) => ({\n      ...task,\n      index: taskIndex,\n      status: 'init',\n      totalSteps: task.flow?.length || 0,\n    }));\n  }\n\n  private setResult(key: string | undefined, value: any) {\n    const keyToUse = key || this.unnamedResultIndex++;\n    if (this.result[keyToUse]) {\n      console.warn(`result key ${keyToUse} already exists, will overwrite`);\n    }\n    this.result[keyToUse] = value;\n\n    return this.flushResult();\n  }\n\n  private setPlayerStatus(status: ScriptPlayerStatusValue, error?: Error) {\n    this.status = status;\n    this.errorInSetup = error;\n  }\n\n  private notifyCurrentTaskStatusChange(taskIndex?: number) {\n    const taskIndexToNotify =\n      typeof taskIndex === 'number' ? taskIndex : this.currentTaskIndex;\n\n    if (typeof taskIndexToNotify !== 'number') {\n      return;\n    }\n\n    const taskStatus = this.taskStatusList[taskIndexToNotify];\n    if (this.onTaskStatusChange) {\n      this.onTaskStatusChange(taskStatus);\n    }\n  }\n\n  private async setTaskStatus(\n    index: number,\n    statusValue: ScriptPlayerStatusValue,\n    error?: Error,\n  ) {\n    this.taskStatusList[index].status = statusValue;\n    if (error) {\n      this.taskStatusList[index].error = error;\n    }\n\n    this.notifyCurrentTaskStatusChange(index);\n  }\n\n  private setTaskIndex(taskIndex: number) {\n    this.currentTaskIndex = taskIndex;\n  }\n\n  private flushResult() {\n    if (this.output) {\n      const output = resolve(process.cwd(), this.output);\n      const outputDir = dirname(output);\n      if (!existsSync(outputDir)) {\n        mkdirSync(outputDir, { recursive: true });\n      }\n      writeFileSync(output, JSON.stringify(this.result || {}, undefined, 2));\n    }\n  }\n\n  private flushUnstableLogContent() {\n    if (this.unstableLogContent) {\n      const content = this.interfaceAgent?._unstableLogContent();\n      const filePath = resolve(process.cwd(), this.unstableLogContent);\n      const outputDir = dirname(filePath);\n      if (!existsSync(outputDir)) {\n        mkdirSync(outputDir, { recursive: true });\n      }\n      writeFileSync(filePath, JSON.stringify(content, null, 2));\n    }\n  }\n\n  async playTask(taskStatus: ScriptPlayerTaskStatus, agent: Agent) {\n    const { flow } = taskStatus;\n    assert(flow, 'missing flow in task');\n\n    for (const flowItemIndex in flow) {\n      const currentStep = Number.parseInt(flowItemIndex, 10);\n      taskStatus.currentStep = currentStep;\n      const flowItem = flow[flowItemIndex];\n      debug(\n        `playing step ${flowItemIndex}, flowItem=${JSON.stringify(flowItem)}`,\n      );\n      const simpleAIKey = (\n        Object.keys(aiTaskHandlerMap) as AISimpleTaskKey[]\n      ).find((key) => Object.prototype.hasOwnProperty.call(flowItem, key));\n      if (\n        'aiAct' in (flowItem as MidsceneYamlFlowItemAIAction) ||\n        'aiAction' in (flowItem as MidsceneYamlFlowItemAIAction) ||\n        'ai' in (flowItem as MidsceneYamlFlowItemAIAction)\n      ) {\n        const actionTask = flowItem as MidsceneYamlFlowItemAIAction;\n        const { aiAct, aiAction, ai, ...actionOptions } = actionTask;\n        const prompt = aiAct || aiAction || ai;\n        assert(prompt, 'missing prompt for ai (aiAct)');\n        await agent.aiAct(prompt, actionOptions);\n      } else if ('aiAssert' in (flowItem as MidsceneYamlFlowItemAIAssert)) {\n        const assertTask = flowItem as MidsceneYamlFlowItemAIAssert;\n        const prompt = assertTask.aiAssert;\n        const msg = assertTask.errorMessage;\n        assert(prompt, 'missing prompt for aiAssert');\n        const { pass, thought, message } =\n          (await agent.aiAssert(prompt, msg, {\n            keepRawResponse: true,\n          })) || {};\n\n        this.setResult(assertTask.name, {\n          pass,\n          thought,\n          message,\n        });\n\n        if (!pass) {\n          throw new Error(message);\n        }\n      } else if (simpleAIKey) {\n        const {\n          [simpleAIKey]: prompt,\n          name,\n          ...options\n        } = flowItem as Record<string, any>;\n        assert(prompt, `missing prompt for ${simpleAIKey}`);\n        const agentMethod = (agent as any)[aiTaskHandlerMap[simpleAIKey]];\n        assert(\n          typeof agentMethod === 'function',\n          `missing agent method for ${simpleAIKey}`,\n        );\n        const aiResult = await agentMethod.call(agent, prompt, options);\n        this.setResult(name, aiResult);\n      } else if ('aiWaitFor' in (flowItem as MidsceneYamlFlowItemAIWaitFor)) {\n        const waitForTask = flowItem as MidsceneYamlFlowItemAIWaitFor;\n        const { aiWaitFor, timeout, ...restWaitForOpts } = waitForTask;\n        const prompt = aiWaitFor;\n        assert(prompt, 'missing prompt for aiWaitFor');\n        const waitForOptions = {\n          ...restWaitForOpts,\n          ...(timeout !== undefined ? { timeout, timeoutMs: timeout } : {}),\n        };\n        await agent.aiWaitFor(prompt, waitForOptions);\n      } else if ('sleep' in (flowItem as MidsceneYamlFlowItemSleep)) {\n        const sleepTask = flowItem as MidsceneYamlFlowItemSleep;\n        const ms = sleepTask.sleep;\n        let msNumber = ms;\n        if (typeof ms === 'string') {\n          msNumber = Number.parseInt(ms, 10);\n        }\n        assert(\n          msNumber && msNumber > 0,\n          `ms for sleep must be greater than 0, but got ${ms}`,\n        );\n        await new Promise((resolve) => setTimeout(resolve, msNumber));\n      } else if (\n        'javascript' in (flowItem as MidsceneYamlFlowItemEvaluateJavaScript)\n      ) {\n        const evaluateJavaScriptTask =\n          flowItem as MidsceneYamlFlowItemEvaluateJavaScript;\n\n        const result = await agent.evaluateJavaScript(\n          evaluateJavaScriptTask.javascript,\n        );\n        this.setResult(evaluateJavaScriptTask.name, result);\n      } else if (\n        'logScreenshot' in (flowItem as MidsceneYamlFlowItemLogScreenshot) ||\n        'recordToReport' in (flowItem as MidsceneYamlFlowItemLogScreenshot)\n      ) {\n        const recordTask = flowItem as MidsceneYamlFlowItemLogScreenshot;\n        const title =\n          recordTask.recordToReport ?? recordTask.logScreenshot ?? 'untitled';\n        const content = recordTask.content || '';\n        await agent.recordToReport(title, { content });\n      } else if ('aiInput' in (flowItem as MidsceneYamlFlowItemAIInput)) {\n        // may be input empty string ''\n        const {\n          aiInput,\n          value: rawValue,\n          ...inputTask\n        } = flowItem as MidsceneYamlFlowItemAIInput;\n\n        // Compatibility with previous version:\n        // Old format: { aiInput: string (value), locate: TUserPrompt }\n        // New format - 1: { aiInput: TUserPrompt, value: string | number }\n        // New format - 2: { aiInput: undefined, locate: TUserPrompt, value: string | number }\n        let locatePrompt: TUserPrompt | undefined;\n        let value: string | number | undefined;\n        if ((inputTask as any).locate) {\n          // Old format - aiInput is the value, locate is the prompt\n          // Keep backward compatibility: empty string is treated as no value\n          value = (aiInput as string | number) || rawValue;\n          locatePrompt = (inputTask as any).locate;\n        } else {\n          // New format - aiInput is the prompt, value is the value\n          locatePrompt = aiInput || '';\n          value = rawValue;\n        }\n\n        // Convert value to string for Input action\n        await agent.callActionInActionSpace('Input', {\n          ...inputTask,\n          ...(value !== undefined ? { value: String(value) } : {}),\n          ...(locatePrompt\n            ? { locate: buildDetailedLocateParam(locatePrompt, inputTask) }\n            : {}),\n        });\n      } else if (\n        'aiKeyboardPress' in (flowItem as MidsceneYamlFlowItemAIKeyboardPress)\n      ) {\n        const { aiKeyboardPress, ...keyboardPressTask } =\n          flowItem as MidsceneYamlFlowItemAIKeyboardPress;\n\n        // Compatibility with previous version:\n        // Old format: { aiKeyboardPress: string (key), locate?: TUserPrompt }\n        // New format - 1: { aiKeyboardPress: TUserPrompt, keyName: string }\n        // New format - 2: { aiKeyboardPress: , locate?: TUserPrompt, keyName: string }\n        let locatePrompt: TUserPrompt | undefined;\n        let keyName: string | undefined;\n        if ((keyboardPressTask as any).locate) {\n          // Old format - aiKeyboardPress is the key, locate is the prompt\n          keyName = aiKeyboardPress as string;\n          locatePrompt = (keyboardPressTask as any).locate;\n        } else if (keyboardPressTask.keyName) {\n          // New format - aiKeyboardPress is the prompt, key is the key\n          keyName = keyboardPressTask.keyName;\n          locatePrompt = aiKeyboardPress;\n        } else {\n          keyName = aiKeyboardPress as string;\n        }\n\n        await agent.callActionInActionSpace('KeyboardPress', {\n          ...keyboardPressTask,\n          ...(keyName ? { keyName } : {}),\n          ...(locatePrompt\n            ? {\n                locate: buildDetailedLocateParam(\n                  locatePrompt,\n                  keyboardPressTask,\n                ),\n              }\n            : {}),\n        });\n      } else if ('aiScroll' in (flowItem as MidsceneYamlFlowItemAIScroll)) {\n        const { aiScroll, ...scrollTask } =\n          flowItem as MidsceneYamlFlowItemAIScroll;\n\n        // Compatibility with previous version:\n        // Old format: { aiScroll: null, locate?: TUserPrompt, direction, scrollType, distance? }\n        // New format - 1: { aiScroll: TUserPrompt, direction, scrollType, distance? }\n        // New format - 2: { aiScroll: undefined, locate: TUserPrompt, direction, scrollType, distance? }\n        const { locate, ...scrollOptions } = scrollTask as any;\n        const locatePrompt: TUserPrompt | undefined = locate ?? aiScroll;\n\n        await agent.aiScroll(locatePrompt, scrollOptions);\n      } else {\n        // generic action, find the action in actionSpace\n\n        /* for aiTap, aiRightClick, the parameters are a flattened data for the 'locate', these are all valid data\n\n        - aiTap: 'search input box'\n        - aiTap: 'search input box'\n          deepThink: true\n          cacheable: false\n        - aiTap:\n          prompt: 'search input box'\n        - aiTap:\n          prompt: 'search input box'\n          deepThink: true\n          cacheable: false\n        */\n\n        const actionSpace = this.actionSpace;\n        let locatePromptShortcut: string | undefined;\n        let actionParamForMatchedAction: unknown;\n        const matchedAction = actionSpace.find((action) => {\n          const actionInterfaceAlias = action.interfaceAlias;\n          if (\n            actionInterfaceAlias &&\n            Object.prototype.hasOwnProperty.call(flowItem, actionInterfaceAlias)\n          ) {\n            actionParamForMatchedAction =\n              flowItem[actionInterfaceAlias as keyof typeof flowItem];\n            if (typeof actionParamForMatchedAction === 'string') {\n              locatePromptShortcut = actionParamForMatchedAction;\n            }\n            return true;\n          }\n\n          const keyOfActionInActionSpace = action.name;\n          if (\n            Object.prototype.hasOwnProperty.call(\n              flowItem,\n              keyOfActionInActionSpace,\n            )\n          ) {\n            actionParamForMatchedAction =\n              flowItem[keyOfActionInActionSpace as keyof typeof flowItem];\n            if (typeof actionParamForMatchedAction === 'string') {\n              locatePromptShortcut = actionParamForMatchedAction;\n            }\n            return true;\n          }\n\n          return false;\n        });\n\n        assert(\n          matchedAction,\n          `unknown flowItem in yaml: ${JSON.stringify(flowItem)}`,\n        );\n\n        const schemaIsStringParam = isStringParamSchema(\n          matchedAction.paramSchema,\n        );\n        let stringParamToCall: string | undefined;\n        if (\n          typeof actionParamForMatchedAction === 'string' &&\n          schemaIsStringParam\n        ) {\n          if (matchedAction.paramSchema) {\n            const parseResult = matchedAction.paramSchema.safeParse(\n              actionParamForMatchedAction,\n            );\n            if (parseResult.success && typeof parseResult.data === 'string') {\n              stringParamToCall = parseResult.data;\n            } else if (!parseResult.success) {\n              debug(\n                `parse failed for action ${matchedAction.name} with string param`,\n                parseResult.error,\n              );\n              stringParamToCall = actionParamForMatchedAction;\n            }\n          } else {\n            stringParamToCall = actionParamForMatchedAction;\n          }\n        }\n\n        if (stringParamToCall !== undefined) {\n          debug(\n            `matchedAction: ${matchedAction.name}`,\n            `flowParams: ${JSON.stringify(stringParamToCall)}`,\n          );\n          const result = await agent.callActionInActionSpace(\n            matchedAction.name,\n            stringParamToCall,\n          );\n\n          // Store result if there's a name property in flowItem\n          const resultName = (flowItem as any).name;\n          if (result !== undefined) {\n            this.setResult(resultName, result);\n          }\n        } else {\n          // Determine the source for parameter extraction:\n          // - If we have a locatePromptShortcut, use the flowItem (for actions like aiTap with prompt)\n          // - Otherwise, use actionParamForMatchedAction (for actions like runWdaRequest with structured params)\n          const sourceForParams =\n            locatePromptShortcut &&\n            typeof actionParamForMatchedAction === 'string'\n              ? { ...flowItem, prompt: locatePromptShortcut }\n              : typeof actionParamForMatchedAction === 'object' &&\n                  actionParamForMatchedAction !== null\n                ? actionParamForMatchedAction\n                : flowItem;\n\n          const { locateParam, restParams } =\n            buildDetailedLocateParamAndRestParams(\n              locatePromptShortcut || '',\n              sourceForParams as LocateOption,\n              [\n                matchedAction.name,\n                matchedAction.interfaceAlias || '_never_mind_',\n              ],\n            );\n\n          const flowParams = {\n            ...restParams,\n            locate: locateParam,\n          };\n\n          debug(\n            `matchedAction: ${matchedAction.name}`,\n            `flowParams: ${JSON.stringify(flowParams, null, 2)}`,\n          );\n          const result = await agent.callActionInActionSpace(\n            matchedAction.name,\n            flowParams,\n          );\n\n          // Store result if there's a name property in flowItem\n          const resultName = (flowItem as any).name;\n          if (result !== undefined) {\n            this.setResult(resultName, result);\n          }\n        }\n      }\n    }\n    this.reportFile = agent.reportFile;\n    await this.flushUnstableLogContent();\n  }\n\n  async run() {\n    const { target, web, android, ios, tasks } = this.script;\n    const webEnv = web || target;\n    const androidEnv = android;\n    const iosEnv = ios;\n    const platform = webEnv || androidEnv || iosEnv;\n\n    this.setPlayerStatus('running');\n\n    let agent: Agent | null = null;\n    let freeFn: FreeFn[] = [];\n    try {\n      const { agent: newAgent, freeFn: newFreeFn } = await this.setupAgent(\n        platform as T,\n      );\n      this.actionSpace = await newAgent.getActionSpace();\n      agent = newAgent;\n      const originalOnTaskStartTip = agent.onTaskStartTip;\n      agent.onTaskStartTip = (tip) => {\n        if (this.status === 'running') {\n          this.agentStatusTip = tip;\n        }\n        originalOnTaskStartTip?.(tip);\n      };\n      freeFn = [\n        ...(newFreeFn || []),\n        {\n          name: 'restore-agent-onTaskStartTip',\n          fn: () => {\n            if (agent) {\n              agent.onTaskStartTip = originalOnTaskStartTip;\n            }\n          },\n        },\n      ];\n    } catch (e) {\n      this.setPlayerStatus('error', e as Error);\n      return;\n    }\n    this.interfaceAgent = agent;\n\n    let taskIndex = 0;\n    this.setPlayerStatus('running');\n    let errorFlag = false;\n    while (taskIndex < tasks.length) {\n      const taskStatus = this.taskStatusList[taskIndex];\n      this.setTaskStatus(taskIndex, 'running' as any);\n      this.setTaskIndex(taskIndex);\n\n      try {\n        await this.playTask(taskStatus, this.interfaceAgent);\n        this.setTaskStatus(taskIndex, 'done' as any);\n      } catch (e) {\n        this.setTaskStatus(taskIndex, 'error' as any, e as Error);\n\n        if (taskStatus.continueOnError) {\n          // nothing more to do\n        } else {\n          this.reportFile = agent.reportFile;\n          errorFlag = true;\n          break;\n        }\n      }\n      this.reportFile = agent?.reportFile;\n      taskIndex++;\n    }\n\n    if (errorFlag) {\n      this.setPlayerStatus('error');\n    } else {\n      this.setPlayerStatus('done');\n    }\n    this.agentStatusTip = '';\n\n    // free the resources\n    for (const fn of freeFn) {\n      try {\n        // console.log('freeing', fn.name);\n        await fn.fn();\n        // console.log('freed', fn.name);\n      } catch (e) {\n        // console.error('error freeing', fn.name, e);\n      }\n    }\n  }\n}\n","import type { DeviceAction } from '@midscene/core';\nimport { findAllMidsceneLocatorField } from '@midscene/core/ai-model';\nimport { buildDetailedLocateParam } from '@midscene/core/yaml';\nimport type {\n  ExecutionOptions,\n  FormValue,\n  PlaygroundAgent,\n  ValidationResult,\n} from './types';\n\n// APIs that should not generate replay scripts\nexport const dataExtractionAPIs = [\n  'aiQuery',\n  'aiBoolean',\n  'aiNumber',\n  'aiString',\n  'aiAsk',\n];\n\nexport const validationAPIs = ['aiAssert', 'aiWaitFor'];\n\nexport const noReplayAPIs = [...dataExtractionAPIs, ...validationAPIs];\n\nexport const formatErrorMessage = (e: any): string => {\n  const errorMessage = e?.message || '';\n\n  if (errorMessage.includes('of different extension')) {\n    return 'Conflicting extension detected. Please disable the suspicious plugins and refresh the page. Guide: https://midscenejs.com/quick-experience.html#faq';\n  }\n\n  if (errorMessage.includes('NOT_IMPLEMENTED_AS_DESIGNED')) {\n    return 'Further actions cannot be performed in the current environment';\n  }\n\n  return errorMessage || 'Unknown error';\n};\n\n// Parse structured parameters for callActionInActionSpace\nexport async function parseStructuredParams(\n  action: DeviceAction<unknown>,\n  params: Record<string, unknown>,\n  options: ExecutionOptions = {},\n): Promise<unknown[]> {\n  if (!action?.paramSchema || !('shape' in action.paramSchema)) {\n    return [params.prompt || '', options];\n  }\n\n  const schema = action.paramSchema;\n  const keys =\n    schema && 'shape' in schema\n      ? Object.keys((schema as { shape: Record<string, unknown> }).shape)\n      : [];\n\n  // Start with options and merge deviceOptions into the same level\n  // Destructure to exclude deviceOptions from the final object\n  const { deviceOptions: _, ...optionsWithoutDeviceOptions } = options;\n  const paramObj: Record<string, unknown> = {\n    ...optionsWithoutDeviceOptions,\n    ...(options.deviceOptions || {}),\n  };\n\n  keys.forEach((key) => {\n    if (\n      params[key] !== undefined &&\n      params[key] !== null &&\n      params[key] !== ''\n    ) {\n      paramObj[key] = params[key];\n    }\n  });\n\n  // Check if there's a locate field that needs detailed locate param processing\n  if (schema) {\n    const locatorFieldKeys = findAllMidsceneLocatorField(schema);\n    locatorFieldKeys.forEach((locateKey: string) => {\n      const locatePrompt = params[locateKey];\n      if (locatePrompt && typeof locatePrompt === 'string') {\n        // Build detailed locate param using the locate prompt and options\n        const detailedLocateParam = buildDetailedLocateParam(locatePrompt, {\n          deepThink: options.deepThink,\n          cacheable: true, // Default to true for playground\n        });\n        if (detailedLocateParam) {\n          paramObj[locateKey] = detailedLocateParam;\n        }\n      }\n    });\n  }\n\n  return [paramObj];\n}\n\nexport function validateStructuredParams(\n  value: FormValue,\n  action: DeviceAction<unknown> | undefined,\n): ValidationResult {\n  if (!value.params) {\n    return { valid: false, errorMessage: 'Parameters are required' };\n  }\n\n  if (!action?.paramSchema) {\n    return { valid: true };\n  }\n\n  try {\n    const paramsForValidation = { ...value.params };\n\n    const schema = action.paramSchema;\n    if (schema) {\n      const locatorFieldKeys = findAllMidsceneLocatorField(schema);\n      locatorFieldKeys.forEach((key: string) => {\n        if (typeof paramsForValidation[key] === 'string') {\n          paramsForValidation[key] = {\n            midscene_location_field_flag: true,\n            prompt: paramsForValidation[key],\n            center: [0, 0],\n            rect: { left: 0, top: 0, width: 0, height: 0 },\n          };\n        }\n      });\n    }\n\n    action.paramSchema?.parse(paramsForValidation);\n    return { valid: true };\n  } catch (error: unknown) {\n    const zodError = error as {\n      errors?: Array<{ path: string[]; message: string }>;\n    };\n    if (zodError.errors && zodError.errors.length > 0) {\n      const errorMessages = zodError.errors\n        .filter((err) => {\n          const path = err.path.join('.');\n          return (\n            !path.includes('center') &&\n            !path.includes('rect') &&\n            !path.includes('midscene_location_field_flag')\n          );\n        })\n        .map((err) => {\n          const field = err.path.join('.');\n          return `${field}: ${err.message}`;\n        });\n\n      if (errorMessages.length > 0) {\n        return {\n          valid: false,\n          errorMessage: `Validation error: ${errorMessages.join(', ')}`,\n        };\n      }\n    } else {\n      const errorMsg =\n        error instanceof Error ? error.message : 'Unknown validation error';\n      return {\n        valid: false,\n        errorMessage: `Parameter validation failed: ${errorMsg}`,\n      };\n    }\n  }\n\n  return { valid: true };\n}\n\nexport async function executeAction(\n  activeAgent: PlaygroundAgent,\n  actionType: string,\n  actionSpace: DeviceAction<unknown>[],\n  value: FormValue,\n  options: ExecutionOptions,\n): Promise<unknown> {\n  const action = actionSpace?.find(\n    (a: DeviceAction<unknown>) =>\n      a.interfaceAlias === actionType || a.name === actionType,\n  );\n\n  if (action && typeof activeAgent.callActionInActionSpace === 'function') {\n    if (value.params) {\n      const parsedParams = await parseStructuredParams(\n        action,\n        value.params,\n        options,\n      );\n      return await activeAgent.callActionInActionSpace(\n        action.name,\n        parsedParams[0],\n      );\n    } else {\n      // For prompt-based actions, we need to build the detailed locate param\n      const detailedLocateParam = value.prompt\n        ? buildDetailedLocateParam(value.prompt, {\n            deepThink: options.deepThink,\n            cacheable: true,\n          })\n        : undefined;\n\n      // Flatten deviceOptions into the params\n      // Destructure to exclude deviceOptions from the final object\n      const { deviceOptions: _, ...optionsWithoutDeviceOptions } = options;\n      const actionParams = {\n        locate: detailedLocateParam,\n        ...optionsWithoutDeviceOptions,\n        ...(options.deviceOptions || {}),\n      };\n\n      return await activeAgent.callActionInActionSpace(\n        action.name,\n        actionParams,\n      );\n    }\n  } else {\n    const prompt = value.prompt;\n\n    if (actionType === 'aiAssert') {\n      const { pass, thought } =\n        (await activeAgent?.aiAssert?.(prompt || '', undefined, {\n          keepRawResponse: true,\n          ...options,\n        })) || {};\n      return { pass: pass || false, thought: thought || '' };\n    }\n\n    // Fallback for methods not found in actionSpace\n    if (activeAgent && typeof activeAgent[actionType] === 'function') {\n      return await activeAgent[actionType](prompt, options);\n    }\n\n    throw new Error(`Unknown action type: ${actionType}`);\n  }\n}\n","import type { DeviceAction } from '@midscene/core';\nimport { findAllMidsceneLocatorField } from '@midscene/core/ai-model';\nimport type { ExecutionOptions, FormValue, ValidationResult } from '../types';\n\nexport abstract class BasePlaygroundAdapter {\n  abstract parseStructuredParams(\n    action: DeviceAction<unknown>,\n    params: Record<string, unknown>,\n    options: ExecutionOptions,\n  ): Promise<unknown[]>;\n\n  abstract formatErrorMessage(error: any): string;\n\n  // Abstract method for execution - must be implemented by concrete adapters\n  abstract executeAction(\n    actionType: string,\n    value: FormValue,\n    options: ExecutionOptions,\n  ): Promise<unknown>;\n\n  // Optional method for getting action space - default implementation returns empty array\n  async getActionSpace(_context: any): Promise<DeviceAction<unknown>[]> {\n    return [];\n  }\n\n  // Common validation logic - can be overridden if needed\n  validateParams(\n    value: FormValue,\n    action: DeviceAction<unknown> | undefined,\n  ): ValidationResult {\n    if (!action?.paramSchema) {\n      return { valid: true };\n    }\n\n    const needsStructuredParams = this.actionNeedsStructuredParams(action);\n\n    if (!needsStructuredParams) {\n      return { valid: true };\n    }\n\n    if (!value.params) {\n      return { valid: false, errorMessage: 'Parameters are required' };\n    }\n\n    try {\n      const paramsForValidation = this.prepareParamsForValidation(\n        value.params,\n        action,\n      );\n      action.paramSchema.parse(paramsForValidation);\n      return { valid: true };\n    } catch (error: unknown) {\n      return this.handleValidationError(error);\n    }\n  }\n\n  // Common display content creation logic - can be overridden if needed\n  createDisplayContent(\n    value: FormValue,\n    needsStructuredParams: boolean,\n    action: DeviceAction<unknown> | undefined,\n  ): string {\n    if (!needsStructuredParams || !value.params || !action?.paramSchema) {\n      return value.prompt || '';\n    }\n\n    const paramsList = this.buildParamsDisplayList(value.params, action);\n    return paramsList.join('\\n') || value.prompt || '';\n  }\n\n  // Helper method for basic error message formatting\n  protected formatBasicErrorMessage(error: any): string {\n    return error?.message || 'Unknown error';\n  }\n\n  // Helper method for parsing structured params base logic\n  protected getSchemaKeys(action: DeviceAction<unknown>): string[] {\n    if (!action?.paramSchema || !('shape' in action.paramSchema)) {\n      return [];\n    }\n\n    const schema = action.paramSchema;\n    return schema && 'shape' in schema\n      ? Object.keys((schema as { shape: Record<string, unknown> }).shape)\n      : [];\n  }\n\n  // Helper method for filtering valid params\n  protected filterValidParams(\n    params: Record<string, unknown>,\n    excludeKeys: string[] = [],\n  ): Record<string, unknown> {\n    const filtered: Record<string, unknown> = {};\n\n    Object.keys(params).forEach((key) => {\n      if (\n        !excludeKeys.includes(key) &&\n        params[key] !== undefined &&\n        params[key] !== null &&\n        params[key] !== ''\n      ) {\n        filtered[key] = params[key];\n      }\n    });\n\n    return filtered;\n  }\n\n  // Check if action needs structured parameters\n  protected actionNeedsStructuredParams(\n    action: DeviceAction<unknown>,\n  ): boolean {\n    if (\n      typeof action.paramSchema === 'object' &&\n      'shape' in action.paramSchema\n    ) {\n      const shape =\n        (action.paramSchema as { shape: Record<string, unknown> }).shape || {};\n      return Object.keys(shape).length > 0;\n    }\n    return true; // If paramSchema exists but not in expected format, assume it needs params\n  }\n\n  // Prepare parameters for validation by converting string locate fields\n  protected prepareParamsForValidation(\n    params: Record<string, unknown>,\n    action: DeviceAction<unknown>,\n  ): Record<string, unknown> {\n    const paramsForValidation = { ...params };\n\n    if (action.paramSchema) {\n      const locatorFieldKeys = findAllMidsceneLocatorField(action.paramSchema);\n      locatorFieldKeys.forEach((key: string) => {\n        if (typeof paramsForValidation[key] === 'string') {\n          paramsForValidation[key] = {\n            midscene_location_field_flag: true,\n            prompt: paramsForValidation[key],\n            center: [0, 0], // dummy values for validation\n            rect: { left: 0, top: 0, width: 0, height: 0 },\n          };\n        }\n      });\n    }\n\n    return paramsForValidation;\n  }\n\n  // Handle validation errors with proper error message extraction\n  protected handleValidationError(error: unknown): ValidationResult {\n    const zodError = error as {\n      errors?: Array<{ path: string[]; message: string }>;\n    };\n\n    if (zodError.errors && zodError.errors.length > 0) {\n      const errorMessages = zodError.errors\n        .filter((err) => {\n          const path = err.path.join('.');\n          return (\n            !path.includes('center') &&\n            !path.includes('rect') &&\n            !path.includes('midscene_location_field_flag')\n          );\n        })\n        .map((err) => {\n          const field = err.path.join('.');\n          return `${field}: ${err.message}`;\n        });\n\n      if (errorMessages.length > 0) {\n        return {\n          valid: false,\n          errorMessage: `Validation error: ${errorMessages.join(', ')}`,\n        };\n      }\n    }\n\n    const errorMsg =\n      error instanceof Error ? error.message : 'Unknown validation error';\n\n    return {\n      valid: false,\n      errorMessage: `Parameter validation failed: ${errorMsg}`,\n    };\n  }\n\n  // Build display list for parameters\n  protected buildParamsDisplayList(\n    params: Record<string, unknown>,\n    action: DeviceAction<unknown>,\n  ): string[] {\n    const paramsList: string[] = [];\n    const schema = action.paramSchema;\n\n    if (!(schema && 'shape' in schema)) {\n      return paramsList;\n    }\n\n    const locatorFieldKeys = findAllMidsceneLocatorField(schema);\n    const shapeKeys = Object.keys(\n      (schema as { shape: Record<string, unknown> }).shape,\n    );\n\n    shapeKeys.forEach((key) => {\n      const paramValue = params[key];\n      if (this.isValidParamValue(paramValue)) {\n        const displayKey = this.capitalizeFirstLetter(key);\n        const formattedValue = this.formatParamValue(\n          key,\n          paramValue,\n          locatorFieldKeys.includes(key),\n        );\n        paramsList.push(`${displayKey}: ${formattedValue}`);\n      }\n    });\n\n    return paramsList;\n  }\n\n  // Check if parameter value is valid for display\n  protected isValidParamValue(value: unknown): boolean {\n    return value !== undefined && value !== null && value !== '';\n  }\n\n  // Capitalize first letter of a string\n  protected capitalizeFirstLetter(str: string): string {\n    return str.charAt(0).toUpperCase() + str.slice(1);\n  }\n\n  // Format parameter value for display\n  protected formatParamValue(\n    key: string,\n    value: unknown,\n    isLocateField: boolean,\n  ): string {\n    if (isLocateField || typeof value === 'string') {\n      return `\"${value}\"`;\n    }\n\n    if (typeof value === 'number') {\n      // Special handling for distance in scroll\n      return key === 'distance' ? `${value}px` : `${value}`;\n    }\n\n    return `${value}`;\n  }\n}\n","import type { DeviceAction, ExecutionDump } from '@midscene/core';\nimport { overrideAIConfig } from '@midscene/shared/env';\nimport { uuid } from '@midscene/shared/utils';\nimport { executeAction, parseStructuredParams } from '../common';\nimport type { ExecutionOptions, FormValue, PlaygroundAgent } from '../types';\nimport { BasePlaygroundAdapter } from './base';\n\nexport class LocalExecutionAdapter extends BasePlaygroundAdapter {\n  private agent: PlaygroundAgent;\n  private dumpUpdateCallback?: (\n    dump: string,\n    executionDump?: ExecutionDump,\n  ) => void;\n  private progressCallback?: (tip: string) => void;\n  private readonly _id: string; // Unique identifier for this local adapter instance\n  private currentRequestId?: string; // Track current request to prevent stale callbacks\n\n  constructor(agent: PlaygroundAgent) {\n    super();\n    this.agent = agent;\n    this._id = uuid(); // Generate unique ID for local adapter\n  }\n\n  // Get adapter ID\n  get id(): string {\n    return this._id;\n  }\n\n  onDumpUpdate(\n    callback: (dump: string, executionDump?: ExecutionDump) => void,\n  ): void {\n    // Clear any existing callback before setting new one\n    this.dumpUpdateCallback = undefined;\n    // Set the new callback\n    this.dumpUpdateCallback = callback;\n  }\n\n  // Set progress callback for monitoring operation status\n  setProgressCallback(callback: (tip: string) => void): void {\n    this.progressCallback = undefined;\n    this.progressCallback = callback;\n  }\n\n  async parseStructuredParams(\n    action: DeviceAction<unknown>,\n    params: Record<string, unknown>,\n    options: ExecutionOptions,\n  ): Promise<unknown[]> {\n    // Use shared implementation from common.ts\n    return await parseStructuredParams(action, params, options);\n  }\n\n  formatErrorMessage(error: any): string {\n    const errorMessage = error?.message || '';\n    if (errorMessage.includes('of different extension')) {\n      return 'Conflicting extension detected. Please disable the suspicious plugins and refresh the page. Guide: https://midscenejs.com/quick-experience.html#faq';\n    }\n    return this.formatBasicErrorMessage(error);\n  }\n\n  // Local execution - use base implementation\n  // (inherits default executeAction from BasePlaygroundAdapter)\n\n  // Local execution gets actionSpace from internal agent (parameter is for backward compatibility)\n  async getActionSpace(context?: unknown): Promise<DeviceAction<unknown>[]> {\n    // Priority 1: Use agent's getActionSpace method\n    if (this.agent?.getActionSpace) {\n      return await this.agent.getActionSpace();\n    }\n\n    // Priority 2: Use agent's interface.actionSpace method\n    if (\n      this.agent &&\n      'interface' in this.agent &&\n      typeof this.agent.interface === 'object'\n    ) {\n      const page = this.agent.interface as {\n        actionSpace?: () => DeviceAction<unknown>[];\n      };\n      if (page?.actionSpace) {\n        return page.actionSpace();\n      }\n    }\n\n    // Priority 3: Fallback to context parameter (for backward compatibility with tests)\n    if (context && typeof context === 'object' && 'actionSpace' in context) {\n      const contextPage = context as {\n        actionSpace: () => DeviceAction<unknown>[];\n      };\n      return contextPage.actionSpace();\n    }\n\n    return [];\n  }\n\n  // Local execution doesn't use a server, so always return true\n  async checkStatus(): Promise<boolean> {\n    return true;\n  }\n\n  async overrideConfig(aiConfig: Record<string, unknown>): Promise<void> {\n    // For local execution, use the shared env override function\n    overrideAIConfig(aiConfig);\n  }\n\n  /**\n   * Safely detaches the Chrome debugger without destroying the agent.\n   * This removes the \"Debugger attached\" banner from the browser window\n   * while keeping the agent instance intact for potential reuse.\n   * Called on errors to improve user experience by cleaning up the UI.\n   */\n  private async detachDebuggerSafely() {\n    try {\n      const page = this.agent?.interface as\n        | { detachDebugger?: () => Promise<void> }\n        | undefined;\n      await page?.detachDebugger?.();\n    } catch (error) {\n      console.warn('Failed to detach debugger:', error);\n    }\n  }\n\n  async executeAction(\n    actionType: string,\n    value: FormValue,\n    options: ExecutionOptions,\n  ): Promise<unknown> {\n    // Get actionSpace using our simplified getActionSpace method\n    const actionSpace = await this.getActionSpace();\n    let removeListener: (() => void) | undefined;\n\n    // Reset dump at the start of execution to ensure clean state\n    try {\n      this.agent.resetDump?.();\n    } catch (error: unknown) {\n      console.warn('Failed to reset dump before execution:', error);\n    }\n\n    // Setup dump update tracking if requestId is provided\n    if (options.requestId && this.agent) {\n      // Track current request ID to prevent stale callbacks\n      this.currentRequestId = options.requestId;\n\n      // Add listener and save remove function\n      removeListener = this.agent.addDumpUpdateListener(\n        (dump: string, executionDump?: ExecutionDump) => {\n          // Only process if this is still the current request\n          if (this.currentRequestId !== options.requestId) {\n            return;\n          }\n\n          // Forward to external callback\n          if (this.dumpUpdateCallback) {\n            this.dumpUpdateCallback(dump, executionDump);\n          }\n        },\n      );\n    }\n\n    try {\n      let result = null;\n      let executionError = null;\n\n      try {\n        // Call the base implementation with the original signature\n        result = await executeAction(\n          this.agent,\n          actionType,\n          actionSpace,\n          value,\n          options,\n        );\n      } catch (error: unknown) {\n        // Capture error but don't throw yet - we need to get dump/reportHTML first\n        executionError = error;\n      }\n\n      // Always construct response with dump and reportHTML, regardless of success/failure\n      const response = {\n        result,\n        dump: null as unknown,\n        reportHTML: null as string | null,\n        error: executionError\n          ? executionError instanceof Error\n            ? executionError.message\n            : String(executionError)\n          : null,\n      };\n\n      try {\n        if (this.agent.dumpDataString) {\n          const dumpString = this.agent.dumpDataString();\n          if (dumpString) {\n            const groupedDump = JSON.parse(dumpString);\n            response.dump = groupedDump.executions?.[0] || null;\n          }\n        }\n\n        // Always generate reportHTML for all APIs (including noReplayAPIs)\n        if (this.agent.reportHTMLString) {\n          response.reportHTML = this.agent.reportHTMLString() || null;\n        }\n\n        // Write out action dumps\n        if (this.agent.writeOutActionDumps) {\n          this.agent.writeOutActionDumps();\n        }\n      } catch (error: unknown) {\n        console.error('Failed to get dump/reportHTML from agent:', error);\n      }\n\n      // Don't throw the error - return it in response so caller can access dump/reportHTML\n      // The caller (usePlaygroundExecution) will check response.error to determine success\n      return response;\n    } finally {\n      // Remove listener to prevent accumulation\n      if (removeListener) {\n        removeListener();\n      }\n    }\n  }\n\n  // Local execution task cancellation - minimal implementation\n  async cancelTask(\n    _requestId: string,\n  ): Promise<{ error?: string; success?: boolean }> {\n    if (!this.agent) {\n      return { error: 'No active agent found for this requestId' };\n    }\n\n    try {\n      await this.agent.destroy?.();\n      return { success: true };\n    } catch (error: unknown) {\n      const errorMessage =\n        error instanceof Error ? error.message : 'Unknown error';\n      console.error(`Failed to cancel agent: ${errorMessage}`);\n      return { error: `Failed to cancel: ${errorMessage}` };\n    }\n  }\n\n  /**\n   * Get current execution data without resetting\n   * This allows retrieving dump and report when execution is stopped\n   */\n  async getCurrentExecutionData(): Promise<{\n    dump: ExecutionDump | null;\n    reportHTML: string | null;\n  }> {\n    const response = {\n      dump: null as ExecutionDump | null,\n      reportHTML: null as string | null,\n    };\n\n    try {\n      // Get dump data\n      if (this.agent.dumpDataString) {\n        const dumpString = this.agent.dumpDataString();\n        if (dumpString) {\n          const groupedDump = JSON.parse(dumpString);\n          response.dump = groupedDump.executions?.[0] || null;\n        }\n      }\n\n      // Get report HTML\n      if (this.agent.reportHTMLString) {\n        response.reportHTML = this.agent.reportHTMLString() || null;\n      }\n    } catch (error: unknown) {\n      console.error('Failed to get current execution data:', error);\n    }\n\n    return response;\n  }\n\n  // Get interface information from the agent\n  async getInterfaceInfo(): Promise<{\n    type: string;\n    description?: string;\n  } | null> {\n    if (!this.agent?.interface) {\n      return null;\n    }\n\n    try {\n      const type = this.agent.interface.interfaceType || 'Unknown';\n      const description = this.agent.interface.describe?.() || undefined;\n\n      return {\n        type,\n        description,\n      };\n    } catch (error: unknown) {\n      console.error('Failed to get interface info:', error);\n      return null;\n    }\n  }\n}\n","import type { DeviceAction, ExecutionDump } from '@midscene/core';\nimport { parseStructuredParams } from '../common';\nimport type { ExecutionOptions, FormValue, ValidationResult } from '../types';\nimport { BasePlaygroundAdapter } from './base';\n\nexport class RemoteExecutionAdapter extends BasePlaygroundAdapter {\n  private serverUrl?: string;\n  private _id?: string;\n  private dumpUpdateCallback?: (\n    dump: string,\n    executionDump?: ExecutionDump,\n  ) => void;\n  private pollingIntervalId?: ReturnType<typeof setInterval>;\n\n  constructor(serverUrl: string) {\n    super();\n    this.serverUrl = serverUrl;\n  }\n\n  // Set dump update callback\n  onDumpUpdate(\n    callback: (dump: string, executionDump?: ExecutionDump) => void,\n  ): void {\n    this.dumpUpdateCallback = undefined;\n    this.dumpUpdateCallback = callback;\n  }\n\n  // Get adapter ID (cached after first status check for remote)\n  get id(): string | undefined {\n    return this._id;\n  }\n\n  // Override validateParams for remote execution\n  // Since schemas from server are JSON-serialized and lack .parse() method\n  validateParams(\n    value: FormValue,\n    action: DeviceAction<unknown> | undefined,\n  ): ValidationResult {\n    if (!action?.paramSchema) {\n      return { valid: true };\n    }\n\n    const needsStructuredParams = this.actionNeedsStructuredParams(action);\n\n    if (!needsStructuredParams) {\n      return { valid: true };\n    }\n\n    if (!value.params) {\n      return { valid: false, errorMessage: 'Parameters are required' };\n    }\n\n    // For remote execution, perform basic validation without .parse()\n    // Check if required fields are present\n    if (action.paramSchema && typeof action.paramSchema === 'object') {\n      const schema = action.paramSchema as any;\n      if (schema.shape || schema.type === 'ZodObject') {\n        const shape = schema.shape || {};\n        const missingFields = Object.keys(shape).filter((key) => {\n          const fieldDef = shape[key];\n          // Check if field is required (not optional)\n          const isOptional =\n            fieldDef?.isOptional ||\n            fieldDef?._def?.innerType || // ZodOptional\n            fieldDef?._def?.typeName === 'ZodOptional';\n          return (\n            !isOptional &&\n            (value.params![key] === undefined || value.params![key] === '')\n          );\n        });\n\n        if (missingFields.length > 0) {\n          return {\n            valid: false,\n            errorMessage: `Missing required parameters: ${missingFields.join(', ')}`,\n          };\n        }\n      }\n    }\n\n    return { valid: true };\n  }\n\n  async parseStructuredParams(\n    action: DeviceAction<unknown>,\n    params: Record<string, unknown>,\n    options: ExecutionOptions,\n  ): Promise<unknown[]> {\n    // Use shared implementation from common.ts\n    return await parseStructuredParams(action, params, options);\n  }\n\n  formatErrorMessage(error: any): string {\n    const message = error?.message || '';\n\n    // Handle Android-specific errors\n    const androidErrors = [\n      {\n        keyword: 'adb',\n        message:\n          'ADB connection error. Please ensure device is connected and USB debugging is enabled.',\n      },\n      {\n        keyword: 'UIAutomator',\n        message:\n          'UIAutomator error. Please ensure the UIAutomator server is running on the device.',\n      },\n    ];\n\n    const androidError = androidErrors.find(({ keyword }) =>\n      message.includes(keyword),\n    );\n    if (androidError) {\n      return androidError.message;\n    }\n\n    return this.formatBasicErrorMessage(error);\n  }\n\n  // Remote execution adapter - simplified interface\n  async executeAction(\n    actionType: string,\n    value: FormValue,\n    options: ExecutionOptions,\n  ): Promise<unknown> {\n    // If serverUrl is provided, use server-side execution\n    if (this.serverUrl && typeof window !== 'undefined') {\n      return this.executeViaServer(actionType, value, options);\n    }\n\n    throw new Error(\n      'Remote execution adapter requires server URL for execution',\n    );\n  }\n\n  // Remote execution via server - uses same endpoint as requestPlaygroundServer\n  private async executeViaServer(\n    actionType: string,\n    value: FormValue,\n    options: ExecutionOptions,\n  ): Promise<unknown> {\n    const payload: Record<string, unknown> = {\n      type: actionType,\n      prompt: value.prompt,\n      ...this.buildOptionalPayloadParams(options, value),\n    };\n\n    // Add context only if it exists (server can handle single agent case without context)\n    if (options.context) {\n      payload.context = options.context;\n    }\n\n    // Start polling if requestId is provided and dumpUpdateCallback is set\n    if (options.requestId && this.dumpUpdateCallback) {\n      this.startProgressPolling(options.requestId);\n    }\n\n    try {\n      const response = await fetch(`${this.serverUrl}/execute`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text().catch(() => 'Unknown error');\n        throw new Error(\n          `Server request failed (${response.status}): ${errorText}`,\n        );\n      }\n\n      const result = await response.json();\n\n      return result;\n    } catch (error) {\n      console.error('Execute via server failed:', error);\n      throw error;\n    } finally {\n      // Stop polling when execution completes (success or error)\n      this.stopProgressPolling();\n    }\n  }\n\n  // Helper method to build optional payload parameters\n  private buildOptionalPayloadParams(\n    options: ExecutionOptions,\n    value: FormValue,\n  ): Record<string, unknown> {\n    const optionalParams: Record<string, unknown> = {};\n\n    // Add optional parameters only if they have meaningful values\n    const optionalFields = [\n      { key: 'requestId', value: options.requestId },\n      { key: 'deepThink', value: options.deepThink },\n      { key: 'screenshotIncluded', value: options.screenshotIncluded },\n      { key: 'domIncluded', value: options.domIncluded },\n      { key: 'deviceOptions', value: options.deviceOptions },\n      { key: 'params', value: value.params },\n    ] as const;\n\n    optionalFields.forEach(({ key, value }) => {\n      if (value !== undefined && value !== null && value !== '') {\n        optionalParams[key] = value;\n      }\n    });\n\n    return optionalParams;\n  }\n\n  // Get action space from server with fallback\n  async getActionSpace(context?: unknown): Promise<DeviceAction<unknown>[]> {\n    // Try server first if available\n    if (this.serverUrl && typeof window !== 'undefined') {\n      try {\n        const response = await fetch(`${this.serverUrl}/action-space`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({ context }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`Failed to get action space: ${response.statusText}`);\n        }\n\n        const result = await response.json();\n        return Array.isArray(result) ? result : [];\n      } catch (error) {\n        console.error('Failed to get action space from server:', error);\n        // Fall through to context fallback\n      }\n    }\n\n    // Fallback: try context.actionSpace if available\n    if (context && typeof context === 'object' && 'actionSpace' in context) {\n      try {\n        const actionSpaceMethod = (\n          context as {\n            actionSpace: () =>\n              | DeviceAction<unknown>[]\n              | Promise<DeviceAction<unknown>[]>;\n          }\n        ).actionSpace;\n        const result = await actionSpaceMethod();\n        return Array.isArray(result) ? result : [];\n      } catch (error) {\n        console.error('Failed to get action space from context:', error);\n      }\n    }\n\n    return [];\n  }\n\n  // Uses base implementation for validateParams and createDisplayContent\n\n  // Server communication methods\n  async checkStatus(): Promise<boolean> {\n    if (!this.serverUrl) {\n      return false;\n    }\n\n    try {\n      const res = await fetch(`${this.serverUrl}/status`);\n      if (res.status === 200) {\n        // Try to extract id from response\n        try {\n          const data = await res.json();\n          if (data.id && typeof data.id === 'string') {\n            this._id = data.id;\n          }\n        } catch (jsonError) {\n          // If JSON parsing fails, id remains undefined but status is still OK\n          console.debug('Failed to parse status response:', jsonError);\n        }\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.warn('Server status check failed:', error);\n      return false;\n    }\n  }\n\n  async overrideConfig(aiConfig: Record<string, unknown>): Promise<void> {\n    if (!this.serverUrl) {\n      throw new Error('Server URL not configured');\n    }\n\n    try {\n      const response = await fetch(`${this.serverUrl}/config`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ aiConfig }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\n          `Failed to override server config: ${response.statusText}`,\n        );\n      }\n    } catch (error) {\n      console.error('Failed to override server config:', error);\n      throw error;\n    }\n  }\n\n  async getTaskProgress(requestId: string): Promise<{\n    executionDump?: ExecutionDump;\n  }> {\n    if (!this.serverUrl) {\n      return {};\n    }\n\n    if (!requestId?.trim()) {\n      console.warn('Invalid requestId provided for task progress');\n      return {};\n    }\n\n    try {\n      const response = await fetch(\n        `${this.serverUrl}/task-progress/${encodeURIComponent(requestId)}`,\n      );\n\n      if (!response.ok) {\n        console.warn(`Task progress request failed: ${response.statusText}`);\n        return {};\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to poll task progress:', error);\n      return {};\n    }\n  }\n\n  /**\n   * Start polling for task progress and invoke dump update callback\n   */\n  private startProgressPolling(requestId: string): void {\n    // Clear any existing polling\n    this.stopProgressPolling();\n\n    // Poll every 500ms for progress updates\n    this.pollingIntervalId = setInterval(async () => {\n      try {\n        const progressData = await this.getTaskProgress(requestId);\n\n        if (progressData.executionDump) {\n          // Invoke dump update callback if set\n          if (this.dumpUpdateCallback) {\n            this.dumpUpdateCallback('', progressData.executionDump);\n          }\n        }\n      } catch (error) {\n        console.error('Error polling task progress:', error);\n      }\n    }, 500); // Poll every 500ms\n  }\n\n  /**\n   * Stop polling for task progress\n   */\n  private stopProgressPolling(): void {\n    if (this.pollingIntervalId) {\n      clearInterval(this.pollingIntervalId);\n      this.pollingIntervalId = undefined;\n    }\n  }\n\n  // Cancel task\n  async cancelTask(\n    requestId: string,\n  ): Promise<{ error?: string; success?: boolean }> {\n    if (!this.serverUrl) {\n      return { error: 'No server URL configured' };\n    }\n\n    if (!requestId?.trim()) {\n      return { error: 'Invalid request ID' };\n    }\n\n    try {\n      const res = await fetch(\n        `${this.serverUrl}/cancel/${encodeURIComponent(requestId)}`,\n        {\n          method: 'POST',\n        },\n      );\n\n      if (!res.ok) {\n        return { error: `Cancel request failed: ${res.statusText}` };\n      }\n\n      const result = await res.json();\n      return { success: true, ...result };\n    } catch (error) {\n      console.error('Failed to cancel task:', error);\n      return { error: 'Failed to cancel task' };\n    }\n  }\n\n  // Get screenshot from server\n  async getScreenshot(): Promise<{\n    screenshot: string;\n    timestamp: number;\n  } | null> {\n    if (!this.serverUrl) {\n      return null;\n    }\n\n    try {\n      const response = await fetch(`${this.serverUrl}/screenshot`);\n\n      if (!response.ok) {\n        console.warn(`Screenshot request failed: ${response.statusText}`);\n        return null;\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to get screenshot:', error);\n      return null;\n    }\n  }\n\n  // Get interface information from server\n  async getInterfaceInfo(): Promise<{\n    type: string;\n    description?: string;\n  } | null> {\n    if (!this.serverUrl) {\n      return null;\n    }\n\n    try {\n      const response = await fetch(`${this.serverUrl}/interface-info`);\n\n      if (!response.ok) {\n        console.warn(`Interface info request failed: ${response.statusText}`);\n        return null;\n      }\n\n      return await response.json();\n    } catch (error) {\n      console.error('Failed to get interface info:', error);\n      return null;\n    }\n  }\n}\n","import type { DeviceAction } from '@midscene/core';\nimport { PLAYGROUND_SERVER_PORT } from '@midscene/shared/constants';\nimport type { BasePlaygroundAdapter } from '../adapters/base';\nimport { LocalExecutionAdapter } from '../adapters/local-execution';\nimport { RemoteExecutionAdapter } from '../adapters/remote-execution';\nimport type {\n  ExecutionOptions,\n  FormValue,\n  PlaygroundAgent,\n  PlaygroundConfig,\n  ValidationResult,\n} from '../types';\n\nexport class PlaygroundSDK {\n  private adapter: BasePlaygroundAdapter;\n\n  constructor(config: PlaygroundConfig) {\n    this.adapter = this.createAdapter(\n      config.type,\n      config.serverUrl,\n      config.agent,\n    );\n  }\n\n  private createAdapter(\n    type: string,\n    serverUrl?: string,\n    agent?: PlaygroundAgent,\n  ): BasePlaygroundAdapter {\n    switch (type) {\n      case 'local-execution':\n        if (!agent) {\n          throw new Error('Agent is required for local execution');\n        }\n        return new LocalExecutionAdapter(agent);\n      case 'remote-execution': {\n        // Use provided serverUrl first, then fallback to localhost if current page origin is file:// or default\n        const finalServerUrl =\n          serverUrl ||\n          (typeof window !== 'undefined' &&\n          window.location.protocol.includes('http')\n            ? window.location.origin\n            : `http://localhost:${PLAYGROUND_SERVER_PORT}`);\n\n        return new RemoteExecutionAdapter(finalServerUrl);\n      }\n      default:\n        throw new Error(`Unsupported execution type: ${type}`);\n    }\n  }\n\n  async executeAction(\n    actionType: string,\n    value: FormValue,\n    options: ExecutionOptions,\n  ): Promise<unknown> {\n    const result = await this.adapter.executeAction(actionType, value, options);\n    return result;\n  }\n\n  async getActionSpace(context?: unknown): Promise<DeviceAction<unknown>[]> {\n    // Both adapters now accept context parameter\n    // Local will prioritize internal agent, Remote will use server + fallback\n    return this.adapter.getActionSpace(context);\n  }\n\n  validateStructuredParams(\n    value: FormValue,\n    action: DeviceAction<unknown> | undefined,\n  ): ValidationResult {\n    return this.adapter.validateParams(value, action);\n  }\n\n  formatErrorMessage(error: any): string {\n    return this.adapter.formatErrorMessage(error);\n  }\n\n  createDisplayContent(\n    value: FormValue,\n    needsStructuredParams: boolean,\n    action: DeviceAction<unknown> | undefined,\n  ): string {\n    return this.adapter.createDisplayContent(\n      value,\n      needsStructuredParams,\n      action,\n    );\n  }\n\n  // Get adapter ID (works for both remote and local execution)\n  get id(): string | undefined {\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      return this.adapter.id;\n    }\n    if (this.adapter instanceof LocalExecutionAdapter) {\n      return this.adapter.id;\n    }\n    return undefined;\n  }\n\n  // Server communication methods (for remote execution)\n  async checkStatus(): Promise<boolean> {\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      return this.adapter.checkStatus();\n    }\n    return true; // For local execution, always return true\n  }\n\n  async overrideConfig(aiConfig: any): Promise<void> {\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      return this.adapter.overrideConfig(aiConfig);\n    }\n    // For local execution, this is a no-op\n  }\n\n  // Get task progress (for remote execution)\n  async getTaskProgress(requestId: string): Promise<{ executionDump?: any }> {\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      return this.adapter.getTaskProgress(requestId);\n    }\n    // For local execution, progress is handled via onDumpUpdate callback\n    return {};\n  }\n\n  // Cancel task (for remote execution)\n  async cancelTask(requestId: string): Promise<any> {\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      return this.adapter.cancelTask(requestId);\n    }\n    return { error: 'Cancel task not supported in local execution mode' };\n  }\n\n  // Dump update callback management\n  onDumpUpdate(callback: (dump: string, executionDump?: any) => void): void {\n    if (this.adapter instanceof LocalExecutionAdapter) {\n      this.adapter.onDumpUpdate(callback);\n    } else if (this.adapter instanceof RemoteExecutionAdapter) {\n      this.adapter.onDumpUpdate(callback);\n    }\n  }\n\n  // Progress update callback management\n  onProgressUpdate(callback: (tip: string) => void): void {\n    if (this.adapter instanceof LocalExecutionAdapter) {\n      this.adapter.setProgressCallback(callback);\n    }\n    // RemoteExecutionAdapter uses polling mechanism via onDumpUpdate, no separate progress callback needed\n  }\n\n  // Cancel execution - supports both remote and local\n  async cancelExecution(requestId: string): Promise<{\n    dump: any | null;\n    reportHTML: string | null;\n  } | null> {\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      const result = await this.adapter.cancelTask(requestId);\n      // Return dump and reportHTML if available from cancellation\n      if (result.success) {\n        return {\n          dump: (result as any).dump || null,\n          reportHTML: (result as any).reportHTML || null,\n        };\n      }\n    } else if (this.adapter instanceof LocalExecutionAdapter) {\n      // For local execution, we might need to implement agent cancellation\n      console.warn('Local execution cancellation not fully implemented');\n    }\n    return null;\n  }\n\n  // Get current execution data (dump and report)\n  async getCurrentExecutionData(): Promise<{\n    dump: any | null;\n    reportHTML: string | null;\n  }> {\n    if (\n      this.adapter instanceof LocalExecutionAdapter &&\n      this.adapter.getCurrentExecutionData\n    ) {\n      return await this.adapter.getCurrentExecutionData();\n    }\n    // For remote execution or if method not available, return empty data\n    return { dump: null, reportHTML: null };\n  }\n\n  // Screenshot method for remote execution\n  async getScreenshot(): Promise<{\n    screenshot: string;\n    timestamp: number;\n  } | null> {\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      return this.adapter.getScreenshot();\n    }\n    return null; // For local execution, not supported yet\n  }\n\n  // Get interface information (type and description)\n  async getInterfaceInfo(): Promise<{\n    type: string;\n    description?: string;\n  } | null> {\n    if (this.adapter instanceof LocalExecutionAdapter) {\n      return this.adapter.getInterfaceInfo();\n    }\n    if (this.adapter instanceof RemoteExecutionAdapter) {\n      return this.adapter.getInterfaceInfo();\n    }\n    return null;\n  }\n\n  // Get service mode based on adapter type\n  getServiceMode(): 'In-Browser-Extension' | 'Server' {\n    if (this.adapter instanceof LocalExecutionAdapter) {\n      return 'In-Browser-Extension';\n    }\n    return 'Server';\n  }\n}\n","const elementColor = [\n    '#01204E'\n];\nconst highlightColorForSearchArea = '#028391';\nconst highlightColorForElement = '#fd5907';\nfunction djb2Hash(str) {\n    if (!str) str = 'unnamed';\n    let hash = 5381;\n    for(let i = 0; i < str.length; i++)hash = (hash << 5) + hash + str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction colorForName(name) {\n    const hashNumber = djb2Hash(name);\n    return elementColor[hashNumber % elementColor.length];\n}\nfunction highlightColorForType(type) {\n    if ('searchArea' === type) return highlightColorForSearchArea;\n    return highlightColorForElement;\n}\nfunction globalThemeConfig() {\n    return {\n        token: {\n            colorPrimary: '#2B83FF'\n        },\n        components: {\n            Layout: {\n                headerHeight: 60,\n                headerPadding: '0 30px',\n                headerBg: '#FFF',\n                bodyBg: '#FFF'\n            }\n        }\n    };\n}\nexport { colorForName, globalThemeConfig, highlightColorForType };\n","import { jsx } from \"react/jsx-runtime\";\nimport { useTheme } from \"../../hooks/useTheme.mjs\";\nimport \"./index.css\";\nconst LogoUrl = 'https://lf3-static.bytednsdoc.com/obj/eden-cn/vhaeh7vhabf/Midscene.png';\nconst LogoUrlLight = 'https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/midscene_with_text_light.png';\nconst LogoUrlDark = 'https://lf3-static.bytednsdoc.com/obj/eden-cn/nupipfups/Midscene/midscene_with_text_dark.png';\nconst Logo = ({ hideLogo = false })=>{\n    const { isDarkMode } = useTheme();\n    if (hideLogo) return null;\n    const logoSrc = isDarkMode ? LogoUrlDark : LogoUrlLight;\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: \"logo\",\n        children: /*#__PURE__*/ jsx(\"a\", {\n            href: \"https://midscenejs.com/\",\n            target: \"_blank\",\n            rel: \"noreferrer\",\n            children: /*#__PURE__*/ jsx(\"img\", {\n                alt: \"Midscene_logo\",\n                src: logoSrc\n            })\n        })\n    });\n};\nexport { Logo, LogoUrl };\n","import { useEffect, useState } from \"react\";\nfunction useTheme() {\n    const [isDarkMode, setIsDarkMode] = useState(false);\n    useEffect(()=>{\n        const checkTheme = ()=>{\n            var _document_querySelector;\n            const theme = null == (_document_querySelector = document.querySelector('[data-theme]')) ? void 0 : _document_querySelector.getAttribute('data-theme');\n            setIsDarkMode('dark' === theme);\n        };\n        checkTheme();\n        const observer = new MutationObserver(checkTheme);\n        const target = document.querySelector('[data-theme]') || document.documentElement;\n        observer.observe(target, {\n            attributes: true,\n            attributeFilter: [\n                'data-theme'\n            ]\n        });\n        return ()=>observer.disconnect();\n    }, []);\n    return {\n        isDarkMode\n    };\n}\nexport { useTheme };\n","import { create } from \"zustand\";\nvar __webpack_require__ = {};\n(()=>{\n    __webpack_require__.d = (exports, definition)=>{\n        for(var key in definition)if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n        });\n    };\n})();\n(()=>{\n    __webpack_require__.o = (obj, prop)=>Object.prototype.hasOwnProperty.call(obj, prop);\n})();\n(()=>{\n    __webpack_require__.r = (exports)=>{\n        if ('undefined' != typeof Symbol && Symbol.toStringTag) Object.defineProperty(exports, Symbol.toStringTag, {\n            value: 'Module'\n        });\n        Object.defineProperty(exports, '__esModule', {\n            value: true\n        });\n    };\n})();\nvar external_zustand_namespaceObject = {};\n__webpack_require__.r(external_zustand_namespaceObject);\n__webpack_require__.d(external_zustand_namespaceObject, {\n    create: ()=>create\n});\nconst { create: store_create } = external_zustand_namespaceObject;\nconst AUTO_ZOOM_KEY = 'midscene-auto-zoom';\nconst BACKGROUND_VISIBLE_KEY = 'midscene-background-visible';\nconst ELEMENTS_VISIBLE_KEY = 'midscene-elements-visible';\nconst MODEL_CALL_DETAILS_KEY = 'midscene-model-call-details';\nconst DARK_MODE_KEY = 'midscene-dark-mode';\nconst parseBooleanParam = (value)=>{\n    if (null === value) return;\n    const normalized = value.trim().toLowerCase();\n    if ([\n        '1',\n        'true',\n        'yes',\n        'on'\n    ].includes(normalized)) return true;\n    if ([\n        '0',\n        'false',\n        'no',\n        'off'\n    ].includes(normalized)) return false;\n};\nconst getQueryPreference = (paramName)=>{\n    if ('undefined' == typeof window) return;\n    const searchParams = new URLSearchParams(window.location.search);\n    return parseBooleanParam(searchParams.get(paramName));\n};\nconst useGlobalPreference = store_create((set)=>{\n    const savedAutoZoom = 'false' !== localStorage.getItem(AUTO_ZOOM_KEY);\n    const savedBackgroundVisible = 'false' !== localStorage.getItem(BACKGROUND_VISIBLE_KEY);\n    const savedElementsVisible = 'false' !== localStorage.getItem(ELEMENTS_VISIBLE_KEY);\n    const savedModelCallDetails = 'true' === localStorage.getItem(MODEL_CALL_DETAILS_KEY);\n    const savedDarkMode = 'true' === localStorage.getItem(DARK_MODE_KEY);\n    const autoZoomFromQuery = getQueryPreference('focusOnCursor');\n    const elementsVisibleFromQuery = getQueryPreference('showElementMarkers');\n    const darkModeFromQuery = getQueryPreference('darkMode');\n    const initialDarkMode = void 0 === darkModeFromQuery ? savedDarkMode : darkModeFromQuery;\n    if (void 0 !== darkModeFromQuery) localStorage.setItem(DARK_MODE_KEY, initialDarkMode.toString());\n    return {\n        backgroundVisible: savedBackgroundVisible,\n        elementsVisible: void 0 === elementsVisibleFromQuery ? savedElementsVisible : elementsVisibleFromQuery,\n        autoZoom: void 0 === autoZoomFromQuery ? savedAutoZoom : autoZoomFromQuery,\n        modelCallDetailsEnabled: savedModelCallDetails,\n        darkModeEnabled: initialDarkMode,\n        setBackgroundVisible: (visible)=>{\n            set({\n                backgroundVisible: visible\n            });\n            localStorage.setItem(BACKGROUND_VISIBLE_KEY, visible.toString());\n        },\n        setElementsVisible: (visible)=>{\n            set({\n                elementsVisible: visible\n            });\n            localStorage.setItem(ELEMENTS_VISIBLE_KEY, visible.toString());\n        },\n        setAutoZoom: (enabled)=>{\n            set({\n                autoZoom: enabled\n            });\n            localStorage.setItem(AUTO_ZOOM_KEY, enabled.toString());\n        },\n        setModelCallDetailsEnabled: (enabled)=>{\n            set({\n                modelCallDetailsEnabled: enabled\n            });\n            localStorage.setItem(MODEL_CALL_DETAILS_KEY, enabled.toString());\n        },\n        setDarkModeEnabled: (enabled)=>{\n            set({\n                darkModeEnabled: enabled\n            });\n            localStorage.setItem(DARK_MODE_KEY, enabled.toString());\n        }\n    };\n});\nconst CONFIG_KEY = 'midscene-env-config';\nconst SERVICE_MODE_KEY = 'midscene-service-mode';\nconst TRACKING_ACTIVE_TAB_KEY = 'midscene-tracking-active-tab';\nconst DEEP_THINK_KEY = 'midscene-deep-think';\nconst SCREENSHOT_INCLUDED_KEY = 'midscene-screenshot-included';\nconst DOM_INCLUDED_KEY = 'midscene-dom-included';\nconst IME_STRATEGY_KEY = 'midscene-ime-strategy';\nconst AUTO_DISMISS_KEYBOARD_KEY = 'midscene-auto-dismiss-keyboard';\nconst KEYBOARD_DISMISS_STRATEGY_KEY = 'midscene-keyboard-dismiss-strategy';\nconst ALWAYS_REFRESH_SCREEN_INFO_KEY = 'midscene-always-refresh-screen-info';\nconst getConfigStringFromLocalStorage = ()=>{\n    const configString = localStorage.getItem(CONFIG_KEY);\n    return configString || '';\n};\nconst parseConfig = (configString)=>{\n    const lines = configString.split('\\n');\n    const config = {};\n    lines.forEach((line)=>{\n        const trimmed = line.trim();\n        if (trimmed.startsWith('#')) return;\n        const cleanLine = trimmed.replace(/^export\\s+/i, '').replace(/;$/, '').trim();\n        const match = cleanLine.match(/^(\\w+)=(.*)$/);\n        if (match) {\n            const [, key, value] = match;\n            let parsedValue = value.trim();\n            if (parsedValue.startsWith(\"'\") && parsedValue.endsWith(\"'\") || parsedValue.startsWith('\"') && parsedValue.endsWith('\"')) parsedValue = parsedValue.slice(1, -1);\n            config[key] = parsedValue;\n        }\n    });\n    return config;\n};\nconst useEnvConfig = store_create((set, get)=>{\n    const configString = getConfigStringFromLocalStorage();\n    const config = parseConfig(configString);\n    const ifInExtension = window.location.href.startsWith('chrome-extension');\n    const savedServiceMode = localStorage.getItem(SERVICE_MODE_KEY);\n    const savedForceSameTabNavigation = 'false' !== localStorage.getItem(TRACKING_ACTIVE_TAB_KEY);\n    const savedDeepThink = 'true' === localStorage.getItem(DEEP_THINK_KEY);\n    const savedScreenshotIncluded = 'false' !== localStorage.getItem(SCREENSHOT_INCLUDED_KEY);\n    const savedDomIncluded = localStorage.getItem(DOM_INCLUDED_KEY) || 'false';\n    const savedImeStrategy = localStorage.getItem(IME_STRATEGY_KEY) || 'yadb-for-non-ascii';\n    const savedAutoDismissKeyboard = 'false' !== localStorage.getItem(AUTO_DISMISS_KEYBOARD_KEY);\n    const savedKeyboardDismissStrategy = localStorage.getItem(KEYBOARD_DISMISS_STRATEGY_KEY) || 'esc-first';\n    const savedAlwaysRefreshScreenInfo = 'true' === localStorage.getItem(ALWAYS_REFRESH_SCREEN_INFO_KEY);\n    return {\n        serviceMode: ifInExtension ? 'In-Browser-Extension' : savedServiceMode || 'Server',\n        setServiceMode: (serviceMode)=>{\n            if (ifInExtension) throw new Error('serviceMode cannot be set in extension');\n            set({\n                serviceMode\n            });\n            localStorage.setItem(SERVICE_MODE_KEY, serviceMode);\n        },\n        config,\n        configString,\n        setConfig: (config)=>set({\n                config\n            }),\n        loadConfig: (configString)=>{\n            const config = parseConfig(configString);\n            set({\n                config,\n                configString\n            });\n            localStorage.setItem(CONFIG_KEY, configString);\n        },\n        syncFromStorage: ()=>{\n            const latestConfigString = getConfigStringFromLocalStorage();\n            const latestConfig = parseConfig(latestConfigString);\n            set({\n                config: latestConfig,\n                configString: latestConfigString\n            });\n        },\n        forceSameTabNavigation: savedForceSameTabNavigation,\n        setForceSameTabNavigation: (forceSameTabNavigation)=>{\n            set({\n                forceSameTabNavigation\n            });\n            localStorage.setItem(TRACKING_ACTIVE_TAB_KEY, forceSameTabNavigation.toString());\n        },\n        deepThink: savedDeepThink,\n        setDeepThink: (deepThink)=>{\n            set({\n                deepThink\n            });\n            localStorage.setItem(DEEP_THINK_KEY, deepThink.toString());\n        },\n        screenshotIncluded: savedScreenshotIncluded,\n        setScreenshotIncluded: (screenshotIncluded)=>{\n            set({\n                screenshotIncluded\n            });\n            localStorage.setItem(SCREENSHOT_INCLUDED_KEY, screenshotIncluded.toString());\n        },\n        domIncluded: 'visible-only' === savedDomIncluded ? 'visible-only' : 'true' === savedDomIncluded,\n        setDomIncluded: (domIncluded)=>{\n            set({\n                domIncluded\n            });\n            localStorage.setItem(DOM_INCLUDED_KEY, domIncluded.toString());\n        },\n        popupTab: 'playground',\n        setPopupTab: (tab)=>{\n            set({\n                popupTab: tab\n            });\n        },\n        imeStrategy: savedImeStrategy,\n        setImeStrategy: (imeStrategy)=>{\n            set({\n                imeStrategy\n            });\n            localStorage.setItem(IME_STRATEGY_KEY, imeStrategy);\n        },\n        autoDismissKeyboard: savedAutoDismissKeyboard,\n        setAutoDismissKeyboard: (autoDismissKeyboard)=>{\n            set({\n                autoDismissKeyboard\n            });\n            localStorage.setItem(AUTO_DISMISS_KEYBOARD_KEY, autoDismissKeyboard.toString());\n        },\n        keyboardDismissStrategy: savedKeyboardDismissStrategy,\n        setKeyboardDismissStrategy: (keyboardDismissStrategy)=>{\n            set({\n                keyboardDismissStrategy\n            });\n            localStorage.setItem(KEYBOARD_DISMISS_STRATEGY_KEY, keyboardDismissStrategy);\n        },\n        alwaysRefreshScreenInfo: savedAlwaysRefreshScreenInfo,\n        setAlwaysRefreshScreenInfo: (alwaysRefreshScreenInfo)=>{\n            set({\n                alwaysRefreshScreenInfo\n            });\n            localStorage.setItem(ALWAYS_REFRESH_SCREEN_INFO_KEY, alwaysRefreshScreenInfo.toString());\n        }\n    };\n});\nexport { useEnvConfig, useGlobalPreference };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { SettingOutlined } from \"@ant-design/icons\";\nimport { Input, Modal, Tooltip } from \"antd\";\nimport { useEffect, useRef, useState } from \"react\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nfunction EnvConfig({ showTooltipWhenEmpty = true, showModelName = true, tooltipPlacement = 'bottom', mode = 'icon' }) {\n    const { config, configString, loadConfig, syncFromStorage } = useEnvConfig();\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [tempConfigString, setTempConfigString] = useState(configString);\n    const midsceneModelName = config.MIDSCENE_MODEL_NAME;\n    const componentRef = useRef(null);\n    const showModal = (e)=>{\n        syncFromStorage();\n        setIsModalOpen(true);\n        e.preventDefault();\n        e.stopPropagation();\n    };\n    const handleOk = ()=>{\n        setIsModalOpen(false);\n        loadConfig(tempConfigString);\n    };\n    const handleCancel = ()=>{\n        setIsModalOpen(false);\n    };\n    useEffect(()=>{\n        if (isModalOpen) setTempConfigString(configString);\n    }, [\n        isModalOpen,\n        configString\n    ]);\n    return /*#__PURE__*/ jsxs(\"div\", {\n        style: {\n            display: 'flex',\n            justifyContent: 'flex-end',\n            gap: '10px',\n            alignItems: 'center',\n            height: '100%',\n            minHeight: '32px'\n        },\n        ref: componentRef,\n        children: [\n            showModelName ? midsceneModelName : null,\n            /*#__PURE__*/ jsx(Tooltip, {\n                title: \"Please set up your environment variables before using.\",\n                placement: tooltipPlacement,\n                align: {\n                    offset: [\n                        -10,\n                        5\n                    ]\n                },\n                getPopupContainer: ()=>componentRef.current,\n                open: isModalOpen ? false : showTooltipWhenEmpty ? 0 === Object.keys(config).length : void 0,\n                children: 'icon' === mode ? /*#__PURE__*/ jsx(SettingOutlined, {\n                    onClick: showModal\n                }) : /*#__PURE__*/ jsx(\"span\", {\n                    onClick: showModal,\n                    style: {\n                        color: '#006AFF',\n                        cursor: 'pointer'\n                    },\n                    children: \"set up\"\n                })\n            }),\n            /*#__PURE__*/ jsxs(Modal, {\n                title: \"Model Env Config\",\n                open: isModalOpen,\n                onOk: handleOk,\n                onCancel: handleCancel,\n                okText: \"Save\",\n                style: {\n                    width: '800px',\n                    height: '100%',\n                    marginTop: '10%'\n                },\n                destroyOnClose: true,\n                maskClosable: true,\n                centered: true,\n                children: [\n                    /*#__PURE__*/ jsx(Input.TextArea, {\n                        rows: 7,\n                        placeholder: 'OPENAI_API_KEY=sk-...\\nMIDSCENE_MODEL_NAME=gpt-4o-2024-08-06\\n...',\n                        value: tempConfigString,\n                        onChange: (e)=>setTempConfigString(e.target.value),\n                        style: {\n                            whiteSpace: 'nowrap',\n                            wordWrap: 'break-word'\n                        }\n                    }),\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        children: [\n                            /*#__PURE__*/ jsx(\"p\", {\n                                children: \"The format is KEY=VALUE and separated by new lines.\"\n                            }),\n                            /*#__PURE__*/ jsxs(\"p\", {\n                                children: [\n                                    \"These data will be saved \",\n                                    /*#__PURE__*/ jsx(\"strong\", {\n                                        children: \"locally in your browser\"\n                                    }),\n                                    \".\"\n                                ]\n                            })\n                        ]\n                    })\n                ]\n            })\n        ]\n    });\n}\nexport { EnvConfig };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { GithubOutlined, QuestionCircleOutlined } from \"@ant-design/icons\";\nimport { Typography } from \"antd\";\nimport { EnvConfig } from \"../env-config/index.mjs\";\nimport \"./style.css\";\nfunction NavActions({ showEnvConfig = true, showTooltipWhenEmpty = false, showModelName = false, githubUrl = 'https://github.com/web-infra-dev/midscene', helpUrl = 'https://midscenejs.com/quick-experience.html', className = '' }) {\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: `nav-actions ${className}`,\n        children: [\n            /*#__PURE__*/ jsx(Typography.Link, {\n                href: githubUrl,\n                target: \"_blank\",\n                children: /*#__PURE__*/ jsx(GithubOutlined, {\n                    className: \"nav-icon\"\n                })\n            }),\n            /*#__PURE__*/ jsx(Typography.Link, {\n                href: helpUrl,\n                target: \"_blank\",\n                children: /*#__PURE__*/ jsx(QuestionCircleOutlined, {\n                    className: \"nav-icon\"\n                })\n            }),\n            showEnvConfig && /*#__PURE__*/ jsx(EnvConfig, {\n                showTooltipWhenEmpty: showTooltipWhenEmpty,\n                showModelName: showModelName\n            })\n        ]\n    });\n}\nexport { NavActions };\n","import type {\n  DetailedLocateParam,\n  ExecutionTask,\n  ExecutionTaskAction,\n  ExecutionTaskInsightAssertion,\n  ExecutionTaskInsightQuery,\n  ExecutionTaskPlanning,\n  ExecutionTaskPlanningLocate,\n  PullParam,\n  ScrollParam,\n} from '@/types';\n\nexport function typeStr(task: ExecutionTask) {\n  // // For Action tasks with subType, show \"Action Space / subType\"\n  // if (task.type === 'Action' && task.subType) {\n  //   return `Action Space / ${task.subType}`;\n  // }\n\n  // // For all other cases with subType, show \"type / subType\"\n  // if (task.subType) {\n  //   return `${task.type} / ${task.subType}`;\n  // }\n\n  // No subType, just show type\n  return task.subType || task.type;\n}\n\nexport function locateParamStr(locate?: DetailedLocateParam | string): string {\n  if (!locate) {\n    return '';\n  }\n\n  if (typeof locate === 'string') {\n    return locate;\n  }\n\n  if (typeof locate === 'object') {\n    // Check for nested prompt.prompt (Planning Locate tasks)\n    if (\n      typeof locate.prompt === 'object' &&\n      locate.prompt !== null &&\n      locate.prompt.prompt\n    ) {\n      const prompt = locate.prompt.prompt;\n      return prompt;\n    }\n\n    // Check for direct prompt string\n    if (typeof locate.prompt === 'string') {\n      return locate.prompt;\n    }\n\n    // Check for description field (Action Space tasks like Tap, Hover)\n    if (typeof (locate as any).description === 'string') {\n      return (locate as any).description;\n    }\n  }\n\n  return '';\n}\n\nexport function scrollParamStr(scrollParam?: ScrollParam) {\n  if (!scrollParam) {\n    return '';\n  }\n  return `${scrollParam.direction || 'down'}, ${scrollParam.scrollType || 'singleAction'}, ${scrollParam.distance || 'distance-not-set'}`;\n}\n\nexport function pullParamStr(pullParam?: PullParam) {\n  if (!pullParam) {\n    return '';\n  }\n  const parts: string[] = [];\n  parts.push(`direction: ${pullParam.direction || 'down'}`);\n  if (pullParam.distance) {\n    parts.push(`distance: ${pullParam.distance}`);\n  }\n  if (pullParam.duration) {\n    parts.push(`duration: ${pullParam.duration}ms`);\n  }\n  return parts.join(', ');\n}\n\nexport function extractInsightParam(taskParam: any): {\n  content: string;\n  images?: Array<{ name: string; url: string }>;\n} {\n  if (!taskParam) {\n    return { content: '' };\n  }\n\n  // Helper to extract images from multimodalPrompt\n  const extractImages = (source: any) => {\n    return source?.multimodalPrompt?.images &&\n      Array.isArray(source.multimodalPrompt.images)\n      ? source.multimodalPrompt.images\n      : undefined;\n  };\n\n  // Helper to stringify if needed\n  const toContent = (value: any) =>\n    typeof value === 'string' ? value : JSON.stringify(value);\n\n  // Extract from demand\n  if (taskParam.demand) {\n    return {\n      content: toContent(taskParam.demand),\n      images: extractImages(taskParam),\n    };\n  }\n\n  // Extract from assertion\n  if (taskParam.assertion) {\n    return {\n      content: toContent(taskParam.assertion),\n      images: extractImages(taskParam),\n    };\n  }\n\n  // Extract from dataDemand\n  if (taskParam.dataDemand) {\n    const { dataDemand } = taskParam;\n\n    if (typeof dataDemand === 'string') {\n      return { content: dataDemand };\n    }\n\n    if (typeof dataDemand === 'object') {\n      return {\n        content: toContent(dataDemand.demand || dataDemand),\n        images: extractImages(dataDemand),\n      };\n    }\n  }\n\n  return { content: '' };\n}\n\nexport function taskTitleStr(\n  type:\n    | 'Tap'\n    | 'Hover'\n    | 'Input'\n    | 'RightClick'\n    | 'KeyboardPress'\n    | 'Scroll'\n    | 'Action'\n    | 'Query'\n    | 'Assert'\n    | 'WaitFor'\n    | 'Locate'\n    | 'Boolean'\n    | 'Number'\n    | 'String',\n  prompt: string,\n) {\n  if (prompt) {\n    return `${type} - ${prompt}`;\n  }\n  return type;\n}\n\nexport function paramStr(task: ExecutionTask) {\n  let value: string | undefined | object;\n  if (task.type === 'Planning') {\n    if (task.subType === 'Locate') {\n      value = locateParamStr((task as ExecutionTaskPlanningLocate)?.param);\n    } else {\n      // Prefer AI-generated output.log over user input\n      const planTask = task as ExecutionTaskPlanning;\n      value = planTask.output?.log || planTask.param?.userInstruction;\n    }\n  }\n\n  if (task.type === 'Insight') {\n    value = extractInsightParam((task as any)?.param).content;\n  }\n\n  if (task.type === 'Action Space') {\n    const locate = (task as ExecutionTaskAction)?.param?.locate;\n    const locateStr = locate ? locateParamStr(locate) : '';\n\n    value = task.thought || '';\n    if (typeof (task as ExecutionTaskAction)?.param?.timeMs === 'number') {\n      value = `${(task as ExecutionTaskAction)?.param?.timeMs}ms`;\n    } else if (\n      typeof (task as ExecutionTaskAction)?.param?.scrollType === 'string'\n    ) {\n      value = scrollParamStr((task as ExecutionTaskAction)?.param);\n    } else if (\n      typeof (task as ExecutionTaskAction)?.param?.direction === 'string' &&\n      (task as ExecutionTaskAction)?.subType === 'AndroidPull'\n    ) {\n      value = pullParamStr((task as ExecutionTaskAction)?.param);\n    } else if (\n      typeof (task as ExecutionTaskAction)?.param?.value !== 'undefined'\n    ) {\n      value = (task as ExecutionTaskAction)?.param?.value;\n    } else if (\n      (task as ExecutionTaskAction)?.param &&\n      typeof (task as ExecutionTaskAction)?.param === 'object' &&\n      Object.keys((task as ExecutionTaskAction)?.param || {}).length > 0\n    ) {\n      // General parameter handling for actions with custom parameters\n      // (e.g., runWdaRequest, runAdbShell)\n      value = (task as ExecutionTaskAction)?.param;\n    }\n\n    if (locateStr) {\n      if (value && typeof value !== 'object') {\n        value = `${locateStr} - ${value}`;\n      } else {\n        value = locateStr;\n      }\n    }\n  }\n\n  if (typeof value === 'undefined') return '';\n\n  if (typeof value === 'string') return value;\n\n  if (typeof value === 'object') {\n    const locateStr = locateParamStr(value as any);\n    if (locateStr) {\n      return locateStr;\n    }\n    return JSON.stringify(value, undefined, 2);\n  }\n\n  return String(value);\n}\n","import {\n  AiExtractElementInfo,\n  AiLocateElement,\n  callAIWithObjectResponse,\n} from '@/ai-model/index';\nimport { AiLocateSection } from '@/ai-model/inspect';\nimport { elementDescriberInstruction } from '@/ai-model/prompt/describe';\nimport { AIActionType, type AIArgs, expandSearchArea } from '@/common';\nimport type {\n  AIDescribeElementResponse,\n  AIUsageInfo,\n  DetailedLocateParam,\n  LocateResultWithDump,\n  PartialServiceDumpFromSDK,\n  Rect,\n  ServiceExtractOption,\n  ServiceExtractParam,\n  ServiceExtractResult,\n  ServiceTaskInfo,\n  UIContext,\n} from '@/types';\nimport { ServiceError } from '@/types';\nimport {\n  type IModelConfig,\n  MIDSCENE_FORCE_DEEP_THINK,\n  globalConfigManager,\n} from '@midscene/shared/env';\nimport { compositeElementInfoImg, cropByRect } from '@midscene/shared/img';\nimport { getDebug } from '@midscene/shared/logger';\nimport { assert } from '@midscene/shared/utils';\nimport type { TMultimodalPrompt } from '../common';\nimport { createServiceDump } from './utils';\n\nexport interface LocateOpts {\n  context?: UIContext;\n}\n\nexport type AnyValue<T> = {\n  [K in keyof T]: unknown extends T[K] ? any : T[K];\n};\n\ninterface ServiceOptions {\n  taskInfo?: Omit<ServiceTaskInfo, 'durationMs'>;\n  aiVendorFn?: typeof callAIWithObjectResponse;\n}\n\nconst debug = getDebug('ai:service');\nexport default class Service {\n  contextRetrieverFn: () => Promise<UIContext> | UIContext;\n\n  aiVendorFn: Exclude<ServiceOptions['aiVendorFn'], undefined> =\n    callAIWithObjectResponse;\n\n  taskInfo?: Omit<ServiceTaskInfo, 'durationMs'>;\n\n  constructor(\n    context: UIContext | (() => Promise<UIContext> | UIContext),\n    opt?: ServiceOptions,\n  ) {\n    assert(context, 'context is required for Service');\n    if (typeof context === 'function') {\n      this.contextRetrieverFn = context;\n    } else {\n      this.contextRetrieverFn = () => Promise.resolve(context);\n    }\n\n    // just for unit test, aiVendorFn is callAIWithObjectResponse by default\n    if (typeof opt?.aiVendorFn !== 'undefined') {\n      this.aiVendorFn = opt.aiVendorFn;\n    }\n    if (typeof opt?.taskInfo !== 'undefined') {\n      this.taskInfo = opt.taskInfo;\n    }\n  }\n\n  async locate(\n    query: DetailedLocateParam,\n    opt: LocateOpts,\n    modelConfig: IModelConfig,\n  ): Promise<LocateResultWithDump> {\n    const queryPrompt = typeof query === 'string' ? query : query.prompt;\n    assert(queryPrompt, 'query is required for locate');\n\n    assert(typeof query === 'object', 'query should be an object for locate');\n\n    const globalDeepThinkSwitch = globalConfigManager.getEnvConfigInBoolean(\n      MIDSCENE_FORCE_DEEP_THINK,\n    );\n    if (globalDeepThinkSwitch) {\n      debug('globalDeepThinkSwitch', globalDeepThinkSwitch);\n    }\n    let searchAreaPrompt;\n    if (query.deepThink || globalDeepThinkSwitch) {\n      searchAreaPrompt = query.prompt;\n    }\n\n    const { vlMode } = modelConfig;\n\n    if (searchAreaPrompt && !vlMode) {\n      console.warn(\n        'The \"deepThink\" feature is not supported with multimodal LLM. Please config VL model for Midscene. https://midscenejs.com/model-config',\n      );\n      searchAreaPrompt = undefined;\n    }\n\n    const context = opt?.context || (await this.contextRetrieverFn());\n\n    let searchArea: Rect | undefined = undefined;\n    let searchAreaRawResponse: string | undefined = undefined;\n    let searchAreaUsage: AIUsageInfo | undefined = undefined;\n    let searchAreaResponse:\n      | Awaited<ReturnType<typeof AiLocateSection>>\n      | undefined = undefined;\n    if (searchAreaPrompt) {\n      searchAreaResponse = await AiLocateSection({\n        context,\n        sectionDescription: searchAreaPrompt,\n        modelConfig,\n      });\n      assert(\n        searchAreaResponse.rect,\n        `cannot find search area for \"${searchAreaPrompt}\"${\n          searchAreaResponse.error ? `: ${searchAreaResponse.error}` : ''\n        }`,\n      );\n      searchAreaRawResponse = searchAreaResponse.rawResponse;\n      searchAreaUsage = searchAreaResponse.usage;\n      searchArea = searchAreaResponse.rect;\n    }\n\n    const startTime = Date.now();\n    const { parseResult, rect, rawResponse, usage } = await AiLocateElement({\n      callAIFn: this.aiVendorFn,\n      context,\n      targetElementDescription: queryPrompt,\n      searchConfig: searchAreaResponse,\n      modelConfig,\n    });\n\n    const timeCost = Date.now() - startTime;\n    const taskInfo: ServiceTaskInfo = {\n      ...(this.taskInfo ? this.taskInfo : {}),\n      durationMs: timeCost,\n      rawResponse: JSON.stringify(rawResponse),\n      formatResponse: JSON.stringify(parseResult),\n      usage,\n      searchArea,\n      searchAreaRawResponse,\n      searchAreaUsage,\n    };\n\n    let errorLog: string | undefined;\n    if (parseResult.errors?.length) {\n      errorLog = `failed to locate element: \\n${parseResult.errors.join('\\n')}`;\n    }\n\n    const dumpData: PartialServiceDumpFromSDK = {\n      type: 'locate',\n      userQuery: {\n        element: queryPrompt,\n      },\n      matchedElement: [],\n      matchedRect: rect,\n      data: null,\n      taskInfo,\n      deepThink: !!searchArea,\n      error: errorLog,\n    };\n\n    const elements = parseResult.elements || [];\n\n    const dump = createServiceDump({\n      ...dumpData,\n      matchedElement: elements,\n    });\n\n    if (errorLog) {\n      throw new ServiceError(errorLog, dump);\n    }\n\n    if (elements.length > 1) {\n      throw new ServiceError(\n        `locate: multiple elements found, length = ${elements.length}`,\n        dump,\n      );\n    }\n\n    if (elements.length === 1) {\n      return {\n        element: {\n          center: elements[0]!.center,\n          rect: elements[0]!.rect,\n          description: elements[0]!.description,\n        },\n        rect,\n        dump,\n      };\n    }\n\n    return {\n      element: null,\n      rect,\n      dump,\n    };\n  }\n\n  async extract<T>(\n    dataDemand: ServiceExtractParam,\n    modelConfig: IModelConfig,\n    opt?: ServiceExtractOption,\n    pageDescription?: string,\n    multimodalPrompt?: TMultimodalPrompt,\n  ): Promise<ServiceExtractResult<T>> {\n    assert(\n      typeof dataDemand === 'object' || typeof dataDemand === 'string',\n      `dataDemand should be object or string, but get ${typeof dataDemand}`,\n    );\n    const context = await this.contextRetrieverFn();\n\n    const startTime = Date.now();\n\n    const { parseResult, usage } = await AiExtractElementInfo<T>({\n      context,\n      dataQuery: dataDemand,\n      multimodalPrompt,\n      extractOption: opt,\n      modelConfig,\n      pageDescription,\n    });\n\n    const timeCost = Date.now() - startTime;\n    const taskInfo: ServiceTaskInfo = {\n      ...(this.taskInfo ? this.taskInfo : {}),\n      durationMs: timeCost,\n      rawResponse: JSON.stringify(parseResult),\n    };\n\n    let errorLog: string | undefined;\n    if (parseResult.errors?.length) {\n      errorLog = `AI response error: \\n${parseResult.errors.join('\\n')}`;\n    }\n\n    const dumpData: PartialServiceDumpFromSDK = {\n      type: 'extract',\n      userQuery: {\n        dataDemand,\n      },\n      matchedElement: [],\n      data: null,\n      taskInfo,\n      error: errorLog,\n    };\n\n    const { data, thought } = parseResult || {};\n\n    // 4\n    const dump = createServiceDump({\n      ...dumpData,\n      data,\n    });\n\n    if (errorLog && !data) {\n      throw new ServiceError(errorLog, dump);\n    }\n\n    return {\n      data,\n      thought,\n      usage,\n      dump,\n    };\n  }\n\n  async describe(\n    target: Rect | [number, number],\n    modelConfig: IModelConfig,\n    opt?: {\n      deepThink?: boolean;\n    },\n  ): Promise<Pick<AIDescribeElementResponse, 'description'>> {\n    assert(target, 'target is required for service.describe');\n    const context = await this.contextRetrieverFn();\n    const { screenshotBase64, size } = context;\n    assert(screenshotBase64, 'screenshot is required for service.describe');\n    // The result of the \"describe\" function will be used for positioning, so essentially it is a form of grounding.\n    const { vlMode } = modelConfig;\n    const systemPrompt = elementDescriberInstruction();\n\n    // Convert [x,y] center point to Rect if needed\n    const defaultRectSize = 30;\n    const targetRect: Rect = Array.isArray(target)\n      ? {\n          left: Math.floor(target[0] - defaultRectSize / 2),\n          top: Math.floor(target[1] - defaultRectSize / 2),\n          width: defaultRectSize,\n          height: defaultRectSize,\n        }\n      : target;\n\n    let imagePayload = await compositeElementInfoImg({\n      inputImgBase64: screenshotBase64,\n      size,\n      elementsPositionInfo: [\n        {\n          rect: targetRect,\n        },\n      ],\n      borderThickness: 3,\n    });\n\n    if (opt?.deepThink) {\n      const searchArea = expandSearchArea(targetRect, context.size, vlMode);\n      debug('describe: set searchArea', searchArea);\n      const croppedResult = await cropByRect(\n        imagePayload,\n        searchArea,\n        vlMode === 'qwen2.5-vl',\n      );\n      imagePayload = croppedResult.imageBase64;\n    }\n\n    const msgs: AIArgs = [\n      { role: 'system', content: systemPrompt },\n      {\n        role: 'user',\n        content: [\n          {\n            type: 'image_url',\n            image_url: {\n              url: imagePayload,\n              detail: 'high',\n            },\n          },\n        ],\n      },\n    ];\n\n    const callAIFn = this\n      .aiVendorFn as typeof callAIWithObjectResponse<AIDescribeElementResponse>;\n\n    const res = await callAIFn(\n      msgs,\n      AIActionType.DESCRIBE_ELEMENT,\n      modelConfig,\n    );\n\n    const { content } = res;\n    assert(!content.error, `describe failed: ${content.error}`);\n    assert(content.description, 'failed to describe the element');\n    return content;\n  }\n}\n","import type {\n  ExecutionDump,\n  ExecutionRecorderItem,\n  ExecutionTask,\n  ExecutionTaskActionApply,\n  ExecutionTaskApply,\n  ExecutionTaskPlanningLocateOutput,\n  ExecutionTaskProgressOptions,\n  ExecutionTaskReturn,\n  ExecutorContext,\n  PlanningActionParamError,\n  UIContext,\n} from '@/types';\nimport { getDebug } from '@midscene/shared/logger';\nimport { assert } from '@midscene/shared/utils';\n\nconst debug = getDebug('task-runner');\nconst UI_CONTEXT_CACHE_TTL_MS = 300;\n\ntype TaskRunnerInitOptions = ExecutionTaskProgressOptions & {\n  tasks?: ExecutionTaskApply[];\n  onTaskUpdate?: (\n    runner: TaskRunner,\n    error?: TaskExecutionError,\n  ) => Promise<void> | void;\n};\n\ntype TaskRunnerOperationOptions = {\n  allowWhenError?: boolean;\n};\n\nexport class TaskRunner {\n  name: string;\n\n  tasks: ExecutionTask[];\n\n  // status of runner\n  status: 'init' | 'pending' | 'running' | 'completed' | 'error';\n\n  onTaskStart?: ExecutionTaskProgressOptions['onTaskStart'];\n\n  private readonly uiContextBuilder: () => Promise<UIContext>;\n\n  private readonly onTaskUpdate?:\n    | ((runner: TaskRunner, error?: TaskExecutionError) => Promise<void> | void)\n    | undefined;\n\n  constructor(\n    name: string,\n    uiContextBuilder: () => Promise<UIContext>,\n    options?: TaskRunnerInitOptions,\n  ) {\n    this.status =\n      options?.tasks && options.tasks.length > 0 ? 'pending' : 'init';\n    this.name = name;\n    this.tasks = (options?.tasks || []).map((item) =>\n      this.markTaskAsPending(item),\n    );\n    this.onTaskStart = options?.onTaskStart;\n    this.uiContextBuilder = uiContextBuilder;\n    this.onTaskUpdate = options?.onTaskUpdate;\n  }\n\n  private async emitOnTaskUpdate(error?: TaskExecutionError): Promise<void> {\n    if (!this.onTaskUpdate) {\n      return;\n    }\n    await this.onTaskUpdate(this, error);\n  }\n\n  private lastUiContext?: {\n    context: UIContext;\n    capturedAt: number;\n  };\n\n  private async getUiContext(options?: { forceRefresh?: boolean }): Promise<\n    UIContext | undefined\n  > {\n    const now = Date.now();\n    const shouldReuse =\n      !options?.forceRefresh &&\n      this.lastUiContext &&\n      now - this.lastUiContext.capturedAt <= UI_CONTEXT_CACHE_TTL_MS;\n\n    if (shouldReuse && this.lastUiContext?.context) {\n      debug(\n        `reuse cached uiContext captured ${now - this.lastUiContext.capturedAt}ms ago`,\n      );\n      return this.lastUiContext?.context;\n    }\n\n    try {\n      const uiContext = await this.uiContextBuilder();\n      if (uiContext) {\n        this.lastUiContext = {\n          context: uiContext,\n          capturedAt: Date.now(),\n        };\n      } else {\n        this.lastUiContext = undefined;\n      }\n      return uiContext;\n    } catch (error) {\n      this.lastUiContext = undefined;\n      throw error;\n    }\n  }\n\n  private async captureScreenshot(): Promise<string | undefined> {\n    try {\n      const uiContext = await this.getUiContext({ forceRefresh: true });\n      return uiContext?.screenshotBase64;\n    } catch (error) {\n      console.error('error while capturing screenshot', error);\n    }\n    return undefined;\n  }\n\n  private attachRecorderItem(\n    task: ExecutionTask,\n    contextOrScreenshot: UIContext | string | undefined,\n    phase: 'after-calling',\n  ): void {\n    const timing = phase;\n    const screenshot =\n      typeof contextOrScreenshot === 'string'\n        ? contextOrScreenshot\n        : contextOrScreenshot?.screenshotBase64;\n    if (!timing || !screenshot) {\n      return;\n    }\n\n    const recorderItem: ExecutionRecorderItem = {\n      type: 'screenshot',\n      ts: Date.now(),\n      screenshot,\n      timing,\n    };\n\n    if (!task.recorder) {\n      task.recorder = [recorderItem];\n      return;\n    }\n    task.recorder.push(recorderItem);\n  }\n\n  private markTaskAsPending(task: ExecutionTaskApply): ExecutionTask {\n    return {\n      status: 'pending',\n      ...task,\n    };\n  }\n\n  private normalizeStatusFromError(\n    options?: TaskRunnerOperationOptions,\n    errorMessage?: string,\n  ): void {\n    if (this.status !== 'error') {\n      return;\n    }\n    assert(\n      options?.allowWhenError,\n      errorMessage ||\n        `task runner is in error state, cannot proceed\\nerror=${this.latestErrorTask()?.error}\\n${this.latestErrorTask()?.errorStack}`,\n    );\n    // reset runner state so new tasks can run\n    this.status = this.tasks.length > 0 ? 'pending' : 'init';\n  }\n\n  private findPreviousNonSubTaskUIContext(\n    currentIndex: number,\n  ): UIContext | undefined {\n    for (let i = currentIndex - 1; i >= 0; i--) {\n      const candidate = this.tasks[i];\n      if (!candidate || candidate.subTask) {\n        continue;\n      }\n      if (candidate.uiContext) {\n        return candidate.uiContext;\n      }\n    }\n    return undefined;\n  }\n\n  async append(\n    task: ExecutionTaskApply[] | ExecutionTaskApply,\n    options?: TaskRunnerOperationOptions,\n  ): Promise<void> {\n    this.normalizeStatusFromError(\n      options,\n      `task runner is in error state, cannot append task\\nerror=${this.latestErrorTask()?.error}\\n${this.latestErrorTask()?.errorStack}`,\n    );\n    if (Array.isArray(task)) {\n      this.tasks.push(...task.map((item) => this.markTaskAsPending(item)));\n    } else {\n      this.tasks.push(this.markTaskAsPending(task));\n    }\n    if (this.status !== 'running') {\n      this.status = 'pending';\n    }\n    await this.emitOnTaskUpdate();\n  }\n\n  async appendAndFlush(\n    task: ExecutionTaskApply[] | ExecutionTaskApply,\n    options?: TaskRunnerOperationOptions,\n  ): Promise<{ output: any; thought?: string } | undefined> {\n    await this.append(task, options);\n    return this.flush(options);\n  }\n\n  async flush(\n    options?: TaskRunnerOperationOptions,\n  ): Promise<{ output: any; thought?: string } | undefined> {\n    if (this.status === 'init' && this.tasks.length > 0) {\n      console.warn(\n        'illegal state for task runner, status is init but tasks are not empty',\n      );\n    }\n\n    this.normalizeStatusFromError(options, 'task runner is in error state');\n    assert(this.status !== 'running', 'task runner is already running');\n    assert(this.status !== 'completed', 'task runner is already completed');\n\n    const nextPendingIndex = this.tasks.findIndex(\n      (task) => task.status === 'pending',\n    );\n    if (nextPendingIndex < 0) {\n      // all tasks are completed\n      return;\n    }\n\n    this.status = 'running';\n    await this.emitOnTaskUpdate();\n    let taskIndex = nextPendingIndex;\n    let successfullyCompleted = true;\n\n    let previousFindOutput: ExecutionTaskPlanningLocateOutput | undefined;\n\n    while (taskIndex < this.tasks.length) {\n      const task = this.tasks[taskIndex];\n      assert(\n        task.status === 'pending',\n        `task status should be pending, but got: ${task.status}`,\n      );\n      task.timing = {\n        start: Date.now(),\n      };\n      try {\n        task.status = 'running';\n        await this.emitOnTaskUpdate();\n        try {\n          if (this.onTaskStart) {\n            await this.onTaskStart(task);\n          }\n        } catch (e) {\n          console.error('error in onTaskStart', e);\n        }\n        assert(\n          ['Insight', 'Action Space', 'Planning'].indexOf(task.type) >= 0,\n          `unsupported task type: ${task.type}`,\n        );\n\n        const { executor, param } = task;\n        assert(executor, `executor is required for task type: ${task.type}`);\n\n        let returnValue;\n        let uiContext: UIContext | undefined;\n        if (task.subTask) {\n          uiContext = this.findPreviousNonSubTaskUIContext(taskIndex);\n          assert(\n            uiContext,\n            'subTask requires uiContext from previous non-subTask task',\n          );\n        } else {\n          uiContext = await this.getUiContext();\n        }\n        task.uiContext = uiContext;\n        const executorContext: ExecutorContext = {\n          task,\n          element: previousFindOutput?.element,\n          uiContext,\n        };\n\n        if (task.type === 'Insight') {\n          assert(\n            task.subType === 'Query' ||\n              task.subType === 'Assert' ||\n              task.subType === 'WaitFor' ||\n              task.subType === 'Boolean' ||\n              task.subType === 'Number' ||\n              task.subType === 'String',\n            `unsupported service subType: ${task.subType}`,\n          );\n          returnValue = await task.executor(param, executorContext);\n        } else if (task.type === 'Planning') {\n          returnValue = await task.executor(param, executorContext);\n          if (task.subType === 'Locate') {\n            previousFindOutput = (\n              returnValue as ExecutionTaskReturn<ExecutionTaskPlanningLocateOutput>\n            )?.output;\n          }\n        } else if (task.type === 'Action Space') {\n          returnValue = await task.executor(param, executorContext);\n        } else {\n          console.warn(\n            `unsupported task type: ${task.type}, will try to execute it directly`,\n          );\n          returnValue = await task.executor(param, executorContext);\n        }\n\n        const isLastTask = taskIndex === this.tasks.length - 1;\n\n        if (isLastTask) {\n          const screenshot = await this.captureScreenshot();\n          this.attachRecorderItem(task, screenshot, 'after-calling');\n        }\n\n        Object.assign(task, returnValue);\n        task.status = 'finished';\n        task.timing.end = Date.now();\n        task.timing.cost = task.timing.end - task.timing.start;\n        await this.emitOnTaskUpdate();\n        taskIndex++;\n      } catch (e: any) {\n        successfullyCompleted = false;\n        task.error = e;\n        task.errorMessage =\n          e?.message || (typeof e === 'string' ? e : 'error-without-message');\n        task.errorStack = e.stack;\n\n        task.status = 'failed';\n        task.timing.end = Date.now();\n        task.timing.cost = task.timing.end - task.timing.start;\n        await this.emitOnTaskUpdate();\n        break;\n      }\n    }\n\n    // set all remaining tasks as cancelled\n    for (let i = taskIndex + 1; i < this.tasks.length; i++) {\n      this.tasks[i].status = 'cancelled';\n    }\n    if (taskIndex + 1 < this.tasks.length) {\n      await this.emitOnTaskUpdate();\n    }\n\n    let finalizeError: TaskExecutionError | undefined;\n    if (!successfullyCompleted) {\n      this.status = 'error';\n      const errorTask = this.latestErrorTask();\n      const messageBase =\n        errorTask?.errorMessage ||\n        (errorTask?.error ? String(errorTask.error) : 'Task execution failed');\n      const stack = errorTask?.errorStack;\n      const message = stack ? `${messageBase}\\n${stack}` : messageBase;\n      finalizeError = new TaskExecutionError(message, this, errorTask, {\n        cause: errorTask?.error,\n      });\n      await this.emitOnTaskUpdate(finalizeError);\n    } else {\n      this.status = 'completed';\n      await this.emitOnTaskUpdate();\n    }\n\n    if (finalizeError) {\n      throw finalizeError;\n    }\n\n    if (this.tasks.length) {\n      // return the last output\n      const outputIndex = Math.min(taskIndex, this.tasks.length - 1);\n      const { thought, output } = this.tasks[outputIndex];\n      return {\n        thought,\n        output,\n      };\n    }\n  }\n\n  isInErrorState(): boolean {\n    return this.status === 'error';\n  }\n\n  latestErrorTask(): ExecutionTask | null {\n    if (this.status !== 'error') {\n      return null;\n    }\n    const errorTaskIndex = this.tasks.findIndex(\n      (task) => task.status === 'failed',\n    );\n    if (errorTaskIndex >= 0) {\n      return this.tasks[errorTaskIndex];\n    }\n    return null;\n  }\n\n  dump(): ExecutionDump {\n    const dumpData: ExecutionDump = {\n      logTime: Date.now(),\n      name: this.name,\n      tasks: this.tasks,\n    };\n    return dumpData;\n  }\n\n  async appendErrorPlan(errorMsg: string): Promise<{\n    output: undefined;\n    runner: TaskRunner;\n  }> {\n    const errorTask: ExecutionTaskActionApply<PlanningActionParamError> = {\n      type: 'Action Space',\n      subType: 'Error',\n      param: {\n        thought: errorMsg,\n      },\n      thought: errorMsg,\n      executor: async () => {\n        throw new Error(errorMsg || 'error without thought');\n      },\n    };\n    await this.appendAndFlush(errorTask);\n\n    return {\n      output: undefined,\n      runner: this,\n    };\n  }\n}\n\nexport class TaskExecutionError extends Error {\n  runner: TaskRunner;\n\n  errorTask: ExecutionTask | null;\n\n  constructor(\n    message: string,\n    runner: TaskRunner,\n    errorTask: ExecutionTask | null,\n    options?: { cause?: unknown },\n  ) {\n    super(message, options);\n    this.runner = runner;\n    this.errorTask = errorTask;\n  }\n}\n","import { getMidsceneLocationSchema } from '@/common';\nimport type {\n  ActionScrollParam,\n  DeviceAction,\n  LocateResultElement,\n} from '@/types';\nimport type { IModelConfig } from '@midscene/shared/env';\nimport type { ElementNode } from '@midscene/shared/extractor';\nimport { getDebug } from '@midscene/shared/logger';\nimport { _keyDefinitions } from '@midscene/shared/us-keyboard-layout';\nimport { z } from 'zod';\nimport type { ElementCacheFeature, Rect, Size, UIContext } from '../types';\n\nexport abstract class AbstractInterface {\n  abstract interfaceType: string;\n\n  abstract screenshotBase64(): Promise<string>;\n  abstract size(): Promise<Size>;\n  abstract actionSpace(): DeviceAction[];\n\n  abstract cacheFeatureForRect?(\n    rect: Rect,\n    options?: {\n      targetDescription?: string;\n      modelConfig?: IModelConfig;\n    },\n  ): Promise<ElementCacheFeature>;\n  abstract rectMatchesCacheFeature?(\n    feature: ElementCacheFeature,\n  ): Promise<Rect>;\n\n  abstract destroy?(): Promise<void>;\n\n  abstract describe?(): string;\n  abstract beforeInvokeAction?(actionName: string, param: any): Promise<void>;\n  abstract afterInvokeAction?(actionName: string, param: any): Promise<void>;\n\n  // @deprecated do NOT extend this method\n  abstract getElementsNodeTree?: () => Promise<ElementNode>;\n\n  // @deprecated do NOT extend this method\n  abstract url?: () => string | Promise<string>;\n\n  // @deprecated do NOT extend this method\n  abstract evaluateJavaScript?<T = any>(script: string): Promise<T>;\n\n  // @deprecated do NOT extend this method\n  abstract getContext?(): Promise<UIContext>;\n}\n\n// Generic function to define actions with proper type inference\n// TRuntime allows specifying a different type for the runtime parameter (after location resolution)\n// TReturn allows specifying the return type of the action\nexport const defineAction = <\n  TSchema extends z.ZodType | undefined = undefined,\n  TRuntime = TSchema extends z.ZodType ? z.infer<TSchema> : undefined,\n  TReturn = any,\n>(\n  config: {\n    name: string;\n    description: string;\n    interfaceAlias?: string;\n    paramSchema?: TSchema;\n    call: (param: TRuntime) => Promise<TReturn> | TReturn;\n  } & Partial<\n    Omit<\n      DeviceAction<TRuntime, TReturn>,\n      'name' | 'description' | 'interfaceAlias' | 'paramSchema' | 'call'\n    >\n  >,\n): DeviceAction<TRuntime, TReturn> => {\n  return config as any; // Type assertion needed because schema validation type differs from runtime type\n};\n\n// Tap\nexport const actionTapParamSchema = z.object({\n  locate: getMidsceneLocationSchema().describe('The element to be tapped'),\n});\n// Override the inferred type to use LocateResultElement for the runtime locate field\nexport type ActionTapParam = {\n  locate: LocateResultElement;\n};\n\nexport const defineActionTap = (\n  call: (param: ActionTapParam) => Promise<void>,\n): DeviceAction<ActionTapParam> => {\n  return defineAction<typeof actionTapParamSchema, ActionTapParam>({\n    name: 'Tap',\n    description: 'Tap the element',\n    interfaceAlias: 'aiTap',\n    paramSchema: actionTapParamSchema,\n    call,\n  });\n};\n\n// RightClick\nexport const actionRightClickParamSchema = z.object({\n  locate: getMidsceneLocationSchema().describe(\n    'The element to be right clicked',\n  ),\n});\nexport type ActionRightClickParam = {\n  locate: LocateResultElement;\n};\n\nexport const defineActionRightClick = (\n  call: (param: ActionRightClickParam) => Promise<void>,\n): DeviceAction<ActionRightClickParam> => {\n  return defineAction<\n    typeof actionRightClickParamSchema,\n    ActionRightClickParam\n  >({\n    name: 'RightClick',\n    description: 'Right click the element',\n    interfaceAlias: 'aiRightClick',\n    paramSchema: actionRightClickParamSchema,\n    call,\n  });\n};\n\n// DoubleClick\nexport const actionDoubleClickParamSchema = z.object({\n  locate: getMidsceneLocationSchema().describe(\n    'The element to be double clicked',\n  ),\n});\nexport type ActionDoubleClickParam = {\n  locate: LocateResultElement;\n};\n\nexport const defineActionDoubleClick = (\n  call: (param: ActionDoubleClickParam) => Promise<void>,\n): DeviceAction<ActionDoubleClickParam> => {\n  return defineAction<\n    typeof actionDoubleClickParamSchema,\n    ActionDoubleClickParam\n  >({\n    name: 'DoubleClick',\n    description: 'Double click the element',\n    interfaceAlias: 'aiDoubleClick',\n    paramSchema: actionDoubleClickParamSchema,\n    call,\n  });\n};\n\n// Hover\nexport const actionHoverParamSchema = z.object({\n  locate: getMidsceneLocationSchema().describe('The element to be hovered'),\n});\nexport type ActionHoverParam = {\n  locate: LocateResultElement;\n};\n\nexport const defineActionHover = (\n  call: (param: ActionHoverParam) => Promise<void>,\n): DeviceAction<ActionHoverParam> => {\n  return defineAction<typeof actionHoverParamSchema, ActionHoverParam>({\n    name: 'Hover',\n    description: 'Move the mouse to the element',\n    interfaceAlias: 'aiHover',\n    paramSchema: actionHoverParamSchema,\n    call,\n  });\n};\n\n// Input\nconst inputLocateDescription =\n  'the position of the placeholder or text content in the target input field. If there is no content, locate the center of the input field.';\nexport const actionInputParamSchema = z.object({\n  value: z\n    .union([z.string(), z.number()])\n    .transform((val) => String(val))\n    .describe(\n      'The text to input. Provide the final content for replace/append modes, or an empty string when using clear mode to remove existing text.',\n    ),\n  locate: getMidsceneLocationSchema()\n    .describe(inputLocateDescription)\n    .optional(),\n  mode: z\n    .enum(['replace', 'clear', 'append'])\n    .default('replace')\n    .optional()\n    .describe(\n      'Input mode: \"replace\" (default) - clear the field and input the value; \"append\" - append the value to existing content; \"clear\" - clear the field without inputting new text.',\n    ),\n});\nexport type ActionInputParam = {\n  value: string;\n  locate?: LocateResultElement;\n  mode?: 'replace' | 'clear' | 'append';\n};\n\nexport const defineActionInput = (\n  call: (param: ActionInputParam) => Promise<void>,\n): DeviceAction<ActionInputParam> => {\n  return defineAction<typeof actionInputParamSchema, ActionInputParam>({\n    name: 'Input',\n    description: 'Input the value into the element',\n    interfaceAlias: 'aiInput',\n    paramSchema: actionInputParamSchema,\n    call,\n  });\n};\n\n// KeyboardPress\nexport const actionKeyboardPressParamSchema = z.object({\n  locate: getMidsceneLocationSchema()\n    .describe('The element to be clicked before pressing the key')\n    .optional(),\n  keyName: z\n    .string()\n    .describe(\n      \"The key to be pressed. Use '+' for key combinations, e.g., 'Control+A', 'Shift+Enter'\",\n    ),\n});\nexport type ActionKeyboardPressParam = {\n  locate?: LocateResultElement;\n  keyName: string;\n};\n\nexport const defineActionKeyboardPress = (\n  call: (param: ActionKeyboardPressParam) => Promise<void>,\n): DeviceAction<ActionKeyboardPressParam> => {\n  return defineAction<\n    typeof actionKeyboardPressParamSchema,\n    ActionKeyboardPressParam\n  >({\n    name: 'KeyboardPress',\n    description:\n      'Press a key or key combination, like \"Enter\", \"Tab\", \"Escape\", or \"Control+A\", \"Shift+Enter\". Do not use this to type text.',\n    interfaceAlias: 'aiKeyboardPress',\n    paramSchema: actionKeyboardPressParamSchema,\n    call,\n  });\n};\n\n// Scroll\nexport const actionScrollParamSchema = z.object({\n  direction: z\n    .enum(['down', 'up', 'right', 'left'])\n    .default('down')\n    .describe('The direction to scroll'),\n  scrollType: z\n    .enum([\n      'singleAction',\n      'scrollToBottom',\n      'scrollToTop',\n      'scrollToRight',\n      'scrollToLeft',\n    ])\n    .default('singleAction')\n    .describe(\n      'The scroll behavior: \"singleAction\" for a single scroll action, \"scrollToBottom\" for scrolling to the bottom, \"scrollToTop\" for scrolling to the top, \"scrollToRight\" for scrolling to the right, \"scrollToLeft\" for scrolling to the left',\n    ),\n  distance: z\n    .number()\n    .nullable()\n    .optional()\n    .describe('The distance in pixels to scroll'),\n  locate: getMidsceneLocationSchema()\n    .optional()\n    .describe(\n      'The target element to be scrolled on, like \"the table\" or \"the list\" or \"the content area\" or \"the scrollable area\"',\n    ),\n});\n\nexport const defineActionScroll = (\n  call: (param: ActionScrollParam) => Promise<void>,\n): DeviceAction<ActionScrollParam> => {\n  return defineAction<typeof actionScrollParamSchema, ActionScrollParam>({\n    name: 'Scroll',\n    description:\n      'Scroll the page or an element. The direction to scroll, the scroll type, and the distance to scroll. The distance is the number of pixels to scroll. If not specified, use `down` direction, `once` scroll type, and `null` distance.',\n    interfaceAlias: 'aiScroll',\n    paramSchema: actionScrollParamSchema,\n    call,\n  });\n};\n\n// DragAndDrop\nexport const actionDragAndDropParamSchema = z.object({\n  from: getMidsceneLocationSchema().describe('The position to be dragged'),\n  to: getMidsceneLocationSchema().describe('The position to be dropped'),\n});\nexport type ActionDragAndDropParam = {\n  from: LocateResultElement;\n  to: LocateResultElement;\n};\n\nexport const defineActionDragAndDrop = (\n  call: (param: ActionDragAndDropParam) => Promise<void>,\n): DeviceAction<ActionDragAndDropParam> => {\n  return defineAction<\n    typeof actionDragAndDropParamSchema,\n    ActionDragAndDropParam\n  >({\n    name: 'DragAndDrop',\n    description:\n      'Drag and drop (hold the mouse or finger down and move the mouse) ',\n    interfaceAlias: 'aiDragAndDrop',\n    paramSchema: actionDragAndDropParamSchema,\n    call,\n  });\n};\n\nexport const ActionLongPressParamSchema = z.object({\n  locate: getMidsceneLocationSchema().describe(\n    'The element to be long pressed',\n  ),\n  duration: z\n    .number()\n    .default(500)\n    .optional()\n    .describe('Long press duration in milliseconds'),\n});\n\nexport type ActionLongPressParam = {\n  locate: LocateResultElement;\n  duration?: number;\n};\nexport const defineActionLongPress = (\n  call: (param: ActionLongPressParam) => Promise<void>,\n): DeviceAction<ActionLongPressParam> => {\n  return defineAction<typeof ActionLongPressParamSchema, ActionLongPressParam>({\n    name: 'LongPress',\n    description: 'Long press the element',\n    paramSchema: ActionLongPressParamSchema,\n    call,\n  });\n};\n\nexport const ActionSwipeParamSchema = z.object({\n  start: getMidsceneLocationSchema()\n    .optional()\n    .describe(\n      'Starting point of the swipe gesture, if not specified, the center of the page will be used',\n    ),\n  direction: z\n    .enum(['up', 'down', 'left', 'right'])\n    .optional()\n    .describe(\n      'The direction to swipe (required when using distance). The direction means the direction of the finger swipe.',\n    ),\n  distance: z\n    .number()\n    .optional()\n    .describe('The distance in pixels to swipe (mutually exclusive with end)'),\n  end: getMidsceneLocationSchema()\n    .optional()\n    .describe(\n      'Ending point of the swipe gesture (mutually exclusive with distance)',\n    ),\n  duration: z\n    .number()\n    .default(300)\n    .describe('Duration of the swipe gesture in milliseconds'),\n  repeat: z\n    .number()\n    .optional()\n    .describe(\n      'The number of times to repeat the swipe gesture. 1 for default, 0 for infinite (e.g. endless swipe until the end of the page)',\n    ),\n});\n\nexport type ActionSwipeParam = {\n  start?: LocateResultElement;\n  direction?: 'up' | 'down' | 'left' | 'right';\n  distance?: number;\n  end?: LocateResultElement;\n  duration?: number;\n  repeat?: number;\n};\n\nexport const defineActionSwipe = (\n  call: (param: ActionSwipeParam) => Promise<void>,\n): DeviceAction<ActionSwipeParam> => {\n  return defineAction<typeof ActionSwipeParamSchema, ActionSwipeParam>({\n    name: 'Swipe',\n    description:\n      'Perform a swipe gesture. You must specify either \"end\" (target location) or \"distance\" + \"direction\" - they are mutually exclusive. Use \"end\" for precise location-based swipes, or \"distance\" + \"direction\" for relative movement.',\n    paramSchema: ActionSwipeParamSchema,\n    call,\n  });\n};\n\n// ClearInput\nexport const actionClearInputParamSchema = z.object({\n  locate: getMidsceneLocationSchema().describe('The input field to be cleared'),\n});\nexport type ActionClearInputParam = {\n  locate: LocateResultElement;\n};\n\nexport const defineActionClearInput = (\n  call: (param: ActionClearInputParam) => Promise<void>,\n): DeviceAction<ActionClearInputParam> => {\n  return defineAction<\n    typeof actionClearInputParamSchema,\n    ActionClearInputParam\n  >({\n    name: 'ClearInput',\n    description: inputLocateDescription,\n    interfaceAlias: 'aiClearInput',\n    paramSchema: actionClearInputParamSchema,\n    call,\n  });\n};\n\n// Assert\nexport const actionAssertParamSchema = z.object({\n  condition: z.string().describe('The condition of the assertion'),\n  thought: z\n    .string()\n    .describe(\n      'The thought of the assertion, like \"I can see there are A, B, C elements on the page, which means ... , so the assertion is true\"',\n    ),\n  result: z.boolean().describe('The result of the assertion, true or false'),\n});\nexport type ActionAssertParam = {\n  condition: string;\n  thought: string;\n  result: boolean;\n};\n\nexport const defineActionAssert = (): DeviceAction<ActionAssertParam> => {\n  return defineAction<typeof actionAssertParamSchema, ActionAssertParam>({\n    name: 'Print_Assert_Result',\n    description: 'Print the result of the assertion',\n    paramSchema: actionAssertParamSchema,\n    call: async (param) => {\n      if (typeof param?.result !== 'boolean') {\n        throw new Error(\n          `The result of the assertion must be a boolean, but got: ${typeof param?.result}. ${param.thought || '(no thought)'}`,\n        );\n      }\n\n      getDebug('device:common-action')(\n        `Assert: ${param.condition}, Thought: ${param.thought}, Result: ${param.result}`,\n      );\n\n      if (!param.result) {\n        throw new Error(\n          `Assertion failed: ${param.thought || '(no thought)'} (Assertion = ${param.condition})`,\n        );\n      }\n    },\n  });\n};\n\nexport type { DeviceAction } from '../types';\nexport type {\n  AndroidDeviceOpt,\n  AndroidDeviceInputOpt,\n  IOSDeviceOpt,\n  IOSDeviceInputOpt,\n} from './device-options';\n","import type { TMultimodalPrompt, TUserPrompt } from '@/common';\nimport type { AbstractInterface } from '@/device';\nimport type {\n  ElementCacheFeature,\n  LocateResultElement,\n  PlanningLocateParam,\n  UIContext,\n} from '@/types';\nimport { uploadTestInfoToServer } from '@/utils';\nimport {\n  MIDSCENE_REPORT_TAG_NAME,\n  globalConfigManager,\n} from '@midscene/shared/env';\nimport { generateElementByPosition } from '@midscene/shared/extractor';\nimport { getDebug } from '@midscene/shared/logger';\nimport { _keyDefinitions } from '@midscene/shared/us-keyboard-layout';\nimport { assert, logMsg, uuid } from '@midscene/shared/utils';\nimport dayjs from 'dayjs';\nimport type { TaskCache } from './task-cache';\nimport { debug as cacheDebug } from './task-cache';\n\nconst debugProfile = getDebug('web:tool:profile');\n\nexport async function commonContextParser(\n  interfaceInstance: AbstractInterface,\n  _opt: { uploadServerUrl?: string },\n): Promise<UIContext> {\n  assert(interfaceInstance, 'interfaceInstance is required');\n\n  debugProfile('Getting interface description');\n  const description = interfaceInstance.describe?.() || '';\n  debugProfile('Interface description end');\n\n  debugProfile('Uploading test info to server');\n  uploadTestInfoToServer({\n    testUrl: description,\n    serverUrl: _opt.uploadServerUrl,\n  });\n  debugProfile('UploadTestInfoToServer end');\n\n  const screenshotBase64 = await interfaceInstance.screenshotBase64();\n  assert(screenshotBase64!, 'screenshotBase64 is required');\n\n  debugProfile('will get size');\n  const size = await interfaceInstance.size();\n  debugProfile(`size: ${size.width}x${size.height} dpr: ${size.dpr}`);\n\n  return {\n    size,\n    screenshotBase64: screenshotBase64!,\n  };\n}\n\nexport function getReportFileName(tag = 'web') {\n  const reportTagName = globalConfigManager.getEnvConfigValue(\n    MIDSCENE_REPORT_TAG_NAME,\n  );\n  const dateTimeInFileName = dayjs().format('YYYY-MM-DD_HH-mm-ss');\n  // ensure uniqueness at the same time\n  const uniqueId = uuid().substring(0, 8);\n  return `${reportTagName || tag}-${dateTimeInFileName}-${uniqueId}`;\n}\n\nexport function printReportMsg(filepath: string) {\n  logMsg(`Midscene - report file updated: ${filepath}`);\n}\n\n/**\n * Get the current execution file name\n * @returns The name of the current execution file\n */\nexport function getCurrentExecutionFile(trace?: string): string | false {\n  const error = new Error();\n  const stackTrace = trace || error.stack;\n  const pkgDir = process.cwd() || '';\n  if (stackTrace) {\n    const stackLines = stackTrace.split('\\n');\n    for (const line of stackLines) {\n      if (\n        line.includes('.spec.') ||\n        line.includes('.test.') ||\n        line.includes('.ts') ||\n        line.includes('.js')\n      ) {\n        const match = line.match(/(?:at\\s+)?(.*?\\.(?:spec|test)\\.[jt]s)/);\n        if (match?.[1]) {\n          const targetFileName = match[1]\n            .replace(pkgDir, '')\n            .trim()\n            .replace('at ', '');\n          return targetFileName;\n        }\n      }\n    }\n  }\n  return false;\n}\n\nconst testFileIndex = new Map<string, number>();\n\nexport function generateCacheId(fileName?: string): string {\n  let taskFile = fileName || getCurrentExecutionFile();\n  if (!taskFile) {\n    taskFile = uuid();\n    console.warn(\n      'Midscene - using random UUID for cache id. Cache may be invalid.',\n    );\n  }\n\n  if (testFileIndex.has(taskFile)) {\n    const currentIndex = testFileIndex.get(taskFile);\n    if (currentIndex !== undefined) {\n      testFileIndex.set(taskFile, currentIndex + 1);\n    }\n  } else {\n    testFileIndex.set(taskFile, 1);\n  }\n  return `${taskFile}-${testFileIndex.get(taskFile)}`;\n}\n\nexport function ifPlanLocateParamIsBbox(\n  planLocateParam: PlanningLocateParam,\n): boolean {\n  return !!(\n    planLocateParam.bbox &&\n    Array.isArray(planLocateParam.bbox) &&\n    planLocateParam.bbox.length === 4\n  );\n}\n\nexport function matchElementFromPlan(\n  planLocateParam: PlanningLocateParam,\n): LocateResultElement | undefined {\n  if (!planLocateParam) {\n    return undefined;\n  }\n\n  if (planLocateParam.bbox) {\n    const centerPosition = {\n      x: Math.floor((planLocateParam.bbox[0] + planLocateParam.bbox[2]) / 2),\n      y: Math.floor((planLocateParam.bbox[1] + planLocateParam.bbox[3]) / 2),\n    };\n\n    const element = generateElementByPosition(\n      centerPosition,\n      typeof planLocateParam.prompt === 'string'\n        ? planLocateParam.prompt\n        : planLocateParam.prompt?.prompt || '',\n    );\n    return element;\n  }\n\n  return undefined;\n}\n\nexport async function matchElementFromCache(\n  context: {\n    taskCache?: TaskCache;\n    interfaceInstance: AbstractInterface;\n  },\n  cacheEntry: ElementCacheFeature | undefined,\n  cachePrompt: TUserPrompt,\n  cacheable: boolean | undefined,\n): Promise<LocateResultElement | undefined> {\n  if (!cacheEntry) {\n    return undefined;\n  }\n\n  if (cacheable === false) {\n    cacheDebug('cache disabled for prompt: %s', cachePrompt);\n    return undefined;\n  }\n\n  if (!context.taskCache?.isCacheResultUsed) {\n    return undefined;\n  }\n\n  if (!context.interfaceInstance.rectMatchesCacheFeature) {\n    cacheDebug(\n      'interface does not implement rectMatchesCacheFeature, skip cache',\n    );\n    return undefined;\n  }\n\n  try {\n    const rect =\n      await context.interfaceInstance.rectMatchesCacheFeature(cacheEntry);\n    const element: LocateResultElement = {\n      center: [\n        Math.round(rect.left + rect.width / 2),\n        Math.round(rect.top + rect.height / 2),\n      ],\n      rect,\n      description:\n        typeof cachePrompt === 'string'\n          ? cachePrompt\n          : cachePrompt.prompt || '',\n    };\n\n    cacheDebug('cache hit, prompt: %s', cachePrompt);\n    return element;\n  } catch (error) {\n    cacheDebug('rectMatchesCacheFeature error: %s', error);\n    return undefined;\n  }\n}\n\ndeclare const __VERSION__: string | undefined;\n\nexport const getMidsceneVersion = (): string => {\n  if (typeof __VERSION__ !== 'undefined') {\n    return __VERSION__;\n  } else if (\n    process.env.__VERSION__ &&\n    process.env.__VERSION__ !== 'undefined'\n  ) {\n    return process.env.__VERSION__;\n  }\n  throw new Error('__VERSION__ inject failed during build');\n};\n\nexport const parsePrompt = (\n  prompt: TUserPrompt,\n): {\n  textPrompt: string;\n  multimodalPrompt?: TMultimodalPrompt;\n} => {\n  if (typeof prompt === 'string') {\n    return {\n      textPrompt: prompt,\n      multimodalPrompt: undefined,\n    };\n  }\n  return {\n    textPrompt: prompt.prompt,\n    multimodalPrompt: prompt.images\n      ? {\n          images: prompt.images,\n          convertHttpImage2Base64: !!prompt.convertHttpImage2Base64,\n        }\n      : undefined,\n  };\n};\n","import assert from 'node:assert';\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\nimport { dirname, join } from 'node:path';\nimport { isDeepStrictEqual } from 'node:util';\nimport type { TUserPrompt } from '@/ai-model';\nimport type { ElementCacheFeature } from '@/types';\nimport { getMidsceneRunSubDir } from '@midscene/shared/common';\nimport {\n  MIDSCENE_CACHE_MAX_FILENAME_LENGTH,\n  globalConfigManager,\n} from '@midscene/shared/env';\nimport { getDebug } from '@midscene/shared/logger';\nimport { ifInBrowser, ifInWorker } from '@midscene/shared/utils';\nimport { generateHashId } from '@midscene/shared/utils';\nimport { replaceIllegalPathCharsAndSpace } from '@midscene/shared/utils';\nimport yaml from 'js-yaml';\nimport semver from 'semver';\nimport { getMidsceneVersion } from './utils';\n\nconst DEFAULT_CACHE_MAX_FILENAME_LENGTH = 200;\n\nexport const debug = getDebug('cache');\n\nexport interface PlanningCache {\n  type: 'plan';\n  prompt: string;\n  yamlWorkflow: string;\n}\n\nexport interface LocateCache {\n  type: 'locate';\n  prompt: TUserPrompt;\n  cache?: ElementCacheFeature;\n  /** @deprecated kept for backward compatibility */\n  xpaths?: string[];\n}\n\nexport interface MatchCacheResult<T extends PlanningCache | LocateCache> {\n  cacheContent: T;\n  updateFn: (cb: (cache: T) => void) => void;\n}\n\nexport type CacheFileContent = {\n  midsceneVersion: string;\n  cacheId: string;\n  caches: Array<PlanningCache | LocateCache>;\n};\n\nconst lowestSupportedMidsceneVersion = '0.16.10';\nexport const cacheFileExt = '.cache.yaml';\n\nexport class TaskCache {\n  cacheId: string;\n\n  cacheFilePath?: string;\n\n  cache: CacheFileContent;\n\n  isCacheResultUsed: boolean; // a flag to indicate if the cache result should be used\n  cacheOriginalLength: number;\n\n  readOnlyMode: boolean; // a flag to indicate if the cache is in read-only mode\n\n  writeOnlyMode: boolean; // a flag to indicate if the cache is in write-only mode\n\n  private matchedCacheIndices: Set<string> = new Set(); // Track matched records\n\n  constructor(\n    cacheId: string,\n    isCacheResultUsed: boolean,\n    cacheFilePath?: string,\n    options: { readOnly?: boolean; writeOnly?: boolean } = {},\n  ) {\n    assert(cacheId, 'cacheId is required');\n    let safeCacheId = replaceIllegalPathCharsAndSpace(cacheId);\n    const cacheMaxFilenameLength =\n      globalConfigManager.getEnvConfigInNumber(\n        MIDSCENE_CACHE_MAX_FILENAME_LENGTH,\n      ) || DEFAULT_CACHE_MAX_FILENAME_LENGTH;\n    if (Buffer.byteLength(safeCacheId, 'utf8') > cacheMaxFilenameLength) {\n      const prefix = safeCacheId.slice(0, 32);\n      const hash = generateHashId(undefined, safeCacheId);\n      safeCacheId = `${prefix}-${hash}`;\n    }\n    this.cacheId = safeCacheId;\n\n    this.cacheFilePath =\n      ifInBrowser || ifInWorker\n        ? undefined\n        : cacheFilePath ||\n          join(getMidsceneRunSubDir('cache'), `${this.cacheId}${cacheFileExt}`);\n    const readOnlyMode = Boolean(options?.readOnly);\n    const writeOnlyMode = Boolean(options?.writeOnly);\n\n    if (readOnlyMode && writeOnlyMode) {\n      throw new Error('TaskCache cannot be both read-only and write-only');\n    }\n\n    this.isCacheResultUsed = writeOnlyMode ? false : isCacheResultUsed;\n    this.readOnlyMode = readOnlyMode;\n    this.writeOnlyMode = writeOnlyMode;\n\n    let cacheContent;\n    if (this.cacheFilePath && !this.writeOnlyMode) {\n      cacheContent = this.loadCacheFromFile();\n    }\n    if (!cacheContent) {\n      cacheContent = {\n        midsceneVersion: getMidsceneVersion(),\n        cacheId: this.cacheId,\n        caches: [],\n      };\n    }\n    this.cache = cacheContent;\n    this.cacheOriginalLength = this.isCacheResultUsed\n      ? this.cache.caches.length\n      : 0;\n  }\n\n  matchCache(\n    prompt: TUserPrompt,\n    type: 'plan' | 'locate',\n  ): MatchCacheResult<PlanningCache | LocateCache> | undefined {\n    if (!this.isCacheResultUsed) {\n      return undefined;\n    }\n    // Find the first unused matching cache\n    const promptStr =\n      typeof prompt === 'string' ? prompt : JSON.stringify(prompt);\n    for (let i = 0; i < this.cacheOriginalLength; i++) {\n      const item = this.cache.caches[i];\n      const key = `${type}:${promptStr}:${i}`;\n      if (\n        item.type === type &&\n        isDeepStrictEqual(item.prompt, prompt) &&\n        !this.matchedCacheIndices.has(key)\n      ) {\n        if (item.type === 'locate') {\n          const locateItem = item as LocateCache;\n          if (!locateItem.cache && Array.isArray(locateItem.xpaths)) {\n            locateItem.cache = { xpaths: locateItem.xpaths };\n          }\n          if ('xpaths' in locateItem) {\n            locateItem.xpaths = undefined;\n          }\n        }\n        this.matchedCacheIndices.add(key);\n        debug(\n          'cache found and marked as used, type: %s, prompt: %s, index: %d',\n          type,\n          prompt,\n          i,\n        );\n        return {\n          cacheContent: item,\n          updateFn: (cb: (cache: PlanningCache | LocateCache) => void) => {\n            debug(\n              'will call updateFn to update cache, type: %s, prompt: %s, index: %d',\n              type,\n              prompt,\n              i,\n            );\n            cb(item);\n\n            if (this.readOnlyMode) {\n              debug(\n                'read-only mode, cache updated in memory but not flushed to file',\n              );\n              return;\n            }\n\n            debug(\n              'cache updated, will flush to file, type: %s, prompt: %s, index: %d',\n              type,\n              prompt,\n              i,\n            );\n            this.flushCacheToFile();\n          },\n        };\n      }\n    }\n    debug('no unused cache found, type: %s, prompt: %s', type, prompt);\n    return undefined;\n  }\n\n  matchPlanCache(prompt: string): MatchCacheResult<PlanningCache> | undefined {\n    return this.matchCache(prompt, 'plan') as\n      | MatchCacheResult<PlanningCache>\n      | undefined;\n  }\n\n  matchLocateCache(\n    prompt: TUserPrompt,\n  ): MatchCacheResult<LocateCache> | undefined {\n    return this.matchCache(prompt, 'locate') as\n      | MatchCacheResult<LocateCache>\n      | undefined;\n  }\n\n  appendCache(cache: PlanningCache | LocateCache) {\n    debug('will append cache', cache);\n    this.cache.caches.push(cache);\n\n    if (this.readOnlyMode) {\n      debug('read-only mode, cache appended to memory but not flushed to file');\n      return;\n    }\n\n    this.flushCacheToFile();\n  }\n\n  loadCacheFromFile() {\n    const cacheFile = this.cacheFilePath;\n    assert(cacheFile, 'cache file path is required');\n\n    if (!existsSync(cacheFile)) {\n      debug('no cache file found, path: %s', cacheFile);\n      return undefined;\n    }\n\n    // detect old cache file\n    const jsonTypeCacheFile = cacheFile.replace(cacheFileExt, '.json');\n    if (existsSync(jsonTypeCacheFile) && this.isCacheResultUsed) {\n      console.warn(\n        `An outdated cache file from an earlier version of Midscene has been detected. Since version 0.17, we have implemented an improved caching strategy. Please delete the old file located at: ${jsonTypeCacheFile}.`,\n      );\n      return undefined;\n    }\n\n    try {\n      const data = readFileSync(cacheFile, 'utf8');\n      const jsonData = yaml.load(data) as CacheFileContent;\n\n      const version = getMidsceneVersion();\n      if (!version) {\n        debug('no midscene version info, will not read cache from file');\n        return undefined;\n      }\n\n      if (\n        semver.lt(jsonData.midsceneVersion, lowestSupportedMidsceneVersion) &&\n        !jsonData.midsceneVersion.includes('beta') // for internal test\n      ) {\n        console.warn(\n          `You are using an old version of Midscene cache file, and we cannot match any info from it. Starting from Midscene v0.17, we changed our strategy to use xpath for cache info, providing better performance.\\nPlease delete the existing cache and rebuild it. Sorry for the inconvenience.\\ncache file: ${cacheFile}`,\n        );\n        return undefined;\n      }\n\n      debug(\n        'cache loaded from file, path: %s, cache version: %s, record length: %s',\n        cacheFile,\n        jsonData.midsceneVersion,\n        jsonData.caches.length,\n      );\n      jsonData.midsceneVersion = getMidsceneVersion(); // update the version\n      return jsonData;\n    } catch (err) {\n      debug(\n        'cache file exists but load failed, path: %s, error: %s',\n        cacheFile,\n        err,\n      );\n      return undefined;\n    }\n  }\n\n  flushCacheToFile(options?: { cleanUnused?: boolean }) {\n    const version = getMidsceneVersion();\n    if (!version) {\n      debug('no midscene version info, will not write cache to file');\n      return;\n    }\n\n    if (!this.cacheFilePath) {\n      debug('no cache file path, will not write cache to file');\n      return;\n    }\n\n    // Clean unused caches if requested\n    if (options?.cleanUnused) {\n      // Skip cleaning in write-only mode or when cache is not used\n      if (this.isCacheResultUsed) {\n        const originalLength = this.cache.caches.length;\n\n        // Collect indices of used caches\n        const usedIndices = new Set<number>();\n        for (const key of this.matchedCacheIndices) {\n          // key format: \"type:prompt:index\"\n          const parts = key.split(':');\n          const index = Number.parseInt(parts[parts.length - 1], 10);\n          if (!Number.isNaN(index)) {\n            usedIndices.add(index);\n          }\n        }\n\n        // Filter: keep used caches and newly added caches\n        this.cache.caches = this.cache.caches.filter((_, index) => {\n          const isUsed = usedIndices.has(index);\n          const isNew = index >= this.cacheOriginalLength;\n          return isUsed || isNew;\n        });\n\n        const removedCount = originalLength - this.cache.caches.length;\n        if (removedCount > 0) {\n          debug('cleaned %d unused cache record(s)', removedCount);\n        } else {\n          debug('no unused cache to clean');\n        }\n      } else {\n        debug('skip cleaning: cache is not used for reading');\n      }\n    }\n\n    try {\n      const dir = dirname(this.cacheFilePath);\n      if (!existsSync(dir)) {\n        mkdirSync(dir, { recursive: true });\n        debug('created cache directory: %s', dir);\n      }\n\n      // Sort caches to ensure plan entries come before locate entries for better readability\n      // Create a sorted copy for writing to disk while keeping in-memory order unchanged\n      const sortedCaches = [...this.cache.caches].sort((a, b) => {\n        if (a.type === 'plan' && b.type === 'locate') return -1;\n        if (a.type === 'locate' && b.type === 'plan') return 1;\n        return 0;\n      });\n\n      const cacheToWrite = {\n        ...this.cache,\n        caches: sortedCaches,\n      };\n\n      const yamlData = yaml.dump(cacheToWrite);\n      writeFileSync(this.cacheFilePath, yamlData);\n      debug('cache flushed to file: %s', this.cacheFilePath);\n    } catch (err) {\n      debug(\n        'write cache to file failed, path: %s, error: %s',\n        this.cacheFilePath,\n        err,\n      );\n    }\n  }\n\n  updateOrAppendCacheRecord(\n    newRecord: PlanningCache | LocateCache,\n    cachedRecord?: MatchCacheResult<PlanningCache | LocateCache>,\n  ) {\n    if (cachedRecord) {\n      // update existing record\n      if (newRecord.type === 'plan') {\n        cachedRecord.updateFn((cache) => {\n          (cache as PlanningCache).yamlWorkflow = newRecord.yamlWorkflow;\n        });\n      } else {\n        cachedRecord.updateFn((cache) => {\n          const locateCache = cache as LocateCache;\n          locateCache.cache = newRecord.cache;\n          if ('xpaths' in locateCache) {\n            locateCache.xpaths = undefined;\n          }\n        });\n      }\n    } else {\n      this.appendCache(newRecord);\n    }\n  }\n}\n","import { findAllMidsceneLocatorField, parseActionParam } from '@/ai-model';\nimport type { AbstractInterface } from '@/device';\nimport type Service from '@/service';\nimport type {\n  DetailedLocateParam,\n  DeviceAction,\n  ElementCacheFeature,\n  ExecutionTaskActionApply,\n  ExecutionTaskApply,\n  ExecutionTaskHitBy,\n  ExecutionTaskPlanningLocateApply,\n  LocateResultElement,\n  LocateResultWithDump,\n  PlanningAction,\n  PlanningActionParamSleep,\n  PlanningLocateParam,\n  Rect,\n  ServiceDump,\n} from '@/types';\nimport { ServiceError } from '@/types';\nimport { sleep } from '@/utils';\nimport type { IModelConfig } from '@midscene/shared/env';\nimport { generateElementByPosition } from '@midscene/shared/extractor';\nimport { getDebug } from '@midscene/shared/logger';\nimport { assert } from '@midscene/shared/utils';\nimport type { TaskCache } from './task-cache';\nimport {\n  ifPlanLocateParamIsBbox,\n  matchElementFromCache,\n  matchElementFromPlan,\n} from './utils';\n\nconst debug = getDebug('agent:task-builder');\n\n/**\n * Check if a cache object is non-empty\n */\nfunction hasNonEmptyCache(cache: unknown): boolean {\n  return (\n    cache !== null &&\n    cache !== undefined &&\n    typeof cache === 'object' &&\n    Object.keys(cache).length > 0\n  );\n}\n\nexport function locatePlanForLocate(param: string | DetailedLocateParam) {\n  const locate = typeof param === 'string' ? { prompt: param } : param;\n  const locatePlan: PlanningAction<PlanningLocateParam> = {\n    type: 'Locate',\n    param: locate,\n    thought: '',\n  };\n  return locatePlan;\n}\n\ninterface TaskBuilderDeps {\n  interfaceInstance: AbstractInterface;\n  service: Service;\n  taskCache?: TaskCache;\n  actionSpace: DeviceAction[];\n}\n\ninterface BuildOptions {\n  cacheable?: boolean;\n  subTask?: boolean;\n}\n\ninterface PlanBuildContext {\n  tasks: ExecutionTaskApply[];\n  modelConfigForPlanning: IModelConfig;\n  modelConfigForDefaultIntent: IModelConfig;\n  cacheable?: boolean;\n  subTask: boolean;\n}\n\nexport class TaskBuilder {\n  private readonly interface: AbstractInterface;\n\n  private readonly service: Service;\n\n  private readonly taskCache?: TaskCache;\n\n  private readonly actionSpace: DeviceAction[];\n\n  constructor({\n    interfaceInstance,\n    service,\n    taskCache,\n    actionSpace,\n  }: TaskBuilderDeps) {\n    this.interface = interfaceInstance;\n    this.service = service;\n    this.taskCache = taskCache;\n    this.actionSpace = actionSpace;\n  }\n\n  public async build(\n    plans: PlanningAction[],\n    modelConfigForPlanning: IModelConfig,\n    modelConfigForDefaultIntent: IModelConfig,\n    options?: BuildOptions,\n  ): Promise<{ tasks: ExecutionTaskApply[] }> {\n    const tasks: ExecutionTaskApply[] = [];\n    const cacheable = options?.cacheable;\n\n    const context: PlanBuildContext = {\n      tasks,\n      modelConfigForPlanning,\n      modelConfigForDefaultIntent,\n      cacheable,\n      subTask: !!options?.subTask,\n    };\n\n    type PlanHandler = (plan: PlanningAction) => Promise<void> | void;\n\n    const planHandlers = new Map<string, PlanHandler>([\n      [\n        'Locate',\n        (plan) =>\n          this.handleLocatePlan(\n            plan as PlanningAction<PlanningLocateParam>,\n            context,\n          ),\n      ],\n      ['Finished', (plan) => this.handleFinishedPlan(plan, context)],\n      [\n        'Sleep',\n        (plan) =>\n          this.handleSleepPlan(\n            plan as PlanningAction<PlanningActionParamSleep>,\n            context,\n          ),\n      ],\n    ]);\n\n    const defaultHandler: PlanHandler = (plan) =>\n      this.handleActionPlan(plan, context);\n\n    for (const plan of plans) {\n      const handler = planHandlers.get(plan.type) ?? defaultHandler;\n      await handler(plan);\n    }\n\n    return {\n      tasks,\n    };\n  }\n\n  private handleFinishedPlan(\n    plan: PlanningAction,\n    context: PlanBuildContext,\n  ): void {\n    const taskActionFinished: ExecutionTaskActionApply<null> = {\n      type: 'Action Space',\n      subType: 'Finished',\n      param: null,\n      thought: plan.thought,\n      subTask: context.subTask || undefined,\n      executor: async () => {},\n    };\n    context.tasks.push(taskActionFinished);\n  }\n\n  private handleSleepPlan(\n    plan: PlanningAction<PlanningActionParamSleep>,\n    context: PlanBuildContext,\n  ): void {\n    const sleepTask = this.createSleepTask(plan.param, {\n      thought: plan.thought,\n    });\n    if (context.subTask) {\n      sleepTask.subTask = true;\n    }\n    context.tasks.push(sleepTask);\n  }\n\n  public createSleepTask(\n    param: PlanningActionParamSleep,\n    meta?: { thought?: string },\n  ): ExecutionTaskActionApply<PlanningActionParamSleep> {\n    return {\n      type: 'Action Space',\n      subType: 'Sleep',\n      param,\n      thought: meta?.thought,\n      executor: async (taskParam) => {\n        await sleep(taskParam?.timeMs || 3000);\n      },\n    };\n  }\n\n  private async handleLocatePlan(\n    plan: PlanningAction<PlanningLocateParam>,\n    context: PlanBuildContext,\n  ): Promise<void> {\n    const taskLocate = this.createLocateTask(plan, plan.param, context);\n    context.tasks.push(taskLocate);\n  }\n\n  private async handleActionPlan(\n    plan: PlanningAction,\n    context: PlanBuildContext,\n  ): Promise<void> {\n    const planType = plan.type;\n    const actionSpace = this.actionSpace;\n    const action = actionSpace.find((item) => item.name === planType);\n    const param = plan.param;\n\n    if (!action) {\n      throw new Error(`Action type '${planType}' not found`);\n    }\n\n    const locateFields = action\n      ? findAllMidsceneLocatorField(action.paramSchema)\n      : [];\n\n    const requiredLocateFields = action\n      ? findAllMidsceneLocatorField(action.paramSchema, true)\n      : [];\n\n    locateFields.forEach((field) => {\n      if (param[field]) {\n        // Always use createLocateTask for all locate params (including bbox)\n        // This ensures cache writing happens even when bbox is available\n        const locatePlan = locatePlanForLocate(param[field]);\n        debug(\n          'will prepend locate param for field',\n          `action.type=${planType}`,\n          `param=${JSON.stringify(param[field])}`,\n          `locatePlan=${JSON.stringify(locatePlan)}`,\n          `hasBbox=${ifPlanLocateParamIsBbox(param[field])}`,\n        );\n        const locateTask = this.createLocateTask(\n          locatePlan,\n          param[field],\n          context,\n          (result) => {\n            param[field] = result;\n          },\n        );\n        context.tasks.push(locateTask);\n      } else {\n        assert(\n          !requiredLocateFields.includes(field),\n          `Required locate field '${field}' is not provided for action ${planType}`,\n        );\n        debug(`field '${field}' is not provided for action ${planType}`);\n      }\n    });\n\n    const task: ExecutionTaskApply<\n      'Action Space',\n      any,\n      { success: boolean; action: string; param: any },\n      void\n    > = {\n      type: 'Action Space',\n      subType: planType,\n      thought: plan.thought,\n      param: plan.param,\n      subTask: context.subTask || undefined,\n      executor: async (param, taskContext) => {\n        debug(\n          'executing action',\n          planType,\n          param,\n          `taskContext.element.center: ${taskContext.element?.center}`,\n        );\n\n        const uiContext = taskContext.uiContext;\n        assert(uiContext, 'uiContext is required for Action task');\n\n        requiredLocateFields.forEach((field) => {\n          assert(\n            param[field],\n            `field '${field}' is required for action ${planType} but not provided. Cannot execute action ${planType}.`,\n          );\n        });\n\n        try {\n          await Promise.all([\n            (async () => {\n              if (this.interface.beforeInvokeAction) {\n                debug('will call \"beforeInvokeAction\" for interface');\n                await this.interface.beforeInvokeAction(action.name, param);\n                debug('called \"beforeInvokeAction\" for interface');\n              }\n            })(),\n            sleep(200),\n          ]);\n        } catch (originalError: any) {\n          const originalMessage =\n            originalError?.message || String(originalError);\n          throw new Error(\n            `error in running beforeInvokeAction for ${action.name}: ${originalMessage}`,\n            { cause: originalError },\n          );\n        }\n\n        if (action.paramSchema) {\n          try {\n            param = parseActionParam(param, action.paramSchema);\n          } catch (error: any) {\n            throw new Error(\n              `Invalid parameters for action ${action.name}: ${error.message}\\nParameters: ${JSON.stringify(param)}`,\n              { cause: error },\n            );\n          }\n        }\n\n        debug('calling action', action.name);\n        const actionFn = action.call.bind(this.interface);\n        const actionResult = await actionFn(param, taskContext);\n        debug('called action', action.name, 'result:', actionResult);\n\n        const delayAfterRunner = action.delayAfterRunner ?? 300;\n        if (delayAfterRunner > 0) {\n          await sleep(delayAfterRunner);\n        }\n\n        try {\n          if (this.interface.afterInvokeAction) {\n            debug('will call \"afterInvokeAction\" for interface');\n            await this.interface.afterInvokeAction(action.name, param);\n            debug('called \"afterInvokeAction\" for interface');\n          }\n        } catch (originalError: any) {\n          const originalMessage =\n            originalError?.message || String(originalError);\n          throw new Error(\n            `error in running afterInvokeAction for ${action.name}: ${originalMessage}`,\n            { cause: originalError },\n          );\n        }\n\n        return {\n          output: actionResult,\n        };\n      },\n    };\n\n    context.tasks.push(task);\n  }\n\n  private createLocateTask(\n    plan: PlanningAction<PlanningLocateParam>,\n    detailedLocateParam: DetailedLocateParam | string,\n    context: PlanBuildContext,\n    onResult?: (result: LocateResultElement) => void,\n  ): ExecutionTaskPlanningLocateApply {\n    const { cacheable, modelConfigForDefaultIntent } = context;\n\n    let locateParam = detailedLocateParam;\n\n    if (typeof locateParam === 'string') {\n      locateParam = {\n        prompt: locateParam,\n      };\n    }\n\n    if (cacheable !== undefined) {\n      locateParam = {\n        ...locateParam,\n        cacheable,\n      };\n    }\n\n    const taskLocator: ExecutionTaskPlanningLocateApply = {\n      type: 'Planning',\n      subType: 'Locate',\n      subTask: context.subTask || undefined,\n      param: locateParam,\n      thought: plan.thought,\n      executor: async (param, taskContext) => {\n        const { task } = taskContext;\n        let { uiContext } = taskContext;\n\n        assert(\n          param?.prompt || param?.bbox,\n          `No prompt or id or position or bbox to locate, param=${JSON.stringify(\n            param,\n          )}`,\n        );\n\n        if (!uiContext) {\n          uiContext = await this.service.contextRetrieverFn();\n        }\n\n        assert(uiContext, 'uiContext is required for Service task');\n\n        let locateDump: ServiceDump | undefined;\n        let locateResult: LocateResultWithDump | undefined;\n\n        const applyDump = (dump?: ServiceDump) => {\n          if (!dump) {\n            return;\n          }\n          locateDump = dump;\n          task.log = {\n            dump,\n          };\n          task.usage = dump.taskInfo?.usage;\n          if (dump.taskInfo?.searchAreaUsage) {\n            task.searchAreaUsage = dump.taskInfo.searchAreaUsage;\n          }\n        };\n\n        // from bbox (plan hit)\n        const elementFromBbox = ifPlanLocateParamIsBbox(param)\n          ? matchElementFromPlan(param)\n          : undefined;\n        const isPlanHit = !!elementFromBbox;\n\n        // from xpath\n        let rectFromXpath: Rect | undefined;\n        if (\n          !isPlanHit &&\n          param.xpath &&\n          this.interface.rectMatchesCacheFeature\n        ) {\n          try {\n            rectFromXpath = await this.interface.rectMatchesCacheFeature({\n              xpaths: [param.xpath],\n            });\n          } catch {\n            // xpath locate failed, allow fallback to cache or AI locate\n          }\n        }\n        const elementFromXpath = rectFromXpath\n          ? generateElementByPosition(\n              {\n                x: rectFromXpath.left + rectFromXpath.width / 2,\n                y: rectFromXpath.top + rectFromXpath.height / 2,\n              },\n              typeof param.prompt === 'string'\n                ? param.prompt\n                : param.prompt?.prompt || '',\n            )\n          : undefined;\n        const isXpathHit = !!elementFromXpath;\n\n        const cachePrompt = param.prompt;\n        const locateCacheRecord = this.taskCache?.matchLocateCache(cachePrompt);\n        const cacheEntry = locateCacheRecord?.cacheContent?.cache;\n\n        const elementFromCache =\n          isPlanHit || isXpathHit\n            ? null\n            : await matchElementFromCache(\n                {\n                  taskCache: this.taskCache,\n                  interfaceInstance: this.interface,\n                },\n                cacheEntry,\n                cachePrompt,\n                param.cacheable,\n              );\n        const isCacheHit = !!elementFromCache;\n\n        let elementFromAiLocate: LocateResultElement | null | undefined;\n        if (!isXpathHit && !isCacheHit && !isPlanHit) {\n          try {\n            locateResult = await this.service.locate(\n              param,\n              {\n                context: uiContext,\n              },\n              modelConfigForDefaultIntent,\n            );\n            applyDump(locateResult.dump);\n            elementFromAiLocate = locateResult.element;\n          } catch (error) {\n            if (error instanceof ServiceError) {\n              applyDump(error.dump);\n            }\n            throw error;\n          }\n        }\n\n        const element =\n          elementFromBbox ||\n          elementFromXpath ||\n          elementFromCache ||\n          elementFromAiLocate;\n\n        // Check if locate cache already exists (for planHitFlag case)\n        const locateCacheAlreadyExists = hasNonEmptyCache(\n          locateCacheRecord?.cacheContent?.cache,\n        );\n\n        let currentCacheEntry: ElementCacheFeature | undefined;\n        // Write cache if:\n        // 1. element found\n        // 2. taskCache enabled\n        // 3. not a cache hit (otherwise we'd be writing what we just read)\n        // 4. not already cached (for bbox/plan hit case, avoid redundant writes)\n        // 5. cacheable is not explicitly false\n        if (\n          element &&\n          this.taskCache &&\n          !isCacheHit &&\n          !locateCacheAlreadyExists &&\n          param?.cacheable !== false\n        ) {\n          if (this.interface.cacheFeatureForRect) {\n            try {\n              const feature = await this.interface.cacheFeatureForRect(\n                element.rect,\n                {\n                  targetDescription:\n                    typeof param.prompt === 'string'\n                      ? param.prompt\n                      : param.prompt?.prompt,\n                  modelConfig: modelConfigForDefaultIntent,\n                },\n              );\n              if (hasNonEmptyCache(feature)) {\n                debug(\n                  'update cache, prompt: %s, cache: %o',\n                  cachePrompt,\n                  feature,\n                );\n                currentCacheEntry = feature;\n                this.taskCache.updateOrAppendCacheRecord(\n                  {\n                    type: 'locate',\n                    prompt: cachePrompt,\n                    cache: feature,\n                  },\n                  locateCacheRecord,\n                );\n              } else {\n                debug(\n                  'no cache data returned, skip cache update, prompt: %s',\n                  cachePrompt,\n                );\n              }\n            } catch (error) {\n              debug('cacheFeatureForRect failed: %s', error);\n            }\n          } else {\n            debug('cacheFeatureForRect is not supported, skip cache update');\n          }\n        }\n\n        if (!element) {\n          if (locateDump) {\n            throw new ServiceError(\n              `Element not found : ${param.prompt}`,\n              locateDump,\n            );\n          }\n          throw new Error(`Element not found: ${param.prompt}`);\n        }\n\n        let hitBy: ExecutionTaskHitBy | undefined;\n\n        if (isPlanHit) {\n          hitBy = {\n            from: 'Plan',\n            context: {\n              bbox: param.bbox,\n            },\n          };\n        } else if (isXpathHit) {\n          hitBy = {\n            from: 'User expected path',\n            context: {\n              xpath: param.xpath,\n            },\n          };\n        } else if (isCacheHit) {\n          hitBy = {\n            from: 'Cache',\n            context: {\n              cacheEntry,\n              cacheToSave: currentCacheEntry,\n            },\n          };\n        }\n\n        onResult?.(element);\n\n        return {\n          output: {\n            element,\n          },\n          hitBy,\n        };\n      },\n    };\n\n    return taskLocator;\n  }\n}\n","import { ConversationHistory, plan, uiTarsPlanning } from '@/ai-model';\nimport type { TMultimodalPrompt, TUserPrompt } from '@/common';\nimport type { AbstractInterface } from '@/device';\nimport type Service from '@/service';\nimport type { TaskRunner } from '@/task-runner';\nimport { TaskExecutionError } from '@/task-runner';\nimport type {\n  DeviceAction,\n  ExecutionTaskApply,\n  ExecutionTaskInsightQueryApply,\n  ExecutionTaskPlanningApply,\n  ExecutionTaskProgressOptions,\n  InterfaceType,\n  MidsceneYamlFlowItem,\n  PlanningAIResponse,\n  PlanningAction,\n  PlanningActionParamSleep,\n  PlanningActionParamWaitFor,\n  ServiceDump,\n  ServiceExtractOption,\n  ServiceExtractParam,\n} from '@/types';\nimport { ServiceError } from '@/types';\nimport type { IModelConfig } from '@midscene/shared/env';\nimport { getDebug } from '@midscene/shared/logger';\nimport { assert } from '@midscene/shared/utils';\nimport { ExecutionSession } from './execution-session';\nimport { TaskBuilder } from './task-builder';\nimport type { TaskCache } from './task-cache';\nexport { locatePlanForLocate } from './task-builder';\nimport { descriptionOfTree } from '@midscene/shared/extractor';\nimport { taskTitleStr } from './ui-utils';\nimport { parsePrompt } from './utils';\n\ninterface ExecutionResult<OutputType = any> {\n  output: OutputType;\n  thought?: string;\n  runner: TaskRunner;\n}\n\ninterface TaskExecutorHooks {\n  onTaskUpdate?: (\n    runner: TaskRunner,\n    error?: TaskExecutionError,\n  ) => Promise<void> | void;\n}\n\nconst debug = getDebug('device-task-executor');\nconst maxErrorCountAllowedInOnePlanningLoop = 5;\n\nexport { TaskExecutionError };\n\nexport class TaskExecutor {\n  interface: AbstractInterface;\n\n  service: Service;\n\n  taskCache?: TaskCache;\n\n  private readonly providedActionSpace: DeviceAction[];\n\n  private readonly taskBuilder: TaskBuilder;\n\n  private conversationHistory: ConversationHistory;\n\n  onTaskStartCallback?: ExecutionTaskProgressOptions['onTaskStart'];\n\n  private readonly hooks?: TaskExecutorHooks;\n\n  replanningCycleLimit?: number;\n\n  // @deprecated use .interface instead\n  get page() {\n    return this.interface;\n  }\n\n  constructor(\n    interfaceInstance: AbstractInterface,\n    service: Service,\n    opts: {\n      taskCache?: TaskCache;\n      onTaskStart?: ExecutionTaskProgressOptions['onTaskStart'];\n      replanningCycleLimit?: number;\n      hooks?: TaskExecutorHooks;\n      actionSpace: DeviceAction[];\n    },\n  ) {\n    this.interface = interfaceInstance;\n    this.service = service;\n    this.taskCache = opts.taskCache;\n    this.onTaskStartCallback = opts?.onTaskStart;\n    this.replanningCycleLimit = opts.replanningCycleLimit;\n    this.hooks = opts.hooks;\n    this.conversationHistory = new ConversationHistory();\n    this.providedActionSpace = opts.actionSpace;\n    this.taskBuilder = new TaskBuilder({\n      interfaceInstance,\n      service,\n      taskCache: opts.taskCache,\n      actionSpace: this.getActionSpace(),\n    });\n  }\n\n  private createExecutionSession(\n    title: string,\n    options?: { tasks?: ExecutionTaskApply[] },\n  ) {\n    return new ExecutionSession(\n      title,\n      () => Promise.resolve(this.service.contextRetrieverFn()),\n      {\n        onTaskStart: this.onTaskStartCallback,\n        tasks: options?.tasks,\n        onTaskUpdate: this.hooks?.onTaskUpdate,\n      },\n    );\n  }\n\n  private getActionSpace(): DeviceAction[] {\n    return this.providedActionSpace;\n  }\n\n  public async convertPlanToExecutable(\n    plans: PlanningAction[],\n    modelConfigForPlanning: IModelConfig,\n    modelConfigForDefaultIntent: IModelConfig,\n    options?: {\n      cacheable?: boolean;\n      subTask?: boolean;\n    },\n  ) {\n    return this.taskBuilder.build(\n      plans,\n      modelConfigForPlanning,\n      modelConfigForDefaultIntent,\n      options,\n    );\n  }\n\n  async loadYamlFlowAsPlanning(userInstruction: string, yamlString: string) {\n    const session = this.createExecutionSession(\n      taskTitleStr('Action', userInstruction),\n    );\n\n    const task: ExecutionTaskPlanningApply = {\n      type: 'Planning',\n      subType: 'LoadYaml',\n      param: {\n        userInstruction,\n      },\n      executor: async (param, executorContext) => {\n        const { uiContext } = executorContext;\n        assert(uiContext, 'uiContext is required for Planning task');\n        return {\n          output: {\n            actions: [],\n            more_actions_needed_by_instruction: false,\n            log: '',\n            yamlString,\n          },\n          cache: {\n            hit: true,\n          },\n          hitBy: {\n            from: 'Cache',\n            context: {\n              yamlString,\n            },\n          },\n        };\n      },\n    };\n    const runner = session.getRunner();\n    await session.appendAndRun(task);\n\n    return {\n      runner,\n    };\n  }\n\n  async runPlans(\n    title: string,\n    plans: PlanningAction[],\n    modelConfigForPlanning: IModelConfig,\n    modelConfigForDefaultIntent: IModelConfig,\n  ): Promise<ExecutionResult> {\n    const session = this.createExecutionSession(title);\n    const { tasks } = await this.convertPlanToExecutable(\n      plans,\n      modelConfigForPlanning,\n      modelConfigForDefaultIntent,\n    );\n    const runner = session.getRunner();\n    const result = await session.appendAndRun(tasks);\n    const { output } = result ?? {};\n    return {\n      output,\n      runner,\n    };\n  }\n\n  async action(\n    userPrompt: string,\n    modelConfigForPlanning: IModelConfig,\n    modelConfigForDefaultIntent: IModelConfig,\n    includeBboxInPlanning: boolean,\n    aiActContext?: string,\n    cacheable?: boolean,\n    replanningCycleLimitOverride?: number,\n    imagesIncludeCount?: number,\n  ): Promise<\n    ExecutionResult<\n      | {\n          yamlFlow?: MidsceneYamlFlowItem[]; // for cache use\n        }\n      | undefined\n    >\n  > {\n    this.conversationHistory.reset();\n\n    const session = this.createExecutionSession(\n      taskTitleStr('Action', userPrompt),\n    );\n    const runner = session.getRunner();\n\n    let replanCount = 0;\n    const yamlFlow: MidsceneYamlFlowItem[] = [];\n    const replanningCycleLimit =\n      replanningCycleLimitOverride ?? this.replanningCycleLimit;\n    assert(\n      replanningCycleLimit !== undefined,\n      'replanningCycleLimit is required for TaskExecutor.action',\n    );\n\n    let errorCountInOnePlanningLoop = 0; // count the number of errors in one planning loop\n\n    // Main planning loop - unified plan/replan logic\n    while (true) {\n      const result = await session.appendAndRun(\n        {\n          type: 'Planning',\n          subType: 'Plan',\n          param: {\n            userInstruction: userPrompt,\n            aiActContext,\n            imagesIncludeCount,\n          },\n          executor: async (param, executorContext) => {\n            const startTime = Date.now();\n            const { uiContext } = executorContext;\n            assert(uiContext, 'uiContext is required for Planning task');\n            const { vlMode } = modelConfigForPlanning;\n            const uiTarsModelVersion =\n              vlMode === 'vlm-ui-tars'\n                ? modelConfigForPlanning.uiTarsModelVersion\n                : undefined;\n\n            const actionSpace = this.getActionSpace();\n            debug(\n              'actionSpace for this interface is:',\n              actionSpace.map((action) => action.name).join(', '),\n            );\n            assert(Array.isArray(actionSpace), 'actionSpace must be an array');\n            if (actionSpace.length === 0) {\n              console.warn(\n                `ActionSpace for ${this.interface.interfaceType} is empty. This may lead to unexpected behavior.`,\n              );\n            }\n\n            const planResult = await (uiTarsModelVersion\n              ? uiTarsPlanning\n              : plan)(param.userInstruction, {\n              context: uiContext,\n              actionContext: param.aiActContext,\n              interfaceType: this.interface.interfaceType as InterfaceType,\n              actionSpace,\n              modelConfig: modelConfigForPlanning,\n              conversationHistory: this.conversationHistory,\n              includeBbox: includeBboxInPlanning,\n              imagesIncludeCount,\n            });\n            debug('planResult', JSON.stringify(planResult, null, 2));\n\n            const {\n              actions,\n              log,\n              more_actions_needed_by_instruction,\n              error,\n              usage,\n              rawResponse,\n              sleep,\n            } = planResult;\n\n            executorContext.task.log = {\n              ...(executorContext.task.log || {}),\n              rawResponse,\n            };\n            executorContext.task.usage = usage;\n            executorContext.task.output = {\n              actions: actions || [],\n              more_actions_needed_by_instruction,\n              log,\n              yamlFlow: planResult.yamlFlow,\n            };\n            executorContext.uiContext = uiContext;\n\n            const finalActions = [...(actions || [])];\n\n            if (sleep) {\n              const timeNow = Date.now();\n              const timeRemaining = sleep - (timeNow - startTime);\n              if (timeRemaining > 0) {\n                finalActions.push(this.sleepPlan(timeRemaining));\n              }\n            }\n\n            assert(!error, `Failed to continue: ${error}\\n${log || ''}`);\n\n            return {\n              cache: {\n                hit: false,\n              },\n            } as any;\n          },\n        },\n        {\n          allowWhenError: true,\n        },\n      );\n\n      const planResult = result?.output as PlanningAIResponse | undefined;\n\n      // Execute planned actions\n      const plans = planResult?.actions || [];\n      yamlFlow.push(...(planResult?.yamlFlow || []));\n\n      let executables: Awaited<ReturnType<typeof this.convertPlanToExecutable>>;\n      try {\n        executables = await this.convertPlanToExecutable(\n          plans,\n          modelConfigForPlanning,\n          modelConfigForDefaultIntent,\n          {\n            cacheable,\n            subTask: true,\n          },\n        );\n      } catch (error) {\n        return session.appendErrorPlan(\n          `Error converting plans to executable tasks: ${error}, plans: ${JSON.stringify(\n            plans,\n          )}`,\n        );\n      }\n      if (this.conversationHistory.pendingFeedbackMessage) {\n        console.warn(\n          'unconsumed pending feedback message detected, this may lead to unexpected planning result:',\n          this.conversationHistory.pendingFeedbackMessage,\n        );\n      }\n      let errorFlag = false;\n      try {\n        await session.appendAndRun(executables.tasks);\n      } catch (error: any) {\n        errorFlag = true;\n        errorCountInOnePlanningLoop++;\n        this.conversationHistory.pendingFeedbackMessage = `Error executing running tasks: ${error?.message || String(error)}`;\n        debug(\n          'error when executing running tasks, but continue to run if it is not too many errors:',\n          error instanceof Error ? error.message : String(error),\n          'current error count in one planning loop:',\n          errorCountInOnePlanningLoop,\n        );\n      }\n\n      if (errorCountInOnePlanningLoop > maxErrorCountAllowedInOnePlanningLoop) {\n        return session.appendErrorPlan('Too many errors in one planning loop');\n      }\n\n      // Check if task is complete\n      if (!planResult?.more_actions_needed_by_instruction) {\n        if (errorFlag) {\n          debug(\n            'more_actions_needed_by_instruction is false, but there are errors in one planning loop, continue to run',\n          );\n        } else {\n          break;\n        }\n      }\n\n      // Increment replan count for next iteration\n      ++replanCount;\n\n      if (replanCount > replanningCycleLimit) {\n        const errorMsg = `Replanned ${replanningCycleLimit} times, exceeding the limit. Please configure a larger value for replanningCycleLimit (or use MIDSCENE_REPLANNING_CYCLE_LIMIT) to handle more complex tasks.`;\n        return session.appendErrorPlan(errorMsg);\n      }\n\n      if (!this.conversationHistory.pendingFeedbackMessage) {\n        this.conversationHistory.pendingFeedbackMessage =\n          'I have finished the action previously planned.';\n      }\n    }\n\n    const finalResult = {\n      output: {\n        yamlFlow,\n      },\n      runner,\n    };\n    return finalResult;\n  }\n\n  private createTypeQueryTask(\n    type: 'Query' | 'Boolean' | 'Number' | 'String' | 'Assert' | 'WaitFor',\n    demand: ServiceExtractParam,\n    modelConfig: IModelConfig,\n    opt?: ServiceExtractOption,\n    multimodalPrompt?: TMultimodalPrompt,\n  ) {\n    const queryTask: ExecutionTaskInsightQueryApply = {\n      type: 'Insight',\n      subType: type,\n      param: {\n        dataDemand: multimodalPrompt\n          ? ({\n              demand,\n              multimodalPrompt,\n            } as never)\n          : demand, // for user param presentation in report right sidebar\n      },\n      executor: async (param, taskContext) => {\n        const { task } = taskContext;\n        let queryDump: ServiceDump | undefined;\n        const applyDump = (dump: ServiceDump) => {\n          queryDump = dump;\n          task.log = {\n            dump,\n          };\n        };\n\n        // Get context for query operations\n        const uiContext = taskContext.uiContext;\n        assert(uiContext, 'uiContext is required for Query task');\n\n        const ifTypeRestricted = type !== 'Query';\n        let demandInput = demand;\n        let keyOfResult = 'result';\n        if (ifTypeRestricted && (type === 'Assert' || type === 'WaitFor')) {\n          keyOfResult = 'StatementIsTruthy';\n          const booleanPrompt =\n            type === 'Assert'\n              ? `Boolean, whether the following statement is true: ${demand}`\n              : `Boolean, the user wants to do some 'wait for' operation, please check whether the following statement is true: ${demand}`;\n          demandInput = {\n            [keyOfResult]: booleanPrompt,\n          };\n        } else if (ifTypeRestricted) {\n          demandInput = {\n            [keyOfResult]: `${type}, ${demand}`,\n          };\n        }\n\n        let extractResult;\n\n        let extraPageDescription = '';\n        if (opt?.domIncluded && this.interface.getElementsNodeTree) {\n          debug('appending tree info for page');\n          const tree = await this.interface.getElementsNodeTree();\n          extraPageDescription = await descriptionOfTree(\n            tree,\n            200,\n            false,\n            opt?.domIncluded === 'visible-only',\n          );\n        }\n\n        try {\n          extractResult = await this.service.extract<any>(\n            demandInput,\n            modelConfig,\n            opt,\n            extraPageDescription,\n            multimodalPrompt,\n          );\n        } catch (error) {\n          if (error instanceof ServiceError) {\n            applyDump(error.dump);\n          }\n          throw error;\n        }\n\n        const { data, usage, thought, dump } = extractResult;\n        applyDump(dump);\n\n        let outputResult = data;\n        if (ifTypeRestricted) {\n          // If AI returned a plain string instead of structured format, use it directly\n          if (typeof data === 'string') {\n            outputResult = data;\n          } else if (type === 'WaitFor') {\n            if (data === null || data === undefined) {\n              outputResult = false;\n            } else {\n              outputResult = (data as any)[keyOfResult];\n            }\n          } else if (data === null || data === undefined) {\n            outputResult = null;\n          } else {\n            assert(\n              data?.[keyOfResult] !== undefined,\n              'No result in query data',\n            );\n            outputResult = (data as any)[keyOfResult];\n          }\n        }\n\n        if (type === 'Assert' && !outputResult) {\n          task.usage = usage;\n          task.thought = thought;\n          throw new Error(`Assertion failed: ${thought}`);\n        }\n\n        return {\n          output: outputResult,\n          log: queryDump,\n          usage,\n          thought,\n        };\n      },\n    };\n\n    return queryTask;\n  }\n  async createTypeQueryExecution<T>(\n    type: 'Query' | 'Boolean' | 'Number' | 'String' | 'Assert',\n    demand: ServiceExtractParam,\n    modelConfig: IModelConfig,\n    opt?: ServiceExtractOption,\n    multimodalPrompt?: TMultimodalPrompt,\n  ): Promise<ExecutionResult<T>> {\n    const session = this.createExecutionSession(\n      taskTitleStr(\n        type,\n        typeof demand === 'string' ? demand : JSON.stringify(demand),\n      ),\n    );\n\n    const queryTask = await this.createTypeQueryTask(\n      type,\n      demand,\n      modelConfig,\n      opt,\n      multimodalPrompt,\n    );\n\n    const runner = session.getRunner();\n    const result = await session.appendAndRun(queryTask);\n\n    if (!result) {\n      throw new Error(\n        'result of taskExecutor.flush() is undefined in function createTypeQueryTask',\n      );\n    }\n\n    const { output, thought } = result;\n\n    return {\n      output,\n      thought,\n      runner,\n    };\n  }\n\n  private sleepPlan(timeMs: number): PlanningAction<PlanningActionParamSleep> {\n    return {\n      type: 'Sleep',\n      param: {\n        timeMs,\n      },\n    };\n  }\n\n  async taskForSleep(timeMs: number, _modelConfig: IModelConfig) {\n    return this.taskBuilder.createSleepTask({\n      timeMs,\n    });\n  }\n\n  async waitFor(\n    assertion: TUserPrompt,\n    opt: PlanningActionParamWaitFor,\n    modelConfig: IModelConfig,\n  ): Promise<ExecutionResult<void>> {\n    const { textPrompt, multimodalPrompt } = parsePrompt(assertion);\n\n    const description = `waitFor: ${textPrompt}`;\n    const session = this.createExecutionSession(\n      taskTitleStr('WaitFor', description),\n    );\n    const runner = session.getRunner();\n    const { timeoutMs, checkIntervalMs } = opt;\n\n    assert(assertion, 'No assertion for waitFor');\n    assert(timeoutMs, 'No timeoutMs for waitFor');\n    assert(checkIntervalMs, 'No checkIntervalMs for waitFor');\n\n    assert(\n      checkIntervalMs <= timeoutMs,\n      `wrong config for waitFor: checkIntervalMs must be less than timeoutMs, config: {checkIntervalMs: ${checkIntervalMs}, timeoutMs: ${timeoutMs}}`,\n    );\n\n    const overallStartTime = Date.now();\n    let lastCheckStart = overallStartTime;\n    let errorThought = '';\n    // Continue checking as long as the previous iteration began within the timeout window.\n    while (lastCheckStart - overallStartTime <= timeoutMs) {\n      const currentCheckStart = Date.now();\n      lastCheckStart = currentCheckStart;\n      const queryTask = await this.createTypeQueryTask(\n        'WaitFor',\n        textPrompt,\n        modelConfig,\n        undefined,\n        multimodalPrompt,\n      );\n\n      const result = (await session.appendAndRun(queryTask)) as\n        | {\n            output: boolean;\n            thought?: string;\n          }\n        | undefined;\n\n      if (result?.output) {\n        return {\n          output: undefined,\n          runner,\n        };\n      }\n\n      errorThought =\n        result?.thought ||\n        (!result && `No result from assertion: ${textPrompt}`) ||\n        `unknown error when waiting for assertion: ${textPrompt}`;\n      const now = Date.now();\n      if (now - currentCheckStart < checkIntervalMs) {\n        const timeRemaining = checkIntervalMs - (now - currentCheckStart);\n        const sleepTask = this.taskBuilder.createSleepTask({\n          timeMs: timeRemaining,\n        });\n        await session.append(sleepTask);\n      }\n    }\n\n    return session.appendErrorPlan(`waitFor timeout: ${errorThought}`);\n  }\n}\n","import {\n  type ActionParam,\n  type ActionReturn,\n  type AgentAssertOpt,\n  type AgentDescribeElementAtPointResult,\n  type AgentOpt,\n  type AgentWaitForOpt,\n  type CacheConfig,\n  type DeviceAction,\n  type ExecutionDump,\n  type ExecutionRecorderItem,\n  type ExecutionTask,\n  type ExecutionTaskLog,\n  type ExecutionTaskPlanning,\n  type GroupedActionDump,\n  type LocateOption,\n  type LocateResultElement,\n  type LocateValidatorResult,\n  type LocatorValidatorOption,\n  type MidsceneYamlScript,\n  type OnTaskStartTip,\n  type PlanningAction,\n  type Rect,\n  type ScrollParam,\n  Service,\n  type ServiceAction,\n  type ServiceExtractOption,\n  type ServiceExtractParam,\n  type TUserPrompt,\n  type UIContext,\n} from '../index';\nexport type TestStatus =\n  | 'passed'\n  | 'failed'\n  | 'timedOut'\n  | 'skipped'\n  | 'interrupted';\nimport yaml from 'js-yaml';\n\nimport {\n  getVersion,\n  groupedActionDumpFileExt,\n  processCacheConfig,\n  reportHTMLContent,\n  stringifyDumpData,\n  writeLogFile,\n} from '@/utils';\nimport {\n  ScriptPlayer,\n  buildDetailedLocateParam,\n  parseYamlScript,\n} from '../yaml/index';\n\nimport type { AbstractInterface } from '@/device';\nimport type { TaskRunner } from '@/task-runner';\nimport {\n  type IModelConfig,\n  MIDSCENE_REPLANNING_CYCLE_LIMIT,\n  ModelConfigManager,\n  globalConfigManager,\n  globalModelConfigManager,\n} from '@midscene/shared/env';\nimport { imageInfoOfBase64, resizeImgBase64 } from '@midscene/shared/img';\nimport { getDebug } from '@midscene/shared/logger';\nimport { assert } from '@midscene/shared/utils';\nimport { defineActionAssert } from '../device';\n// import type { AndroidDeviceInputOpt } from '../device';\nimport { TaskCache } from './task-cache';\nimport { TaskExecutionError, TaskExecutor, locatePlanForLocate } from './tasks';\nimport { locateParamStr, paramStr, taskTitleStr, typeStr } from './ui-utils';\nimport {\n  commonContextParser,\n  getReportFileName,\n  parsePrompt,\n  printReportMsg,\n} from './utils';\n\nconst debug = getDebug('agent');\n\nconst distanceOfTwoPoints = (p1: [number, number], p2: [number, number]) => {\n  const [x1, y1] = p1;\n  const [x2, y2] = p2;\n  return Math.round(Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2));\n};\n\nconst includedInRect = (point: [number, number], rect: Rect) => {\n  const [x, y] = point;\n  const { left, top, width, height } = rect;\n  return x >= left && x <= left + width && y >= top && y <= top + height;\n};\n\nconst defaultServiceExtractOption: ServiceExtractOption = {\n  domIncluded: false,\n  screenshotIncluded: true,\n};\n\ntype CacheStrategy = NonNullable<CacheConfig['strategy']>;\n\nconst CACHE_STRATEGIES: readonly CacheStrategy[] = [\n  'read-only',\n  'read-write',\n  'write-only',\n];\n\nconst isValidCacheStrategy = (strategy: string): strategy is CacheStrategy =>\n  CACHE_STRATEGIES.some((value) => value === strategy);\n\nconst CACHE_STRATEGY_VALUES = CACHE_STRATEGIES.map(\n  (value) => `\"${value}\"`,\n).join(', ');\n\nconst legacyScrollTypeMap = {\n  once: 'singleAction',\n  untilBottom: 'scrollToBottom',\n  untilTop: 'scrollToTop',\n  untilRight: 'scrollToRight',\n  untilLeft: 'scrollToLeft',\n} as const;\n\ntype LegacyScrollType = keyof typeof legacyScrollTypeMap;\n\nconst normalizeScrollType = (\n  scrollType: ScrollParam['scrollType'] | LegacyScrollType | undefined,\n): ScrollParam['scrollType'] | undefined => {\n  if (!scrollType) {\n    return scrollType;\n  }\n\n  if (scrollType in legacyScrollTypeMap) {\n    return legacyScrollTypeMap[scrollType as LegacyScrollType];\n  }\n\n  return scrollType as ScrollParam['scrollType'];\n};\n\nconst defaultReplanningCycleLimit = 20;\nconst defaultVlmUiTarsReplanningCycleLimit = 40;\n\nexport type AiActOptions = {\n  cacheable?: boolean;\n};\n\nexport class Agent<\n  InterfaceType extends AbstractInterface = AbstractInterface,\n> {\n  interface: InterfaceType;\n\n  service: Service;\n\n  dump: GroupedActionDump;\n\n  reportFile?: string | null;\n\n  reportFileName?: string;\n\n  taskExecutor: TaskExecutor;\n\n  opts: AgentOpt;\n\n  /**\n   * If true, the agent will not perform any actions\n   */\n  dryMode = false;\n\n  onTaskStartTip?: OnTaskStartTip;\n\n  taskCache?: TaskCache;\n\n  private dumpUpdateListeners: Array<\n    (dump: string, executionDump?: ExecutionDump) => void\n  > = [];\n\n  get onDumpUpdate():\n    | ((dump: string, executionDump?: ExecutionDump) => void)\n    | undefined {\n    return this.dumpUpdateListeners[0];\n  }\n\n  set onDumpUpdate(callback:\n    | ((dump: string, executionDump?: ExecutionDump) => void)\n    | undefined) {\n    // Clear existing listeners\n    this.dumpUpdateListeners = [];\n    // Add callback to array if provided\n    if (callback) {\n      this.dumpUpdateListeners.push(callback);\n    }\n  }\n\n  destroyed = false;\n\n  modelConfigManager: ModelConfigManager;\n\n  /**\n   * Frozen page context for consistent AI operations\n   */\n  private frozenUIContext?: UIContext;\n\n  private get aiActContext(): string | undefined {\n    return this.opts.aiActContext ?? this.opts.aiActionContext;\n  }\n\n  /**\n   * Flag to track if VL model warning has been shown\n   */\n  private hasWarnedNonVLModel = false;\n\n  /**\n   * Screenshot scale factor derived from actual screenshot dimensions\n   */\n  private screenshotScale?: number;\n\n  /**\n   * Internal promise to deduplicate screenshot scale computation\n   */\n  private screenshotScalePromise?: Promise<number>;\n\n  private executionDumpIndexByRunner = new WeakMap<TaskRunner, number>();\n\n  // @deprecated use .interface instead\n  get page() {\n    return this.interface;\n  }\n\n  /**\n   * Ensures VL model warning is shown once when needed\n   */\n  private ensureVLModelWarning() {\n    if (\n      !this.hasWarnedNonVLModel &&\n      this.interface.interfaceType !== 'puppeteer' &&\n      this.interface.interfaceType !== 'playwright' &&\n      this.interface.interfaceType !== 'static' &&\n      this.interface.interfaceType !== 'chrome-extension-proxy' &&\n      this.interface.interfaceType !== 'page-over-chrome-extension-bridge'\n    ) {\n      this.modelConfigManager.throwErrorIfNonVLModel();\n      this.hasWarnedNonVLModel = true;\n    }\n  }\n\n  /**\n   * Lazily compute the ratio between the physical screenshot width and the logical page width\n   */\n  private async getScreenshotScale(context: UIContext): Promise<number> {\n    if (this.screenshotScale !== undefined) {\n      return this.screenshotScale;\n    }\n\n    if (!this.screenshotScalePromise) {\n      this.screenshotScalePromise = (async () => {\n        const pageWidth = context.size?.width;\n        assert(\n          pageWidth && pageWidth > 0,\n          `Invalid page width when computing screenshot scale: ${pageWidth}`,\n        );\n\n        debug('will get image info of base64');\n        const { width: screenshotWidth } = await imageInfoOfBase64(\n          context.screenshotBase64,\n        );\n        debug('image info of base64 done');\n\n        assert(\n          Number.isFinite(screenshotWidth) && screenshotWidth > 0,\n          `Invalid screenshot width when computing screenshot scale: ${screenshotWidth}`,\n        );\n\n        const computedScale = screenshotWidth / pageWidth;\n        assert(\n          Number.isFinite(computedScale) && computedScale > 0,\n          `Invalid computed screenshot scale: ${computedScale}`,\n        );\n\n        debug(\n          `Computed screenshot scale ${computedScale} from screenshot width ${screenshotWidth} and page width ${pageWidth}`,\n        );\n        return computedScale;\n      })();\n    }\n\n    try {\n      this.screenshotScale = await this.screenshotScalePromise;\n      return this.screenshotScale;\n    } finally {\n      this.screenshotScalePromise = undefined;\n    }\n  }\n\n  private resolveReplanningCycleLimit(\n    modelConfigForPlanning: IModelConfig,\n  ): number {\n    if (this.opts.replanningCycleLimit !== undefined) {\n      return this.opts.replanningCycleLimit;\n    }\n\n    return modelConfigForPlanning.vlMode === 'vlm-ui-tars'\n      ? defaultVlmUiTarsReplanningCycleLimit\n      : defaultReplanningCycleLimit;\n  }\n\n  constructor(interfaceInstance: InterfaceType, opts?: AgentOpt) {\n    this.interface = interfaceInstance;\n\n    const envConfig = globalConfigManager.getAllEnvConfig();\n    const envReplanningCycleLimitRaw =\n      envConfig[MIDSCENE_REPLANNING_CYCLE_LIMIT];\n    const envReplanningCycleLimit =\n      envReplanningCycleLimitRaw !== undefined\n        ? Number(envReplanningCycleLimitRaw)\n        : undefined;\n\n    this.opts = Object.assign(\n      {\n        generateReport: true,\n        autoPrintReportMsg: true,\n        groupName: 'Midscene Report',\n        groupDescription: '',\n      },\n      opts || {},\n      opts?.replanningCycleLimit === undefined &&\n        envReplanningCycleLimit !== undefined &&\n        !Number.isNaN(envReplanningCycleLimit)\n        ? { replanningCycleLimit: envReplanningCycleLimit }\n        : {},\n    );\n\n    const resolvedAiActContext =\n      this.opts.aiActContext ?? this.opts.aiActionContext;\n    if (resolvedAiActContext !== undefined) {\n      this.opts.aiActContext = resolvedAiActContext;\n      this.opts.aiActionContext ??= resolvedAiActContext;\n    }\n\n    if (\n      opts?.modelConfig &&\n      (typeof opts?.modelConfig !== 'object' || Array.isArray(opts.modelConfig))\n    ) {\n      throw new Error(\n        `opts.modelConfig must be a plain object map of env keys to values, but got ${typeof opts?.modelConfig}`,\n      );\n    }\n    // Create ModelConfigManager if modelConfig or createOpenAIClient is provided\n    // Otherwise, use the global config manager\n    const hasCustomConfig = opts?.modelConfig || opts?.createOpenAIClient;\n    this.modelConfigManager = hasCustomConfig\n      ? new ModelConfigManager(opts?.modelConfig, opts?.createOpenAIClient)\n      : globalModelConfigManager;\n\n    this.onTaskStartTip = this.opts.onTaskStartTip;\n\n    this.service = new Service(async () => {\n      return this.getUIContext();\n    });\n\n    // Process cache configuration\n    const cacheConfigObj = this.processCacheConfig(opts || {});\n    if (cacheConfigObj) {\n      this.taskCache = new TaskCache(\n        cacheConfigObj.id,\n        cacheConfigObj.enabled,\n        undefined, // cacheFilePath\n        {\n          readOnly: cacheConfigObj.readOnly,\n          writeOnly: cacheConfigObj.writeOnly,\n        },\n      );\n    }\n\n    const baseActionSpace = this.interface.actionSpace();\n    const fullActionSpace = [...baseActionSpace, defineActionAssert()];\n\n    this.taskExecutor = new TaskExecutor(this.interface, this.service, {\n      taskCache: this.taskCache,\n      onTaskStart: this.callbackOnTaskStartTip.bind(this),\n      replanningCycleLimit: this.opts.replanningCycleLimit,\n      actionSpace: fullActionSpace,\n      hooks: {\n        onTaskUpdate: (runner) => {\n          const executionDump = runner.dump();\n          this.appendExecutionDump(executionDump, runner);\n\n          // Call all registered dump update listeners\n          const dumpString = this.dumpDataString();\n          for (const listener of this.dumpUpdateListeners) {\n            try {\n              listener(dumpString, executionDump);\n            } catch (error) {\n              console.error('Error in onDumpUpdate listener', error);\n            }\n          }\n\n          this.writeOutActionDumps();\n        },\n      },\n    });\n    this.dump = this.resetDump();\n    this.reportFileName =\n      opts?.reportFileName ||\n      getReportFileName(opts?.testId || this.interface.interfaceType || 'web');\n  }\n\n  async getActionSpace(): Promise<DeviceAction[]> {\n    const commonAssertionAction = defineActionAssert();\n\n    return [...this.interface.actionSpace(), commonAssertionAction];\n  }\n\n  async getUIContext(action?: ServiceAction): Promise<UIContext> {\n    // Check VL model configuration when UI context is first needed\n    this.ensureVLModelWarning();\n\n    // If page context is frozen, return the frozen context for all actions\n    if (this.frozenUIContext) {\n      debug('Using frozen page context for action:', action);\n      return this.frozenUIContext;\n    }\n\n    // Get original context\n    let context: UIContext;\n    if (this.interface.getContext) {\n      debug('Using page.getContext for action:', action);\n      context = await this.interface.getContext();\n    } else {\n      debug('Using commonContextParser');\n      context = await commonContextParser(this.interface, {\n        uploadServerUrl: this.modelConfigManager.getUploadTestServerUrl(),\n      });\n    }\n\n    debug('will get screenshot scale');\n    const computedScreenshotScale = await this.getScreenshotScale(context);\n    debug('computedScreenshotScale', computedScreenshotScale);\n\n    if (computedScreenshotScale !== 1) {\n      const scaleForLog = Number.parseFloat(computedScreenshotScale.toFixed(4));\n      debug(\n        `Applying computed screenshot scale: ${scaleForLog} (resize to logical size)`,\n      );\n      const targetWidth = Math.round(context.size.width);\n      const targetHeight = Math.round(context.size.height);\n      debug(`Resizing screenshot to ${targetWidth}x${targetHeight}`);\n      context.screenshotBase64 = await resizeImgBase64(\n        context.screenshotBase64,\n        { width: targetWidth, height: targetHeight },\n      );\n    } else {\n      debug(`screenshot scale=${computedScreenshotScale}`);\n    }\n\n    return context;\n  }\n\n  async _snapshotContext(): Promise<UIContext> {\n    return await this.getUIContext('locate');\n  }\n\n  /**\n   * @deprecated Use {@link setAIActContext} instead.\n   */\n  async setAIActionContext(prompt: string) {\n    await this.setAIActContext(prompt);\n  }\n\n  async setAIActContext(prompt: string) {\n    if (this.aiActContext) {\n      console.warn(\n        'aiActContext is already set, and it is called again, will override the previous setting',\n      );\n    }\n    this.opts.aiActContext = prompt;\n    this.opts.aiActionContext = prompt;\n  }\n\n  resetDump() {\n    this.dump = {\n      sdkVersion: getVersion(),\n      groupName: this.opts.groupName!,\n      groupDescription: this.opts.groupDescription,\n      executions: [],\n      modelBriefs: [],\n    };\n    this.executionDumpIndexByRunner = new WeakMap<TaskRunner, number>();\n\n    return this.dump;\n  }\n\n  appendExecutionDump(execution: ExecutionDump, runner?: TaskRunner) {\n    const currentDump = this.dump;\n    if (runner) {\n      const existingIndex = this.executionDumpIndexByRunner.get(runner);\n      if (existingIndex !== undefined) {\n        currentDump.executions[existingIndex] = execution;\n        return;\n      }\n      currentDump.executions.push(execution);\n      this.executionDumpIndexByRunner.set(\n        runner,\n        currentDump.executions.length - 1,\n      );\n      return;\n    }\n    currentDump.executions.push(execution);\n  }\n\n  dumpDataString() {\n    // update dump info\n    this.dump.groupName = this.opts.groupName!;\n    this.dump.groupDescription = this.opts.groupDescription;\n    return stringifyDumpData(this.dump);\n  }\n\n  reportHTMLString() {\n    return reportHTMLContent(this.dumpDataString());\n  }\n\n  writeOutActionDumps() {\n    if (this.destroyed) {\n      throw new Error(\n        'PageAgent has been destroyed. Cannot update report file.',\n      );\n    }\n    const { generateReport, autoPrintReportMsg } = this.opts;\n    this.reportFile = writeLogFile({\n      fileName: this.reportFileName!,\n      fileExt: groupedActionDumpFileExt,\n      fileContent: this.dumpDataString(),\n      type: 'dump',\n      generateReport,\n    });\n    debug('writeOutActionDumps', this.reportFile);\n    if (generateReport && autoPrintReportMsg && this.reportFile) {\n      printReportMsg(this.reportFile);\n    }\n  }\n\n  private async callbackOnTaskStartTip(task: ExecutionTask) {\n    const param = paramStr(task);\n    const tip = param ? `${typeStr(task)} - ${param}` : typeStr(task);\n\n    if (this.onTaskStartTip) {\n      await this.onTaskStartTip(tip);\n    }\n  }\n\n  wrapActionInActionSpace<T extends DeviceAction>(\n    name: string,\n  ): (param: ActionParam<T>) => Promise<ActionReturn<T>> {\n    return async (param: ActionParam<T>) => {\n      return await this.callActionInActionSpace<ActionReturn<T>>(name, param);\n    };\n  }\n\n  async callActionInActionSpace<T = any>(\n    type: string,\n    opt?: T, // and all other action params\n  ) {\n    debug('callActionInActionSpace', type, ',', opt);\n\n    const actionPlan: PlanningAction<T> = {\n      type: type as any,\n      param: (opt as any) || {},\n      thought: '',\n    };\n    debug('actionPlan', actionPlan); // , ', in which the locateParam is', locateParam);\n\n    const plans: PlanningAction[] = [actionPlan].filter(\n      Boolean,\n    ) as PlanningAction[];\n\n    const title = taskTitleStr(\n      type as any,\n      locateParamStr((opt as any)?.locate || {}),\n    );\n\n    // assume all operation in action space is related to locating\n    const defaultIntentModelConfig =\n      this.modelConfigManager.getModelConfig('default');\n    const modelConfigForPlanning =\n      this.modelConfigManager.getModelConfig('planning');\n\n    const { output } = await this.taskExecutor.runPlans(\n      title,\n      plans,\n      modelConfigForPlanning,\n      defaultIntentModelConfig,\n    );\n    return output;\n  }\n\n  async aiTap(locatePrompt: TUserPrompt, opt?: LocateOption) {\n    assert(locatePrompt, 'missing locate prompt for tap');\n\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\n\n    return this.callActionInActionSpace('Tap', {\n      locate: detailedLocateParam,\n    });\n  }\n\n  async aiRightClick(locatePrompt: TUserPrompt, opt?: LocateOption) {\n    assert(locatePrompt, 'missing locate prompt for right click');\n\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\n\n    return this.callActionInActionSpace('RightClick', {\n      locate: detailedLocateParam,\n    });\n  }\n\n  async aiDoubleClick(locatePrompt: TUserPrompt, opt?: LocateOption) {\n    assert(locatePrompt, 'missing locate prompt for double click');\n\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\n\n    return this.callActionInActionSpace('DoubleClick', {\n      locate: detailedLocateParam,\n    });\n  }\n\n  async aiHover(locatePrompt: TUserPrompt, opt?: LocateOption) {\n    assert(locatePrompt, 'missing locate prompt for hover');\n\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\n\n    return this.callActionInActionSpace('Hover', {\n      locate: detailedLocateParam,\n    });\n  }\n\n  // New signature, always use locatePrompt as the first param\n  async aiInput(\n    locatePrompt: TUserPrompt,\n    opt: LocateOption & { value: string | number } & {\n      autoDismissKeyboard?: boolean;\n    } & { mode?: 'replace' | 'clear' | 'append' },\n  ): Promise<any>;\n\n  // Legacy signature - deprecated\n  /**\n   * @deprecated Use aiInput(locatePrompt, opt) instead where opt contains the value\n   */\n  async aiInput(\n    value: string | number,\n    locatePrompt: TUserPrompt,\n    opt?: LocateOption & { autoDismissKeyboard?: boolean } & {\n      mode?: 'replace' | 'clear' | 'append';\n    }, // AndroidDeviceInputOpt &\n  ): Promise<any>;\n\n  // Implementation\n  async aiInput(\n    locatePromptOrValue: TUserPrompt | string | number,\n    locatePromptOrOpt:\n      | TUserPrompt\n      | (LocateOption & { value: string | number } & {\n          autoDismissKeyboard?: boolean;\n        } & { mode?: 'replace' | 'clear' | 'append' }) // AndroidDeviceInputOpt &\n      | undefined,\n    optOrUndefined?: LocateOption, // AndroidDeviceInputOpt &\n  ) {\n    let value: string | number;\n    let locatePrompt: TUserPrompt;\n    let opt:\n      | (LocateOption & { value: string | number } & {\n          autoDismissKeyboard?: boolean;\n        } & { mode?: 'replace' | 'clear' | 'append' }) // AndroidDeviceInputOpt &\n      | undefined;\n\n    // Check if using new signature (first param is locatePrompt, second has value)\n    if (\n      typeof locatePromptOrOpt === 'object' &&\n      locatePromptOrOpt !== null &&\n      'value' in locatePromptOrOpt\n    ) {\n      // New signature: aiInput(locatePrompt, opt)\n      locatePrompt = locatePromptOrValue as TUserPrompt;\n      const optWithValue = locatePromptOrOpt as LocateOption & {\n        // AndroidDeviceInputOpt &\n        value: string | number;\n        autoDismissKeyboard?: boolean;\n      };\n      value = optWithValue.value;\n      opt = optWithValue;\n    } else {\n      // Legacy signature: aiInput(value, locatePrompt, opt)\n      value = locatePromptOrValue as string | number;\n      locatePrompt = locatePromptOrOpt as TUserPrompt;\n      opt = {\n        ...optOrUndefined,\n        value,\n      };\n    }\n\n    assert(\n      typeof value === 'string' || typeof value === 'number',\n      'input value must be a string or number, use empty string if you want to clear the input',\n    );\n    assert(locatePrompt, 'missing locate prompt for input');\n\n    const detailedLocateParam = buildDetailedLocateParam(locatePrompt, opt);\n\n    // Convert value to string to ensure consistency\n    const stringValue = typeof value === 'number' ? String(value) : value;\n\n    return this.callActionInActionSpace('Input', {\n      ...(opt || {}),\n      value: stringValue,\n      locate: detailedLocateParam,\n    });\n  }\n\n  // New signature\n  async aiKeyboardPress(\n    locatePrompt: TUserPrompt,\n    opt: LocateOption & { keyName: string },\n  ): Promise<any>;\n\n  // Legacy signature - deprecated\n  /**\n   * @deprecated Use aiKeyboardPress(locatePrompt, opt) instead where opt contains the keyName\n   */\n  async aiKeyboardPress(\n    keyName: string,\n    locatePrompt?: TUserPrompt,\n    opt?: LocateOption,\n  ): Promise<any>;\n\n  // Implementation\n  async aiKeyboardPress(\n    locatePromptOrKeyName: TUserPrompt | string,\n    locatePromptOrOpt:\n      | TUserPrompt\n      | (LocateOption & { keyName: string })\n      | undefined,\n    optOrUndefined?: LocateOption,\n  ) {\n    let keyName: string;\n    let locatePrompt: TUserPrompt | undefined;\n    let opt: (LocateOption & { keyName: string }) | undefined;\n\n    // Check if using new signature (first param is locatePrompt, second has keyName)\n    if (\n      typeof locatePromptOrOpt === 'object' &&\n      locatePromptOrOpt !== null &&\n      'keyName' in locatePromptOrOpt\n    ) {\n      // New signature: aiKeyboardPress(locatePrompt, opt)\n      locatePrompt = locatePromptOrKeyName as TUserPrompt;\n      opt = locatePromptOrOpt as LocateOption & {\n        keyName: string;\n      };\n    } else {\n      // Legacy signature: aiKeyboardPress(keyName, locatePrompt, opt)\n      keyName = locatePromptOrKeyName as string;\n      locatePrompt = locatePromptOrOpt as TUserPrompt | undefined;\n      opt = {\n        ...(optOrUndefined || {}),\n        keyName,\n      };\n    }\n\n    assert(opt?.keyName, 'missing keyName for keyboard press');\n\n    const detailedLocateParam = locatePrompt\n      ? buildDetailedLocateParam(locatePrompt, opt)\n      : undefined;\n\n    return this.callActionInActionSpace('KeyboardPress', {\n      ...(opt || {}),\n      locate: detailedLocateParam,\n    });\n  }\n\n  // New signature\n  async aiScroll(\n    locatePrompt: TUserPrompt | undefined,\n    opt: LocateOption & ScrollParam,\n  ): Promise<any>;\n\n  // Legacy signature - deprecated\n  /**\n   * @deprecated Use aiScroll(locatePrompt, opt) instead where opt contains the scroll parameters\n   */\n  async aiScroll(\n    scrollParam: ScrollParam,\n    locatePrompt?: TUserPrompt,\n    opt?: LocateOption,\n  ): Promise<any>;\n\n  // Implementation\n  async aiScroll(\n    locatePromptOrScrollParam: TUserPrompt | ScrollParam | undefined,\n    locatePromptOrOpt: TUserPrompt | (LocateOption & ScrollParam) | undefined,\n    optOrUndefined?: LocateOption,\n  ) {\n    let scrollParam: ScrollParam;\n    let locatePrompt: TUserPrompt | undefined;\n    let opt: LocateOption | undefined;\n\n    // Check if using new signature (first param is locatePrompt, second has scroll params)\n    if (\n      typeof locatePromptOrOpt === 'object' &&\n      ('direction' in locatePromptOrOpt ||\n        'scrollType' in locatePromptOrOpt ||\n        'distance' in locatePromptOrOpt)\n    ) {\n      // New signature: aiScroll(locatePrompt, opt)\n      locatePrompt = locatePromptOrScrollParam as TUserPrompt;\n      opt = locatePromptOrOpt as LocateOption & ScrollParam;\n    } else {\n      // Legacy signature: aiScroll(scrollParam, locatePrompt, opt)\n      scrollParam = locatePromptOrScrollParam as ScrollParam;\n      locatePrompt = locatePromptOrOpt as TUserPrompt | undefined;\n      opt = {\n        ...(optOrUndefined || {}),\n        ...(scrollParam || {}),\n      };\n    }\n\n    if (opt) {\n      const normalizedScrollType = normalizeScrollType(\n        (opt as ScrollParam).scrollType as\n          | ScrollParam['scrollType']\n          | LegacyScrollType\n          | undefined,\n      );\n\n      if (normalizedScrollType !== (opt as ScrollParam).scrollType) {\n        (opt as ScrollParam) = {\n          ...(opt || {}),\n          scrollType: normalizedScrollType as ScrollParam['scrollType'],\n        };\n      }\n    }\n\n    const detailedLocateParam = buildDetailedLocateParam(\n      locatePrompt || '',\n      opt,\n    );\n\n    return this.callActionInActionSpace('Scroll', {\n      ...(opt || {}),\n      locate: detailedLocateParam,\n    });\n  }\n\n  async aiAct(taskPrompt: string, opt?: AiActOptions) {\n    const modelConfigForPlanning =\n      this.modelConfigManager.getModelConfig('planning');\n    const defaultIntentModelConfig =\n      this.modelConfigManager.getModelConfig('default');\n\n    const includeBboxInPlanning =\n      modelConfigForPlanning.modelName === defaultIntentModelConfig.modelName &&\n      modelConfigForPlanning.openaiBaseURL ===\n        defaultIntentModelConfig.openaiBaseURL;\n    debug('setting includeBboxInPlanning to', includeBboxInPlanning);\n\n    const cacheable = opt?.cacheable;\n    const replanningCycleLimit = this.resolveReplanningCycleLimit(\n      modelConfigForPlanning,\n    );\n    // if vlm-ui-tars, plan cache is not used\n    const isVlmUiTars = modelConfigForPlanning.vlMode === 'vlm-ui-tars';\n    const matchedCache =\n      isVlmUiTars || cacheable === false\n        ? undefined\n        : this.taskCache?.matchPlanCache(taskPrompt);\n    if (\n      matchedCache &&\n      this.taskCache?.isCacheResultUsed &&\n      matchedCache.cacheContent?.yamlWorkflow?.trim()\n    ) {\n      // log into report file\n      await this.taskExecutor.loadYamlFlowAsPlanning(\n        taskPrompt,\n        matchedCache.cacheContent.yamlWorkflow,\n      );\n\n      debug('matched cache, will call .runYaml to run the action');\n      const yaml = matchedCache.cacheContent.yamlWorkflow;\n      return this.runYaml(yaml);\n    }\n\n    // If cache matched but yamlWorkflow is empty, fall through to normal execution\n\n    const useDeepThink = (this.opts as any)?._deepThink;\n    if (useDeepThink) {\n      debug('using deep think planning settings');\n    }\n    const imagesIncludeCount: number | undefined = useDeepThink ? undefined : 2;\n    const { output } = await this.taskExecutor.action(\n      taskPrompt,\n      modelConfigForPlanning,\n      defaultIntentModelConfig,\n      includeBboxInPlanning,\n      this.aiActContext,\n      cacheable,\n      replanningCycleLimit,\n      imagesIncludeCount,\n    );\n\n    // update cache\n    if (this.taskCache && output?.yamlFlow && cacheable !== false) {\n      const yamlContent: MidsceneYamlScript = {\n        tasks: [\n          {\n            name: taskPrompt,\n            flow: output.yamlFlow,\n          },\n        ],\n      };\n      const yamlFlowStr = yaml.dump(yamlContent);\n      this.taskCache.updateOrAppendCacheRecord(\n        {\n          type: 'plan',\n          prompt: taskPrompt,\n          yamlWorkflow: yamlFlowStr,\n        },\n        matchedCache,\n      );\n    }\n\n    return output;\n  }\n\n  /**\n   * @deprecated Use {@link Agent.aiAct} instead.\n   */\n  async aiAction(taskPrompt: string, opt?: AiActOptions) {\n    return this.aiAct(taskPrompt, opt);\n  }\n\n  async aiQuery<ReturnType = any>(\n    demand: ServiceExtractParam,\n    opt: ServiceExtractOption = defaultServiceExtractOption,\n  ): Promise<ReturnType> {\n    const modelConfig = this.modelConfigManager.getModelConfig('insight');\n    const { output } = await this.taskExecutor.createTypeQueryExecution(\n      'Query',\n      demand,\n      modelConfig,\n      opt,\n    );\n    return output as ReturnType;\n  }\n\n  async aiBoolean(\n    prompt: TUserPrompt,\n    opt: ServiceExtractOption = defaultServiceExtractOption,\n  ): Promise<boolean> {\n    const modelConfig = this.modelConfigManager.getModelConfig('insight');\n\n    const { textPrompt, multimodalPrompt } = parsePrompt(prompt);\n    const { output } = await this.taskExecutor.createTypeQueryExecution(\n      'Boolean',\n      textPrompt,\n      modelConfig,\n      opt,\n      multimodalPrompt,\n    );\n    return output as boolean;\n  }\n\n  async aiNumber(\n    prompt: TUserPrompt,\n    opt: ServiceExtractOption = defaultServiceExtractOption,\n  ): Promise<number> {\n    const modelConfig = this.modelConfigManager.getModelConfig('insight');\n\n    const { textPrompt, multimodalPrompt } = parsePrompt(prompt);\n    const { output } = await this.taskExecutor.createTypeQueryExecution(\n      'Number',\n      textPrompt,\n      modelConfig,\n      opt,\n      multimodalPrompt,\n    );\n    return output as number;\n  }\n\n  async aiString(\n    prompt: TUserPrompt,\n    opt: ServiceExtractOption = defaultServiceExtractOption,\n  ): Promise<string> {\n    const modelConfig = this.modelConfigManager.getModelConfig('insight');\n\n    const { textPrompt, multimodalPrompt } = parsePrompt(prompt);\n    const { output } = await this.taskExecutor.createTypeQueryExecution(\n      'String',\n      textPrompt,\n      modelConfig,\n      opt,\n      multimodalPrompt,\n    );\n    return output as string;\n  }\n\n  async aiAsk(\n    prompt: TUserPrompt,\n    opt: ServiceExtractOption = defaultServiceExtractOption,\n  ): Promise<string> {\n    return this.aiString(prompt, opt);\n  }\n\n  async describeElementAtPoint(\n    center: [number, number],\n    opt?: {\n      verifyPrompt?: boolean;\n      retryLimit?: number;\n      deepThink?: boolean;\n    } & LocatorValidatorOption,\n  ): Promise<AgentDescribeElementAtPointResult> {\n    const { verifyPrompt = true, retryLimit = 3 } = opt || {};\n\n    let success = false;\n    let retryCount = 0;\n    let resultPrompt = '';\n    let deepThink = opt?.deepThink || false;\n    let verifyResult: LocateValidatorResult | undefined;\n\n    while (!success && retryCount < retryLimit) {\n      if (retryCount >= 2) {\n        deepThink = true;\n      }\n      debug(\n        'aiDescribe',\n        center,\n        'verifyPrompt',\n        verifyPrompt,\n        'retryCount',\n        retryCount,\n        'deepThink',\n        deepThink,\n      );\n      // use same intent as aiLocate\n      const modelConfig = this.modelConfigManager.getModelConfig('insight');\n\n      const text = await this.service.describe(center, modelConfig, {\n        deepThink,\n      });\n      debug('aiDescribe text', text);\n      assert(text.description, `failed to describe element at [${center}]`);\n      resultPrompt = text.description;\n\n      verifyResult = await this.verifyLocator(\n        resultPrompt,\n        deepThink ? { deepThink: true } : undefined,\n        center,\n        opt,\n      );\n      if (verifyResult.pass) {\n        success = true;\n      } else {\n        retryCount++;\n      }\n    }\n\n    return {\n      prompt: resultPrompt,\n      deepThink,\n      verifyResult,\n    };\n  }\n\n  async verifyLocator(\n    prompt: string,\n    locateOpt: LocateOption | undefined,\n    expectCenter: [number, number],\n    verifyLocateOption?: LocatorValidatorOption,\n  ): Promise<LocateValidatorResult> {\n    debug('verifyLocator', prompt, locateOpt, expectCenter, verifyLocateOption);\n\n    const { center: verifyCenter, rect: verifyRect } = await this.aiLocate(\n      prompt,\n      locateOpt,\n    );\n    const distance = distanceOfTwoPoints(expectCenter, verifyCenter);\n    const included = includedInRect(expectCenter, verifyRect);\n    const pass =\n      distance <= (verifyLocateOption?.centerDistanceThreshold || 20) ||\n      included;\n    const verifyResult = {\n      pass,\n      rect: verifyRect,\n      center: verifyCenter,\n      centerDistance: distance,\n    };\n    debug('aiDescribe verifyResult', verifyResult);\n    return verifyResult;\n  }\n\n  async aiLocate(prompt: TUserPrompt, opt?: LocateOption) {\n    const locateParam = buildDetailedLocateParam(prompt, opt);\n    assert(locateParam, 'cannot get locate param for aiLocate');\n    const locatePlan = locatePlanForLocate(locateParam);\n    const plans = [locatePlan];\n    const defaultIntentModelConfig =\n      this.modelConfigManager.getModelConfig('default');\n    const modelConfigForPlanning =\n      this.modelConfigManager.getModelConfig('planning');\n\n    const { output } = await this.taskExecutor.runPlans(\n      taskTitleStr('Locate', locateParamStr(locateParam)),\n      plans,\n      modelConfigForPlanning,\n      defaultIntentModelConfig,\n    );\n\n    const { element } = output;\n\n    const dprValue = await (this.interface.size() as any).dpr;\n    const dprEntry = dprValue\n      ? {\n          dpr: dprValue,\n        }\n      : {};\n    return {\n      rect: element?.rect,\n      center: element?.center,\n      ...dprEntry,\n    } as Pick<LocateResultElement, 'rect' | 'center'> & {\n      dpr?: number; // this field is deprecated\n    };\n  }\n\n  async aiAssert(\n    assertion: TUserPrompt,\n    msg?: string,\n    opt?: AgentAssertOpt & ServiceExtractOption,\n  ) {\n    const modelConfig = this.modelConfigManager.getModelConfig('insight');\n\n    const serviceOpt: ServiceExtractOption = {\n      domIncluded: opt?.domIncluded ?? defaultServiceExtractOption.domIncluded,\n      screenshotIncluded:\n        opt?.screenshotIncluded ??\n        defaultServiceExtractOption.screenshotIncluded,\n    };\n\n    const { textPrompt, multimodalPrompt } = parsePrompt(assertion);\n    const assertionText =\n      typeof assertion === 'string' ? assertion : assertion.prompt;\n\n    try {\n      const { output, thought } =\n        await this.taskExecutor.createTypeQueryExecution<boolean>(\n          'Assert',\n          textPrompt,\n          modelConfig,\n          serviceOpt,\n          multimodalPrompt,\n        );\n\n      const pass = Boolean(output);\n      const message = pass\n        ? undefined\n        : `Assertion failed: ${msg || assertionText}\\nReason: ${thought || '(no_reason)'}`;\n\n      if (opt?.keepRawResponse) {\n        return {\n          pass,\n          thought,\n          message,\n        };\n      }\n\n      if (!pass) {\n        throw new Error(message);\n      }\n    } catch (error) {\n      if (error instanceof TaskExecutionError) {\n        const errorTask = error.errorTask;\n        const thought = errorTask?.thought;\n        const rawError = errorTask?.error;\n        const rawMessage =\n          errorTask?.errorMessage ||\n          (rawError instanceof Error\n            ? rawError.message\n            : rawError\n              ? String(rawError)\n              : undefined);\n        const reason = thought || rawMessage || '(no_reason)';\n        const message = `Assertion failed: ${msg || assertionText}\\nReason: ${reason}`;\n\n        if (opt?.keepRawResponse) {\n          return {\n            pass: false,\n            thought,\n            message,\n          };\n        }\n\n        throw new Error(message, {\n          cause: rawError ?? error,\n        });\n      }\n\n      throw error;\n    }\n  }\n\n  async aiWaitFor(assertion: TUserPrompt, opt?: AgentWaitForOpt) {\n    const modelConfig = this.modelConfigManager.getModelConfig('insight');\n    await this.taskExecutor.waitFor(\n      assertion,\n      {\n        timeoutMs: opt?.timeoutMs || 15 * 1000,\n        checkIntervalMs: opt?.checkIntervalMs || 3 * 1000,\n      },\n      modelConfig,\n    );\n  }\n\n  async ai(...args: Parameters<typeof this.aiAct>) {\n    return this.aiAct(...args);\n  }\n\n  async runYaml(yamlScriptContent: string): Promise<{\n    result: Record<string, any>;\n  }> {\n    const script = parseYamlScript(yamlScriptContent, 'yaml');\n    const player = new ScriptPlayer(script, async () => {\n      return { agent: this, freeFn: [] };\n    });\n    await player.run();\n\n    if (player.status === 'error') {\n      const errors = player.taskStatusList\n        .filter((task) => task.status === 'error')\n        .map((task) => {\n          return `task - ${task.name}: ${task.error?.message}`;\n        })\n        .join('\\n');\n      throw new Error(`Error(s) occurred in running yaml script:\\n${errors}`);\n    }\n\n    return {\n      result: player.result,\n    };\n  }\n\n  async evaluateJavaScript(script: string) {\n    assert(\n      this.interface.evaluateJavaScript,\n      'evaluateJavaScript is not supported in current agent',\n    );\n    return this.interface.evaluateJavaScript(script);\n  }\n\n  /**\n   * Add a dump update listener\n   * @param listener Listener function\n   * @returns A remove function that can be called to remove this listener\n   */\n  addDumpUpdateListener(\n    listener: (dump: string, executionDump?: ExecutionDump) => void,\n  ): () => void {\n    this.dumpUpdateListeners.push(listener);\n\n    // Return remove function\n    return () => {\n      this.removeDumpUpdateListener(listener);\n    };\n  }\n\n  /**\n   * Remove a dump update listener\n   * @param listener The listener function to remove\n   */\n  removeDumpUpdateListener(\n    listener: (dump: string, executionDump?: ExecutionDump) => void,\n  ): void {\n    const index = this.dumpUpdateListeners.indexOf(listener);\n    if (index > -1) {\n      this.dumpUpdateListeners.splice(index, 1);\n    }\n  }\n\n  /**\n   * Clear all dump update listeners\n   */\n  clearDumpUpdateListeners(): void {\n    this.dumpUpdateListeners = [];\n  }\n\n  async destroy() {\n    // Early return if already destroyed\n    if (this.destroyed) {\n      return;\n    }\n\n    await this.interface.destroy?.();\n    this.resetDump(); // reset dump to release memory\n    this.destroyed = true;\n  }\n\n  async recordToReport(\n    title?: string,\n    opt?: {\n      content: string;\n    },\n  ) {\n    // 1. screenshot\n    const base64 = await this.interface.screenshotBase64();\n    const now = Date.now();\n    // 2. build recorder\n    const recorder: ExecutionRecorderItem[] = [\n      {\n        type: 'screenshot',\n        ts: now,\n        screenshot: base64,\n      },\n    ];\n    // 3. build ExecutionTaskLog\n    const task: ExecutionTaskLog = {\n      type: 'Log',\n      subType: 'Screenshot',\n      status: 'finished',\n      recorder,\n      timing: {\n        start: now,\n        end: now,\n        cost: 0,\n      },\n      param: {\n        content: opt?.content || '',\n      },\n      executor: async () => {},\n    };\n    // 4. build ExecutionDump\n    const executionDump: ExecutionDump = {\n      logTime: now,\n      name: `Log - ${title || 'untitled'}`,\n      description: opt?.content || '',\n      tasks: [task],\n    };\n    // 5. append to execution dump\n    this.appendExecutionDump(executionDump);\n\n    // Call all registered dump update listeners\n    const dumpString = this.dumpDataString();\n    for (const listener of this.dumpUpdateListeners) {\n      try {\n        listener(dumpString);\n      } catch (error) {\n        console.error('Error in onDumpUpdate listener', error);\n      }\n    }\n\n    this.writeOutActionDumps();\n  }\n\n  /**\n   * @deprecated Use {@link Agent.recordToReport} instead.\n   */\n  async logScreenshot(\n    title?: string,\n    opt?: {\n      content: string;\n    },\n  ) {\n    await this.recordToReport(title, opt);\n  }\n\n  _unstableLogContent() {\n    const { groupName, groupDescription, executions } = this.dump;\n    return {\n      groupName,\n      groupDescription,\n      executions: executions || [],\n    };\n  }\n\n  /**\n   * Freezes the current page context to be reused in subsequent AI operations\n   * This avoids recalculating page context for each operation\n   */\n  async freezePageContext(): Promise<void> {\n    debug('Freezing page context');\n    const context = await this._snapshotContext();\n    // Mark the context as frozen\n    context._isFrozen = true;\n    this.frozenUIContext = context;\n    debug('Page context frozen successfully');\n  }\n\n  /**\n   * Unfreezes the page context, allowing AI operations to calculate context dynamically\n   */\n  async unfreezePageContext(): Promise<void> {\n    debug('Unfreezing page context');\n    this.frozenUIContext = undefined;\n    debug('Page context unfrozen successfully');\n  }\n\n  /**\n   * Process cache configuration and return normalized cache settings\n   */\n  private processCacheConfig(opts: AgentOpt): {\n    id: string;\n    enabled: boolean;\n    readOnly: boolean;\n    writeOnly: boolean;\n  } | null {\n    // Validate original cache config before processing\n    // Agent requires explicit IDs - don't allow auto-generation\n    if (opts.cache === true) {\n      throw new Error(\n        'cache: true requires an explicit cache ID. Please provide:\\n' +\n          'Example: cache: { id: \"my-cache-id\" }',\n      );\n    }\n\n    // Check if cache config object is missing ID\n    if (\n      opts.cache &&\n      typeof opts.cache === 'object' &&\n      opts.cache !== null &&\n      !opts.cache.id\n    ) {\n      throw new Error(\n        'cache configuration requires an explicit id.\\n' +\n          'Example: cache: { id: \"my-cache-id\" }',\n      );\n    }\n\n    // Use the unified utils function to process cache configuration\n    const cacheConfig = processCacheConfig(\n      opts.cache,\n      opts.cacheId || opts.testId || 'default',\n    );\n\n    if (!cacheConfig) {\n      return null;\n    }\n\n    // Handle cache configuration object\n    if (typeof cacheConfig === 'object' && cacheConfig !== null) {\n      const id = cacheConfig.id;\n      const rawStrategy = cacheConfig.strategy as unknown;\n      let strategyValue: string;\n\n      if (rawStrategy === undefined) {\n        strategyValue = 'read-write';\n      } else if (typeof rawStrategy === 'string') {\n        strategyValue = rawStrategy;\n      } else {\n        throw new Error(\n          `cache.strategy must be a string when provided, but received type ${typeof rawStrategy}`,\n        );\n      }\n\n      if (!isValidCacheStrategy(strategyValue)) {\n        throw new Error(\n          `cache.strategy must be one of ${CACHE_STRATEGY_VALUES}, but received \"${strategyValue}\"`,\n        );\n      }\n\n      const isReadOnly = strategyValue === 'read-only';\n      const isWriteOnly = strategyValue === 'write-only';\n\n      return {\n        id,\n        enabled: !isWriteOnly,\n        readOnly: isReadOnly,\n        writeOnly: isWriteOnly,\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Manually flush cache to file\n   * @param options - Optional configuration\n   * @param options.cleanUnused - If true, removes unused cache records before flushing\n   */\n  async flushCache(options?: { cleanUnused?: boolean }): Promise<void> {\n    if (!this.taskCache) {\n      throw new Error('Cache is not configured');\n    }\n\n    this.taskCache.flushCacheToFile(options);\n  }\n}\n\nexport const createAgent = (\n  interfaceInstance: AbstractInterface,\n  opts?: AgentOpt,\n) => {\n  return new Agent(interfaceInstance, opts);\n};\n","const trackingTip = 'limit popup to current tab';\nconst deepThinkTip = 'deep think';\nconst screenshotIncludedTip = 'include screenshot in request';\nconst domIncludedTip = 'include DOM info in request';\nconst imeStrategyTip = 'IME strategy';\nconst autoDismissKeyboardTip = 'Auto dismiss keyboard';\nconst keyboardDismissStrategyTip = 'Keyboard dismiss strategy';\nconst alwaysRefreshScreenInfoTip = 'Always refresh screen info';\nconst apiMetadata = {\n    aiAct: {\n        group: 'interaction',\n        title: 'Auto Planning: plan the steps and execute'\n    },\n    aiTap: {\n        group: 'interaction',\n        title: 'Click an element'\n    },\n    aiDoubleClick: {\n        group: 'interaction',\n        title: 'Double-click an element'\n    },\n    aiHover: {\n        group: 'interaction',\n        title: 'Hover over an element'\n    },\n    aiInput: {\n        group: 'interaction',\n        title: 'Input text into an element'\n    },\n    aiRightClick: {\n        group: 'interaction',\n        title: 'Right-click an element'\n    },\n    aiKeyboardPress: {\n        group: 'interaction',\n        title: 'Press keyboard keys'\n    },\n    aiScroll: {\n        group: 'interaction',\n        title: 'Scroll the page or element'\n    },\n    aiLocate: {\n        group: 'interaction',\n        title: 'Locate an element on the page'\n    },\n    aiQuery: {\n        group: 'extraction',\n        title: 'Extract data directly from the UI'\n    },\n    aiBoolean: {\n        group: 'extraction',\n        title: 'Get true/false answer'\n    },\n    aiNumber: {\n        group: 'extraction',\n        title: 'Extract numeric value'\n    },\n    aiString: {\n        group: 'extraction',\n        title: 'Extract text value'\n    },\n    aiAsk: {\n        group: 'extraction',\n        title: 'Ask a question about the UI'\n    },\n    aiAssert: {\n        group: 'validation',\n        title: 'Assert a condition is true'\n    },\n    aiWaitFor: {\n        group: 'validation',\n        title: 'Wait for a condition to be met'\n    }\n};\nconst defaultMainButtons = [\n    'aiAct',\n    'aiTap',\n    'aiQuery',\n    'aiAssert'\n];\nconst WELCOME_MESSAGE_TEMPLATE = {\n    type: 'system',\n    content: `\n      Welcome to Midscene.js Playground!\n      \n      This is a panel for experimenting and testing Midscene.js features. You can use natural language instructions to operate the web page, such as clicking buttons, filling in forms, querying information, etc.\n      \n      Please enter your instructions in the input box below to start experiencing.\n    `,\n    loading: false,\n    result: void 0,\n    replayScriptsInfo: null,\n    replayCounter: 0,\n    loadingProgressText: '',\n    verticalMode: false\n};\nconst BLANK_RESULT = {\n    result: void 0,\n    dump: null,\n    reportHTML: null,\n    error: null\n};\nexport { BLANK_RESULT, WELCOME_MESSAGE_TEMPLATE, alwaysRefreshScreenInfoTip, apiMetadata, autoDismissKeyboardTip, deepThinkTip, defaultMainButtons, domIncludedTip, imeStrategyTip, keyboardDismissStrategyTip, screenshotIncludedTip, trackingTip };\n","import dayjs from \"dayjs\";\nfunction timeStr(timestamp) {\n    return timestamp ? dayjs(timestamp).format('YYYY-MM-DD HH:mm:ss') : '-';\n}\nfunction fullTimeStrWithMilliseconds(timestamp) {\n    return timestamp ? dayjs(timestamp).format('YYYY-MM-DD HH:mm:ss.SSS') : '-';\n}\nfunction filterBase64Value(input) {\n    return input.replace(/data:image\\/[^\"]+\"/g, 'data:image...\"');\n}\nconst mousePointer = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABfCAYAAACgCTpnAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAS6ADAAQAAAABAAAAXwAAAAARa1b5AAAaTElEQVR4AeVcB7iUxbme3T2FKl1BlKZgFDWo2JCiPCpgohQBsRB7iTwmJrZriD0RSACDBb3Gq6i5sWCEq6KiCNhBrKBIUzw0KYfqKbtn233f2X1/5vzssntOaJrveWa/mW/6+38z883882+osrLyTwcddNCX06ZNCxhjiuCKHcdwYdoVgIfSLgjO9HLwVvMz/NOjWCw2NxqNvv/JJ5/0QO8awzVxHMON4PaDawBXD64uHAEliAIwE3iI/olReXn5E0lQPB4vWbJkySXo3v6OawF/c7imcATOBY2AUfP+YwALAqyl6LAJBoNtOnbs+NjatWtHnnHGGdQmAuF3rjYRJGqUX6s4NEnuEE1Jfuy/n3322QBqlktbtmx5c9y4caehbx3g2sG1gTsIriUctY2aRi2rD/efMywnT57cLZFIVLhg0R8Oh7974403rgYYh8F1hCNwbeFawx0A1wyOGqi57Cc/jwWXL19egUm+FJ020RfH4CdMrykuLm57+umnT1i4cOH1xx9/POerOhQ7zl0ptUqS/2SHZah58+aNzz777LMKCwtbRv9vvIm996wJHX6KCdRvbAKBQEGLFi26nnPOOR0ikciijz76qAJgcC4iICTNS+QiyRimP5nmDJPctCnJj+W3ZcuW7TBHvWWH3t9/kyy/5tBkxfVdkrFPp1cbmVgISiZNmjQC/ToG7kg4Ds/2cJzL/MPyJzmPBbH6JTA/bUCHTbD5wWQmGS4zkUdHmOi/RhuTiFtZvXr12lx00UVj3nvvveGtW7duCKE7LLVqarWUOfGTGpZ2foHWrCUigTRYFh38RGf8jwmPv9Akt6yzolAoVP+UU0753TvvvDNyyJAh1CgBRi7ANJcJMNYhpyEoznJdP8P7LFmwNm/e/D1amPCDxVYnvvnEhP98jokv+sDrRIcOHX7xxBNPPPjkk0/2glCAafIXWH4tE2C2TuRzQXL9Xj37mocNN2vWrFkH8yEabE5zakdKlm0ykfsvNdHXJmKMcr6GgVW/frsLLrjgz2+++eaQZs2a0d4SaNIwguUH7Ec9LNn4xm3btg327t17cLBew+Lo6w97gCDOoaRJLJ5jEt99YUKde5lAUR1a/UXQsu5Dhw5tDRNk4eLFi2l3UEtcpzL82uOGs/mVd5/gBKsR5qzkZZddNqygsLBBbO4UYyq2Zm1cckOJic97xYQ6HGsCTWjQA+3GjTtii3RUkyZNlr/11lubIBJYjJZfgIgzjuQPZ5PZxHvzh8Mw+dVXX0WqqqrWsyFaEXfWqCSmuPC4YSY2+2kvGey1n994440TXn/99XNhs9F04LB0h2a+w1JlZgJRcXuFW7AAVALatZItyDTJZ2xZPGaqnrvbRB77LUyNcpsEIDU688wzb/3iiy9uOO2007iH9AOmyZ8rZbbVkiAJKNdv69ibPxYsNCC5devWNFiZJ/lsjYx/8qqJjB5oEmuW2CSw+gOHH374ec8///xfbr/99s4QCjByd/IXYDsDTdUKPIX3CvfA2rhxowUrn2Hob2li3XITHjPYxOZO9aIwLI+99dZbJ+AE9hwINRxlXpDvTMukUS5Irt+rZ096PLDWrVtn56y8h6G/lVWVpmrSTabqn7cZE6uysXXq1GnWr1+/2z7//PMR2JRzS+SCJrBc84JaxjbJ+UFT2Ja/p39CqJBHLKFevXo1PfbYY38RLK5TGHvj0Vq3I7HiSxP/6u3UZrxeI27GA9h/dgFonXG6sXjOnDnbULg6La76GCaJ+/020hcv2W7nnmatWLFiM87itwTYQbh/hxIrvjLheweY+Py3vGJwenHcPffcMw5W/2kQah7TsNRcpnmMD5GO7ROg4hBZcgGVbLdyNojWN0yswuB5553Xt6ioaP/4p69hxrejsvaVxyIm/sk0Y6rCJnTYSehy0KDs/Y466qjeOPIpnD179iLMkwlUIBDEWacLhOtXeyRz8yhut3E+OVJy1qxZZdAsa43Wet5KlbX9F1ujKIZ0+G/DAb492KDVX3jcccddgc34mN///vedkDiTlrk2mbRMmuZqm+oSeArvFu4NQ5SexAEfre+8DNOatCaxdB6GJTbjS+Z62Q444IBud99997innnpKm/GdTf6ZgPJr1W4HzAUrgdOHEvYm0CJ1ruX1bBd4kttKTWTCxSY6/b/xWLzN+MEXXnjhaEz6lzZt2lSb8Uyg5TuX+QHcBS3fXoQLVnLDhg0rGRXIcvqwPVstfThIjE4dayITrzLJ9P4Tw7L4xBNPHIGXvHdcfPHFbVGyOyw18cvMkAHrahr7QHI1y/WnYnfBbzWwVq1atQZnyYnaGKY1aUv8y9kYlv1NomSBl61du3Z977///vGPP/54Dwhd7XINWNlkBEuAERj2w69VuxywamDNnTt3FSqNB5oeiOrZlt1HyY2rTXgsNuPvPONVst9++x0yfPjwUR9++OEl8GtYuuaFO/H7tUxgibNc1+/VU1sPEeFTJC/AUUsRzqbOgR3RMDbnXziqof24GwnDMv7lLJNc/50JHdGTBoxdLXFR5YTBgwc3w6Hksq+//roSLVCnxdUohl1yw9n8bvoa+TXeOeMm169fH8HLizUsIdupaY1KzzNxbN7L2FsOMom133g5cJVgIIbkfRMnToSRVm0e07B05zFpGfsjlwtYr658PdWGIV6ohisqKtYy826b5LO0LPH9MhMePcgeLCoJhmKnyy+/fBTOyAbVrVuXN3jcuUxgaR4TYO5ctksBqwYW7KzEDz/8sJqN3R3mg0DIyiMVJvL470zVs3dhMx61yWD1N+7Tp89IbMZvwarJKwMELBNoBEuASbvIBRg5SeFUqAa/1cBCvuSmTZvSw3DX21r5tiv29j/s5J/cZJ+bzdapU6dBr7766t/uu+++rhC4gFHDpGUCbGegqRkCT+GcnGCROGdxn0awSmk+7LItD0uvBSVK5lvzgmaGCIbr0ddcc80ogNYfMgGWS8t22bCUZrE9dpLHClTKWzV7GyzboPKt1oCNvnSf92YcZ2TN+/bt+8dFixbd1LVr16Zp0HKZF+ynnIahNEthVrlTIupUYWs6kHfu3Lluz549zy6oW79BbOYk7yAPcXuNEsvmmcSyj9G4niZQXM+ekeEktjMutHTCcdmyDz74gDaOOi2u9rqg+GUKkyudK6vmF1hEnf5QWVkZX4sNxJFNk9RRTeq0oFquvRBIblyFlfIlE2r3c2ONZrShYcOGB3fv3v0UnGJswpl/CUQCSh3Pxf09UXq/3IY1DO0QhCSJVacSb3s2M3ZfGIq2lekfHvOE77vIRN98zBPjwsqBAwYMuAtmzw0Yllot3WGpyZ8mhlUI8ExDUkCRy+/VQw8zsxBPs+AvuO66607GUzssiSPixDefQrQPEU4sEl+/bxKrvk69GS8s5rAM4ST2KAzLQ2H+LME9sh/QYnVanJ1wQcgmV2fdtFZGkESedsHWWkPhnjZM1ZB8ePyLGanN+MqFXvJWrVp1HzNmzP0Ykn0g1Grpt/ipHDItqCzEQMCJQ2SpGmBM6IGU9iew7VnBpPvaMGSbXEqWrjThvw41sfef98Qclueee+6dOBS4HLYZXya4oAk4AuYOy52B5gGYcRji3kITnJUPYKrYrKe8huyTHm7G5880XABCR3THxFLIYVmAC3fH9+/fvw32uss+/vjjMrTd67TjdzXHH08lqhZPsKSS1DIbxiux+lhlhgTqNAhFX38Eusd8+zYlVi0y8QUz8XLkZBNowI9EcOOlUaMOPXr0OAbArXzttdf4BkaAiDOZCwjDoh3kBIgkNOyQxCFgGVbEjSZU4N2USSXbt38TqxdjMz7Q0OQRAbBOv/71r8dj0r88fXStlVJDUqultkpUGDpiI1AtV4QiyQuwEhbgXKsPrnfvn0irOOQ/DsIG3NqHldtM6Gfd0OWgPSPjsDz//PPbYDu3GBdXdOvaBSNn/yw4SEUUvWG4bdu2IJ7GaZgs2/GaJF+a/tgosfwLE4eJETqihwnU5X1hOywPOfXUU7tg1SzBsY//xahGV9auEiA79FwO9GOYGO2HBPv6ipi1Z4hILP88tRlf+K6XDBfujhgxYsQE3Lq+EEIOQQ3DnCYFwfITweN9LYv87n554a98V4eTZZtN5MErTPSV+6EWPFjBPFNQwFvXN3777bcjMd3wwormKy12HHF0xEdD1QYQ3lG7SktLV0G+149q2Lh/mwBSdNoDJvLAZYaXiUXt27cf/Oijj47D0fVRkAkocoLkOgsYBRqr1YbjahCOaiL7shWPtteIOIfZV3Dfbt/CYbU85oorrpg4b968IShM2iTuahZua6RoB8AWLFjwPcCqCtTHrZr0BFmjlu2jiZOb19oPIdxXcDhhaY5N+D3Qjz/icJEfo2roudwKZfZT/ein/VGHW4X58+e/QfPBPg1nD4b4PUt4hxkoxmvEOvXteZaBPwC/4dkWXEqeik/J3LRIY9MyL+XMA57lvSiOqN6bOXPm3bD+P0cnY2kXB48ToGrDT2F8AhzGDn4NwbIr4h4AK9D4AFN8JSZiCwbu2AkMnCzUlPAZcxSOt7Ar+UEEqDJWFQvHK8sq4/GtlbhYx08H6XhwWI6+boZ/K64TVEDTiMsOlEnogYfXYqvxOqoLV0RCu7uJ3wgl8MK14KRBtio0PoYv1jYnk9vojaPDYfxbQAU6Vo62lWHFroAmlMFfCVaOj7a2godh+lQiTRTyKC4WhwFYHOVEcJpShbgwZLzHSa3hKyRx+iknpyNperKBrJrFhDBOv8cVxz16VBOdMtaEuvSxQwcaEb/zzjufx6d73wCYCNqkYeFyO0QQR7vAdXro9kWME6f05G459Cs/8yqfyvFMB8RVG442IW7mrWDEnnyHmNy2wcRefZDV8qZgMY64TwJQfNLqnDSA4NGF4fiKn1uYTI5xrmN65XU1ScAJTIHkcf9qiHK2g/Y9iII9bZhGZz1p7z+w7i6gO+6443B4/WCxowKLALigZQJPgCltNsAEFnk17RJYkG8HKe1PYA7YgkmyItC0ddbVgxnzIpxgFA66Ja+kfBtdNfnPNi0m3NDVV199FjbCnDIEGLWAYAkwgSZAqGHyu1xAiSs/uTSLXEC5w9IOQ6qZSH6reiUlJfYGsz2qadxSaWrFC3/5W1N4xhUmdMyZeeXny1VeESdh49vu3nvvPQFeNt4FzD8kpS0EwwVJfoGkdOQEiuXQuUCxHm8I0i/NkhCy7Qnwnw9buSBR+O8MxeChXU1hn6tYjCk69w+w5vIzBax24Rsh0qBBg/rjzkNTeNnWbKBJU1wwsvmZ1gVKYLmAuZrlgYV8lqqB9vbbb/MQ0IJV20kep62m+JKxWCWCBkM6VtWgeWXh6Zervp3yJD5zic6cZNM0aNCgKT5v6Y1PjxkWYAJN2iYNIRcY0h4BKbmbln6CJKDcYShMsoJlEwAofmxuTx9qu0csHHaHCTRrjXYYg5cI82AGvFTY95q8T2Bjrz4EG8aeFhmcFPTDZ3qH2sJSP+qIHzR1XCAIGMpdmdIRHDlpE7nKJ/fmLAkpIymcgDFnzYfaDMPQsf1MwYkDbIEwCLfiKveMG2644cNV6zd+WzTwFivP9cN/AohO/atNhqOVupjsB+HVPbdl3LeJvPZC4AInjRMoLhc44i5IAkqc9excs5gA1m7qELCG1725dSm68B5WYmBcJp555pmXp0+fvho2U+WECRNeTB7Ttyp4yHE2PtdPbM4UXNadb5Phou4JY8eO7YYA51u6aptdmyj1sN3OExCGXZ4NJAGkByBuK0uXb7WJfkVajgOy5akrSG2ULjcPBEzRr8Z43wDhBGMeNOo9ZLTzBsD6El/Pzi0aepudy3IWiLdLVc8BeHC+fcbnLENgfu2HfJzA6Fzg3OLcvrjgUe6G5XfT0y+yclZCUoTLbQIcv64CWDiqwd+tYLLOhwpOHW6/CmNaaOYGTMxTsGfj8m3B4h5v9OjRU6r2P2RrQbfB+RRpj4j1PSOOhg99+OGHmZG2F8EiZ18EnLQNouoPPx0mOLZ/eXIkS1VgPc5PtUKWLl1ajlWMdwfyekMdbHmIKRp4s4pLTpky5SW8s1sFAVcl2jl2KX/22WeXv//++y8XDrgh7/Myzl36xPjoo4/uiyPhA1Ee5y+CJeD82qahiiQeufOdJ8zlkWYxnQuSF4YVX4XdOzube48IK73o0nGeHYXzsA/wlmg2slqNAhdg1jiExr2yLR4qKfzFdYjKTbxFE3vtIZsQb56a33XXXb9CgGC5zgVNQEnTagWSWuaCJRm5Bxy+Q4zgWGQNhbmue7PTwTadmdTgxKIUnZkC08PTJohlQVuOo9wN+JRucqjXRYlgyw42X64f2l38uwQSrn+filMJnp/739D4AfODxuw1Bo6FEBiSB5Drx5IfxwdQK5lgZ6/Fgh2OgZV+NZNhHk5y9XvuxRdfXIGgtKoaUJDbMF5Lvb6udOO8wiF/ZNbc5OwbYaDWufLKKy/GCsnJ1A+YhqPmMQGWu44sKVgASYClQj7gANhaRmQFq7iuKb4EtlD6qBbz3KcYYh8gi4Cy8xTC4gTK+nHuXfbyyy8/E/jZKVWho3tDnJviC2Zh3/iOTXjggQd2HTVqVE8ENHeJU7vYPzl3KNZYq1gZC3JJ2kUZ/XbVwLmWfX+UzTAtGvRfmM/a2nIAbOnIkSP/F9qo1c8PmIASj1x11VUfLlu2bFrR4D9gmmZfc1N08p9gNdHGNOass866CG5/eF2gpFnsowsUs4hqBJofLBayA2CY5NdjRSyzRzXeC6FUfXw9XtDzAhuA7RmbOnXqC6AVELggZfK7sgi+CHs62qjVxsLel6YKzvHLv0fguRcJR98H33zzzX3gpTbJCSx3GDJ5jQBiBpELFkESCTDLcY26FKcPZXzq+v8ZJuSH50XDRymPgXZ8fO21186CgPsvgiHHISd/Rv7QQw8tx4WN5wr6XWsCjVogeW6KTXvQ2zeefPLJQ7Fv7IhcmUDya1etAHPBYusEkutP4m+fSqlZFLpD0W6Ssa0h4QXBNnz98ELa+MwFjsAk9xy0Y3J5LPlt4YAbbZm5flL7xrE2GY6gG+Gd3xB848OhyH5JowiM62z6tEz+vLgfLGUSaJbjXKsSVnfqqCb97208xCs4/mybHqtf8pVXXvnnI488sgSCTJrjAYJ4+TnhyG85zIhNuN0yMXTCgFiw/c9t2bl+YnNe9PaN7du3Px2v4rsijzSJXP5MgOUqvlp8PmBxkudRzWrm5IoYaNDUFJ1/t1fQypUr511//fVvQOAHqhoYiHd3/a5f6apgxL69obT046Kht6OyPEYL5tDEioW2LfyyH9e8r8IHUXiL6mkT4/wF+cM2f64fgVVNk9KZXBmPakooD7ZoA6DuMoGGvHIOYykc3oil+zHeFkQw0/AjEC4w2u2LK86mw4WUMGy0h5MHdy4vOHEgq8hKwVaHmjo3P28KegyzaWjf4VTj+yOPPFKbWPZBVCuAlJmcK0cmqgYUEiSwIU5pVrODTLB9Fy8PNtocft9AoE672iWNYZzAseYIwmy8OsOHxjRMH7rpppvm4/X5jLYDb+wf/3y6tx9EXIpgz/E8v/CXv0EPaIsawxt9M2bMeBZf80/HYkSzhfWI1B+Fa8WlWW5mdYAy+u0wxB/7rOR1HV50FcH++gx/xzkV4Xw1ypalMsEFoMC0gGF+jIwfP/7vkaKGawv6jVB1lgdbdbTaZBcBAAVNKsXx99PdunW7Gf948haAUlluXW6fqpVXk4AfLBVK7gEFfxz/6bc2vmB2vKD7ebZ8rI7l+Cz3bwCxHAJpk0CTRpELEHK3A34/O2nBAo8+8MADJdiIP13Y+5KkNXipTTiOrvOHqSbY9mgDTCpgakzD3xvcgquP/8D/DW5L5xdYbn3qj8uRvPbEYUHwODT5+oWTJC/dN4dr9cLvhp4d2bSef2VgCR0ZDznHIx2Xrs5wh8EdAtcGrhUcJzYe0uGqiy2TyzrL57JOzjDrYjzTMT3ztYXrdNJJJ52IufJT/NNIMv7dfFWdxIIy97bbbrseafrAnQ7XC64b3HFwR8J1gmMZbhvYH9bFOl2zAsH8iA3ORHoCevrxf60NLT2rTgO+vGiFLc1Hw4YNexp+ahSJ6aRB1CZpiPt0mUblkoso54NSGczLhxbEP4lswd8WTML3hXwgAdS7FPPSM9g8v4spgOlYDutQfWyPtJqybPUjquaUCSx1hI1no1lh4N133/0B2xncaEmW40DvHnyF9QPlcEzPtHRsoBrJfHKMYzrXIegR42094CyTzhLmxDfxhcTTWHUj2Jy/gO3UFkQonuWpDj0kAea2xa2f5aod9OdNqlQZCA5l9smCU101ZEJYER9CozfgT3fGpNOAeRWr0eIuaGysv8HMy7r89fEB0mnIilOm9qjdKpd1ChxyAScZ0zGN2wYCRhJPhXby69csZmRDhDy5KjJ4nf8CzqgWQMbGqKNKq8YILHUkUwOR3RLzklSGV1dKvIOcYKle5VMe1SuAFFY7VIfqTFeRP9MTUg41JJOGSdvElVeNUKPUeDesNGooufKrTnKWTUDEPa1Oy1Q3gpZUruoUQOLZ2uC2Q2Xl5H7NUga3MPpZuRpGzka4JJm4GunmoZ/kcgKksOLcspWf9Qsogaz0TKP6XK42U6ZyxJm3xpQPWKxMDVTDGHZlaoTiFXYbysZRno2Ul/HKL06gVKfqVTnKJ646/Vzluvnkz4v7K1bYbVgmv79wdSoTZ1rKSeKpUOrXXyelfnDcsJuXfrdOAeTKVKe48vjLyRlWQ5VQ4UycMr+c+dQIl9Pvht109PvJX67qcjnzKJ2b31+Xwv76mUcyN3/e/kyVSybOwuj3h1WJ2wD5s3Hl8fNMZUvm5/68DLO+XHUqPlP+vGRqiJvYL3PDrt/NQ7/bGNfvj/PnU9hftht2/Urvcrc+1880/rCbr0b+bI3IJM8k81eWqWGZZP58Cu+sjmxx2crPJlddNeb/D/KyIM/aYvSmAAAAAElFTkSuQmCC';\nconst mouseLoading = 'data:image/png;base64,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';\nexport { filterBase64Value, fullTimeStrWithMilliseconds, mouseLoading, mousePointer, timeStr };\n","\"use client\";\nimport { mousePointer } from \"./index.mjs\";\nimport { paramStr, typeStr } from \"@midscene/core/agent\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction replay_scripts_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else replay_scripts_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst stillDuration = 900;\nconst actionSpinningPointerDuration = 300;\nconst stillAfterInsightDuration = 300;\nconst locateDuration = 800;\nconst actionDuration = 500;\nconst clearInsightDuration = 200;\nconst lastFrameDuration = 200;\nconst cameraStateForRect = (rect, imageWidth, imageHeight)=>{\n    const canvasRatio = imageWidth / imageHeight;\n    const rectRatio = rect.width / rect.height;\n    let rectWidthOnPage;\n    rectWidthOnPage = rectRatio >= canvasRatio ? rect.width : rect.height / imageHeight * imageWidth;\n    const cameraPaddingRatio = rectWidthOnPage > 400 ? 0.1 : rectWidthOnPage > 50 ? 0.2 : 0.3;\n    const cameraWidth = Math.min(imageWidth, rectWidthOnPage + imageWidth * cameraPaddingRatio * 2);\n    const cameraHeight = imageHeight / imageWidth * cameraWidth;\n    let left = Math.min(rect.left - imageWidth * cameraPaddingRatio, imageWidth - cameraWidth);\n    left = Math.max(left, 0);\n    let top = Math.min(rect.top - imageHeight * cameraPaddingRatio, imageHeight - cameraHeight);\n    top = Math.max(top, 0);\n    return {\n        left: Math.round(left),\n        top: Math.round(top),\n        width: Math.round(cameraWidth)\n    };\n};\nconst mergeTwoCameraState = (cameraState1, cameraState2)=>{\n    const newLeft = Math.min(cameraState1.left, cameraState2.left);\n    const newTop = Math.min(cameraState1.top, cameraState2.top);\n    const newRight = Math.max(cameraState1.left + cameraState1.width, cameraState2.left + cameraState2.width);\n    const newWidth = newRight - newLeft;\n    return {\n        left: newLeft,\n        top: newTop,\n        width: newWidth\n    };\n};\nconst allScriptsFromDump = (dump)=>{\n    var _normalizedDump_executions, _normalizedDump_executions1, _normalizedDump_modelBriefs;\n    if (!dump) {\n        console.warn('[allScriptsFromDump] dump is empty');\n        return {\n            scripts: [],\n            modelBriefs: []\n        };\n    }\n    const normalizedDump = Array.isArray(dump.executions) ? dump : {\n        sdkVersion: '',\n        groupName: 'Execution',\n        modelBriefs: [],\n        executions: [\n            dump\n        ]\n    };\n    const dimensionsSet = new Set();\n    let firstWidth;\n    let firstHeight;\n    const sdkVersion = normalizedDump.sdkVersion;\n    const modelBriefsSet = new Set();\n    null == (_normalizedDump_executions = normalizedDump.executions) || _normalizedDump_executions.filter(Boolean).forEach((execution)=>{\n        execution.tasks.forEach((task)=>{\n            var _task_uiContext_size, _task_uiContext;\n            if (null == (_task_uiContext = task.uiContext) ? void 0 : null == (_task_uiContext_size = _task_uiContext.size) ? void 0 : _task_uiContext_size.width) {\n                const w = task.uiContext.size.width;\n                const h = task.uiContext.size.height;\n                if (!firstWidth) {\n                    firstWidth = w;\n                    firstHeight = h;\n                }\n                dimensionsSet.add(`${w}x${h}`);\n            }\n        });\n    });\n    if (!firstWidth || !firstHeight) {\n        console.warn('width or height is missing in dump file');\n        return {\n            scripts: [],\n            sdkVersion,\n            modelBriefs: []\n        };\n    }\n    const allScripts = [];\n    null == (_normalizedDump_executions1 = normalizedDump.executions) || _normalizedDump_executions1.filter(Boolean).forEach((execution)=>{\n        const scripts = generateAnimationScripts(execution, -1, firstWidth, firstHeight);\n        if (scripts) allScripts.push(...scripts);\n        execution.tasks.forEach((task)=>{\n            if (task.usage) {\n                const { model_name, model_description, intent } = task.usage;\n                if (intent && model_name) modelBriefsSet.add(model_description ? `${intent}/${model_name}(${model_description})` : `${intent}/${model_name}`);\n            }\n        });\n    });\n    const allScriptsWithoutIntermediateDoneFrame = allScripts.filter((script, index)=>{\n        if (index !== allScripts.length - 1 && 'Done' === script.title) return false;\n        return true;\n    });\n    const normalizedModelBriefs = (null == (_normalizedDump_modelBriefs = normalizedDump.modelBriefs) ? void 0 : _normalizedDump_modelBriefs.length) ? normalizedDump.modelBriefs : [];\n    const modelBriefs = (()=>{\n        var _list_;\n        const list = normalizedModelBriefs.length ? normalizedModelBriefs : [\n            ...modelBriefsSet\n        ];\n        if (!list.length) return list;\n        const firstOneInfo = null == (_list_ = list[0]) ? void 0 : _list_.split('/', 2)[1];\n        if (firstOneInfo && list.slice(1).every((item)=>(null == item ? void 0 : item.split('/', 2)[1]) === firstOneInfo)) return [\n            firstOneInfo\n        ];\n        return list;\n    })();\n    return {\n        scripts: allScriptsWithoutIntermediateDoneFrame,\n        width: firstWidth,\n        height: firstHeight,\n        sdkVersion,\n        modelBriefs\n    };\n};\nconst generateAnimationScripts = (execution, task, imageWidth, imageHeight)=>{\n    if (!execution || !execution.tasks.length) return null;\n    if (0 === imageWidth || 0 === imageHeight) return null;\n    let tasksIncluded = [];\n    if (-1 === task) tasksIncluded = execution.tasks;\n    else {\n        const startIndex = execution.tasks.findIndex((t)=>t === task);\n        if (-1 === startIndex) {\n            console.error(\"task not found, cannot generate animation scripts\");\n            return null;\n        }\n        if (startIndex === execution.tasks.length - 1) return null;\n        for(let i = startIndex; i < execution.tasks.length; i++){\n            if (i > startIndex && 'Planning' === execution.tasks[i].type) break;\n            tasksIncluded.push(execution.tasks[i]);\n        }\n    }\n    if (0 === tasksIncluded.length) return null;\n    const fullPageCameraState = cameraStateForRect({\n        left: 0,\n        top: 0,\n        width: imageWidth,\n        height: imageHeight\n    }, imageWidth, imageHeight);\n    const setPointerScript = (img, title, subTitle)=>({\n            type: 'pointer',\n            img,\n            duration: 0,\n            title,\n            subTitle\n        });\n    const scripts = [];\n    let insightCameraState;\n    let insightOnTop = false;\n    tasksIncluded.length;\n    let initSubTitle = '';\n    let errorStateFlag = false;\n    tasksIncluded.forEach((task, index)=>{\n        if (errorStateFlag) return;\n        if (0 === index) initSubTitle = paramStr(task);\n        if ('Planning' === task.type) {\n            var _task_output;\n            let locateElements = [];\n            if ('Plan' === task.subType) {\n                var _planTask_output;\n                const planTask = task;\n                const actions = (null == (_planTask_output = planTask.output) ? void 0 : _planTask_output.actions) || [];\n                if (actions.length > 0) {\n                    const action = actions[0];\n                    const knownFields = [\n                        'locate',\n                        'start',\n                        'end'\n                    ];\n                    if (action.param) {\n                        knownFields.forEach((field)=>{\n                            if (action.param[field] && 'object' == typeof action.param[field] && 'center' in (action.param[field] || {})) locateElements.push(action.param[field]);\n                        });\n                        for(const key in action.param)if (!knownFields.includes(key)) {\n                            if ('object' == typeof action.param[key] && 'center' in (action.param[key] || {})) locateElements.push(action.param[key]);\n                        }\n                    }\n                }\n            } else if ('Locate' === task.subType && (null == (_task_output = task.output) ? void 0 : _task_output.element)) {\n                const locateTask = task;\n                locateElements = [\n                    locateTask.output.element\n                ];\n            }\n            const title = typeStr(task);\n            const subTitle = paramStr(task);\n            const context = task.uiContext;\n            if (null == context ? void 0 : context.screenshotBase64) {\n                var _context_size, _context_size1;\n                const width = (null == (_context_size = context.size) ? void 0 : _context_size.width) || imageWidth;\n                const height = (null == (_context_size1 = context.size) ? void 0 : _context_size1.height) || imageHeight;\n                scripts.push({\n                    type: 'img',\n                    img: context.screenshotBase64,\n                    duration: stillAfterInsightDuration,\n                    title,\n                    subTitle,\n                    imageWidth: width,\n                    imageHeight: height\n                });\n                locateElements.forEach((element)=>{\n                    var _task_log_taskInfo, _task_log, _context_size, _context_size1;\n                    insightCameraState = _object_spread_props(_object_spread({}, cameraStateForRect(element.rect, width, height)), {\n                        pointerLeft: element.center[0],\n                        pointerTop: element.center[1]\n                    });\n                    const newCameraState = insightCameraState;\n                    scripts.push({\n                        type: 'insight',\n                        img: context.screenshotBase64,\n                        context: context,\n                        camera: newCameraState,\n                        highlightElement: element,\n                        searchArea: null == (_task_log = task.log) ? void 0 : null == (_task_log_taskInfo = _task_log.taskInfo) ? void 0 : _task_log_taskInfo.searchArea,\n                        duration: 0.5 * locateDuration,\n                        insightCameraDuration: locateDuration,\n                        title,\n                        subTitle: element.description || subTitle,\n                        imageWidth: (null == (_context_size = context.size) ? void 0 : _context_size.width) || imageWidth,\n                        imageHeight: (null == (_context_size1 = context.size) ? void 0 : _context_size1.height) || imageHeight\n                    });\n                    insightOnTop = true;\n                });\n            }\n            const planningTask = task;\n            if (planningTask.recorder && planningTask.recorder.length > 0) {\n                var _planningTask_recorder_, _planningTask_recorder, _task_uiContext_size, _task_uiContext, _task_uiContext_size1, _task_uiContext1;\n                scripts.push({\n                    type: 'img',\n                    img: null == (_planningTask_recorder = planningTask.recorder) ? void 0 : null == (_planningTask_recorder_ = _planningTask_recorder[0]) ? void 0 : _planningTask_recorder_.screenshot,\n                    duration: stillDuration,\n                    title: typeStr(task),\n                    subTitle: paramStr(task),\n                    imageWidth: (null == (_task_uiContext = task.uiContext) ? void 0 : null == (_task_uiContext_size = _task_uiContext.size) ? void 0 : _task_uiContext_size.width) || imageWidth,\n                    imageHeight: (null == (_task_uiContext1 = task.uiContext) ? void 0 : null == (_task_uiContext_size1 = _task_uiContext1.size) ? void 0 : _task_uiContext_size1.height) || imageHeight\n                });\n            }\n        } else if ('Action Space' === task.type) {\n            var _task_recorder_, _task_recorder, _task_uiContext_size2, _task_uiContext2, _task_uiContext_size3, _task_uiContext3;\n            const title = typeStr(task);\n            const subTitle = paramStr(task);\n            scripts.push({\n                type: 'spinning-pointer',\n                duration: actionSpinningPointerDuration,\n                title,\n                subTitle\n            });\n            if (insightOnTop) {\n                scripts.push({\n                    type: 'clear-insight',\n                    duration: clearInsightDuration,\n                    title,\n                    subTitle\n                });\n                insightOnTop = false;\n            }\n            scripts.push(setPointerScript(mousePointer, title, subTitle));\n            scripts.push({\n                type: 'img',\n                img: null == (_task_recorder = task.recorder) ? void 0 : null == (_task_recorder_ = _task_recorder[0]) ? void 0 : _task_recorder_.screenshot,\n                duration: actionDuration,\n                camera: 'Sleep' === task.subType ? fullPageCameraState : void 0,\n                title,\n                subTitle,\n                imageWidth: (null == (_task_uiContext2 = task.uiContext) ? void 0 : null == (_task_uiContext_size2 = _task_uiContext2.size) ? void 0 : _task_uiContext_size2.width) || imageWidth,\n                imageHeight: (null == (_task_uiContext3 = task.uiContext) ? void 0 : null == (_task_uiContext_size3 = _task_uiContext3.size) ? void 0 : _task_uiContext_size3.height) || imageHeight\n            });\n        } else {\n            var _task_recorder_1, _task_recorder1;\n            const title = typeStr(task);\n            const subTitle = paramStr(task);\n            const screenshot = null == (_task_recorder1 = task.recorder) ? void 0 : null == (_task_recorder_1 = _task_recorder1[task.recorder.length - 1]) ? void 0 : _task_recorder_1.screenshot;\n            if (screenshot) {\n                var _task_uiContext_size4, _task_uiContext4, _task_uiContext_size5, _task_uiContext5;\n                scripts.push({\n                    type: 'img',\n                    img: screenshot,\n                    duration: stillDuration,\n                    camera: fullPageCameraState,\n                    title,\n                    subTitle,\n                    imageWidth: (null == (_task_uiContext4 = task.uiContext) ? void 0 : null == (_task_uiContext_size4 = _task_uiContext4.size) ? void 0 : _task_uiContext_size4.width) || imageWidth,\n                    imageHeight: (null == (_task_uiContext5 = task.uiContext) ? void 0 : null == (_task_uiContext_size5 = _task_uiContext5.size) ? void 0 : _task_uiContext_size5.height) || imageHeight\n                });\n            }\n        }\n        if ('finished' !== task.status) {\n            var _task_uiContext_size6, _task_uiContext6, _task_uiContext_size7, _task_uiContext7;\n            errorStateFlag = true;\n            const errorTitle = typeStr(task);\n            const errorMsg = task.errorMessage || 'unknown error';\n            const errorSubTitle = errorMsg.indexOf('NOT_IMPLEMENTED_AS_DESIGNED') > 0 ? 'Further actions cannot be performed in the current environment' : errorMsg;\n            scripts.push({\n                type: 'img',\n                img: task.recorder && task.recorder.length > 0 ? task.recorder[task.recorder.length - 1].screenshot : '',\n                camera: fullPageCameraState,\n                duration: stillDuration,\n                title: errorTitle,\n                subTitle: errorSubTitle,\n                imageWidth: (null == (_task_uiContext6 = task.uiContext) ? void 0 : null == (_task_uiContext_size6 = _task_uiContext6.size) ? void 0 : _task_uiContext_size6.width) || imageWidth,\n                imageHeight: (null == (_task_uiContext7 = task.uiContext) ? void 0 : null == (_task_uiContext_size7 = _task_uiContext7.size) ? void 0 : _task_uiContext_size7.height) || imageHeight\n            });\n            return;\n        }\n    });\n    if (!errorStateFlag) scripts.push({\n        title: 'Done',\n        subTitle: initSubTitle,\n        type: 'img',\n        duration: lastFrameDuration,\n        camera: fullPageCameraState\n    });\n    return scripts;\n};\nexport { allScriptsFromDump, cameraStateForRect, generateAnimationScripts, mergeTwoCameraState };\n","import { paramStr, typeStr } from \"@midscene/core/agent\";\nimport { useCallback } from \"react\";\nimport { useEnvConfig } from \"../store/store.mjs\";\nimport { BLANK_RESULT } from \"../utils/constants.mjs\";\nimport { allScriptsFromDump } from \"../utils/replay-scripts.mjs\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction usePlaygroundExecution_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else usePlaygroundExecution_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nfunction formatError(error) {\n    var _error_dump;\n    if (!error) return '';\n    if ('string' == typeof error) return error;\n    if (null == error ? void 0 : null == (_error_dump = error.dump) ? void 0 : _error_dump.error) return error.dump.error;\n    if (error.message) return String(error.message);\n    try {\n        return JSON.stringify(error);\n    } catch (e) {\n        return String(error);\n    }\n}\nfunction buildProgressContent(task) {\n    const action = typeStr(task);\n    const description = paramStr(task);\n    return description ? `${action} - ${description}` : action;\n}\nfunction wrapExecutionDumpForReplay(dump) {\n    const modelBriefsSet = new Set();\n    if ((null == dump ? void 0 : dump.tasks) && Array.isArray(dump.tasks)) dump.tasks.forEach((task)=>{\n        if (task.usage) {\n            const { model_name, model_description, intent } = task.usage;\n            if (intent && model_name) modelBriefsSet.add(model_description ? `${intent}/${model_name}(${model_description})` : `${intent}/${model_name}`);\n        }\n    });\n    else console.warn('[wrapExecutionDumpForReplay] Invalid dump structure:', dump);\n    const modelBriefs = [\n        ...modelBriefsSet\n    ];\n    return {\n        sdkVersion: '',\n        groupName: 'Playground Execution',\n        modelBriefs,\n        executions: [\n            dump\n        ]\n    };\n}\nfunction usePlaygroundExecution(playgroundSDK, storage, actionSpace, loading, setLoading, setInfoList, replayCounter, setReplayCounter, verticalMode, currentRunningIdRef, interruptedFlagRef) {\n    const { deepThink, screenshotIncluded, domIncluded } = useEnvConfig();\n    const handleRun = useCallback((value)=>_async_to_generator(function*() {\n            if (!playgroundSDK) return void console.warn('PlaygroundSDK is not available');\n            const thisRunningId = Date.now();\n            const actionType = value.type;\n            const displayContent = `${value.type}: ${value.prompt || JSON.stringify(value.params)}`;\n            const userItem = {\n                id: `user-${Date.now()}`,\n                type: 'user',\n                content: displayContent,\n                timestamp: new Date()\n            };\n            setInfoList((prev)=>[\n                    ...prev,\n                    userItem\n                ]);\n            setLoading(true);\n            const result = _object_spread({}, BLANK_RESULT);\n            const systemItem = {\n                id: `system-${thisRunningId}`,\n                type: 'system',\n                content: '',\n                timestamp: new Date(),\n                loading: true,\n                loadingProgressText: ''\n            };\n            setInfoList((prev)=>[\n                    ...prev,\n                    systemItem\n                ]);\n            try {\n                currentRunningIdRef.current = thisRunningId;\n                interruptedFlagRef.current[thisRunningId] = false;\n                if (playgroundSDK.onDumpUpdate) playgroundSDK.onDumpUpdate((_, executionDump)=>{\n                    var _executionDump_tasks;\n                    if (interruptedFlagRef.current[thisRunningId] || !(null == executionDump ? void 0 : null == (_executionDump_tasks = executionDump.tasks) ? void 0 : _executionDump_tasks.length)) return;\n                    const progressItems = executionDump.tasks.map((task, index)=>{\n                        var _task_timing;\n                        return {\n                            id: `progress-${thisRunningId}-task-${index}`,\n                            type: 'progress',\n                            content: buildProgressContent(task),\n                            timestamp: new Date((null == (_task_timing = task.timing) ? void 0 : _task_timing.start) || Date.now()),\n                            result: task.error ? {\n                                error: formatError(task.error),\n                                result: null\n                            } : void 0\n                        };\n                    });\n                    setInfoList((prev)=>{\n                        const systemItemIndex = prev.findIndex((item)=>item.id === `system-${thisRunningId}`);\n                        if (-1 === systemItemIndex) return prev;\n                        const listWithoutCurrentProgress = prev.filter((item)=>!('progress' === item.type && item.id.startsWith(`progress-${thisRunningId}-`)));\n                        return [\n                            ...listWithoutCurrentProgress.slice(0, systemItemIndex + 1),\n                            ...progressItems,\n                            ...listWithoutCurrentProgress.slice(systemItemIndex + 1)\n                        ];\n                    });\n                });\n                result.result = yield playgroundSDK.executeAction(actionType, value, {\n                    requestId: thisRunningId.toString(),\n                    deepThink,\n                    screenshotIncluded,\n                    domIncluded\n                });\n                if ('object' == typeof result.result && null !== result.result) {\n                    const resultObj = result.result;\n                    if (resultObj.dump) result.dump = resultObj.dump;\n                    if (resultObj.reportHTML) result.reportHTML = resultObj.reportHTML;\n                    if (resultObj.error) result.error = formatError(resultObj.error);\n                    if (void 0 !== resultObj.result) result.result = resultObj.result;\n                }\n            } catch (e) {\n                result.error = formatError(e);\n                console.error('Playground execution error:', e);\n                if ('object' == typeof e && null !== e) {\n                    if (e.dump) result.dump = e.dump;\n                    if (e.reportHTML) result.reportHTML = e.reportHTML;\n                }\n            }\n            if (interruptedFlagRef.current[thisRunningId]) return;\n            setLoading(false);\n            currentRunningIdRef.current = null;\n            let replayInfo = null;\n            let counter = replayCounter;\n            if (null == result ? void 0 : result.dump) {\n                if (result.dump.tasks && Array.isArray(result.dump.tasks)) {\n                    const groupedDump = wrapExecutionDumpForReplay(result.dump);\n                    const info = allScriptsFromDump(groupedDump);\n                    setReplayCounter((c)=>c + 1);\n                    replayInfo = info;\n                    counter = replayCounter + 1;\n                }\n            }\n            setInfoList((prev)=>prev.map((item)=>item.id === `system-${thisRunningId}` ? _object_spread_props(_object_spread({}, item), {\n                        content: '',\n                        loading: false,\n                        loadingProgressText: ''\n                    }) : item));\n            const resultItem = {\n                id: `result-${thisRunningId}`,\n                type: 'result',\n                content: 'Execution result',\n                timestamp: new Date(),\n                result: result,\n                loading: false,\n                replayScriptsInfo: replayInfo,\n                replayCounter: counter,\n                loadingProgressText: '',\n                verticalMode: verticalMode,\n                actionType: actionType\n            };\n            setInfoList((prev)=>[\n                    ...prev,\n                    resultItem\n                ]);\n            if (null == storage ? void 0 : storage.saveResult) try {\n                yield storage.saveResult(resultItem.id, resultItem);\n            } catch (error) {\n                console.error('Failed to save result:', error);\n            }\n            const separatorItem = {\n                id: `separator-${thisRunningId}`,\n                type: 'separator',\n                content: 'New Session',\n                timestamp: new Date()\n            };\n            setInfoList((prev)=>[\n                    ...prev,\n                    separatorItem\n                ]);\n        })(), [\n        playgroundSDK,\n        storage,\n        actionSpace,\n        setLoading,\n        setInfoList,\n        replayCounter,\n        setReplayCounter,\n        verticalMode,\n        currentRunningIdRef,\n        interruptedFlagRef,\n        deepThink,\n        screenshotIncluded,\n        domIncluded\n    ]);\n    const handleStop = useCallback(()=>_async_to_generator(function*() {\n            const thisRunningId = currentRunningIdRef.current;\n            if (thisRunningId && playgroundSDK && playgroundSDK.cancelExecution) try {\n                const cancelResult = yield playgroundSDK.cancelExecution(thisRunningId.toString());\n                let executionData = null;\n                if (cancelResult) executionData = cancelResult;\n                else if (playgroundSDK.getCurrentExecutionData) try {\n                    executionData = yield playgroundSDK.getCurrentExecutionData();\n                } catch (error) {\n                    console.error('Failed to get execution data before stop:', error);\n                }\n                interruptedFlagRef.current[thisRunningId] = true;\n                setLoading(false);\n                if (playgroundSDK.onProgressUpdate) playgroundSDK.onProgressUpdate(()=>{});\n                if (playgroundSDK.onDumpUpdate) playgroundSDK.onDumpUpdate(()=>{});\n                setInfoList((prev)=>prev.map((item)=>item.id === `system-${thisRunningId}` ? _object_spread_props(_object_spread({}, item), {\n                            content: '',\n                            loading: false,\n                            loadingProgressText: ''\n                        }) : item));\n                if (executionData && (executionData.dump || executionData.reportHTML)) {\n                    const resultItem = {\n                        id: `stop-result-${thisRunningId}`,\n                        type: 'result',\n                        content: 'Execution stopped by user',\n                        timestamp: new Date(),\n                        result: {\n                            result: null,\n                            dump: executionData.dump,\n                            reportHTML: executionData.reportHTML,\n                            error: null\n                        },\n                        loading: false,\n                        verticalMode,\n                        replayCounter\n                    };\n                    setInfoList((prev)=>[\n                            ...prev,\n                            resultItem\n                        ]);\n                } else {\n                    const stopItem = {\n                        id: `stop-${thisRunningId}`,\n                        type: 'system',\n                        content: 'Operation stopped',\n                        timestamp: new Date(),\n                        loading: false\n                    };\n                    setInfoList((prev)=>[\n                            ...prev,\n                            stopItem\n                        ]);\n                }\n                const separatorItem = {\n                    id: `separator-${thisRunningId}`,\n                    type: 'separator',\n                    content: 'New Session',\n                    timestamp: new Date()\n                };\n                setInfoList((prev)=>[\n                        ...prev,\n                        separatorItem\n                    ]);\n            } catch (error) {\n                console.error('Failed to stop execution:', error);\n            }\n        })(), [\n        playgroundSDK,\n        currentRunningIdRef,\n        interruptedFlagRef,\n        setLoading,\n        setInfoList,\n        verticalMode,\n        replayCounter\n    ]);\n    const canStop = loading && !!currentRunningIdRef.current && !!playgroundSDK && !!playgroundSDK.cancelExecution;\n    return {\n        handleRun,\n        handleStop,\n        canStop\n    };\n}\nexport { usePlaygroundExecution };\n","function _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nclass IndexedDBManager {\n    initDB() {\n        return new Promise((resolve, reject)=>{\n            const request = indexedDB.open(this.dbName, this.version);\n            request.onerror = ()=>reject(request.error);\n            request.onsuccess = ()=>resolve(request.result);\n            request.onupgradeneeded = (event)=>{\n                const db = event.target.result;\n                this.storeConfigs.forEach(({ name, keyPath })=>{\n                    if (!db.objectStoreNames.contains(name)) {\n                        const store = db.createObjectStore(name, {\n                            keyPath\n                        });\n                        store.createIndex('timestamp', 'timestamp', {\n                            unique: false\n                        });\n                    }\n                });\n            };\n        });\n    }\n    async withTransaction(storeNames, mode, operation) {\n        const db = await this.dbPromise;\n        const transaction = db.transaction(storeNames, mode);\n        const stores = Array.isArray(storeNames) ? storeNames.map((name)=>transaction.objectStore(name)) : transaction.objectStore(storeNames);\n        return operation(stores);\n    }\n    promisifyRequest(request) {\n        return new Promise((resolve, reject)=>{\n            request.onsuccess = ()=>resolve(request.result);\n            request.onerror = ()=>reject(request.error);\n        });\n    }\n    async put(storeName, data) {\n        await this.withTransaction(storeName, 'readwrite', async (store)=>{\n            await this.promisifyRequest(store.put(data));\n        });\n    }\n    async get(storeName, key) {\n        return this.withTransaction(storeName, 'readonly', async (store)=>this.promisifyRequest(store.get(key)));\n    }\n    async getAll(storeName, sortByTimestamp = true) {\n        return this.withTransaction(storeName, 'readonly', async (store)=>{\n            const objectStore = store;\n            const results = sortByTimestamp ? await this.promisifyRequest(objectStore.index('timestamp').getAll()) : await this.promisifyRequest(objectStore.getAll());\n            return sortByTimestamp ? results.sort((a, b)=>a.timestamp - b.timestamp) : results;\n        });\n    }\n    async clear(storeName) {\n        await this.withTransaction(storeName, 'readwrite', async (store)=>{\n            await this.promisifyRequest(store.clear());\n        });\n    }\n    async delete(storeName, key) {\n        await this.withTransaction(storeName, 'readwrite', async (store)=>{\n            await this.promisifyRequest(store.delete(key));\n        });\n    }\n    async count(storeName) {\n        return this.withTransaction(storeName, 'readonly', async (store)=>this.promisifyRequest(store.count()));\n    }\n    getDBPromise() {\n        return this.dbPromise;\n    }\n    constructor(dbName, version, storeConfigs){\n        _define_property(this, \"dbPromise\", void 0);\n        _define_property(this, \"dbName\", void 0);\n        _define_property(this, \"version\", void 0);\n        _define_property(this, \"storeConfigs\", void 0);\n        this.dbName = dbName;\n        this.version = version;\n        this.storeConfigs = storeConfigs;\n        this.dbPromise = this.initDB();\n    }\n}\nconst withErrorHandling = async (operation, errorMessage, defaultValue, onQuotaExceeded)=>{\n    try {\n        return await operation();\n    } catch (e) {\n        console.error(errorMessage, e);\n        if (e instanceof Error && 'QuotaExceededError' === e.name && onQuotaExceeded) {\n            console.log('Storage quota exceeded, running cleanup...');\n            await onQuotaExceeded();\n        }\n        return defaultValue;\n    }\n};\nconst createCleanupFunction = (dbManager, storeName, maxItems)=>async ()=>{\n        try {\n            const results = await dbManager.getAll(storeName);\n            if (results.length > maxItems) {\n                const toDelete = results.sort((a, b)=>a.timestamp - b.timestamp).slice(0, results.length - maxItems);\n                await Promise.all(toDelete.map((item)=>dbManager.delete(storeName, item.id)));\n            }\n        } catch (e) {\n            console.error(`Failed to cleanup ${storeName}:`, e);\n        }\n    };\nexport { IndexedDBManager, createCleanupFunction, withErrorHandling };\n","import { IndexedDBManager, createCleanupFunction, withErrorHandling } from \"@midscene/shared/baseDB\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction indexeddb_storage_provider_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else indexeddb_storage_provider_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst DB_NAME = 'midscene_playground';\nconst DB_VERSION = 1;\nconst MESSAGES_STORE = 'playground_messages';\nconst RESULTS_STORE = 'playground_results';\nconst MAX_STORED_MESSAGES = 100;\nconst MAX_STORED_RESULTS = 50;\nclass IndexedDBStorageProvider {\n    saveMessages(messages) {\n        return _async_to_generator(function*() {\n            yield withErrorHandling(()=>_async_to_generator(function*() {\n                    yield this.dbManager.clear(MESSAGES_STORE);\n                    const messagesToSave = messages.slice(-MAX_STORED_MESSAGES);\n                    yield Promise.all(messagesToSave.map((msg, index)=>{\n                        const lightMessage = _object_spread_props(_object_spread({}, msg), {\n                            result: 'result' === msg.type ? void 0 : msg.result\n                        });\n                        const data = {\n                            id: msg.id || `msg-${index}`,\n                            data: lightMessage,\n                            timestamp: msg.timestamp ? msg.timestamp.getTime() : Date.now() + index\n                        };\n                        return this.dbManager.put(MESSAGES_STORE, data);\n                    }));\n                }).call(this), 'Failed to save messages to IndexedDB', void 0, this.messagesCleanup);\n        }).call(this);\n    }\n    loadMessages() {\n        return _async_to_generator(function*() {\n            const result = yield withErrorHandling(()=>_async_to_generator(function*() {\n                    const messages = yield this.dbManager.getAll(MESSAGES_STORE, true);\n                    if (0 === messages.length) return [];\n                    return Promise.all(messages.map((msg)=>_async_to_generator(function*() {\n                            const item = msg.data;\n                            const restoredItem = _object_spread_props(_object_spread({}, item), {\n                                timestamp: new Date(item.timestamp)\n                            });\n                            if ('result' === item.type && item.id) {\n                                const fullResult = yield this.loadResult(item.id);\n                                if (fullResult) {\n                                    restoredItem.result = fullResult.result;\n                                    restoredItem.replayScriptsInfo = fullResult.replayScriptsInfo;\n                                    restoredItem.replayCounter = fullResult.replayCounter;\n                                    restoredItem.verticalMode = fullResult.verticalMode;\n                                }\n                            }\n                            return restoredItem;\n                        }).call(this)));\n                }).call(this), 'Failed to load messages from IndexedDB', [], this.messagesCleanup);\n            return result || [];\n        }).call(this);\n    }\n    clearMessages() {\n        return _async_to_generator(function*() {\n            yield withErrorHandling(()=>_async_to_generator(function*() {\n                    yield Promise.all([\n                        this.dbManager.clear(MESSAGES_STORE),\n                        this.dbManager.clear(RESULTS_STORE)\n                    ]);\n                }).call(this), 'Failed to clear messages from IndexedDB');\n        }).call(this);\n    }\n    saveResult(id, result) {\n        return _async_to_generator(function*() {\n            yield withErrorHandling(()=>_async_to_generator(function*() {\n                    const compressedResult = this.compressResultForStorage(result);\n                    const data = {\n                        id,\n                        data: compressedResult,\n                        timestamp: Date.now(),\n                        size: JSON.stringify(compressedResult).length\n                    };\n                    yield this.dbManager.put(RESULTS_STORE, data);\n                }).call(this), 'Failed to save result to IndexedDB', void 0, this.resultsCleanup);\n        }).call(this);\n    }\n    loadResult(id) {\n        return _async_to_generator(function*() {\n            const result = yield withErrorHandling(()=>_async_to_generator(function*() {\n                    const data = yield this.dbManager.get(RESULTS_STORE, id);\n                    return (null == data ? void 0 : data.data) || null;\n                }).call(this), 'Failed to load result from IndexedDB', null);\n            return result || null;\n        }).call(this);\n    }\n    compressResultForStorage(result) {\n        var _result_result_dump, _result_result;\n        if (!(null == (_result_result = result.result) ? void 0 : null == (_result_result_dump = _result_result.dump) ? void 0 : _result_result_dump.tasks)) return result;\n        const compressedTasks = result.result.dump.tasks.map((task)=>{\n            var _task_recorder;\n            var _this_compressScreenshotIfNeeded;\n            return _object_spread_props(_object_spread({}, task), {\n                uiContext: task.uiContext ? _object_spread_props(_object_spread({}, task.uiContext), {\n                    screenshotBase64: null != (_this_compressScreenshotIfNeeded = this.compressScreenshotIfNeeded(task.uiContext.screenshotBase64)) ? _this_compressScreenshotIfNeeded : task.uiContext.screenshotBase64\n                }) : task.uiContext,\n                recorder: null == (_task_recorder = task.recorder) ? void 0 : _task_recorder.map((record)=>_object_spread_props(_object_spread({}, record), {\n                        screenshot: this.compressScreenshotIfNeeded(record.screenshot)\n                    }))\n            });\n        });\n        return _object_spread_props(_object_spread({}, result), {\n            result: _object_spread_props(_object_spread({}, result.result), {\n                dump: _object_spread_props(_object_spread({}, result.result.dump), {\n                    tasks: compressedTasks\n                })\n            })\n        });\n    }\n    compressScreenshotIfNeeded(screenshot) {\n        if (!screenshot) return screenshot;\n        if (screenshot.length > 1048576) {\n            const sizeKB = Math.round(screenshot.length / 1024);\n            return `[COMPRESSED: ${sizeKB}KB screenshot removed for storage]`;\n        }\n        return screenshot;\n    }\n    getStorageStats() {\n        return _async_to_generator(function*() {\n            const result = yield withErrorHandling(()=>_async_to_generator(function*() {\n                    const [messageCount, resultCount] = yield Promise.all([\n                        this.dbManager.count(MESSAGES_STORE),\n                        this.dbManager.count(RESULTS_STORE)\n                    ]);\n                    return {\n                        messageCount,\n                        resultCount\n                    };\n                }).call(this), 'Failed to get storage statistics', {\n                messageCount: 0,\n                resultCount: 0\n            });\n            return result || {\n                messageCount: 0,\n                resultCount: 0\n            };\n        }).call(this);\n    }\n    cleanup() {\n        return _async_to_generator(function*() {\n            yield Promise.all([\n                this.messagesCleanup(),\n                this.resultsCleanup()\n            ]);\n        }).call(this);\n    }\n    constructor(namespace = 'playground'){\n        _define_property(this, \"dbManager\", void 0);\n        _define_property(this, \"namespace\", void 0);\n        _define_property(this, \"messagesCleanup\", void 0);\n        _define_property(this, \"resultsCleanup\", void 0);\n        this.namespace = namespace;\n        this.dbManager = new IndexedDBManager(`${DB_NAME}_${namespace}`, DB_VERSION, [\n            {\n                name: MESSAGES_STORE,\n                keyPath: 'id'\n            },\n            {\n                name: RESULTS_STORE,\n                keyPath: 'id'\n            }\n        ]);\n        this.messagesCleanup = createCleanupFunction(this.dbManager, MESSAGES_STORE, MAX_STORED_MESSAGES);\n        this.resultsCleanup = createCleanupFunction(this.dbManager, RESULTS_STORE, MAX_STORED_RESULTS);\n    }\n}\nclass MemoryStorageProvider {\n    saveMessages(messages) {\n        return _async_to_generator(function*() {\n            this.messages = [\n                ...messages\n            ];\n        }).call(this);\n    }\n    loadMessages() {\n        return _async_to_generator(function*() {\n            return [\n                ...this.messages\n            ];\n        }).call(this);\n    }\n    clearMessages() {\n        return _async_to_generator(function*() {\n            this.messages = [];\n            this.results.clear();\n        }).call(this);\n    }\n    saveResult(id, result) {\n        return _async_to_generator(function*() {\n            this.results.set(id, result);\n        }).call(this);\n    }\n    constructor(){\n        _define_property(this, \"messages\", []);\n        _define_property(this, \"results\", new Map());\n    }\n}\nclass NoOpStorageProvider {\n    saveMessages(_messages) {\n        return _async_to_generator(function*() {})();\n    }\n    loadMessages() {\n        return _async_to_generator(function*() {\n            return [];\n        })();\n    }\n    clearMessages() {\n        return _async_to_generator(function*() {})();\n    }\n    saveResult(_id, _result) {\n        return _async_to_generator(function*() {})();\n    }\n}\nexport { IndexedDBStorageProvider, MemoryStorageProvider, NoOpStorageProvider };\n","import { IndexedDBStorageProvider, MemoryStorageProvider, NoOpStorageProvider } from \"./indexeddb-storage-provider.mjs\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction storage_provider_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else storage_provider_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nclass LocalStorageProvider {\n    checkStorageSpace() {\n        try {\n            const testKey = 'storage-test';\n            const testData = 'x'.repeat(102400);\n            localStorage.setItem(testKey, testData);\n            localStorage.removeItem(testKey);\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n    saveMessages(messages) {\n        return _async_to_generator(function*() {\n            try {\n                if (!this.checkStorageSpace()) {\n                    console.warn('Low storage space detected, clearing old data...');\n                    yield this.handleQuotaExceeded();\n                }\n                const messagesToSave = messages.slice(-this.maxStorageItems);\n                const lightMessages = messagesToSave.map((msg)=>_object_spread_props(_object_spread({}, msg), {\n                        result: 'result' === msg.type ? void 0 : msg.result\n                    }));\n                const messageData = JSON.stringify(lightMessages);\n                localStorage.setItem(this.messagesKey, messageData);\n            } catch (error) {\n                if (error instanceof DOMException && 'QuotaExceededError' === error.name) {\n                    console.warn('LocalStorage quota exceeded, attempting to clear old data and retry...');\n                    yield this.handleQuotaExceeded();\n                    try {\n                        const recentMessages = messages.slice(-10);\n                        const lightRecentMessages = recentMessages.map((msg)=>_object_spread_props(_object_spread({}, msg), {\n                                result: 'result' === msg.type ? void 0 : msg.result\n                            }));\n                        const messageData = JSON.stringify(lightRecentMessages);\n                        localStorage.setItem(this.messagesKey, messageData);\n                        console.info('Successfully saved recent messages after clearing storage');\n                    } catch (retryError) {\n                        console.error('Failed to save even after clearing storage:', retryError);\n                        yield this.clearMessages();\n                    }\n                } else console.error('Failed to save messages to localStorage:', error);\n            }\n        }).call(this);\n    }\n    loadMessages() {\n        return _async_to_generator(function*() {\n            try {\n                const stored = localStorage.getItem(this.messagesKey);\n                if (!stored) return [];\n                const messages = JSON.parse(stored);\n                const restoredMessages = yield Promise.all(messages.map((msg)=>_async_to_generator(function*() {\n                        if ('result' === msg.type && msg.id) {\n                            const resultKey = `${this.resultsKey}-${msg.id}`;\n                            const storedResult = localStorage.getItem(resultKey);\n                            if (storedResult) try {\n                                const resultItem = JSON.parse(storedResult);\n                                return _object_spread({}, msg, resultItem);\n                            } catch (e) {\n                                console.warn('Failed to parse stored result:', e);\n                            }\n                        }\n                        return msg;\n                    }).call(this)));\n                return restoredMessages;\n            } catch (error) {\n                console.error('Failed to load messages from localStorage:', error);\n                return [];\n            }\n        }).call(this);\n    }\n    clearMessages() {\n        return _async_to_generator(function*() {\n            try {\n                localStorage.removeItem(this.messagesKey);\n                const keys = Object.keys(localStorage);\n                keys.forEach((key)=>{\n                    if (key.startsWith(this.resultsKey)) localStorage.removeItem(key);\n                });\n            } catch (error) {\n                console.error('Failed to clear messages from localStorage:', error);\n            }\n        }).call(this);\n    }\n    saveResult(id, result) {\n        return _async_to_generator(function*() {\n            try {\n                const resultKey = `${this.resultsKey}-${id}`;\n                localStorage.setItem(resultKey, JSON.stringify(result));\n            } catch (error) {\n                if (error instanceof DOMException && 'QuotaExceededError' === error.name) {\n                    console.warn('LocalStorage quota exceeded when saving result, clearing old results...');\n                    yield this.handleQuotaExceeded();\n                    try {\n                        const resultKey = `${this.resultsKey}-${id}`;\n                        localStorage.setItem(resultKey, JSON.stringify(result));\n                    } catch (retryError) {\n                        console.error('Failed to save result even after clearing storage:', retryError);\n                    }\n                } else console.error('Failed to save result to localStorage:', error);\n            }\n        }).call(this);\n    }\n    handleQuotaExceeded() {\n        return _async_to_generator(function*() {\n            try {\n                const keys = Object.keys(localStorage);\n                const resultKeys = keys.filter((key)=>key.startsWith(this.resultsKey));\n                const keysToRemove = resultKeys.slice(0, Math.max(1, Math.floor(resultKeys.length / 2)));\n                keysToRemove.forEach((key)=>{\n                    localStorage.removeItem(key);\n                });\n                console.info(`Cleared ${keysToRemove.length} old result entries to free up storage space`);\n                const playgroundKeys = keys.filter((key)=>key.includes('playground') || key.includes('agent') || key.startsWith('midscene'));\n                if (playgroundKeys.length > 10) {\n                    const additionalKeysToRemove = playgroundKeys.slice(0, Math.floor(playgroundKeys.length / 3));\n                    additionalKeysToRemove.forEach((key)=>{\n                        if (key !== this.messagesKey) localStorage.removeItem(key);\n                    });\n                    console.info(`Cleared ${additionalKeysToRemove.length} additional playground-related entries`);\n                }\n            } catch (error) {\n                console.error('Failed to handle quota exceeded:', error);\n            }\n        }).call(this);\n    }\n    constructor(namespace = 'playground'){\n        _define_property(this, \"messagesKey\", void 0);\n        _define_property(this, \"resultsKey\", void 0);\n        _define_property(this, \"maxStorageItems\", 50);\n        this.messagesKey = `${namespace}-messages`;\n        this.resultsKey = `${namespace}-results`;\n    }\n}\nclass storage_provider_MemoryStorageProvider {\n    saveMessages(messages) {\n        return _async_to_generator(function*() {\n            this.messages = [\n                ...messages\n            ];\n        }).call(this);\n    }\n    loadMessages() {\n        return _async_to_generator(function*() {\n            return [\n                ...this.messages\n            ];\n        }).call(this);\n    }\n    clearMessages() {\n        return _async_to_generator(function*() {\n            this.messages = [];\n            this.results.clear();\n        }).call(this);\n    }\n    saveResult(id, result) {\n        return _async_to_generator(function*() {\n            this.results.set(id, result);\n        }).call(this);\n    }\n    constructor(){\n        _define_property(this, \"messages\", []);\n        _define_property(this, \"results\", new Map());\n    }\n}\nclass storage_provider_NoOpStorageProvider {\n    saveMessages(_messages) {\n        return _async_to_generator(function*() {})();\n    }\n    loadMessages() {\n        return _async_to_generator(function*() {\n            return [];\n        })();\n    }\n    clearMessages() {\n        return _async_to_generator(function*() {})();\n    }\n    saveResult(_id, _result) {\n        return _async_to_generator(function*() {})();\n    }\n}\nvar storage_provider_StorageType = /*#__PURE__*/ function(StorageType) {\n    StorageType[\"INDEXEDDB\"] = \"indexeddb\";\n    StorageType[\"LOCALSTORAGE\"] = \"localStorage\";\n    StorageType[\"MEMORY\"] = \"memory\";\n    StorageType[\"NONE\"] = \"none\";\n    return StorageType;\n}({});\nfunction createStorageProvider(type = \"indexeddb\", namespace = 'playground') {\n    switch(type){\n        case \"indexeddb\":\n            if ('undefined' != typeof indexedDB) return new IndexedDBStorageProvider(namespace);\n            console.warn('IndexedDB not available, falling back to localStorage');\n            return createStorageProvider(\"localStorage\", namespace);\n        case \"localStorage\":\n            if ('undefined' != typeof localStorage) return new LocalStorageProvider(namespace);\n            console.warn('localStorage not available, falling back to memory storage');\n            return createStorageProvider(\"memory\", namespace);\n        case \"memory\":\n            return new storage_provider_MemoryStorageProvider();\n        case \"none\":\n            return new storage_provider_NoOpStorageProvider();\n        default:\n            throw new Error(`Unknown storage type: ${type}`);\n    }\n}\nfunction detectBestStorageType() {\n    if ('undefined' != typeof indexedDB) try {\n        indexedDB.open('test', 1).onerror = ()=>{};\n        return \"indexeddb\";\n    } catch (e) {}\n    if ('undefined' != typeof localStorage) try {\n        localStorage.setItem('test', 'test');\n        localStorage.removeItem('test');\n        return \"localStorage\";\n    } catch (e) {}\n    return \"memory\";\n}\nexport { MemoryStorageProvider as IndexedDBMemoryStorageProvider, NoOpStorageProvider as IndexedDBNoOpStorageProvider, IndexedDBStorageProvider, LocalStorageProvider, storage_provider_MemoryStorageProvider as MemoryStorageProvider, storage_provider_NoOpStorageProvider as NoOpStorageProvider, storage_provider_StorageType as StorageType, createStorageProvider, detectBestStorageType };\n","import { useCallback, useEffect, useRef, useState } from \"react\";\nimport { createStorageProvider, detectBestStorageType } from \"../component/universal-playground/providers/storage-provider.mjs\";\nimport { WELCOME_MESSAGE_TEMPLATE } from \"../utils/constants.mjs\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction usePlaygroundState_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else usePlaygroundState_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nfunction usePlaygroundState(playgroundSDK, storage, contextProvider) {\n    const [loading, setLoading] = useState(false);\n    const [infoList, setInfoList] = useState([]);\n    const [actionSpace, setActionSpace] = useState([]);\n    const [actionSpaceLoading, setActionSpaceLoading] = useState(true);\n    const [uiContextPreview, setUiContextPreview] = useState();\n    const [showScrollToBottomButton, setShowScrollToBottomButton] = useState(false);\n    const [verticalMode, setVerticalMode] = useState(false);\n    const [replayCounter, setReplayCounter] = useState(0);\n    const infoListRef = useRef(null);\n    const currentRunningIdRef = useRef(null);\n    const interruptedFlagRef = useRef({});\n    const initializedRef = useRef(false);\n    useEffect(()=>{\n        const migrateFromOldNamespace = ()=>_async_to_generator(function*() {\n                const oldStorage = createStorageProvider(detectBestStorageType(), 'playground-default');\n                try {\n                    if (null == oldStorage ? void 0 : oldStorage.loadMessages) {\n                        const oldMessages = yield oldStorage.loadMessages();\n                        if (oldMessages.length > 1) {\n                            console.log('Found data in old namespace, migrating...');\n                            if (null == storage ? void 0 : storage.saveMessages) yield storage.saveMessages(oldMessages);\n                            if (oldStorage.clearMessages) yield oldStorage.clearMessages();\n                            return oldMessages;\n                        }\n                    }\n                } catch (error) {\n                    console.debug('No data found in old namespace:', error);\n                }\n                return [];\n            })();\n        const initializeMessages = ()=>_async_to_generator(function*() {\n                const welcomeMessage = _object_spread_props(_object_spread({}, WELCOME_MESSAGE_TEMPLATE), {\n                    id: 'welcome',\n                    timestamp: new Date()\n                });\n                if (null == storage ? void 0 : storage.loadMessages) try {\n                    let storedMessages = yield storage.loadMessages();\n                    if (0 === storedMessages.length) storedMessages = yield migrateFromOldNamespace();\n                    const hasWelcomeMessage = storedMessages.some((msg)=>'welcome' === msg.id);\n                    hasWelcomeMessage ? setInfoList(storedMessages) : setInfoList([\n                        welcomeMessage,\n                        ...storedMessages\n                    ]);\n                } catch (error) {\n                    console.error('Failed to load messages:', error);\n                    setInfoList([\n                        welcomeMessage\n                    ]);\n                }\n                else setInfoList([\n                    welcomeMessage\n                ]);\n            })();\n        if (storage && !initializedRef.current) {\n            initializedRef.current = true;\n            initializeMessages();\n        } else if (!storage && 0 === infoList.length) initializeMessages();\n    }, [\n        storage\n    ]);\n    useEffect(()=>{\n        if ((null == storage ? void 0 : storage.saveMessages) && infoList.length > 1) storage.saveMessages(infoList).catch((error)=>{\n            if (error instanceof DOMException && 'QuotaExceededError' === error.name) console.warn('Storage quota exceeded - some messages may not be saved persistently');\n            else console.error('Failed to save messages:', error);\n        });\n    }, [\n        infoList,\n        storage\n    ]);\n    useEffect(()=>{\n        if (!(null == contextProvider ? void 0 : contextProvider.getUIContext) || uiContextPreview) return;\n        contextProvider.getUIContext().then((context)=>setUiContextPreview(context)).catch((error)=>{\n            console.error('Failed to get UI context:', error);\n        });\n    }, [\n        contextProvider,\n        uiContextPreview\n    ]);\n    useEffect(()=>{\n        const loadActionSpace = ()=>_async_to_generator(function*() {\n                setActionSpaceLoading(true);\n                try {\n                    var _contextProvider_getUIContext;\n                    if (!playgroundSDK) return void setActionSpace([]);\n                    const context = uiContextPreview || (yield null == contextProvider ? void 0 : null == (_contextProvider_getUIContext = contextProvider.getUIContext) ? void 0 : _contextProvider_getUIContext.call(contextProvider));\n                    const space = yield playgroundSDK.getActionSpace(context);\n                    setActionSpace(space || []);\n                } catch (error) {\n                    console.error('Failed to load action space:', error);\n                    setActionSpace([]);\n                } finally{\n                    setActionSpaceLoading(false);\n                }\n            })();\n        loadActionSpace();\n    }, [\n        playgroundSDK,\n        uiContextPreview,\n        contextProvider\n    ]);\n    useEffect(()=>{\n        const sizeThreshold = 750;\n        setVerticalMode(window.innerWidth < sizeThreshold);\n        const handleResize = ()=>{\n            setVerticalMode(window.innerWidth < sizeThreshold);\n        };\n        window.addEventListener('resize', handleResize);\n        return ()=>window.removeEventListener('resize', handleResize);\n    }, []);\n    const scrollToBottom = useCallback(()=>{\n        setTimeout(()=>{\n            if (infoListRef.current) infoListRef.current.scrollTop = infoListRef.current.scrollHeight;\n        }, 100);\n    }, []);\n    const checkIfScrolledToBottom = useCallback(()=>{\n        if (infoListRef.current) {\n            const { scrollTop, scrollHeight, clientHeight } = infoListRef.current;\n            const isAtBottom = scrollTop + clientHeight >= scrollHeight - 10;\n            setShowScrollToBottomButton(!isAtBottom);\n        }\n    }, []);\n    const handleScrollToBottom = useCallback(()=>{\n        if (infoListRef.current) {\n            infoListRef.current.scrollTo({\n                top: infoListRef.current.scrollHeight,\n                behavior: 'smooth'\n            });\n            setShowScrollToBottomButton(false);\n        }\n    }, []);\n    useEffect(()=>{\n        if (infoList.length > 0) scrollToBottom();\n    }, [\n        infoList,\n        scrollToBottom\n    ]);\n    useEffect(()=>{\n        const container = infoListRef.current;\n        if (container) {\n            container.addEventListener('scroll', checkIfScrolledToBottom);\n            checkIfScrolledToBottom();\n            return ()=>{\n                container.removeEventListener('scroll', checkIfScrolledToBottom);\n            };\n        }\n    }, [\n        checkIfScrolledToBottom\n    ]);\n    const clearInfoList = useCallback(()=>_async_to_generator(function*() {\n            const welcomeMessage = _object_spread_props(_object_spread({}, WELCOME_MESSAGE_TEMPLATE), {\n                id: 'welcome',\n                timestamp: new Date()\n            });\n            setInfoList([\n                welcomeMessage\n            ]);\n            if (null == storage ? void 0 : storage.clearMessages) try {\n                yield storage.clearMessages();\n            } catch (error) {\n                console.error('Failed to clear stored messages:', error);\n            }\n        })(), [\n        storage\n    ]);\n    const refreshContext = useCallback(()=>_async_to_generator(function*() {\n            if (null == contextProvider ? void 0 : contextProvider.refreshContext) try {\n                const newContext = yield contextProvider.refreshContext();\n                setUiContextPreview(newContext);\n            } catch (error) {\n                console.error('Failed to refresh context:', error);\n            }\n        })(), [\n        contextProvider\n    ]);\n    return {\n        loading,\n        setLoading,\n        infoList,\n        setInfoList,\n        actionSpace,\n        actionSpaceLoading,\n        uiContextPreview,\n        setUiContextPreview,\n        showScrollToBottomButton,\n        verticalMode,\n        replayCounter,\n        setReplayCounter,\n        infoListRef,\n        currentRunningIdRef,\n        interruptedFlagRef,\n        clearInfoList,\n        refreshContext,\n        handleScrollToBottom,\n        scrollToBottom\n    };\n}\nexport { usePlaygroundState };\n","\"use client\";\nimport { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"pixi.js/unsafe-eval\";\nimport { Application, Container, Graphics, Rectangle, Sprite, Text, Texture } from \"pixi.js\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { colorForName, highlightColorForType } from \"../../utils/color.mjs\";\nimport \"./index.css\";\nimport { DropShadowFilter, GlowFilter } from \"pixi-filters\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nconst itemFillAlpha = 0.4;\nconst highlightAlpha = 0.4;\nconst pointRadius = 10;\nconst pointMarkForItem = (point, type)=>{\n    const [x, y] = point;\n    const themeColor = highlightColorForType('element');\n    const graphics = new Graphics();\n    graphics.beginFill(themeColor, itemFillAlpha);\n    graphics.drawCircle(x, y, pointRadius);\n    graphics.endFill();\n    return graphics;\n};\nconst rectMarkForItem = (rect, name, type)=>{\n    const { left, top, width, height } = rect;\n    let themeColor;\n    themeColor = 'element' === type ? colorForName(name) : 'searchArea' === type ? highlightColorForType('searchArea') : highlightColorForType('element');\n    const alpha = 'highlight' === type ? highlightAlpha : itemFillAlpha;\n    const graphics = new Graphics();\n    graphics.beginFill(themeColor, alpha);\n    graphics.lineStyle(1, themeColor, 1);\n    graphics.drawRect(left, top, width, height);\n    graphics.endFill();\n    const dropShadowFilter = new DropShadowFilter({\n        blur: 2,\n        quality: 3,\n        alpha: 0.4,\n        offset: {\n            x: 4,\n            y: 4\n        },\n        color: 0x333333\n    });\n    graphics.filters = [\n        dropShadowFilter\n    ];\n    const nameFontSize = 18;\n    if (!name) return [\n        graphics\n    ];\n    const texts = new Text(name, {\n        fontSize: nameFontSize,\n        fill: 0x0\n    });\n    texts.x = left;\n    texts.y = Math.max(top - (nameFontSize + 4), 0);\n    return [\n        graphics,\n        texts\n    ];\n};\nconst Blackboard = (props)=>{\n    const highlightElements = props.highlightElements || [];\n    highlightElements.map((e)=>e.id);\n    const highlightRect = props.highlightRect;\n    const highlightPoints = props.highlightPoints;\n    const context = props.uiContext;\n    const { size, screenshotBase64 } = context;\n    const screenWidth = size.width;\n    const screenHeight = size.height;\n    const domRef = useRef(null);\n    const app = useMemo(()=>new Application(), []);\n    const [appInitialed, setAppInitialed] = useState(false);\n    const highlightContainer = useMemo(()=>new Container(), []);\n    const elementMarkContainer = useMemo(()=>new Container(), []);\n    const [hoverElement, setHoverElement] = useState(null);\n    const pixiBgRef = useRef(void 0);\n    const animationFrameRef = useRef(null);\n    const highlightGraphicsRef = useRef([]);\n    const glowFiltersRef = useRef([]);\n    const backgroundVisible = true;\n    const elementsVisible = true;\n    useEffect(()=>{\n        Promise.resolve((()=>_async_to_generator(function*() {\n                if (!domRef.current || !screenWidth) return;\n                yield app.init({\n                    width: screenWidth,\n                    height: screenHeight,\n                    background: 0xffffff\n                });\n                const canvasEl = domRef.current;\n                domRef.current.appendChild(app.canvas);\n                const { clientWidth } = domRef.current.parentElement;\n                const targetHeight = 0.6 * window.innerHeight;\n                const viewportRatio = clientWidth / targetHeight;\n                if (screenWidth / screenHeight <= viewportRatio) {\n                    const ratio = targetHeight / screenHeight;\n                    canvasEl.style.width = `${Math.floor(screenWidth * ratio)}px`;\n                    canvasEl.style.height = `${Math.floor(screenHeight * ratio)}px`;\n                }\n                app.stage.addChild(highlightContainer);\n                app.stage.addChild(elementMarkContainer);\n                setAppInitialed(true);\n            })())());\n        return ()=>{\n            console.log('will destroy');\n            if (null !== animationFrameRef.current) {\n                cancelAnimationFrame(animationFrameRef.current);\n                animationFrameRef.current = null;\n            }\n            try {\n                app.destroy(true, {\n                    children: true,\n                    texture: true\n                });\n            } catch (e) {\n                console.warn('destroy failed', e);\n            }\n        };\n    }, [\n        app,\n        screenWidth,\n        screenHeight\n    ]);\n    useEffect(()=>{\n        if (!appInitialed) return;\n        app.stage.eventMode = 'static';\n        app.stage.hitArea = new Rectangle(0, 0, screenWidth, screenHeight);\n        const clickHandler = (event)=>{\n            var _props_onCanvasClick;\n            console.log('pixi click', event);\n            const { x, y } = event.data.global;\n            null == (_props_onCanvasClick = props.onCanvasClick) || _props_onCanvasClick.call(props, [\n                Math.round(x),\n                Math.round(y)\n            ]);\n        };\n        app.stage.on('click', clickHandler);\n        return ()=>{\n            var _app_stage;\n            null == app || null == (_app_stage = app.stage) || _app_stage.off('click');\n        };\n    }, [\n        appInitialed,\n        props.onCanvasClick,\n        screenWidth,\n        screenHeight\n    ]);\n    useEffect(()=>{\n        if (!appInitialed) return;\n        const img = new Image();\n        img.onload = ()=>{\n            if (!app.stage) return;\n            const screenshotTexture = Texture.from(img);\n            const backgroundSprite = new Sprite(screenshotTexture);\n            backgroundSprite.x = 0;\n            backgroundSprite.y = 0;\n            backgroundSprite.width = screenWidth;\n            backgroundSprite.height = screenHeight;\n            backgroundSprite.eventMode = 'passive';\n            app.stage.addChildAt(backgroundSprite, 0);\n            pixiBgRef.current = backgroundSprite;\n            backgroundSprite.visible = backgroundVisible;\n        };\n        img.onerror = (e)=>{\n            console.error('load screenshot failed', e);\n        };\n        img.src = screenshotBase64;\n    }, [\n        app.stage,\n        appInitialed,\n        screenWidth,\n        screenHeight\n    ]);\n    const { highlightElementRects } = useMemo(()=>{\n        const highlightElementRects = [];\n        highlightContainer.removeChildren();\n        elementMarkContainer.removeChildren();\n        highlightContainer.eventMode = 'passive';\n        elementMarkContainer.eventMode = 'passive';\n        highlightGraphicsRef.current = [];\n        glowFiltersRef.current = [];\n        if (highlightRect) {\n            const [graphics] = rectMarkForItem(highlightRect, 'Search Area', 'searchArea');\n            highlightContainer.addChild(graphics);\n        }\n        if (highlightElements.length) highlightElements.forEach((element)=>{\n            const { rect, content, id } = element;\n            const items = rectMarkForItem(rect, content, 'highlight');\n            const graphics = items[0];\n            const glowFilter = new GlowFilter({\n                distance: 30,\n                outerStrength: 3,\n                innerStrength: 0,\n                color: 0xfd5907,\n                quality: 0.5\n            });\n            const existingFilters = graphics.filters;\n            if (Array.isArray(existingFilters)) graphics.filters = [\n                ...existingFilters,\n                glowFilter\n            ];\n            else if (existingFilters) graphics.filters = [\n                existingFilters,\n                glowFilter\n            ];\n            else graphics.filters = [\n                glowFilter\n            ];\n            items.forEach((item)=>highlightContainer.addChild(item));\n            highlightGraphicsRef.current.push(graphics);\n            glowFiltersRef.current.push(glowFilter);\n        });\n        if (null == highlightPoints ? void 0 : highlightPoints.length) highlightPoints.forEach((point)=>{\n            const graphics = pointMarkForItem(point, 'highlightPoint');\n            const glowFilter = new GlowFilter({\n                distance: 25,\n                outerStrength: 2.5,\n                innerStrength: 0,\n                color: 0xfd5907,\n                quality: 0.5\n            });\n            graphics.filters = [\n                glowFilter\n            ];\n            highlightContainer.addChild(graphics);\n            highlightGraphicsRef.current.push(graphics);\n            glowFiltersRef.current.push(glowFilter);\n        });\n        elementMarkContainer.visible = elementsVisible;\n        return {\n            highlightElementRects\n        };\n    }, [\n        app,\n        appInitialed,\n        highlightElements,\n        hoverElement,\n        highlightRect,\n        highlightPoints\n    ]);\n    useEffect(()=>{\n        if (!appInitialed || 0 === highlightGraphicsRef.current.length) return void console.log('Animation skipped:', {\n            appInitialed,\n            graphicsCount: highlightGraphicsRef.current.length\n        });\n        console.log('Starting pulsing animation for', highlightGraphicsRef.current.length, 'graphics');\n        const graphicsToAnimate = highlightGraphicsRef.current;\n        const glowFilters = glowFiltersRef.current;\n        const pulseDuration = 1200;\n        const minAlpha = 0.4;\n        const maxAlpha = 1.0;\n        const minGlowStrength = 2.0;\n        const maxGlowStrength = 5.0;\n        const startTime = performance.now();\n        const animate = ()=>{\n            const elapsed = performance.now() - startTime;\n            const progress = elapsed % pulseDuration / pulseDuration;\n            const sineValue = Math.sin(progress * Math.PI * 2);\n            const normalizedSine = (sineValue + 1) / 2;\n            const alpha = minAlpha + normalizedSine * (maxAlpha - minAlpha);\n            const glowStrength = minGlowStrength + normalizedSine * (maxGlowStrength - minGlowStrength);\n            graphicsToAnimate.forEach((graphics, index)=>{\n                graphics.alpha = alpha;\n                if (glowFilters[index]) glowFilters[index].outerStrength = glowStrength;\n            });\n            animationFrameRef.current = requestAnimationFrame(animate);\n        };\n        animate();\n        return ()=>{\n            console.log('Stopping pulsing animation');\n            if (null !== animationFrameRef.current) {\n                cancelAnimationFrame(animationFrameRef.current);\n                animationFrameRef.current = null;\n            }\n        };\n    }, [\n        appInitialed,\n        highlightElements,\n        highlightPoints\n    ]);\n    let bottomTipA = null;\n    if (1 === highlightElementRects.length) bottomTipA = /*#__PURE__*/ jsx(\"div\", {\n        className: \"bottom-tip\",\n        children: /*#__PURE__*/ jsxs(\"div\", {\n            className: \"bottom-tip-item\",\n            children: [\n                \"Element: \",\n                JSON.stringify(highlightElementRects[0])\n            ]\n        })\n    });\n    else if (highlightElementRects.length > 1) bottomTipA = /*#__PURE__*/ jsx(\"div\", {\n        className: \"bottom-tip\",\n        children: /*#__PURE__*/ jsxs(\"div\", {\n            className: \"bottom-tip-item\",\n            children: [\n                \"Element: \",\n                JSON.stringify(highlightElementRects)\n            ]\n        })\n    });\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"blackboard\",\n        children: [\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"blackboard-main-content\",\n                style: {\n                    width: '100%'\n                },\n                ref: domRef\n            }),\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"bottom-tip\",\n                style: {\n                    display: props.hideController ? 'none' : 'block'\n                },\n                children: bottomTipA\n            })\n        ]\n    });\n};\nconst blackboard = Blackboard;\nexport { Blackboard, blackboard as default, pointMarkForItem, rectMarkForItem };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"./index.css\";\nconst ShinyText = ({ text, disabled = false, speed = 5, className = '', colorTheme = 'blue' })=>{\n    const style = {\n        '--animation-duration': `${speed}s`\n    };\n    const themeClass = `theme-${colorTheme}`;\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: `shiny-text ${themeClass} ${disabled ? 'disabled' : ''} ${className}`,\n        style: style,\n        children: text\n    });\n};\nconst shiny_text = ShinyText;\nexport { shiny_text as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { ArrowRightOutlined, CheckOutlined, ClockCircleOutlined, CloseOutlined, LogoutOutlined, MinusOutlined, WarningOutlined } from \"@ant-design/icons\";\nimport { Alert } from \"antd\";\nimport shiny_text from \"../shiny-text/index.mjs\";\nfunction timeCostStrElement(timeCost) {\n    let str;\n    str = 'number' != typeof timeCost ? '-' : `${(timeCost / 1000).toFixed(2)}s`;\n    return /*#__PURE__*/ jsx(\"span\", {\n        style: {\n            fontVariantNumeric: 'tabular-nums',\n            fontFeatureSettings: 'tnum'\n        },\n        children: str\n    });\n}\nconst iconForStatus = (status)=>{\n    switch(status){\n        case 'finished':\n        case 'passed':\n        case 'success':\n        case 'connected':\n            return /*#__PURE__*/ jsx(\"span\", {\n                style: {\n                    color: '#00AD4B'\n                },\n                children: /*#__PURE__*/ jsx(CheckOutlined, {})\n            });\n        case 'finishedWithWarning':\n            return /*#__PURE__*/ jsx(\"span\", {\n                style: {\n                    color: '#f7bb05'\n                },\n                children: /*#__PURE__*/ jsx(WarningOutlined, {})\n            });\n        case 'failed':\n        case 'closed':\n        case 'timedOut':\n        case 'interrupted':\n            return /*#__PURE__*/ jsx(\"span\", {\n                style: {\n                    color: '#FF0A0A'\n                },\n                children: /*#__PURE__*/ jsx(CloseOutlined, {})\n            });\n        case 'pending':\n            return /*#__PURE__*/ jsx(ClockCircleOutlined, {});\n        case 'cancelled':\n        case 'skipped':\n            return /*#__PURE__*/ jsx(LogoutOutlined, {});\n        case 'running':\n            return /*#__PURE__*/ jsx(ArrowRightOutlined, {});\n        default:\n            return /*#__PURE__*/ jsx(MinusOutlined, {});\n    }\n};\nconst errorMessageServerNotReady = /*#__PURE__*/ jsxs(\"span\", {\n    children: [\n        \"Don't worry, just one more step to launch the playground server.\",\n        /*#__PURE__*/ jsx(\"br\", {}),\n        \"Please run one of the commands under the midscene project directory:\",\n        /*#__PURE__*/ jsx(\"br\", {}),\n        \"a. \",\n        /*#__PURE__*/ jsx(\"strong\", {\n            children: \"npx midscene-playground\"\n        }),\n        /*#__PURE__*/ jsx(\"br\", {}),\n        \"b. \",\n        /*#__PURE__*/ jsx(\"strong\", {\n            children: \"npx --yes @midscene/web\"\n        })\n    ]\n});\nconst serverLaunchTip = (notReadyMessage = errorMessageServerNotReady)=>/*#__PURE__*/ jsx(\"div\", {\n        className: \"server-tip\",\n        children: /*#__PURE__*/ jsx(Alert, {\n            message: \"Playground Server Not Ready\",\n            description: notReadyMessage,\n            type: \"warning\"\n        })\n    });\nconst emptyResultTip = /*#__PURE__*/ jsx(\"div\", {\n    className: \"result-empty-tip\",\n    style: {\n        textAlign: 'center'\n    },\n    children: /*#__PURE__*/ jsx(shiny_text, {\n        disabled: true,\n        text: \"The result will be shown here\"\n    })\n});\nexport { emptyResultTip, errorMessageServerNotReady, iconForStatus, serverLaunchTip, timeCostStrElement };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { Button } from \"antd\";\nimport blackboard from \"../blackboard/index.mjs\";\nimport { iconForStatus } from \"../misc/index.mjs\";\nimport playground_demo_ui_context from \"../playground/playground-demo-ui-context.json\";\nconst ContextPreview = ({ uiContextPreview, setUiContextPreview, showContextPreview })=>{\n    if (!showContextPreview) return null;\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"form-part context-panel\",\n        children: [\n            /*#__PURE__*/ jsx(\"h3\", {\n                children: \"UI Context\"\n            }),\n            uiContextPreview ? /*#__PURE__*/ jsx(blackboard, {\n                uiContext: uiContextPreview,\n                hideController: true\n            }) : /*#__PURE__*/ jsxs(\"div\", {\n                children: [\n                    iconForStatus('failed'),\n                    \" No UI context\",\n                    /*#__PURE__*/ jsx(Button, {\n                        type: \"link\",\n                        onClick: (e)=>{\n                            e.preventDefault();\n                            setUiContextPreview(playground_demo_ui_context);\n                        },\n                        children: \"Load Demo\"\n                    }),\n                    /*#__PURE__*/ jsx(\"div\", {\n                        children: \"To load the UI context, you can either use the demo data above, or click the 'Send to Playground' in the report page.\"\n                    })\n                ]\n            })\n        ]\n    });\n};\nexport { ContextPreview };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { ExclamationCircleFilled } from \"@ant-design/icons\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nimport { EnvConfig } from \"../env-config/index.mjs\";\nimport \"./index.css\";\nconst EnvConfigReminder = ({ className = '' })=>{\n    const { config } = useEnvConfig();\n    const configAlreadySet = Object.keys(config || {}).length >= 1;\n    if (configAlreadySet) return null;\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: `env-config-reminder ${className}`,\n        children: [\n            /*#__PURE__*/ jsx(ExclamationCircleFilled, {\n                className: \"reminder-icon\"\n            }),\n            /*#__PURE__*/ jsx(\"span\", {\n                className: \"reminder-text\",\n                children: \"Please set up your environment variables before using.\"\n            }),\n            /*#__PURE__*/ jsx(EnvConfig, {\n                mode: \"text\",\n                showTooltipWhenEmpty: false\n            })\n        ]\n    });\n};\nexport { EnvConfigReminder };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"react\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction global_perspective_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else global_perspective_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst SvgGlobalPerspective = (props)=>/*#__PURE__*/ jsx(\"svg\", _object_spread_props(_object_spread({\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 16,\n        height: 16,\n        fill: \"none\",\n        viewBox: \"0 0 16 16\"\n    }, props), {\n        children: /*#__PURE__*/ jsx(\"path\", {\n            fill: \"currentColor\",\n            d: \"M1.333 13v-2.5a.667.667 0 0 1 1.334 0V13c0 .184.149.333.333.333h2.5a.667.667 0 0 1 0 1.334H3c-.92 0-1.667-.746-1.667-1.667m12 0v-2.5a.667.667 0 0 1 1.334 0V13c0 .92-.746 1.667-1.667 1.667h-2.5a.667.667 0 0 1 0-1.334H13a.333.333 0 0 0 .333-.333m-12-7.5V3c0-.92.747-1.667 1.667-1.667h2.5a.667.667 0 0 1 0 1.334H3A.333.333 0 0 0 2.667 3v2.5a.667.667 0 0 1-1.334 0m12 0V3A.333.333 0 0 0 13 2.667h-2.5a.667.667 0 0 1 0-1.334H13c.92 0 1.667.747 1.667 1.667v2.5a.667.667 0 0 1-1.334 0M5.667 10.333h4.666V5.667H5.667zm6 .167c0 .644-.523 1.167-1.167 1.167h-5A1.167 1.167 0 0 1 4.333 10.5v-5c0-.644.523-1.167 1.167-1.167h5c.644 0 1.167.523 1.167 1.167z\"\n        })\n    }));\nconst global_perspective = SvgGlobalPerspective;\nexport { global_perspective as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction player_setting_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else player_setting_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst SvgPlayerSetting = (props)=>/*#__PURE__*/ jsxs(\"svg\", _object_spread_props(_object_spread({\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 16,\n        height: 16,\n        fill: \"none\",\n        viewBox: \"0 0 16 16\"\n    }, props), {\n        children: [\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"currentColor\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 1.333,\n                d: \"M11.333 13.667 14.667 8l-3.334-5.667H4.667L1.333 8l3.334 5.667z\"\n            }),\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"currentColor\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 1.333,\n                d: \"M8 9.667a1.667 1.667 0 1 0 0-3.334 1.667 1.667 0 0 0 0 3.334Z\"\n            })\n        ]\n    }));\nconst player_setting = SvgPlayerSetting;\nexport { player_setting as default };\n","import \"pixi.js/unsafe-eval\";\nimport { Assets } from \"pixi.js\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nconst globalTextureMap = new Map();\nconst loadTexture = (img)=>_async_to_generator(function*() {\n        if (globalTextureMap.has(img)) return;\n        return Assets.load(img).then((texture)=>{\n            globalTextureMap.set(img, texture);\n        });\n    })();\nconst getTextureFromCache = (name)=>globalTextureMap.get(name);\nconst getTexture = (name)=>_async_to_generator(function*() {\n        if (globalTextureMap.has(name)) return globalTextureMap.get(name);\n        yield loadTexture(name);\n        return globalTextureMap.get(name);\n    })();\nexport { getTexture, getTextureFromCache, loadTexture };\n","\"use client\";\nimport { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"pixi.js/unsafe-eval\";\nimport { Application, Container, Sprite } from \"pixi.js\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport \"./index.css\";\nimport { mouseLoading, mousePointer } from \"../../utils/index.mjs\";\nimport { CaretRightOutlined, DownloadOutlined, ExportOutlined, LoadingOutlined } from \"@ant-design/icons\";\nimport { Dropdown, Spin, Switch, Tooltip, message } from \"antd\";\nimport global_perspective from \"../../icons/global-perspective.mjs\";\nimport player_setting from \"../../icons/player-setting.mjs\";\nimport { useGlobalPreference } from \"../../store/store.mjs\";\nimport { getTextureFromCache, loadTexture } from \"../../utils/pixi-loader.mjs\";\nimport { rectMarkForItem } from \"../blackboard/index.mjs\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction player_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else player_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst canvasPaddingLeft = 0;\nconst canvasPaddingTop = 0;\nconst cubicBezier = (t, p0, p1, p2, p3)=>{\n    const t2 = 1 - t;\n    return p0 * t2 * t2 * t2 + 3 * p1 * t * t2 * t2 + 3 * p2 * t * t * t2 + p3 * t * t * t;\n};\nconst cubicImage = (t)=>linear(t);\nconst cubicInsightElement = (t)=>cubicBezier(t, 0, 0.5, 0.5, 1);\nconst cubicMouse = (t)=>linear(t);\nconst linear = (t)=>t;\nconst sleep = (ms)=>new Promise((resolve)=>setTimeout(resolve, ms));\nconst ERROR_FRAME_CANCEL = 'frame cancel (this is an error on purpose)';\nconst frameKit = ()=>{\n    let cancelFlag = false;\n    return {\n        frame: (callback)=>{\n            if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n            requestAnimationFrame(()=>{\n                if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n                callback(performance.now());\n            });\n        },\n        timeout: (callback, ms)=>{\n            if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n            setTimeout(()=>{\n                if (cancelFlag) throw new Error(ERROR_FRAME_CANCEL);\n                callback();\n            }, ms);\n        },\n        cancel: ()=>{\n            cancelFlag = true;\n        }\n    };\n};\nconst singleElementFadeInDuration = 80;\nconst LAYER_ORDER_IMG = 0;\nconst LAYER_ORDER_INSIGHT = 1;\nconst LAYER_ORDER_POINTER = 2;\nconst LAYER_ORDER_SPINNING_POINTER = 3;\nconst downloadReport = (content)=>{\n    const blob = new Blob([\n        content\n    ], {\n        type: 'text/html'\n    });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = 'midscene_report.html';\n    a.click();\n};\nclass RecordingSession {\n    start() {\n        const stream = this.canvas.captureStream(60);\n        const mediaRecorder = new MediaRecorder(stream, {\n            mimeType: 'video/webm'\n        });\n        mediaRecorder.ondataavailable = (event)=>{\n            if (event.data.size > 0) this.chunks.push(event.data);\n        };\n        mediaRecorder.onerror = (event)=>{\n            console.error('MediaRecorder error:', event);\n            message.error('Video recording failed. Please try again.');\n            this.recording = false;\n            this.mediaRecorder = null;\n        };\n        this.mediaRecorder = mediaRecorder;\n        this.recording = true;\n        return this.mediaRecorder.start();\n    }\n    stop() {\n        if (!this.recording || !this.mediaRecorder) return void console.warn('not recording');\n        this.mediaRecorder.onstop = ()=>{\n            if (0 === this.chunks.length) {\n                console.error('No video data captured');\n                message.error('Video export failed: No data captured.');\n                return;\n            }\n            const blob = new Blob(this.chunks, {\n                type: 'video/webm'\n            });\n            if (0 === blob.size) {\n                console.error('Video blob is empty');\n                message.error('Video export failed: Empty file.');\n                return;\n            }\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'midscene_replay.webm';\n            a.click();\n            URL.revokeObjectURL(url);\n        };\n        this.mediaRecorder.stop();\n        this.recording = false;\n        this.mediaRecorder = null;\n    }\n    constructor(canvas){\n        _define_property(this, \"canvas\", void 0);\n        _define_property(this, \"mediaRecorder\", null);\n        _define_property(this, \"chunks\", void 0);\n        _define_property(this, \"recording\", false);\n        this.canvas = canvas;\n        this.chunks = [];\n    }\n}\nfunction Player(props) {\n    var _scripts_;\n    const [titleText, setTitleText] = useState('');\n    const [subTitleText, setSubTitleText] = useState('');\n    const { autoZoom, setAutoZoom } = useGlobalPreference();\n    useEffect(()=>{\n        if ((null == props ? void 0 : props.autoZoom) !== void 0) setAutoZoom(props.autoZoom);\n    }, [\n        null == props ? void 0 : props.autoZoom,\n        setAutoZoom\n    ]);\n    const scripts = null == props ? void 0 : props.replayScripts;\n    const imageWidth = (null == props ? void 0 : props.imageWidth) || 1920;\n    const imageHeight = (null == props ? void 0 : props.imageHeight) || 1080;\n    const fitMode = (null == props ? void 0 : props.fitMode) || 'height';\n    const currentImg = useRef((null == scripts ? void 0 : null == (_scripts_ = scripts[0]) ? void 0 : _scripts_.img) || null);\n    const divContainerRef = useRef(null);\n    const app = useMemo(()=>new Application(), []);\n    const pointerSprite = useRef(null);\n    const spinningPointerSprite = useRef(null);\n    const [replayMark, setReplayMark] = useState(0);\n    const triggerReplay = ()=>{\n        setReplayMark(Date.now());\n    };\n    const windowContentContainer = useMemo(()=>{\n        const container = new Container();\n        return container;\n    }, []);\n    const insightMarkContainer = useMemo(()=>{\n        const container = new Container();\n        container.zIndex = LAYER_ORDER_INSIGHT;\n        return container;\n    }, []);\n    const basicCameraState = {\n        left: 0,\n        top: 0,\n        width: imageWidth,\n        pointerLeft: Math.round(imageWidth / 2),\n        pointerTop: Math.round(imageHeight / 2)\n    };\n    const [animationProgress, setAnimationProgress] = useState(-1);\n    const cancelFlag = useRef(false);\n    useEffect(()=>{\n        cancelFlag.current = false;\n        return ()=>{\n            cancelFlag.current = true;\n        };\n    }, []);\n    const cameraState = useRef(_object_spread({}, basicCameraState));\n    const resizeCanvasIfNeeded = (newWidth, newHeight)=>_async_to_generator(function*() {\n            if (app.screen.width !== newWidth || app.screen.height !== newHeight) {\n                app.renderer.resize(newWidth, newHeight);\n                if (divContainerRef.current) {\n                    const aspectRatio = newWidth / newHeight;\n                    divContainerRef.current.style.setProperty('--canvas-aspect-ratio', aspectRatio.toString());\n                }\n                const newBasicCameraState = {\n                    left: 0,\n                    top: 0,\n                    width: newWidth,\n                    pointerLeft: Math.round(newWidth / 2),\n                    pointerTop: Math.round(newHeight / 2)\n                };\n                cameraState.current = newBasicCameraState;\n            }\n        })();\n    const repaintImage = (scriptWidth, scriptHeight)=>_async_to_generator(function*() {\n            const imgToUpdate = currentImg.current;\n            if (!imgToUpdate) return void console.warn('no image to update');\n            const targetWidth = scriptWidth || imageWidth;\n            const targetHeight = scriptHeight || imageHeight;\n            yield resizeCanvasIfNeeded(targetWidth, targetHeight);\n            if (!getTextureFromCache(imgToUpdate)) {\n                console.warn('image not loaded', imgToUpdate);\n                yield loadTexture(imgToUpdate);\n            }\n            const texture = getTextureFromCache(imgToUpdate);\n            if (!texture) throw new Error('texture not found');\n            const sprite = Sprite.from(texture);\n            if (!sprite) throw new Error('sprite not found');\n            const mainImgLabel = 'main-img';\n            const child = windowContentContainer.getChildByLabel(mainImgLabel);\n            if (child) windowContentContainer.removeChild(child);\n            sprite.label = mainImgLabel;\n            sprite.zIndex = LAYER_ORDER_IMG;\n            sprite.width = targetWidth;\n            sprite.height = targetHeight;\n            windowContentContainer.addChild(sprite);\n        })();\n    const spinningPointer = (frame)=>{\n        var _pointerSprite_current, _pointerSprite_current1;\n        if (!spinningPointerSprite.current) {\n            spinningPointerSprite.current = Sprite.from(mouseLoading);\n            spinningPointerSprite.current.zIndex = LAYER_ORDER_SPINNING_POINTER;\n            spinningPointerSprite.current.anchor.set(0.5, 0.5);\n            spinningPointerSprite.current.scale.set(0.5);\n            spinningPointerSprite.current.label = 'spinning-pointer';\n        }\n        spinningPointerSprite.current.x = (null == (_pointerSprite_current = pointerSprite.current) ? void 0 : _pointerSprite_current.x) || 0;\n        spinningPointerSprite.current.y = (null == (_pointerSprite_current1 = pointerSprite.current) ? void 0 : _pointerSprite_current1.y) || 0;\n        windowContentContainer.addChild(spinningPointerSprite.current);\n        let startTime;\n        let isCancelled = false;\n        const animate = (currentTime)=>{\n            if (isCancelled) return;\n            if (!startTime) startTime = currentTime;\n            const elapsedTime = currentTime - startTime;\n            const progress = (Math.sin(elapsedTime / 500 - Math.PI / 2) + 1) / 2;\n            const rotation = progress * Math.PI * 2;\n            if (spinningPointerSprite.current) spinningPointerSprite.current.rotation = rotation;\n            frame(animate);\n        };\n        frame(animate);\n        const stopFn = ()=>{\n            if (spinningPointerSprite.current) windowContentContainer.removeChild(spinningPointerSprite.current);\n            isCancelled = true;\n        };\n        return stopFn;\n    };\n    const updatePointer = (img, x, y)=>_async_to_generator(function*() {\n            var _pointerSprite_current, _pointerSprite_current1;\n            if (!getTextureFromCache(img)) {\n                console.warn('image not loaded', img);\n                yield loadTexture(img);\n            }\n            const texture = getTextureFromCache(img);\n            if (!texture) throw new Error('texture not found');\n            const sprite = Sprite.from(texture);\n            let targetX = null == (_pointerSprite_current = pointerSprite.current) ? void 0 : _pointerSprite_current.x;\n            let targetY = null == (_pointerSprite_current1 = pointerSprite.current) ? void 0 : _pointerSprite_current1.y;\n            if ('number' == typeof x) targetX = x;\n            if ('number' == typeof y) targetY = y;\n            if (void 0 === targetX || void 0 === targetY) return void console.warn('invalid pointer position', x, y);\n            if (pointerSprite.current) {\n                const pointer = windowContentContainer.getChildByLabel('pointer');\n                if (pointer) windowContentContainer.removeChild(pointer);\n            }\n            pointerSprite.current = sprite;\n            pointerSprite.current.x = targetX;\n            pointerSprite.current.y = targetY;\n            pointerSprite.current.label = 'pointer';\n            pointerSprite.current.zIndex = LAYER_ORDER_POINTER;\n            windowContentContainer.addChild(pointerSprite.current);\n        })();\n    const updateCamera = (state, currentWidth)=>{\n        cameraState.current = state;\n        const effectiveWidth = currentWidth || app.screen.width || imageWidth;\n        const newScale = autoZoom ? Math.max(1, effectiveWidth / state.width) : 1;\n        windowContentContainer.scale.set(newScale);\n        windowContentContainer.x = autoZoom ? Math.round(canvasPaddingLeft - state.left * newScale) : canvasPaddingLeft;\n        windowContentContainer.y = autoZoom ? Math.round(canvasPaddingTop - state.top * newScale) : canvasPaddingTop;\n        const pointer = windowContentContainer.getChildByLabel('pointer');\n        if (pointer) {\n            pointer.scale.set(1 / newScale);\n            if ('number' == typeof state.pointerLeft && 'number' == typeof state.pointerTop) {\n                pointer.x = state.pointerLeft;\n                pointer.y = state.pointerTop;\n            }\n        }\n    };\n    const cameraAnimation = (targetState, duration, frame)=>_async_to_generator(function*() {\n            const currentCanvasWidth = app.screen.width || imageWidth;\n            const currentCanvasHeight = app.screen.height || imageHeight;\n            if (!autoZoom) {\n                const currentState = _object_spread({}, cameraState.current);\n                const startPointerLeft = currentState.pointerLeft;\n                const startPointerTop = currentState.pointerTop;\n                const startTime = performance.now();\n                const shouldMovePointer = 'number' == typeof targetState.pointerLeft && 'number' == typeof targetState.pointerTop && (targetState.pointerLeft !== startPointerLeft || targetState.pointerTop !== startPointerTop);\n                if (!shouldMovePointer) return;\n                yield new Promise((resolve)=>{\n                    const animate = (currentTime)=>{\n                        const elapsedTime = currentTime - startTime;\n                        const rawProgress = Math.min(elapsedTime / duration, 1);\n                        const progress = cubicMouse(rawProgress);\n                        const nextState = _object_spread_props(_object_spread({}, currentState), {\n                            pointerLeft: startPointerLeft + (targetState.pointerLeft - startPointerLeft) * progress,\n                            pointerTop: startPointerTop + (targetState.pointerTop - startPointerTop) * progress\n                        });\n                        updateCamera(nextState, currentCanvasWidth);\n                        if (elapsedTime < duration) frame(animate);\n                        else resolve();\n                    };\n                    frame(animate);\n                });\n                return;\n            }\n            const currentState = _object_spread({}, cameraState.current);\n            const startLeft = currentState.left;\n            const startTop = currentState.top;\n            const startPointerLeft = currentState.pointerLeft;\n            const startPointerTop = currentState.pointerTop;\n            const startScale = currentState.width / currentCanvasWidth;\n            const startTime = performance.now();\n            const shouldMovePointer = 'number' == typeof targetState.pointerLeft && 'number' == typeof targetState.pointerTop && (targetState.pointerLeft !== startPointerLeft || targetState.pointerTop !== startPointerTop);\n            const pointerMoveDuration = shouldMovePointer ? 0.375 * duration : 0;\n            const cameraMoveStart = pointerMoveDuration;\n            const cameraMoveDuration = duration - pointerMoveDuration;\n            yield new Promise((resolve)=>{\n                const animate = (currentTime)=>{\n                    const nextState = _object_spread({}, cameraState.current);\n                    const elapsedTime = currentTime - startTime;\n                    if (shouldMovePointer) if (elapsedTime <= pointerMoveDuration) {\n                        const rawMouseProgress = Math.min(elapsedTime / pointerMoveDuration, 1);\n                        const mouseProgress = cubicMouse(rawMouseProgress);\n                        nextState.pointerLeft = startPointerLeft + (targetState.pointerLeft - startPointerLeft) * mouseProgress;\n                        nextState.pointerTop = startPointerTop + (targetState.pointerTop - startPointerTop) * mouseProgress;\n                    } else {\n                        nextState.pointerLeft = targetState.pointerLeft;\n                        nextState.pointerTop = targetState.pointerTop;\n                    }\n                    if (elapsedTime > cameraMoveStart) {\n                        const cameraElapsedTime = elapsedTime - cameraMoveStart;\n                        const rawCameraProgress = Math.min(cameraElapsedTime / cameraMoveDuration, 1);\n                        const cameraProgress = cubicImage(rawCameraProgress);\n                        const targetScale = targetState.width / currentCanvasWidth;\n                        const progressScale = startScale + (targetScale - startScale) * cameraProgress;\n                        const progressWidth = currentCanvasWidth * progressScale;\n                        const progressHeight = currentCanvasHeight * progressScale;\n                        nextState.width = progressWidth;\n                        const progressLeft = startLeft + (targetState.left - startLeft) * cameraProgress;\n                        const progressTop = startTop + (targetState.top - startTop) * cameraProgress;\n                        const horizontalExceed = progressLeft + progressWidth - currentCanvasWidth;\n                        const verticalExceed = progressTop + progressHeight - currentCanvasHeight;\n                        nextState.left = horizontalExceed > 0 ? progressLeft + horizontalExceed : progressLeft;\n                        nextState.top = verticalExceed > 0 ? progressTop + verticalExceed : progressTop;\n                    }\n                    updateCamera(nextState, currentCanvasWidth);\n                    if (elapsedTime < duration) frame(animate);\n                    else resolve();\n                };\n                frame(animate);\n            });\n        })();\n    const fadeInGraphics = (graphics, duration, frame, targetAlpha = 1)=>new Promise((resolve)=>{\n            const startTime = performance.now();\n            const animate = (currentTime)=>{\n                const elapsedTime = currentTime - startTime;\n                const progress = Math.min(elapsedTime / duration, 1);\n                graphics.alpha = 0 === targetAlpha ? 1 - linear(progress) : linear(progress);\n                if (elapsedTime < duration) frame(animate);\n                else resolve();\n            };\n            frame(animate);\n        });\n    const fadeOutItem = (graphics, duration, frame)=>_async_to_generator(function*() {\n            return fadeInGraphics(graphics, duration, frame, 0);\n        })();\n    const insightElementsAnimation = (elements, highlightElements, searchArea, duration, frame)=>_async_to_generator(function*() {\n            insightMarkContainer.removeChildren();\n            const elementsToAdd = [\n                ...elements\n            ];\n            const totalLength = elementsToAdd.length;\n            let childrenCount = 0;\n            yield new Promise((resolve)=>{\n                const startTime = performance.now();\n                const animate = (currentTime)=>{\n                    const elapsedTime = currentTime - startTime;\n                    const progress = cubicInsightElement(Math.min(elapsedTime / duration, 1));\n                    const elementsToAddNow = Math.floor(progress * totalLength);\n                    while(childrenCount < elementsToAddNow){\n                        const randomIndex = Math.floor(Math.random() * elementsToAdd.length);\n                        const element = elementsToAdd.splice(randomIndex, 1)[0];\n                        if (element) {\n                            const [insightMarkGraphic] = rectMarkForItem(element.rect, element.content, 'element');\n                            insightMarkGraphic.alpha = 0;\n                            insightMarkContainer.addChild(insightMarkGraphic);\n                            childrenCount++;\n                            fadeInGraphics(insightMarkGraphic, singleElementFadeInDuration, frame);\n                        }\n                    }\n                    if (elapsedTime < duration) frame(animate);\n                    else {\n                        while(elementsToAdd.length > 0){\n                            const randomIndex = Math.floor(Math.random() * elementsToAdd.length);\n                            const element = elementsToAdd.splice(randomIndex, 1)[0];\n                            const [insightMarkGraphic] = rectMarkForItem(element.rect, element.content, 'element');\n                            insightMarkGraphic.alpha = 1;\n                            insightMarkContainer.addChild(insightMarkGraphic);\n                        }\n                        if (searchArea) {\n                            const [searchAreaGraphic] = rectMarkForItem(searchArea, 'Search Area', 'searchArea');\n                            searchAreaGraphic.alpha = 1;\n                            insightMarkContainer.addChild(searchAreaGraphic);\n                        }\n                        highlightElements.map((element)=>{\n                            const [insightMarkGraphic] = rectMarkForItem(element.rect, element.content || '', 'highlight');\n                            insightMarkGraphic.alpha = 1;\n                            insightMarkContainer.addChild(insightMarkGraphic);\n                        });\n                        resolve();\n                    }\n                };\n                frame(animate);\n            });\n        })();\n    const init = ()=>_async_to_generator(function*() {\n            if (!divContainerRef.current || !scripts) return;\n            yield app.init({\n                width: imageWidth,\n                height: imageHeight,\n                background: 0xf4f4f4,\n                autoDensity: true,\n                antialias: true\n            });\n            if (!divContainerRef.current) return;\n            divContainerRef.current.appendChild(app.canvas);\n            windowContentContainer.x = 0;\n            windowContentContainer.y = 0;\n            app.stage.addChild(windowContentContainer);\n            insightMarkContainer.x = 0;\n            insightMarkContainer.y = 0;\n            windowContentContainer.addChild(insightMarkContainer);\n        })();\n    const [isRecording, setIsRecording] = useState(false);\n    const recorderSessionRef = useRef(null);\n    const cancelAnimationRef = useRef(null);\n    const handleExport = ()=>_async_to_generator(function*() {\n            if (recorderSessionRef.current) return void console.warn('recorderSession exists');\n            if (!app.canvas) return void console.warn('canvas is not initialized');\n            if (cancelAnimationRef.current) {\n                cancelAnimationRef.current();\n                cancelAnimationRef.current = null;\n                yield new Promise((resolve)=>setTimeout(resolve, 100));\n            }\n            recorderSessionRef.current = new RecordingSession(app.canvas);\n            setIsRecording(true);\n            triggerReplay();\n        })();\n    const play = ()=>{\n        let cancelFn;\n        Promise.resolve((()=>_async_to_generator(function*() {\n                if (!app) throw new Error('app is not initialized');\n                if (!scripts) throw new Error(\"scripts is required\");\n                const { frame, cancel, timeout } = frameKit();\n                cancelFn = cancel;\n                cancelAnimationRef.current = cancel;\n                const allImages = scripts.filter((item)=>!!item.img).map((item)=>item.img);\n                yield Promise.all([\n                    ...allImages,\n                    mouseLoading,\n                    mousePointer\n                ].map(loadTexture));\n                insightMarkContainer.removeChildren();\n                yield updatePointer(mousePointer, imageWidth / 2, imageHeight / 2);\n                yield repaintImage();\n                yield updateCamera(_object_spread({}, basicCameraState));\n                const totalDuration = scripts.reduce((acc, item)=>acc + item.duration + (item.camera && item.insightCameraDuration ? item.insightCameraDuration : 0), 0);\n                const progressUpdateInterval = 200;\n                const startTime = performance.now();\n                setAnimationProgress(0);\n                const updateProgress = ()=>{\n                    const progress = Math.min((performance.now() - startTime) / totalDuration, 1);\n                    setAnimationProgress(progress);\n                    if (progress < 1) return timeout(updateProgress, progressUpdateInterval);\n                };\n                frame(updateProgress);\n                if (recorderSessionRef.current) recorderSessionRef.current.start();\n                for(const index in scripts){\n                    const item = scripts[index];\n                    setTitleText(item.title || '');\n                    setSubTitleText(item.subTitle || '');\n                    if ('sleep' === item.type) yield sleep(item.duration);\n                    else if ('insight' === item.type) {\n                        if (!item.img) throw new Error('img is required');\n                        currentImg.current = item.img;\n                        yield repaintImage(item.imageWidth, item.imageHeight);\n                        const highlightElements = item.highlightElement ? [\n                            item.highlightElement\n                        ] : [];\n                        yield insightElementsAnimation([], highlightElements, item.searchArea, item.duration, frame);\n                        if (item.camera) {\n                            if (!item.insightCameraDuration) throw new Error('insightCameraDuration is required');\n                            yield cameraAnimation(item.camera, item.insightCameraDuration, frame);\n                        }\n                    } else if ('clear-insight' === item.type) {\n                        yield fadeOutItem(insightMarkContainer, item.duration, frame);\n                        insightMarkContainer.removeChildren();\n                        insightMarkContainer.alpha = 1;\n                    } else if ('img' === item.type) {\n                        if (item.img && item.img !== currentImg.current) {\n                            currentImg.current = item.img;\n                            yield repaintImage(item.imageWidth, item.imageHeight);\n                        }\n                        if (item.camera) yield cameraAnimation(item.camera, item.duration, frame);\n                        else yield sleep(item.duration);\n                    } else if ('pointer' === item.type) {\n                        if (!item.img) throw new Error('pointer img is required');\n                        yield updatePointer(item.img);\n                    } else if ('spinning-pointer' === item.type) {\n                        const stop = spinningPointer(frame);\n                        yield sleep(item.duration);\n                        stop();\n                    }\n                }\n                if (recorderSessionRef.current) {\n                    yield sleep(1200);\n                    recorderSessionRef.current.stop();\n                    recorderSessionRef.current = null;\n                    setIsRecording(false);\n                }\n            })())().catch((e)=>{\n            console.error('player error', e);\n            if ((null == e ? void 0 : e.message) === ERROR_FRAME_CANCEL) return void console.log('Animation cancelled (expected behavior)');\n            const wasRecording = !!recorderSessionRef.current;\n            if (recorderSessionRef.current) {\n                try {\n                    recorderSessionRef.current.stop();\n                } catch (stopError) {\n                    console.error('Error stopping recorder:', stopError);\n                }\n                recorderSessionRef.current = null;\n            }\n            setIsRecording(false);\n            if (wasRecording) message.error('Failed to export video. Please try again.');\n        }));\n        return ()=>{\n            null == cancelFn || cancelFn();\n            cancelAnimationRef.current = null;\n        };\n    };\n    useEffect(()=>{\n        Promise.resolve((()=>_async_to_generator(function*() {\n                yield init();\n                if (divContainerRef.current && imageWidth && imageHeight) {\n                    const aspectRatio = imageWidth / imageHeight;\n                    divContainerRef.current.style.setProperty('--canvas-aspect-ratio', aspectRatio.toString());\n                    divContainerRef.current.setAttribute('data-fit-mode', fitMode);\n                    const playerContainer = divContainerRef.current.closest('.player-container');\n                    if (playerContainer) playerContainer.setAttribute('data-fit-mode', fitMode);\n                }\n                triggerReplay();\n            })())());\n        return ()=>{\n            try {\n                app.destroy(true, {\n                    children: true,\n                    texture: true\n                });\n            } catch (e) {\n                console.warn('destroy failed', e);\n            }\n        };\n    }, [\n        imageWidth,\n        imageHeight,\n        fitMode\n    ]);\n    useEffect(()=>{\n        if (replayMark) return play();\n    }, [\n        replayMark\n    ]);\n    const [mouseOverStatusIcon, setMouseOverStatusIcon] = useState(false);\n    const [mouseOverSettingsIcon, setMouseOverSettingsIcon] = useState(false);\n    const progressString = Math.round(100 * animationProgress);\n    const transitionStyle = 0 === animationProgress ? 'none' : '0.3s';\n    const canReplayNow = 1 === animationProgress;\n    useEffect(()=>{\n        if (canReplayNow) {\n            const listener = (event)=>{\n                if (' ' === event.key) triggerReplay();\n            };\n            window.addEventListener('keydown', listener);\n            return ()=>{\n                window.removeEventListener('keydown', listener);\n            };\n        }\n    }, [\n        canReplayNow\n    ]);\n    let statusIconElement;\n    let statusOnClick = ()=>{};\n    if (animationProgress < 1) statusIconElement = /*#__PURE__*/ jsx(Spin, {\n        indicator: /*#__PURE__*/ jsx(LoadingOutlined, {\n            spin: true,\n            color: \"#333\"\n        }),\n        size: \"default\"\n    });\n    else if (mouseOverStatusIcon) {\n        statusIconElement = /*#__PURE__*/ jsx(Spin, {\n            indicator: /*#__PURE__*/ jsx(CaretRightOutlined, {\n                color: \"#333\"\n            }),\n            size: \"default\"\n        });\n        statusOnClick = ()=>triggerReplay();\n    } else statusIconElement = /*#__PURE__*/ jsx(Spin, {\n        indicator: /*#__PURE__*/ jsx(CaretRightOutlined, {\n            color: \"#333\"\n        }),\n        size: \"default\"\n    });\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"player-container\",\n        children: [\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"canvas-container\",\n                ref: divContainerRef\n            }),\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"player-timeline-wrapper\",\n                children: /*#__PURE__*/ jsx(\"div\", {\n                    className: \"player-timeline\",\n                    children: /*#__PURE__*/ jsx(\"div\", {\n                        className: \"player-timeline-progress\",\n                        style: {\n                            width: `${progressString}%`,\n                            transition: transitionStyle\n                        }\n                    })\n                })\n            }),\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"player-tools-wrapper\",\n                children: /*#__PURE__*/ jsx(\"div\", {\n                    className: \"player-tools\",\n                    children: /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"player-control\",\n                        children: [\n                            /*#__PURE__*/ jsxs(\"div\", {\n                                className: \"status-text\",\n                                children: [\n                                    /*#__PURE__*/ jsx(\"div\", {\n                                        className: \"title\",\n                                        children: titleText\n                                    }),\n                                    /*#__PURE__*/ jsx(Tooltip, {\n                                        title: subTitleText,\n                                        children: /*#__PURE__*/ jsx(\"div\", {\n                                            className: \"subtitle\",\n                                            children: subTitleText\n                                        })\n                                    })\n                                ]\n                            }),\n                            isRecording ? null : /*#__PURE__*/ jsx(\"div\", {\n                                className: \"status-icon\",\n                                onMouseEnter: ()=>setMouseOverStatusIcon(true),\n                                onMouseLeave: ()=>setMouseOverStatusIcon(false),\n                                onClick: statusOnClick,\n                                children: statusIconElement\n                            }),\n                            (null == props ? void 0 : props.reportFileContent) && (null == props ? void 0 : props.canDownloadReport) !== false ? /*#__PURE__*/ jsx(Tooltip, {\n                                title: \"Download Report\",\n                                children: /*#__PURE__*/ jsx(\"div\", {\n                                    className: \"status-icon\",\n                                    onMouseEnter: ()=>setMouseOverStatusIcon(true),\n                                    onMouseLeave: ()=>setMouseOverStatusIcon(false),\n                                    onClick: ()=>downloadReport(props.reportFileContent),\n                                    children: /*#__PURE__*/ jsx(DownloadOutlined, {\n                                        color: \"#333\"\n                                    })\n                                })\n                            }) : null,\n                            /*#__PURE__*/ jsx(Tooltip, {\n                                title: isRecording ? 'Generating...' : 'Export Video',\n                                children: /*#__PURE__*/ jsx(\"div\", {\n                                    className: \"status-icon\",\n                                    onClick: isRecording ? void 0 : handleExport,\n                                    style: {\n                                        opacity: isRecording ? 0.5 : 1,\n                                        cursor: isRecording ? 'not-allowed' : 'pointer'\n                                    },\n                                    children: isRecording ? /*#__PURE__*/ jsx(Spin, {\n                                        size: \"default\",\n                                        percent: progressString\n                                    }) : /*#__PURE__*/ jsx(ExportOutlined, {})\n                                })\n                            }),\n                            /*#__PURE__*/ jsx(Dropdown, {\n                                trigger: [\n                                    'hover',\n                                    'click'\n                                ],\n                                placement: \"bottomRight\",\n                                overlayStyle: {\n                                    minWidth: '148px'\n                                },\n                                dropdownRender: (menu)=>/*#__PURE__*/ jsx(\"div\", {\n                                        style: {\n                                            borderRadius: '8px',\n                                            border: '1px solid rgba(0, 0, 0, 0.08)',\n                                            backgroundColor: '#fff',\n                                            boxShadow: '0 2px 8px rgba(0, 0, 0, 0.08)',\n                                            overflow: 'hidden'\n                                        },\n                                        children: menu\n                                    }),\n                                menu: {\n                                    style: {\n                                        borderRadius: '8px',\n                                        padding: 0\n                                    },\n                                    items: [\n                                        {\n                                            key: 'autoZoom',\n                                            style: {\n                                                height: '39px',\n                                                margin: 0,\n                                                padding: '0 12px'\n                                            },\n                                            label: /*#__PURE__*/ jsxs(\"div\", {\n                                                style: {\n                                                    display: 'flex',\n                                                    alignItems: 'center',\n                                                    justifyContent: 'space-between',\n                                                    width: '100%',\n                                                    height: '39px'\n                                                },\n                                                children: [\n                                                    /*#__PURE__*/ jsxs(\"div\", {\n                                                        style: {\n                                                            display: 'flex',\n                                                            alignItems: 'center',\n                                                            gap: '4px'\n                                                        },\n                                                        children: [\n                                                            /*#__PURE__*/ jsx(global_perspective, {\n                                                                style: {\n                                                                    width: '16px',\n                                                                    height: '16px'\n                                                                }\n                                                            }),\n                                                            /*#__PURE__*/ jsx(\"span\", {\n                                                                style: {\n                                                                    fontSize: '12px',\n                                                                    marginRight: '16px'\n                                                                },\n                                                                children: \"Focus on cursor\"\n                                                            })\n                                                        ]\n                                                    }),\n                                                    /*#__PURE__*/ jsx(Switch, {\n                                                        size: \"small\",\n                                                        checked: autoZoom,\n                                                        onChange: (checked)=>{\n                                                            setAutoZoom(checked);\n                                                            triggerReplay();\n                                                        },\n                                                        onClick: (_, e)=>{\n                                                            var _e_stopPropagation;\n                                                            return null == e ? void 0 : null == (_e_stopPropagation = e.stopPropagation) ? void 0 : _e_stopPropagation.call(e);\n                                                        }\n                                                    })\n                                                ]\n                                            })\n                                        }\n                                    ]\n                                },\n                                children: /*#__PURE__*/ jsx(\"div\", {\n                                    className: \"status-icon\",\n                                    onMouseEnter: ()=>setMouseOverSettingsIcon(true),\n                                    onMouseLeave: ()=>setMouseOverSettingsIcon(false),\n                                    style: {\n                                        cursor: 'pointer',\n                                        display: 'flex',\n                                        alignItems: 'center',\n                                        justifyContent: 'center',\n                                        opacity: mouseOverSettingsIcon ? 1 : 0.7,\n                                        transition: 'opacity 0.2s'\n                                    },\n                                    children: /*#__PURE__*/ jsx(player_setting, {\n                                        style: {\n                                            width: '16px',\n                                            height: '16px'\n                                        }\n                                    })\n                                })\n                            })\n                        ]\n                    })\n                })\n            })\n        ]\n    });\n}\nexport { Player };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport { noReplayAPIs } from \"@midscene/playground\";\nimport { Spin } from \"antd\";\nimport { emptyResultTip, serverLaunchTip } from \"../misc/index.mjs\";\nimport { Player } from \"../player/index.mjs\";\nimport shiny_text from \"../shiny-text/index.mjs\";\nimport \"./index.css\";\nconst PlaygroundResultView = ({ result, loading, serverValid, serviceMode, replayScriptsInfo, replayCounter, loadingProgressText, verticalMode = false, notReadyMessage, fitMode, autoZoom, actionType, canDownloadReport })=>{\n    let resultWrapperClassName = 'result-wrapper';\n    if (verticalMode) resultWrapperClassName += ' vertical-mode-result';\n    if (replayScriptsInfo && verticalMode) resultWrapperClassName += ' result-wrapper-compact';\n    let resultDataToShow = emptyResultTip;\n    const shouldPrioritizeResult = actionType && noReplayAPIs.includes(actionType);\n    if (serverValid || 'Server' !== serviceMode) {\n        if (loading) resultDataToShow = /*#__PURE__*/ jsxs(\"div\", {\n            className: \"loading-container\",\n            children: [\n                /*#__PURE__*/ jsx(Spin, {\n                    spinning: loading,\n                    indicator: /*#__PURE__*/ jsx(LoadingOutlined, {\n                        spin: true\n                    })\n                }),\n                /*#__PURE__*/ jsx(\"div\", {\n                    className: \"loading-progress-text loading-progress-text-progress\",\n                    children: /*#__PURE__*/ jsx(shiny_text, {\n                        text: loadingProgressText,\n                        speed: 3\n                    })\n                })\n            ]\n        });\n        else if (null == result ? void 0 : result.error) {\n            const errorNode = /*#__PURE__*/ jsx(\"pre\", {\n                style: {\n                    color: '#ff4d4f',\n                    whiteSpace: 'pre-wrap'\n                },\n                children: null == result ? void 0 : result.error\n            });\n            resultDataToShow = result.reportHTML || replayScriptsInfo ? /*#__PURE__*/ jsxs(\"div\", {\n                style: {\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: '16px',\n                    height: '100%'\n                },\n                children: [\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        style: {\n                            flex: '0 0 auto',\n                            maxHeight: '40%',\n                            overflow: 'auto'\n                        },\n                        children: [\n                            /*#__PURE__*/ jsx(\"div\", {\n                                style: {\n                                    fontWeight: 'bold',\n                                    marginBottom: '8px'\n                                },\n                                children: \"Error:\"\n                            }),\n                            errorNode\n                        ]\n                    }),\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        style: {\n                            flex: '1 1 auto',\n                            minHeight: 0\n                        },\n                        children: [\n                            /*#__PURE__*/ jsx(\"div\", {\n                                style: {\n                                    fontWeight: 'bold',\n                                    marginBottom: '8px'\n                                },\n                                children: \"Report:\"\n                            }),\n                            /*#__PURE__*/ jsx(Player, {\n                                replayScripts: null == replayScriptsInfo ? void 0 : replayScriptsInfo.scripts,\n                                imageWidth: null == replayScriptsInfo ? void 0 : replayScriptsInfo.width,\n                                imageHeight: null == replayScriptsInfo ? void 0 : replayScriptsInfo.height,\n                                reportFileContent: result.reportHTML || null,\n                                fitMode: fitMode,\n                                autoZoom: autoZoom,\n                                canDownloadReport: null != canDownloadReport ? canDownloadReport : 'In-Browser' !== serviceMode\n                            }, replayCounter)\n                        ]\n                    })\n                ]\n            }) : errorNode;\n        } else if (shouldPrioritizeResult && (null == result ? void 0 : result.result) !== void 0 && replayScriptsInfo) {\n            const resultOutput = 'string' == typeof (null == result ? void 0 : result.result) ? /*#__PURE__*/ jsx(\"pre\", {\n                children: null == result ? void 0 : result.result\n            }) : /*#__PURE__*/ jsx(\"pre\", {\n                children: JSON.stringify(null == result ? void 0 : result.result, null, 2)\n            });\n            const reportContent = (null == result ? void 0 : result.reportHTML) || null;\n            resultDataToShow = /*#__PURE__*/ jsxs(\"div\", {\n                style: {\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: '16px',\n                    height: '100%'\n                },\n                children: [\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        style: {\n                            flex: '0 0 auto'\n                        },\n                        children: [\n                            /*#__PURE__*/ jsx(\"div\", {\n                                style: {\n                                    fontWeight: 'bold',\n                                    marginBottom: '8px'\n                                },\n                                children: \"Output:\"\n                            }),\n                            resultOutput\n                        ]\n                    }),\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        style: {\n                            flex: '1 1 auto',\n                            minHeight: 0\n                        },\n                        children: [\n                            /*#__PURE__*/ jsx(\"div\", {\n                                style: {\n                                    fontWeight: 'bold',\n                                    marginBottom: '8px'\n                                },\n                                children: \"Report:\"\n                            }),\n                            /*#__PURE__*/ jsx(Player, {\n                                replayScripts: replayScriptsInfo.scripts,\n                                imageWidth: replayScriptsInfo.width,\n                                imageHeight: replayScriptsInfo.height,\n                                reportFileContent: reportContent,\n                                fitMode: fitMode,\n                                autoZoom: autoZoom,\n                                canDownloadReport: null != canDownloadReport ? canDownloadReport : 'In-Browser' !== serviceMode\n                            }, replayCounter)\n                        ]\n                    })\n                ]\n            });\n        } else if (replayScriptsInfo) {\n            const reportContent = (null == result ? void 0 : result.reportHTML) || null;\n            resultDataToShow = /*#__PURE__*/ jsx(Player, {\n                replayScripts: replayScriptsInfo.scripts,\n                imageWidth: replayScriptsInfo.width,\n                imageHeight: replayScriptsInfo.height,\n                reportFileContent: reportContent,\n                fitMode: fitMode,\n                autoZoom: autoZoom,\n                canDownloadReport: null != canDownloadReport ? canDownloadReport : 'In-Browser' !== serviceMode\n            }, replayCounter);\n        } else if (shouldPrioritizeResult && (null == result ? void 0 : result.result) !== void 0 && (null == result ? void 0 : result.reportHTML)) {\n            const resultOutput = 'string' == typeof (null == result ? void 0 : result.result) ? /*#__PURE__*/ jsx(\"pre\", {\n                children: null == result ? void 0 : result.result\n            }) : /*#__PURE__*/ jsx(\"pre\", {\n                children: JSON.stringify(null == result ? void 0 : result.result, null, 2)\n            });\n            resultDataToShow = /*#__PURE__*/ jsxs(\"div\", {\n                style: {\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: '16px',\n                    height: '100%'\n                },\n                children: [\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        style: {\n                            flex: '0 0 auto'\n                        },\n                        children: [\n                            /*#__PURE__*/ jsx(\"div\", {\n                                style: {\n                                    fontWeight: 'bold',\n                                    marginBottom: '8px'\n                                },\n                                children: \"Output:\"\n                            }),\n                            resultOutput\n                        ]\n                    }),\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        style: {\n                            flex: '1 1 auto',\n                            minHeight: 0\n                        },\n                        children: [\n                            /*#__PURE__*/ jsx(\"div\", {\n                                style: {\n                                    fontWeight: 'bold',\n                                    marginBottom: '8px'\n                                },\n                                children: \"Report:\"\n                            }),\n                            /*#__PURE__*/ jsx(Player, {\n                                reportFileContent: result.reportHTML,\n                                fitMode: fitMode,\n                                autoZoom: autoZoom,\n                                canDownloadReport: null != canDownloadReport ? canDownloadReport : 'In-Browser' !== serviceMode\n                            }, replayCounter)\n                        ]\n                    })\n                ]\n            });\n        } else if (shouldPrioritizeResult && (null == result ? void 0 : result.result) !== void 0) resultDataToShow = 'string' == typeof (null == result ? void 0 : result.result) ? /*#__PURE__*/ jsx(\"pre\", {\n            children: null == result ? void 0 : result.result\n        }) : /*#__PURE__*/ jsx(\"pre\", {\n            children: JSON.stringify(null == result ? void 0 : result.result, null, 2)\n        });\n        else if (null == result ? void 0 : result.reportHTML) resultDataToShow = /*#__PURE__*/ jsx(Player, {\n            reportFileContent: result.reportHTML,\n            fitMode: fitMode,\n            autoZoom: autoZoom,\n            canDownloadReport: null != canDownloadReport ? canDownloadReport : 'In-Browser' !== serviceMode\n        }, replayCounter);\n        else if ((null == result ? void 0 : result.result) !== void 0) resultDataToShow = 'string' == typeof (null == result ? void 0 : result.result) ? /*#__PURE__*/ jsx(\"pre\", {\n            children: null == result ? void 0 : result.result\n        }) : /*#__PURE__*/ jsx(\"pre\", {\n            children: JSON.stringify(null == result ? void 0 : result.result, null, 2)\n        });\n    } else resultDataToShow = serverLaunchTip(notReadyMessage);\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: resultWrapperClassName,\n        style: {\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column',\n            flex: '1 1 auto',\n            justifyContent: 'center'\n        },\n        children: resultDataToShow\n    });\n};\nexport { PlaygroundResultView };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction avatar_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else avatar_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst SvgAvatar = (props)=>/*#__PURE__*/ jsxs(\"svg\", _object_spread_props(_object_spread({\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 20,\n        height: 20,\n        fill: \"none\",\n        \"aria-label\": \"Playground\",\n        viewBox: \"0 0 20 20\"\n    }, props), {\n        children: [\n            /*#__PURE__*/ jsx(\"rect\", {\n                width: 20,\n                height: 20,\n                fill: \"#2B83FF\",\n                rx: 10\n            }),\n            /*#__PURE__*/ jsx(\"path\", {\n                fill: \"#2B83FF\",\n                stroke: \"#fff\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 1.125,\n                d: \"M6.866 5.882a.56.56 0 0 1 .667-.078l3.248 1.875 3.247 1.875a.563.563 0 0 1 0 .974l-3.247 1.875-3.248 1.875a.563.563 0 0 1-.784-.74l1.749-3.497-1.75-3.498a.56.56 0 0 1 .118-.661Z\"\n            })\n        ]\n    }));\nconst avatar = SvgAvatar;\nexport { avatar as default };\n","import { create } from \"zustand\";\nvar __webpack_require__ = {};\n(()=>{\n    __webpack_require__.d = (exports, definition)=>{\n        for(var key in definition)if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n        });\n    };\n})();\n(()=>{\n    __webpack_require__.o = (obj, prop)=>Object.prototype.hasOwnProperty.call(obj, prop);\n})();\n(()=>{\n    __webpack_require__.r = (exports)=>{\n        if ('undefined' != typeof Symbol && Symbol.toStringTag) Object.defineProperty(exports, Symbol.toStringTag, {\n            value: 'Module'\n        });\n        Object.defineProperty(exports, '__esModule', {\n            value: true\n        });\n    };\n})();\nvar external_zustand_namespaceObject = {};\n__webpack_require__.r(external_zustand_namespaceObject);\n__webpack_require__.d(external_zustand_namespaceObject, {\n    create: ()=>create\n});\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction history_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else history_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst { create: history_create } = external_zustand_namespaceObject;\nconst HISTORY_KEY = 'midscene-prompt-history-v2';\nconst LAST_SELECTED_TYPE_KEY = 'midscene-last-selected-type';\nconst getHistoryFromLocalStorage = ()=>{\n    const historyString = localStorage.getItem(HISTORY_KEY);\n    return historyString ? JSON.parse(historyString) : {};\n};\nconst getLastSelectedType = ()=>localStorage.getItem(LAST_SELECTED_TYPE_KEY) || 'aiAct';\nconst setLastSelectedType = (type)=>{\n    localStorage.setItem(LAST_SELECTED_TYPE_KEY, type);\n};\nconst useHistoryStore = history_create((set, get)=>({\n        history: getHistoryFromLocalStorage(),\n        lastSelectedType: getLastSelectedType(),\n        clearHistory: (type)=>{\n            const newHistory = _object_spread({}, get().history);\n            delete newHistory[type];\n            set({\n                history: newHistory\n            });\n            localStorage.setItem(HISTORY_KEY, JSON.stringify(newHistory));\n        },\n        addHistory: (historyItem)=>{\n            const { type } = historyItem;\n            const currentHistory = get().history;\n            const typeHistory = currentHistory[type] || [];\n            const stringifiedNewItem = JSON.stringify({\n                prompt: historyItem.prompt,\n                params: historyItem.params\n            });\n            const newTypeHistory = [\n                historyItem,\n                ...typeHistory.filter((h)=>{\n                    const stringifiedOldItem = JSON.stringify({\n                        prompt: h.prompt,\n                        params: h.params\n                    });\n                    return stringifiedOldItem !== stringifiedNewItem;\n                })\n            ];\n            if (newTypeHistory.length > 10) newTypeHistory.length = 10;\n            const newHistory = _object_spread_props(_object_spread({}, currentHistory), {\n                [type]: newTypeHistory\n            });\n            set({\n                history: newHistory\n            });\n            localStorage.setItem(HISTORY_KEY, JSON.stringify(newHistory));\n        },\n        getHistoryForType: (type)=>get().history[type] || [],\n        setLastSelectedType: (type)=>{\n            set({\n                lastSelectedType: type\n            });\n            setLastSelectedType(type);\n        }\n    }));\nexport { useHistoryStore };\n","const VALIDATION_CONSTANTS = {\n    ZOD_TYPES: {\n        OPTIONAL: 'ZodOptional',\n        DEFAULT: 'ZodDefault',\n        NULLABLE: 'ZodNullable',\n        OBJECT: 'ZodObject',\n        ENUM: 'ZodEnum',\n        NUMBER: 'ZodNumber',\n        STRING: 'ZodString',\n        BOOLEAN: 'ZodBoolean'\n    },\n    FIELD_FLAGS: {\n        LOCATION: 'midscene_location_field_flag'\n    },\n    DEFAULT_VALUES: {\n        ACTION_TYPE: 'aiAct',\n        TIMEOUT_MS: 15000,\n        CHECK_INTERVAL_MS: 3000\n    }\n};\nconst isZodObjectSchema = (schema)=>'object' == typeof schema && null !== schema && ('shape' in schema || 'ZodObject' === schema.type);\nconst isLocateField = (field)=>{\n    var _field__def;\n    const fieldWithRuntime = field;\n    if ((null == (_field__def = field._def) ? void 0 : _field__def.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.OBJECT) {\n        var _field__def1;\n        let shape;\n        if (field._def.shape) shape = 'function' == typeof field._def.shape ? field._def.shape() : field._def.shape;\n        if (!shape && fieldWithRuntime.shape) shape = fieldWithRuntime.shape;\n        if (shape && VALIDATION_CONSTANTS.FIELD_FLAGS.LOCATION in shape) return true;\n        const description = (null == (_field__def1 = field._def) ? void 0 : _field__def1.description) || fieldWithRuntime.description || '';\n        if ('string' == typeof description && description.toLowerCase().includes('input field')) return true;\n    }\n    if ('object' == typeof field && null !== field) {\n        var _fieldWithRuntime__def;\n        const description = fieldWithRuntime.description || (null == (_fieldWithRuntime__def = fieldWithRuntime._def) ? void 0 : _fieldWithRuntime__def.description) || '';\n        if ('string' == typeof description) {\n            const desc = description.toLowerCase();\n            if (desc.includes('input field') || desc.includes('element') || desc.includes('locate')) return true;\n        }\n        if ('ZodObject' === fieldWithRuntime.typeName || 'ZodObject' === fieldWithRuntime.type) return 'string' == typeof description && description.toLowerCase().includes('input field');\n    }\n    return false;\n};\nconst unwrapZodType = (field)=>{\n    var _actualField__def, _actualField__def1, _actualField__def2;\n    let actualField = field;\n    let isOptional = false;\n    let hasDefault = false;\n    while((null == (_actualField__def = actualField._def) ? void 0 : _actualField__def.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.OPTIONAL || (null == (_actualField__def1 = actualField._def) ? void 0 : _actualField__def1.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.DEFAULT || (null == (_actualField__def2 = actualField._def) ? void 0 : _actualField__def2.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.NULLABLE){\n        var _actualField__def3, _actualField__def4;\n        if ((null == (_actualField__def3 = actualField._def) ? void 0 : _actualField__def3.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.OPTIONAL) isOptional = true;\n        if ((null == (_actualField__def4 = actualField._def) ? void 0 : _actualField__def4.typeName) === VALIDATION_CONSTANTS.ZOD_TYPES.DEFAULT) hasDefault = true;\n        actualField = actualField._def.innerType || actualField;\n    }\n    return {\n        actualField,\n        isOptional,\n        hasDefault\n    };\n};\nconst extractDefaultValue = (field)=>{\n    var _currentField__def;\n    let currentField = field;\n    while(null == (_currentField__def = currentField._def) ? void 0 : _currentField__def.innerType){\n        if (currentField._def.typeName === VALIDATION_CONSTANTS.ZOD_TYPES.DEFAULT && currentField._def.defaultValue) return currentField._def.defaultValue();\n        currentField = currentField._def.innerType;\n    }\n};\nexport { VALIDATION_CONSTANTS, extractDefaultValue, isLocateField, isZodObjectSchema, unwrapZodType };\n","import { StaticPage, StaticPageAgent } from \"@midscene/web/static\";\nimport { isZodObjectSchema, unwrapZodType } from \"../types.mjs\";\nconst actionNameForType = (type)=>{\n    const typeWithoutAi = type.startsWith('ai') ? type.slice(2) : type;\n    if (typeWithoutAi.startsWith('IOS')) return typeWithoutAi.substring(3).replace(/([A-Z])/g, ' $1').replace(/^/, 'IOS').trim();\n    const fullName = typeWithoutAi.replace(/([A-Z])/g, ' $1').trim();\n    const words = fullName.split(' ');\n    if (words.length > 3) return words.slice(-3).join(' ');\n    return fullName;\n};\nconst staticAgentFromContext = (context)=>{\n    const page = new StaticPage(context);\n    return new StaticPageAgent(page);\n};\nconst getPlaceholderForType = (type)=>{\n    if ('aiQuery' === type) return 'What do you want to query?';\n    if ('aiAssert' === type) return 'What do you want to assert?';\n    if ('aiTap' === type) return 'What element do you want to tap?';\n    if ('aiDoubleClick' === type) return 'What element do you want to double-click?';\n    if ('aiHover' === type) return 'What element do you want to hover over?';\n    if ('aiInput' === type) return 'Format: <value> | <element>\\nExample: hello world | search box';\n    if ('aiRightClick' === type) return 'What element do you want to right-click?';\n    if ('aiKeyboardPress' === type) return 'Format: <key> | <element (optional)>\\nExample: Enter | text field';\n    if ('aiScroll' === type) return 'Format: <direction> <amount> | <element (optional)>\\nExample: down 500 | main content';\n    if ('aiLocate' === type) return 'What element do you want to locate?';\n    if ('aiBoolean' === type) return 'What do you want to check (returns true/false)?';\n    if ('aiNumber' === type) return 'What number do you want to extract?';\n    if ('aiString' === type) return 'What text do you want to extract?';\n    if ('aiAsk' === type) return 'What do you want to ask?';\n    if ('aiWaitFor' === type) return 'What condition do you want to wait for?';\n    return 'What do you want to do?';\n};\nconst isRunButtonEnabled = (runButtonEnabled, needsStructuredParams, params, actionSpace, selectedType, promptValue)=>{\n    if (!runButtonEnabled) return false;\n    const needsAnyInput = (()=>{\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if (action) {\n                if (!action.paramSchema) return false;\n                if ('object' == typeof action.paramSchema && 'shape' in action.paramSchema) {\n                    const shape = action.paramSchema.shape || {};\n                    const shapeKeys = Object.keys(shape);\n                    return shapeKeys.length > 0;\n                }\n            }\n        }\n        return true;\n    })();\n    if (!needsAnyInput) return true;\n    if (needsStructuredParams) {\n        const currentParams = params || {};\n        const action = null == actionSpace ? void 0 : actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n        if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n            const schema = action.paramSchema;\n            const shape = schema.shape || {};\n            return Object.keys(shape).every((key)=>{\n                const field = shape[key];\n                const { isOptional } = unwrapZodType(field);\n                const value = currentParams[key];\n                return isOptional || void 0 !== value && '' !== value && null !== value;\n            });\n        }\n        return true;\n    }\n    return promptValue.trim().length > 0;\n};\nexport { actionNameForType, getPlaceholderForType, isRunButtonEnabled, staticAgentFromContext };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"react\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction setting_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else setting_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst SvgSetting = (props)=>/*#__PURE__*/ jsx(\"svg\", _object_spread_props(_object_spread({\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 27,\n        height: 27,\n        fill: \"none\",\n        viewBox: \"0 0 27 27\"\n    }, props), {\n        children: /*#__PURE__*/ jsx(\"path\", {\n            stroke: \"currentColor\",\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeOpacity: 0.85,\n            strokeWidth: 1.333,\n            d: \"M19.527 8.855h-2M14.86 7.522v2.667M14.86 8.855H7.527M10.194 13.522H7.527M12.86 12.189v2.666M20.193 13.522H12.86M19.527 18.189h-2M14.86 16.855v2.667M14.86 18.189H7.527\"\n        })\n    }));\nconst setting = SvgSetting;\nexport { setting as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { Checkbox, Dropdown, Radio } from \"antd\";\nimport setting from \"../../icons/setting.mjs\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nimport { alwaysRefreshScreenInfoTip, autoDismissKeyboardTip, deepThinkTip, domIncludedTip, imeStrategyTip, keyboardDismissStrategyTip, screenshotIncludedTip, trackingTip } from \"../../utils/constants.mjs\";\nconst ConfigSelector = ({ showDeepThinkOption = false, enableTracking = false, showDataExtractionOptions = false, hideDomAndScreenshotOptions = false, deviceType })=>{\n    const forceSameTabNavigation = useEnvConfig((state)=>state.forceSameTabNavigation);\n    const setForceSameTabNavigation = useEnvConfig((state)=>state.setForceSameTabNavigation);\n    const deepThink = useEnvConfig((state)=>state.deepThink);\n    const setDeepThink = useEnvConfig((state)=>state.setDeepThink);\n    const screenshotIncluded = useEnvConfig((state)=>state.screenshotIncluded);\n    const setScreenshotIncluded = useEnvConfig((state)=>state.setScreenshotIncluded);\n    const domIncluded = useEnvConfig((state)=>state.domIncluded);\n    const setDomIncluded = useEnvConfig((state)=>state.setDomIncluded);\n    const imeStrategy = useEnvConfig((state)=>state.imeStrategy);\n    const setImeStrategy = useEnvConfig((state)=>state.setImeStrategy);\n    const autoDismissKeyboard = useEnvConfig((state)=>state.autoDismissKeyboard);\n    const setAutoDismissKeyboard = useEnvConfig((state)=>state.setAutoDismissKeyboard);\n    const keyboardDismissStrategy = useEnvConfig((state)=>state.keyboardDismissStrategy);\n    const setKeyboardDismissStrategy = useEnvConfig((state)=>state.setKeyboardDismissStrategy);\n    const alwaysRefreshScreenInfo = useEnvConfig((state)=>state.alwaysRefreshScreenInfo);\n    const setAlwaysRefreshScreenInfo = useEnvConfig((state)=>state.setAlwaysRefreshScreenInfo);\n    const hasDeviceOptions = 'android' === deviceType || 'ios' === deviceType;\n    if (!enableTracking && !showDeepThinkOption && !showDataExtractionOptions && !hasDeviceOptions) return null;\n    const configItems = buildConfigItems();\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: \"selector-trigger\",\n        children: /*#__PURE__*/ jsx(Dropdown, {\n            menu: {\n                items: configItems\n            },\n            trigger: [\n                'click'\n            ],\n            children: /*#__PURE__*/ jsx(setting, {\n                width: 24,\n                height: 24\n            })\n        })\n    });\n    function buildConfigItems() {\n        const items = [];\n        if (enableTracking) items.push({\n            label: /*#__PURE__*/ jsx(Checkbox, {\n                onChange: (e)=>setForceSameTabNavigation(e.target.checked),\n                checked: forceSameTabNavigation,\n                children: trackingTip\n            }),\n            key: 'track-config'\n        });\n        if (showDeepThinkOption) items.push({\n            label: /*#__PURE__*/ jsx(Checkbox, {\n                onChange: (e)=>{\n                    setDeepThink(e.target.checked);\n                },\n                checked: deepThink,\n                children: deepThinkTip\n            }),\n            key: 'deep-think-config'\n        });\n        if (showDataExtractionOptions && !hideDomAndScreenshotOptions) {\n            items.push({\n                label: /*#__PURE__*/ jsx(Checkbox, {\n                    onChange: (e)=>{\n                        setScreenshotIncluded(e.target.checked);\n                    },\n                    checked: screenshotIncluded,\n                    children: screenshotIncludedTip\n                }),\n                key: 'screenshot-included-config'\n            });\n            items.push({\n                label: /*#__PURE__*/ jsxs(\"div\", {\n                    style: {\n                        padding: '4px 0'\n                    },\n                    children: [\n                        /*#__PURE__*/ jsx(\"div\", {\n                            style: {\n                                marginBottom: '4px',\n                                fontSize: '14px'\n                            },\n                            children: domIncludedTip\n                        }),\n                        /*#__PURE__*/ jsxs(Radio.Group, {\n                            size: \"small\",\n                            value: domIncluded,\n                            onChange: (e)=>setDomIncluded(e.target.value),\n                            children: [\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: false,\n                                    children: \"Off\"\n                                }),\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: true,\n                                    children: \"All\"\n                                }),\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: 'visible-only',\n                                    children: \"Visible only\"\n                                })\n                            ]\n                        })\n                    ]\n                }),\n                key: 'dom-included-config'\n            });\n        }\n        if ('android' === deviceType) {\n            items.push({\n                label: /*#__PURE__*/ jsxs(\"div\", {\n                    style: {\n                        padding: '4px 0'\n                    },\n                    children: [\n                        /*#__PURE__*/ jsx(\"div\", {\n                            style: {\n                                marginBottom: '4px',\n                                fontSize: '14px'\n                            },\n                            children: imeStrategyTip\n                        }),\n                        /*#__PURE__*/ jsxs(Radio.Group, {\n                            size: \"small\",\n                            value: imeStrategy,\n                            onChange: (e)=>setImeStrategy(e.target.value),\n                            children: [\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: \"always-yadb\",\n                                    children: \"Always YADB\"\n                                }),\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: \"yadb-for-non-ascii\",\n                                    children: \"YADB for non-ASCII\"\n                                })\n                            ]\n                        })\n                    ]\n                }),\n                key: 'ime-strategy-config'\n            });\n            items.push({\n                label: /*#__PURE__*/ jsx(Checkbox, {\n                    onChange: (e)=>setAutoDismissKeyboard(e.target.checked),\n                    checked: autoDismissKeyboard,\n                    children: autoDismissKeyboardTip\n                }),\n                key: 'auto-dismiss-keyboard-config'\n            });\n            items.push({\n                label: /*#__PURE__*/ jsxs(\"div\", {\n                    style: {\n                        padding: '4px 0'\n                    },\n                    children: [\n                        /*#__PURE__*/ jsx(\"div\", {\n                            style: {\n                                marginBottom: '4px',\n                                fontSize: '14px'\n                            },\n                            children: keyboardDismissStrategyTip\n                        }),\n                        /*#__PURE__*/ jsxs(Radio.Group, {\n                            size: \"small\",\n                            value: keyboardDismissStrategy,\n                            onChange: (e)=>setKeyboardDismissStrategy(e.target.value),\n                            children: [\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: \"esc-first\",\n                                    children: \"ESC first\"\n                                }),\n                                /*#__PURE__*/ jsx(Radio, {\n                                    value: \"back-first\",\n                                    children: \"Back first\"\n                                })\n                            ]\n                        })\n                    ]\n                }),\n                key: 'keyboard-dismiss-strategy-config'\n            });\n            items.push({\n                label: /*#__PURE__*/ jsx(Checkbox, {\n                    onChange: (e)=>setAlwaysRefreshScreenInfo(e.target.checked),\n                    checked: alwaysRefreshScreenInfo,\n                    children: alwaysRefreshScreenInfoTip\n                }),\n                key: 'always-refresh-screen-info-config'\n            });\n        }\n        if ('ios' === deviceType) items.push({\n            label: /*#__PURE__*/ jsx(Checkbox, {\n                onChange: (e)=>setAutoDismissKeyboard(e.target.checked),\n                checked: autoDismissKeyboard,\n                children: autoDismissKeyboardTip\n            }),\n            key: 'auto-dismiss-keyboard-config'\n        });\n        return items;\n    }\n};\nexport { ConfigSelector };\n","import { jsx } from \"react/jsx-runtime\";\nimport { Form, Input, InputNumber, Select } from \"antd\";\nconst { TextArea } = Input;\nconst renderLabel = (label, isOptional)=>`${label}${isOptional ? ' (Optional)' : ''}`;\nconst TextField = ({ name, label, isRequired, marginBottom, placeholder: customPlaceholder })=>{\n    const placeholder = customPlaceholder || `Enter ${name}`;\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: renderLabel(label, !isRequired),\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please input ${name}`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(Input, {\n            placeholder: placeholder\n        })\n    }, name);\n};\nconst LocateField = ({ name, label, isRequired, marginBottom, placeholder: customPlaceholder })=>{\n    const placeholder = customPlaceholder || `Describe the ${name}, use natural language`;\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: renderLabel(label, !isRequired),\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `The ${name} is required`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(TextArea, {\n            rows: 2,\n            placeholder: placeholder\n        })\n    }, name);\n};\nconst EnumField = ({ name, label, fieldSchema, isRequired, marginBottom, placeholder: customPlaceholder })=>{\n    var _fieldSchema__def;\n    const enumValues = (null == (_fieldSchema__def = fieldSchema._def) ? void 0 : _fieldSchema__def.values) || [];\n    const selectOptions = enumValues.map((value)=>({\n            value,\n            label: value.charAt(0).toUpperCase() + value.slice(1)\n        }));\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: label,\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please select ${name}`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(Select, {\n            placeholder: customPlaceholder || `Select ${name}`,\n            options: selectOptions\n        })\n    }, name);\n};\nconst NumberField = ({ name, label, isRequired, marginBottom, placeholder: customPlaceholder })=>{\n    const defaultPlaceholder = 'distance' === name ? 500 : 0;\n    const placeholderValue = customPlaceholder ? Number(customPlaceholder) || defaultPlaceholder : defaultPlaceholder;\n    const min = 0;\n    const max = 'distance' === name ? 10000 : void 0;\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: `${label}${'distance' === name ? ' (px)' : ''}`,\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please input ${name}`\n            },\n            {\n                type: 'number',\n                min,\n                message: `${label} must be at least ${min}`\n            }\n        ] : [\n            {\n                type: 'number',\n                min,\n                message: `${label} must be at least ${min}`\n            }\n        ],\n        style: {\n            flex: 'distance' === name ? 1 : void 0,\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(InputNumber, {\n            placeholder: placeholderValue.toString(),\n            min: min,\n            max: max,\n            step: 'distance' === name ? 10 : 1,\n            style: {\n                width: '100%'\n            }\n        })\n    }, name);\n};\nconst BooleanField = ({ name, label, isRequired, marginBottom, placeholder: customPlaceholder })=>{\n    const selectOptions = [\n        {\n            value: true,\n            label: 'True'\n        },\n        {\n            value: false,\n            label: 'False'\n        }\n    ];\n    return /*#__PURE__*/ jsx(Form.Item, {\n        name: [\n            'params',\n            name\n        ],\n        label: renderLabel(label, !isRequired),\n        rules: isRequired ? [\n            {\n                required: true,\n                message: `Please select ${name}`\n            }\n        ] : [],\n        style: {\n            marginBottom\n        },\n        colon: false,\n        children: /*#__PURE__*/ jsx(Select, {\n            placeholder: customPlaceholder || `Select ${name}`,\n            options: selectOptions\n        })\n    }, name);\n};\nexport { BooleanField, EnumField, LocateField, NumberField, TextField };\n","import { jsx } from \"react/jsx-runtime\";\nimport \"react\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction close_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else close_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst SvgClose = (props)=>/*#__PURE__*/ jsx(\"svg\", _object_spread_props(_object_spread({\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 18,\n        height: 16,\n        fill: \"none\",\n        viewBox: \"0 0 18 16\"\n    }, props), {\n        children: /*#__PURE__*/ jsx(\"path\", {\n            stroke: \"#333\",\n            strokeLinecap: \"round\",\n            strokeLinejoin: \"round\",\n            strokeWidth: 1.333,\n            d: \"m3.124 2.667 11.162 10.666M3.124 13.333 14.286 2.667\"\n        })\n    }));\nconst icons_close = SvgClose;\nexport { icons_close as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction history_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else history_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst SvgHistory = (props)=>/*#__PURE__*/ jsxs(\"svg\", _object_spread_props(_object_spread({\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 25,\n        height: 25,\n        fill: \"none\",\n        viewBox: \"0 0 25 25\"\n    }, props), {\n        children: [\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"currentColor\",\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeOpacity: 0.85,\n                strokeWidth: 1.33,\n                d: \"M6.63 9.021c-2.862 6.126 2.197 10.501 6.063 10.501a7 7 0 1 0-6.063-10.5\"\n            }),\n            /*#__PURE__*/ jsx(\"path\", {\n                stroke: \"currentColor\",\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeOpacity: 0.85,\n                strokeWidth: 1.33,\n                d: \"M12.695 8.322v4.203l2.967 2.968\"\n            })\n        ]\n    }));\nconst icons_history = SvgHistory;\nexport { icons_history as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport \"react\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nfunction magnifying_glass_ownKeys(object, enumerableOnly) {\n    var keys = Object.keys(object);\n    if (Object.getOwnPropertySymbols) {\n        var symbols = Object.getOwnPropertySymbols(object);\n        if (enumerableOnly) symbols = symbols.filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n        });\n        keys.push.apply(keys, symbols);\n    }\n    return keys;\n}\nfunction _object_spread_props(target, source) {\n    source = null != source ? source : {};\n    if (Object.getOwnPropertyDescriptors) Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    else magnifying_glass_ownKeys(Object(source)).forEach(function(key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n    return target;\n}\nconst SvgMagnifyingGlass = (props)=>/*#__PURE__*/ jsxs(\"svg\", _object_spread_props(_object_spread({\n        xmlns: \"http://www.w3.org/2000/svg\",\n        width: 19,\n        height: 19,\n        fill: \"none\",\n        viewBox: \"0 0 19 19\"\n    }, props), {\n        children: [\n            /*#__PURE__*/ jsxs(\"g\", {\n                stroke: \"currentColor\",\n                strokeLinejoin: \"round\",\n                strokeOpacity: 0.65,\n                strokeWidth: 1.5,\n                clipPath: \"url(#magnifying-glass_svg__a)\",\n                children: [\n                    /*#__PURE__*/ jsx(\"path\", {\n                        d: \"M8.397 14.29a6.375 6.375 0 1 0 0-12.75 6.375 6.375 0 0 0 0 12.75Z\"\n                    }),\n                    /*#__PURE__*/ jsx(\"path\", {\n                        strokeLinecap: \"round\",\n                        d: \"M10.519 5.42a3 3 0 0 0-2.122-.88 3 3 0 0 0-2.121.88M12.98 12.499l3.182 3.182\"\n                    })\n                ]\n            }),\n            /*#__PURE__*/ jsx(\"defs\", {\n                children: /*#__PURE__*/ jsx(\"clipPath\", {\n                    id: \"magnifying-glass_svg__a\",\n                    children: /*#__PURE__*/ jsx(\"path\", {\n                        fill: \"#fff\",\n                        d: \"M.522.04h18v18h-18z\"\n                    })\n                })\n            })\n        ]\n    }));\nconst magnifying_glass = SvgMagnifyingGlass;\nexport { magnifying_glass as default };\n","import { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport { Button, Input, Typography } from \"antd\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport icons_close from \"../../icons/close.mjs\";\nimport icons_history from \"../../icons/history.mjs\";\nimport magnifying_glass from \"../../icons/magnifying-glass.mjs\";\nimport { useHistoryStore } from \"../../store/history.mjs\";\nimport \"./index.css\";\nconst { Text } = Typography;\nconst HistorySelector = ({ onSelect, history, currentType })=>{\n    const [isModalOpen, setIsModalOpen] = useState(false);\n    const [searchText, setSearchText] = useState('');\n    const clearHistory = useHistoryStore((state)=>state.clearHistory);\n    const modalRef = useRef(null);\n    const groupedHistory = useMemo(()=>{\n        const now = Date.now();\n        const sevenDaysAgo = now - 604800000;\n        const oneYearAgo = now - 31536000000;\n        const filteredHistory = history.filter((item)=>item.prompt.toLowerCase().includes(searchText.toLowerCase()));\n        const groups = {\n            recent7Days: filteredHistory.filter((item)=>item.timestamp >= sevenDaysAgo),\n            recent1Year: filteredHistory.filter((item)=>item.timestamp < sevenDaysAgo && item.timestamp >= oneYearAgo),\n            older: filteredHistory.filter((item)=>item.timestamp < oneYearAgo)\n        };\n        return groups;\n    }, [\n        history,\n        searchText\n    ]);\n    const handleHistoryClick = (item)=>{\n        onSelect(item);\n        setIsModalOpen(false);\n    };\n    const handleClearHistory = ()=>{\n        clearHistory(currentType);\n        setSearchText('');\n        setIsModalOpen(false);\n    };\n    useEffect(()=>{\n        if (!isModalOpen) return;\n        const handleClickOutside = (event)=>{\n            if (modalRef.current && !modalRef.current.contains(event.target)) setIsModalOpen(false);\n        };\n        const timer = setTimeout(()=>{\n            document.addEventListener('click', handleClickOutside);\n        }, 100);\n        return ()=>{\n            clearTimeout(timer);\n            document.removeEventListener('click', handleClickOutside);\n        };\n    }, [\n        isModalOpen\n    ]);\n    const renderHistoryGroup = (title, items)=>{\n        if (0 === items.length) return null;\n        return /*#__PURE__*/ jsxs(\"div\", {\n            className: \"history-group\",\n            children: [\n                /*#__PURE__*/ jsx(\"div\", {\n                    className: \"history-group-title\",\n                    children: title\n                }),\n                items.map((item, index)=>/*#__PURE__*/ jsx(\"div\", {\n                        className: \"history-item\",\n                        onClick: ()=>handleHistoryClick(item),\n                        children: item.prompt\n                    }, `${item.timestamp}-${index}`))\n            ]\n        }, title);\n    };\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"history-selector-wrapper\",\n        children: [\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"selector-trigger\",\n                onClick: ()=>setIsModalOpen(true),\n                children: /*#__PURE__*/ jsx(icons_history, {\n                    width: 24,\n                    height: 24\n                })\n            }),\n            isModalOpen && /*#__PURE__*/ jsx(\"div\", {\n                className: \"history-modal-overlay\",\n                ref: modalRef,\n                children: /*#__PURE__*/ jsxs(\"div\", {\n                    className: \"history-modal-container\",\n                    children: [\n                        /*#__PURE__*/ jsxs(\"div\", {\n                            className: \"history-modal-header\",\n                            children: [\n                                /*#__PURE__*/ jsxs(Text, {\n                                    strong: true,\n                                    style: {\n                                        fontSize: '16px'\n                                    },\n                                    children: [\n                                        \"History (\",\n                                        history.length,\n                                        \")\"\n                                    ]\n                                }),\n                                /*#__PURE__*/ jsx(Button, {\n                                    size: \"small\",\n                                    type: \"text\",\n                                    icon: /*#__PURE__*/ jsx(icons_close, {\n                                        width: 16,\n                                        height: 16\n                                    }),\n                                    onClick: ()=>setIsModalOpen(false),\n                                    className: \"close-button\"\n                                })\n                            ]\n                        }),\n                        /*#__PURE__*/ jsx(\"div\", {\n                            className: \"history-search-section\",\n                            children: /*#__PURE__*/ jsxs(\"div\", {\n                                className: \"search-input-wrapper\",\n                                children: [\n                                    /*#__PURE__*/ jsx(Input, {\n                                        placeholder: \"Search\",\n                                        value: searchText,\n                                        onChange: (e)=>setSearchText(e.target.value),\n                                        prefix: /*#__PURE__*/ jsx(magnifying_glass, {\n                                            width: 18,\n                                            height: 18\n                                        }),\n                                        className: \"search-input\",\n                                        allowClear: true\n                                    }),\n                                    /*#__PURE__*/ jsx(Button, {\n                                        type: \"link\",\n                                        onClick: handleClearHistory,\n                                        className: \"clear-button\",\n                                        disabled: 0 === history.length,\n                                        children: \"Clear\"\n                                    })\n                                ]\n                            })\n                        }),\n                        /*#__PURE__*/ jsx(\"div\", {\n                            className: \"history-content\",\n                            children: 0 === history.length ? /*#__PURE__*/ jsx(\"div\", {\n                                className: \"no-results\",\n                                children: /*#__PURE__*/ jsx(Text, {\n                                    type: \"secondary\",\n                                    children: \"No history record\"\n                                })\n                            }) : /*#__PURE__*/ jsxs(Fragment, {\n                                children: [\n                                    renderHistoryGroup('Last 7 days', groupedHistory.recent7Days),\n                                    renderHistoryGroup('Last 1 year', groupedHistory.recent1Year),\n                                    renderHistoryGroup('Earlier', groupedHistory.older),\n                                    searchText && 0 === groupedHistory.recent7Days.length && 0 === groupedHistory.recent1Year.length && 0 === groupedHistory.older.length && /*#__PURE__*/ jsx(\"div\", {\n                                        className: \"no-results\",\n                                        children: /*#__PURE__*/ jsx(Text, {\n                                            type: \"secondary\",\n                                            children: \"No matching history record\"\n                                        })\n                                    })\n                                ]\n                            })\n                        })\n                    ]\n                })\n            })\n        ]\n    });\n};\nexport { HistorySelector };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { BorderOutlined, DownOutlined, SendOutlined } from \"@ant-design/icons\";\nimport \"./index.css\";\nimport { Button, Dropdown, Form, Input, Radio, Tooltip } from \"antd\";\nimport react, { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { useHistoryStore } from \"../../store/history.mjs\";\nimport { extractDefaultValue, isLocateField, isZodObjectSchema, unwrapZodType } from \"../../types.mjs\";\nimport { apiMetadata, defaultMainButtons } from \"../../utils/constants.mjs\";\nimport { actionNameForType, getPlaceholderForType, isRunButtonEnabled as playground_utils_mjs_isRunButtonEnabled } from \"../../utils/playground-utils.mjs\";\nimport { ConfigSelector } from \"../config-selector/index.mjs\";\nimport { BooleanField, EnumField, LocateField, NumberField, TextField } from \"../form-field/index.mjs\";\nimport { HistorySelector } from \"../history-selector/index.mjs\";\nfunction _define_property(obj, key, value) {\n    if (key in obj) Object.defineProperty(obj, key, {\n        value: value,\n        enumerable: true,\n        configurable: true,\n        writable: true\n    });\n    else obj[key] = value;\n    return obj;\n}\nfunction _object_spread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = null != arguments[i] ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (\"function\" == typeof Object.getOwnPropertySymbols) ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n            return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n        }));\n        ownKeys.forEach(function(key) {\n            _define_property(target, key, source[key]);\n        });\n    }\n    return target;\n}\nconst { TextArea } = Input;\nconst PromptInput = ({ runButtonEnabled, form, serviceMode, selectedType, dryMode, stoppable, loading, onRun, onStop, clearPromptAfterRun = true, actionSpace, hideDomAndScreenshotOptions = false, deviceType })=>{\n    const [hoveringSettings, setHoveringSettings] = useState(false);\n    const [promptValue, setPromptValue] = useState('');\n    const placeholder = getPlaceholderForType(selectedType);\n    const textAreaRef = useRef(null);\n    const modeRadioGroupRef = useRef(null);\n    const params = Form.useWatch('params', form);\n    const lastHistoryRef = useRef(null);\n    const history = useHistoryStore((state)=>state.history);\n    const lastSelectedType = useHistoryStore((state)=>state.lastSelectedType);\n    const addHistory = useHistoryStore((state)=>state.addHistory);\n    const setLastSelectedType = useHistoryStore((state)=>state.setLastSelectedType);\n    const historyForSelectedType = useMemo(()=>history[selectedType] || [], [\n        history,\n        selectedType\n    ]);\n    const needsStructuredParams = useMemo(()=>{\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if (!(null == action ? void 0 : action.paramSchema)) return false;\n            if (isZodObjectSchema(action.paramSchema)) {\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                const shapeKeys = Object.keys(shape);\n                return shapeKeys.length > 0;\n            }\n            return true;\n        }\n        return false;\n    }, [\n        selectedType,\n        actionSpace\n    ]);\n    const needsAnyInput = useMemo(()=>{\n        if (actionSpace && actionSpace.length > 0) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if (action) {\n                if (action.paramSchema && isZodObjectSchema(action.paramSchema)) {\n                    const schema = action.paramSchema;\n                    const shape = schema.shape || {};\n                    const hasRequiredFields = Object.keys(shape).some((key)=>{\n                        const field = shape[key];\n                        const { isOptional } = unwrapZodType(field);\n                        return !isOptional;\n                    });\n                    return hasRequiredFields;\n                }\n                return !!action.paramSchema;\n            }\n        }\n        return true;\n    }, [\n        selectedType,\n        actionSpace\n    ]);\n    const showDataExtractionOptions = useMemo(()=>{\n        const dataExtractionMethods = [\n            'aiQuery',\n            'aiBoolean',\n            'aiNumber',\n            'aiString',\n            'aiAsk',\n            'aiAssert'\n        ];\n        return dataExtractionMethods.includes(selectedType);\n    }, [\n        selectedType\n    ]);\n    const showDeepThinkOption = useMemo(()=>{\n        if ('aiLocate' === selectedType) return true;\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                const hasLocateField = Object.keys(shape).some((key)=>{\n                    const field = shape[key];\n                    const { actualField } = unwrapZodType(field);\n                    return isLocateField(actualField);\n                });\n                return hasLocateField;\n            }\n        }\n        return false;\n    }, [\n        selectedType,\n        actionSpace\n    ]);\n    const hasConfigOptions = useMemo(()=>{\n        const hasTracking = 'In-Browser-Extension' === serviceMode;\n        const hasDeepThink = showDeepThinkOption;\n        const hasDataExtraction = showDataExtractionOptions && !hideDomAndScreenshotOptions;\n        const hasDeviceOptions = 'android' === deviceType || 'ios' === deviceType;\n        return hasTracking || hasDeepThink || hasDataExtraction || hasDeviceOptions;\n    }, [\n        serviceMode,\n        showDeepThinkOption,\n        showDataExtractionOptions,\n        hideDomAndScreenshotOptions,\n        deviceType\n    ]);\n    const availableDropdownMethods = useMemo(()=>{\n        const metadataMethods = Object.keys(apiMetadata);\n        if (!actionSpace || 0 === actionSpace.length) return metadataMethods;\n        const availableMethods = actionSpace.map((action)=>action.interfaceAlias || action.name);\n        const finalMethods = new Set();\n        metadataMethods.forEach((method)=>{\n            const methodInfo = apiMetadata[method];\n            if ((null == methodInfo ? void 0 : methodInfo.group) === 'extraction' || (null == methodInfo ? void 0 : methodInfo.group) === 'validation') finalMethods.add(method);\n            else if (availableMethods.includes(method)) finalMethods.add(method);\n        });\n        availableMethods.forEach((method)=>{\n            finalMethods.add(method);\n        });\n        return Array.from(finalMethods);\n    }, [\n        actionSpace\n    ]);\n    const getDefaultParams = useCallback(()=>{\n        if (!needsStructuredParams || !actionSpace) return {};\n        const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n        if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n            const defaultParams = {};\n            const schema = action.paramSchema;\n            const shape = schema.shape || {};\n            Object.keys(shape).forEach((key)=>{\n                const field = shape[key];\n                const defaultValue = extractDefaultValue(field);\n                if (void 0 !== defaultValue) defaultParams[key] = defaultValue;\n            });\n            return defaultParams;\n        }\n        return {};\n    }, [\n        selectedType,\n        needsStructuredParams,\n        actionSpace\n    ]);\n    useEffect(()=>{\n        if (!form.getFieldValue('type') && lastSelectedType) form.setFieldValue('type', lastSelectedType);\n    }, [\n        form,\n        lastSelectedType\n    ]);\n    useEffect(()=>{\n        if (selectedType && selectedType !== lastSelectedType) setLastSelectedType(selectedType);\n    }, [\n        selectedType,\n        lastSelectedType,\n        setLastSelectedType\n    ]);\n    const scrollToSelectedItem = useCallback(()=>{\n        const container = modeRadioGroupRef.current;\n        if (!container) return;\n        let targetElement = null;\n        const selectedRadioButton = container.querySelector('.ant-radio-button-wrapper-checked');\n        const dropdownButton = container.querySelector('.more-apis-button.selected-from-dropdown');\n        if (selectedRadioButton) targetElement = selectedRadioButton;\n        else if (dropdownButton) targetElement = dropdownButton;\n        if (targetElement) {\n            const containerRect = container.getBoundingClientRect();\n            const targetRect = targetElement.getBoundingClientRect();\n            const targetLeft = targetRect.left - containerRect.left + container.scrollLeft;\n            const targetWidth = targetRect.width;\n            const containerWidth = containerRect.width;\n            const optimalScrollLeft = targetLeft - (containerWidth - targetWidth) / 2;\n            container.scrollTo({\n                left: Math.max(0, optimalScrollLeft),\n                behavior: 'smooth'\n            });\n        }\n    }, []);\n    useEffect(()=>{\n        const lastHistory = historyForSelectedType[0];\n        if (lastHistory && lastHistoryRef.current && lastHistory.timestamp === lastHistoryRef.current.timestamp) return;\n        if (lastHistory) {\n            form.setFieldsValue({\n                type: lastHistory.type,\n                prompt: lastHistory.prompt || '',\n                params: lastHistory.params\n            });\n            setPromptValue(lastHistory.prompt || '');\n            lastHistoryRef.current = lastHistory;\n        } else {\n            const defaultParams = getDefaultParams();\n            form.setFieldsValue({\n                prompt: '',\n                params: defaultParams\n            });\n            setPromptValue('');\n            lastHistoryRef.current = null;\n        }\n    }, [\n        selectedType,\n        historyForSelectedType,\n        form,\n        getDefaultParams\n    ]);\n    useEffect(()=>{\n        const timeoutId = setTimeout(()=>{\n            scrollToSelectedItem();\n        }, 100);\n        return ()=>clearTimeout(timeoutId);\n    }, [\n        selectedType,\n        scrollToSelectedItem\n    ]);\n    const formPromptValue = Form.useWatch('prompt', form);\n    useEffect(()=>{\n        if (formPromptValue !== promptValue) setPromptValue(formPromptValue || '');\n    }, [\n        formPromptValue,\n        promptValue\n    ]);\n    const handleSelectHistory = useCallback((historyItem)=>{\n        form.setFieldsValue({\n            prompt: historyItem.prompt,\n            type: historyItem.type,\n            params: historyItem.params\n        });\n        setPromptValue(historyItem.prompt);\n    }, [\n        form\n    ]);\n    const handlePromptChange = useCallback((e)=>{\n        const value = e.target.value;\n        setPromptValue(value);\n    }, []);\n    const hasSingleStructuredParam = useMemo(()=>{\n        if (!needsStructuredParams || !actionSpace) return false;\n        const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n        if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n            const schema = action.paramSchema;\n            const shape = schema.shape || {};\n            return 1 === Object.keys(shape).length;\n        }\n        return false;\n    }, [\n        selectedType,\n        needsStructuredParams,\n        actionSpace\n    ]);\n    const isRunButtonEnabled = useMemo(()=>playground_utils_mjs_isRunButtonEnabled(runButtonEnabled, !!needsStructuredParams, params, actionSpace, selectedType, promptValue), [\n        runButtonEnabled,\n        needsStructuredParams,\n        selectedType,\n        actionSpace,\n        promptValue,\n        params\n    ]);\n    const handleRunWithHistory = useCallback(()=>{\n        const values = form.getFieldsValue();\n        let historyPrompt = '';\n        if (needsStructuredParams && values.params && actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n                let locateValue = '';\n                const otherValues = [];\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                Object.keys(shape).forEach((key)=>{\n                    var _values_params;\n                    const paramValue = null == (_values_params = values.params) ? void 0 : _values_params[key];\n                    if (null != paramValue && '' !== paramValue) {\n                        const field = shape[key];\n                        const { actualField } = unwrapZodType(field);\n                        if (isLocateField(actualField)) locateValue = String(paramValue);\n                        else if ('distance' === key) otherValues.push(`${paramValue}`);\n                        else otherValues.push(String(paramValue));\n                    }\n                });\n                const mainPart = otherValues.join(' ');\n                historyPrompt = locateValue ? `${locateValue} - ${mainPart}` : mainPart;\n            } else historyPrompt = values.prompt || '';\n        } else historyPrompt = values.prompt || '';\n        const newHistoryItem = {\n            type: values.type,\n            prompt: historyPrompt,\n            params: values.params,\n            timestamp: Date.now()\n        };\n        addHistory(newHistoryItem);\n        onRun();\n        if (clearPromptAfterRun) {\n            lastHistoryRef.current = newHistoryItem;\n            setPromptValue('');\n            if (needsStructuredParams) {\n                const defaultParams = getDefaultParams();\n                form.setFieldValue('params', defaultParams);\n            } else form.setFieldValue('prompt', '');\n        }\n    }, [\n        form,\n        addHistory,\n        onRun,\n        needsStructuredParams,\n        selectedType,\n        clearPromptAfterRun,\n        actionSpace,\n        getDefaultParams\n    ]);\n    const handleKeyDown = useCallback((e)=>{\n        if ('Enter' === e.key && e.metaKey && isRunButtonEnabled) {\n            handleRunWithHistory();\n            e.preventDefault();\n            e.stopPropagation();\n        } else if ('Enter' === e.key) setTimeout(()=>{\n            if (textAreaRef.current) {\n                var _textAreaRef_current_resizableTextArea;\n                const textarea = null == (_textAreaRef_current_resizableTextArea = textAreaRef.current.resizableTextArea) ? void 0 : _textAreaRef_current_resizableTextArea.textArea;\n                if (textarea) {\n                    const selectionStart = textarea.selectionStart;\n                    const value = textarea.value;\n                    const lastNewlineIndex = value.lastIndexOf('\\n');\n                    const isAtLastLine = -1 === lastNewlineIndex || selectionStart > lastNewlineIndex;\n                    if (isAtLastLine) textarea.scrollTop = textarea.scrollHeight;\n                }\n            }\n        }, 0);\n    }, [\n        handleRunWithHistory,\n        isRunButtonEnabled\n    ]);\n    const handleStructuredKeyDown = useCallback((e)=>{\n        if ('Enter' === e.key && e.metaKey && isRunButtonEnabled) {\n            handleRunWithHistory();\n            e.preventDefault();\n            e.stopPropagation();\n        }\n    }, [\n        handleRunWithHistory,\n        isRunButtonEnabled\n    ]);\n    const renderStructuredParams = useCallback(()=>{\n        if (!needsStructuredParams) return null;\n        if (actionSpace) {\n            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n            if ((null == action ? void 0 : action.paramSchema) && isZodObjectSchema(action.paramSchema)) {\n                const schema = action.paramSchema;\n                const shape = schema.shape || {};\n                const schemaKeys = Object.keys(shape);\n                if (1 === schemaKeys.length) {\n                    const key = schemaKeys[0];\n                    const field = shape[key];\n                    const { actualField } = unwrapZodType(field);\n                    const isLocateFieldFlag = isLocateField(actualField);\n                    const placeholderText = (()=>{\n                        var _fieldWithRuntime__def;\n                        const fieldWithRuntime = actualField;\n                        if (null == (_fieldWithRuntime__def = fieldWithRuntime._def) ? void 0 : _fieldWithRuntime__def.description) return fieldWithRuntime._def.description;\n                        if (fieldWithRuntime.description) return fieldWithRuntime.description;\n                        if (actionSpace) {\n                            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n                            if ((null == action ? void 0 : action.paramSchema) && 'object' == typeof action.paramSchema && 'shape' in action.paramSchema) {\n                                var _fieldDef__def;\n                                const shape = action.paramSchema.shape || {};\n                                const fieldDef = shape[key];\n                                if (null == fieldDef ? void 0 : null == (_fieldDef__def = fieldDef._def) ? void 0 : _fieldDef__def.description) return fieldDef._def.description;\n                                if (null == fieldDef ? void 0 : fieldDef.description) return fieldDef.description;\n                            }\n                        }\n                        if (isLocateFieldFlag) return 'Describe the element you want to interact with';\n                        if ('keyName' === key) return 'Enter key name or text to type';\n                        if ('value' === key) return 'Enter text to input';\n                        return `Enter ${key}`;\n                    })();\n                    return /*#__PURE__*/ jsx(Form.Item, {\n                        name: [\n                            'params',\n                            key\n                        ],\n                        style: {\n                            margin: 0\n                        },\n                        children: /*#__PURE__*/ jsx(Input.TextArea, {\n                            className: \"main-side-console-input-textarea\",\n                            rows: 3,\n                            placeholder: placeholderText,\n                            autoFocus: true,\n                            onKeyDown: handleStructuredKeyDown\n                        })\n                    });\n                }\n                const fields = [];\n                const sortedKeys = schemaKeys.sort((keyA, keyB)=>{\n                    const fieldSchemaA = shape[keyA];\n                    const fieldSchemaB = shape[keyB];\n                    const { isOptional: isOptionalA } = unwrapZodType(fieldSchemaA);\n                    const { isOptional: isOptionalB } = unwrapZodType(fieldSchemaB);\n                    if (!isOptionalA && isOptionalB) return -1;\n                    if (isOptionalA && !isOptionalB) return 1;\n                    return 0;\n                });\n                sortedKeys.forEach((key, index)=>{\n                    var _actualField__def, _actualField__def1, _actualField__def2;\n                    const fieldSchema = shape[key];\n                    const { actualField, isOptional } = unwrapZodType(fieldSchema);\n                    const isLocateFieldFlag = isLocateField(actualField);\n                    const label = key.charAt(0).toUpperCase() + key.slice(1);\n                    const isRequired = !isOptional;\n                    const marginBottom = index === sortedKeys.length - 1 ? 0 : 12;\n                    const placeholder = (()=>{\n                        var _fieldWithRuntime__def;\n                        const fieldWithRuntime = actualField;\n                        if (null == (_fieldWithRuntime__def = fieldWithRuntime._def) ? void 0 : _fieldWithRuntime__def.description) return fieldWithRuntime._def.description;\n                        if (fieldWithRuntime.description) return fieldWithRuntime.description;\n                        if (actionSpace) {\n                            const action = actionSpace.find((a)=>a.interfaceAlias === selectedType || a.name === selectedType);\n                            if ((null == action ? void 0 : action.paramSchema) && 'object' == typeof action.paramSchema && 'shape' in action.paramSchema) {\n                                var _fieldDef__def;\n                                const shape = action.paramSchema.shape || {};\n                                const fieldDef = shape[key];\n                                if (null == fieldDef ? void 0 : null == (_fieldDef__def = fieldDef._def) ? void 0 : _fieldDef__def.description) return fieldDef._def.description;\n                                if (null == fieldDef ? void 0 : fieldDef.description) return fieldDef.description;\n                            }\n                        }\n                        if (isLocateFieldFlag) return 'Describe the element you want to interact with';\n                    })();\n                    const fieldProps = {\n                        name: key,\n                        label,\n                        fieldSchema: actualField,\n                        isRequired,\n                        marginBottom,\n                        placeholder\n                    };\n                    if (isLocateFieldFlag) fields.push(/*#__PURE__*/ jsx(LocateField, _object_spread({}, fieldProps), key));\n                    else if ((null == (_actualField__def = actualField._def) ? void 0 : _actualField__def.typeName) === 'ZodEnum') fields.push(/*#__PURE__*/ jsx(EnumField, _object_spread({}, fieldProps), key));\n                    else if ((null == (_actualField__def1 = actualField._def) ? void 0 : _actualField__def1.typeName) === 'ZodNumber') fields.push(/*#__PURE__*/ jsx(NumberField, _object_spread({}, fieldProps), key));\n                    else if ((null == (_actualField__def2 = actualField._def) ? void 0 : _actualField__def2.typeName) === 'ZodBoolean') fields.push(/*#__PURE__*/ jsx(BooleanField, _object_spread({}, fieldProps), key));\n                    else fields.push(/*#__PURE__*/ jsx(TextField, _object_spread({}, fieldProps), key));\n                });\n                if ('aiScroll' === selectedType) {\n                    const directionField = fields.find((field)=>/*#__PURE__*/ react.isValidElement(field) && 'direction' === field.props.name);\n                    const distanceField = fields.find((field)=>/*#__PURE__*/ react.isValidElement(field) && 'distance' === field.props.name);\n                    const otherFields = fields.filter((field)=>/*#__PURE__*/ react.isValidElement(field) && 'direction' !== field.props.name && 'distance' !== field.props.name);\n                    if (directionField && distanceField) return /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"structured-params\",\n                        children: [\n                            /*#__PURE__*/ jsxs(\"div\", {\n                                style: {\n                                    display: 'flex',\n                                    gap: 12,\n                                    marginBottom: 12\n                                },\n                                children: [\n                                    directionField,\n                                    distanceField\n                                ]\n                            }),\n                            otherFields\n                        ]\n                    });\n                }\n                return /*#__PURE__*/ jsx(\"div\", {\n                    className: \"structured-params\",\n                    children: fields\n                });\n            }\n        }\n        return null;\n    }, [\n        selectedType,\n        needsStructuredParams,\n        actionSpace,\n        handleStructuredKeyDown\n    ]);\n    const handleMouseEnter = useCallback(()=>{\n        setHoveringSettings(true);\n    }, []);\n    const handleMouseLeave = useCallback(()=>{\n        setHoveringSettings(false);\n    }, []);\n    const renderActionButton = useCallback(()=>{\n        const runButton = (text)=>/*#__PURE__*/ jsx(Button, {\n                type: \"primary\",\n                icon: /*#__PURE__*/ jsx(SendOutlined, {}),\n                style: {\n                    borderRadius: 20,\n                    zIndex: 999\n                },\n                onClick: handleRunWithHistory,\n                disabled: !isRunButtonEnabled,\n                loading: loading,\n                children: text\n            });\n        if (dryMode) return 'aiAct' === selectedType ? /*#__PURE__*/ jsx(Tooltip, {\n            title: \"Start executing until some interaction actions need to be performed. You can see the process of planning and locating.\",\n            children: runButton('Dry Run')\n        }) : runButton('Run');\n        if (stoppable) return /*#__PURE__*/ jsx(Button, {\n            icon: /*#__PURE__*/ jsx(BorderOutlined, {}),\n            onClick: onStop,\n            style: {\n                borderRadius: 20,\n                zIndex: 999\n            },\n            children: \"Stop\"\n        });\n        return runButton('Run');\n    }, [\n        dryMode,\n        loading,\n        handleRunWithHistory,\n        onStop,\n        isRunButtonEnabled,\n        selectedType,\n        stoppable\n    ]);\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"prompt-input-wrapper\",\n        children: [\n            /*#__PURE__*/ jsxs(\"div\", {\n                className: \"mode-radio-group-wrapper\",\n                children: [\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"mode-radio-group\",\n                        ref: modeRadioGroupRef,\n                        children: [\n                            /*#__PURE__*/ jsx(Form.Item, {\n                                name: \"type\",\n                                style: {\n                                    margin: 0\n                                },\n                                children: /*#__PURE__*/ jsx(Radio.Group, {\n                                    buttonStyle: \"solid\",\n                                    disabled: !runButtonEnabled,\n                                    children: defaultMainButtons.map((apiType)=>{\n                                        var _apiMetadata_apiType;\n                                        return /*#__PURE__*/ jsx(Tooltip, {\n                                            title: (null == (_apiMetadata_apiType = apiMetadata[apiType]) ? void 0 : _apiMetadata_apiType.title) || '',\n                                            children: /*#__PURE__*/ jsx(Radio.Button, {\n                                                value: apiType,\n                                                children: actionNameForType(apiType)\n                                            })\n                                        }, apiType);\n                                    })\n                                })\n                            }),\n                            /*#__PURE__*/ jsx(Dropdown, {\n                                menu: (()=>{\n                                    const hiddenAPIs = availableDropdownMethods.filter((api)=>!defaultMainButtons.includes(api));\n                                    const groupedItems = [];\n                                    const interactionAPIs = hiddenAPIs.filter((api)=>{\n                                        var _apiMetadata_api;\n                                        return (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.group) === 'interaction';\n                                    });\n                                    if (interactionAPIs.length > 0) groupedItems.push({\n                                        key: 'interaction-group',\n                                        type: 'group',\n                                        label: 'Interaction APIs',\n                                        children: interactionAPIs.map((api)=>{\n                                            var _apiMetadata_api;\n                                            return {\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.title) || '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            };\n                                        })\n                                    });\n                                    const extractionAPIs = hiddenAPIs.filter((api)=>{\n                                        var _apiMetadata_api;\n                                        return (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.group) === 'extraction';\n                                    });\n                                    if (extractionAPIs.length > 0) groupedItems.push({\n                                        key: 'extraction-group',\n                                        type: 'group',\n                                        label: 'Data Extraction APIs',\n                                        children: extractionAPIs.map((api)=>{\n                                            var _apiMetadata_api;\n                                            return {\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.title) || '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            };\n                                        })\n                                    });\n                                    const validationAPIs = hiddenAPIs.filter((api)=>{\n                                        var _apiMetadata_api;\n                                        return (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.group) === 'validation';\n                                    });\n                                    if (validationAPIs.length > 0) groupedItems.push({\n                                        key: 'validation-group',\n                                        type: 'group',\n                                        label: 'Validation APIs',\n                                        children: validationAPIs.map((api)=>{\n                                            var _apiMetadata_api;\n                                            return {\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: (null == (_apiMetadata_api = apiMetadata[api]) ? void 0 : _apiMetadata_api.title) || '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            };\n                                        })\n                                    });\n                                    const deviceSpecificAPIs = hiddenAPIs.filter((api)=>!apiMetadata[api]);\n                                    if (deviceSpecificAPIs.length > 0) groupedItems.push({\n                                        key: 'device-specific-group',\n                                        type: 'group',\n                                        label: 'Device-Specific APIs',\n                                        children: deviceSpecificAPIs.map((api)=>({\n                                                key: api,\n                                                label: actionNameForType(api),\n                                                title: '',\n                                                onClick: ()=>{\n                                                    form.setFieldValue('type', api);\n                                                }\n                                            }))\n                                    });\n                                    return {\n                                        items: groupedItems\n                                    };\n                                })(),\n                                placement: \"bottomLeft\",\n                                trigger: [\n                                    'click'\n                                ],\n                                disabled: !runButtonEnabled,\n                                overlayClassName: \"more-apis-dropdown\",\n                                children: /*#__PURE__*/ jsxs(Button, {\n                                    className: `more-apis-button ${!defaultMainButtons.includes(selectedType) ? 'selected-from-dropdown' : ''}`,\n                                    children: [\n                                        selectedType && !defaultMainButtons.includes(selectedType) ? actionNameForType(selectedType) : 'more',\n                                        /*#__PURE__*/ jsx(DownOutlined, {\n                                            style: {\n                                                fontSize: '10px',\n                                                marginLeft: '2px'\n                                            }\n                                        })\n                                    ]\n                                })\n                            })\n                        ]\n                    }),\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"action-icons\",\n                        children: [\n                            hasConfigOptions && /*#__PURE__*/ jsx(\"div\", {\n                                className: hoveringSettings ? 'settings-wrapper settings-wrapper-hover' : 'settings-wrapper',\n                                onMouseEnter: handleMouseEnter,\n                                onMouseLeave: handleMouseLeave,\n                                children: /*#__PURE__*/ jsx(ConfigSelector, {\n                                    enableTracking: 'In-Browser-Extension' === serviceMode,\n                                    showDeepThinkOption: showDeepThinkOption,\n                                    showDataExtractionOptions: showDataExtractionOptions,\n                                    hideDomAndScreenshotOptions: hideDomAndScreenshotOptions,\n                                    deviceType: deviceType\n                                })\n                            }),\n                            /*#__PURE__*/ jsx(HistorySelector, {\n                                onSelect: handleSelectHistory,\n                                history: historyForSelectedType,\n                                currentType: selectedType\n                            })\n                        ]\n                    })\n                ]\n            }),\n            /*#__PURE__*/ jsxs(\"div\", {\n                className: `main-side-console-input ${!runButtonEnabled ? 'disabled' : ''} ${loading ? 'loading' : ''}`,\n                children: [\n                    needsAnyInput ? needsStructuredParams ? hasSingleStructuredParam ? renderStructuredParams() : /*#__PURE__*/ jsx(\"div\", {\n                        className: \"structured-params-container\",\n                        children: renderStructuredParams()\n                    }) : /*#__PURE__*/ jsx(Form.Item, {\n                        name: \"prompt\",\n                        style: {\n                            margin: 0\n                        },\n                        children: /*#__PURE__*/ jsx(TextArea, {\n                            className: \"main-side-console-input-textarea\",\n                            disabled: !runButtonEnabled,\n                            rows: 3,\n                            placeholder: placeholder,\n                            autoFocus: true,\n                            onKeyDown: handleKeyDown,\n                            onChange: handlePromptChange,\n                            ref: textAreaRef\n                        })\n                    }) : /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"no-input-method\",\n                        style: {\n                            padding: '20px',\n                            textAlign: 'center',\n                            color: '#666',\n                            fontSize: '14px'\n                        },\n                        children: [\n                            'Click \"Run\" to execute ',\n                            actionNameForType(selectedType)\n                        ]\n                    }),\n                    /*#__PURE__*/ jsx(\"div\", {\n                        className: \"form-controller-wrapper\",\n                        children: renderActionButton()\n                    })\n                ]\n            })\n        ]\n    });\n};\nexport { PromptInput };\n","import { Fragment, jsx, jsxs } from \"react/jsx-runtime\";\nimport icons, { ArrowDownOutlined, ClearOutlined, LoadingOutlined } from \"@ant-design/icons\";\nimport { Alert, Button, Form, List, Typography, message } from \"antd\";\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { usePlaygroundExecution } from \"../../hooks/usePlaygroundExecution.mjs\";\nimport { usePlaygroundState } from \"../../hooks/usePlaygroundState.mjs\";\nimport { useEnvConfig } from \"../../store/store.mjs\";\nimport { ContextPreview } from \"../context-preview/index.mjs\";\nimport { EnvConfigReminder } from \"../env-config-reminder/index.mjs\";\nimport { PlaygroundResultView } from \"../playground-result/index.mjs\";\nimport \"./index.css\";\nimport avatar from \"../../icons/avatar.mjs\";\nimport { defaultMainButtons } from \"../../utils/constants.mjs\";\nimport { PromptInput } from \"../prompt-input/index.mjs\";\nimport shiny_text from \"../shiny-text/index.mjs\";\nimport { createStorageProvider, detectBestStorageType } from \"./providers/storage-provider.mjs\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nconst { Text } = Typography;\nfunction getSDKId(sdk) {\n    if (!sdk) return 'playground-default';\n    if (sdk.id && 'string' == typeof sdk.id) return `agent-${sdk.id}`;\n    return 'playground-default';\n}\nfunction ErrorMessage({ error }) {\n    if (!error) return null;\n    const cleanError = error.replace(/^(Error:\\s*)+/, 'Error: ');\n    return /*#__PURE__*/ jsx(Alert, {\n        message: /*#__PURE__*/ jsx(\"span\", {\n            style: {\n                color: '#ff4d4f'\n            },\n            children: cleanError\n        }),\n        type: \"error\",\n        showIcon: true\n    });\n}\nfunction UniversalPlayground({ playgroundSDK, storage, contextProvider, config: componentConfig = {}, branding = {}, className = '', dryMode = false, showContextPreview = true }) {\n    const [form] = Form.useForm();\n    const { config } = useEnvConfig();\n    const [sdkReady, setSdkReady] = useState(false);\n    useEffect(()=>{\n        form.setFieldsValue({\n            type: defaultMainButtons[\"0\"]\n        });\n    }, [\n        form\n    ]);\n    useEffect(()=>{\n        const initializeSDK = ()=>_async_to_generator(function*() {\n                if (playgroundSDK && 'function' == typeof playgroundSDK.checkStatus) try {\n                    yield playgroundSDK.checkStatus();\n                    setSdkReady(true);\n                } catch (error) {\n                    console.warn('Failed to initialize SDK, using default namespace:', error);\n                    setSdkReady(true);\n                }\n                else setSdkReady(true);\n            })();\n        initializeSDK();\n    }, [\n        playgroundSDK\n    ]);\n    const effectiveStorage = useMemo(()=>{\n        if (storage) return storage;\n        if (!sdkReady) return null;\n        const namespace = componentConfig.storageNamespace || getSDKId(playgroundSDK);\n        const bestStorageType = detectBestStorageType();\n        console.log(`Using ${bestStorageType} storage for namespace: ${namespace}`);\n        return createStorageProvider(bestStorageType, namespace);\n    }, [\n        storage,\n        sdkReady,\n        componentConfig.storageNamespace,\n        playgroundSDK\n    ]);\n    const { loading, setLoading, infoList, setInfoList, actionSpace, actionSpaceLoading, uiContextPreview, setUiContextPreview, showScrollToBottomButton, verticalMode, replayCounter, setReplayCounter, infoListRef, currentRunningIdRef, interruptedFlagRef, clearInfoList, handleScrollToBottom } = usePlaygroundState(playgroundSDK, effectiveStorage, contextProvider);\n    const { handleRun: executeAction, handleStop, canStop } = usePlaygroundExecution(playgroundSDK, effectiveStorage, actionSpace, loading, setLoading, setInfoList, replayCounter, setReplayCounter, verticalMode, currentRunningIdRef, interruptedFlagRef);\n    useEffect(()=>{\n        if ((null == playgroundSDK ? void 0 : playgroundSDK.overrideConfig) && config) playgroundSDK.overrideConfig(config).catch((error)=>{\n            console.error('Failed to override SDK config:', error);\n        });\n    }, [\n        playgroundSDK,\n        config\n    ]);\n    const handleFormRun = useCallback(()=>_async_to_generator(function*() {\n            try {\n                const value = form.getFieldsValue();\n                yield executeAction(value);\n            } catch (error) {\n                message.error((null == error ? void 0 : error.message) || 'Execution failed');\n            }\n        })(), [\n        form,\n        executeAction\n    ]);\n    const configAlreadySet = Object.keys(config || {}).length >= 1;\n    const runButtonEnabled = componentConfig.serverMode || !dryMode && !actionSpaceLoading && configAlreadySet;\n    const selectedType = Form.useWatch('type', form);\n    const serviceMode = useMemo(()=>{\n        if (!playgroundSDK || 'function' != typeof playgroundSDK.getServiceMode) return 'Server';\n        return playgroundSDK.getServiceMode();\n    }, [\n        playgroundSDK\n    ]);\n    const finalShowContextPreview = showContextPreview && false !== componentConfig.showContextPreview;\n    const layout = componentConfig.layout || 'vertical';\n    const showVersionInfo = false !== componentConfig.showVersionInfo;\n    const deviceType = componentConfig.deviceType;\n    return /*#__PURE__*/ jsx(\"div\", {\n        className: `playground-container ${layout}-mode ${className}`.trim(),\n        children: /*#__PURE__*/ jsxs(Form, {\n            form: form,\n            onFinish: handleFormRun,\n            className: \"command-form\",\n            children: [\n                finalShowContextPreview && /*#__PURE__*/ jsx(\"div\", {\n                    className: \"context-preview-section\",\n                    children: /*#__PURE__*/ jsx(ContextPreview, {\n                        uiContextPreview: uiContextPreview,\n                        setUiContextPreview: setUiContextPreview,\n                        showContextPreview: finalShowContextPreview\n                    })\n                }),\n                /*#__PURE__*/ jsxs(\"div\", {\n                    className: \"middle-dialog-area\",\n                    children: [\n                        infoList.length > 1 && /*#__PURE__*/ jsx(\"div\", {\n                            className: \"clear-button-container\",\n                            children: /*#__PURE__*/ jsx(Button, {\n                                size: \"small\",\n                                icon: /*#__PURE__*/ jsx(ClearOutlined, {}),\n                                onClick: clearInfoList,\n                                type: \"text\",\n                                className: \"clear-button\"\n                            })\n                        }),\n                        /*#__PURE__*/ jsx(\"div\", {\n                            ref: infoListRef,\n                            className: \"info-list-container\",\n                            children: /*#__PURE__*/ jsx(List, {\n                                itemLayout: \"vertical\",\n                                dataSource: infoList,\n                                renderItem: (item)=>/*#__PURE__*/ jsx(List.Item, {\n                                        className: \"list-item\",\n                                        children: 'user' === item.type ? /*#__PURE__*/ jsx(\"div\", {\n                                            className: \"user-message-container\",\n                                            children: /*#__PURE__*/ jsx(\"div\", {\n                                                className: \"user-message-bubble\",\n                                                children: item.content\n                                            })\n                                        }) : 'progress' === item.type ? /*#__PURE__*/ jsx(\"div\", {\n                                            children: (()=>{\n                                                var _parts_, _item_result, _item_result1, _item_result2;\n                                                const parts = item.content.split(' - ');\n                                                const action = null == (_parts_ = parts[0]) ? void 0 : _parts_.trim();\n                                                const description = parts.slice(1).join(' - ').trim();\n                                                const currentIndex = infoList.findIndex((listItem)=>listItem.id === item.id);\n                                                const laterProgressExists = infoList.slice(currentIndex + 1).some((listItem)=>'progress' === listItem.type);\n                                                const isLatestProgress = !laterProgressExists;\n                                                const shouldShowLoading = loading && isLatestProgress;\n                                                return /*#__PURE__*/ jsxs(Fragment, {\n                                                    children: [\n                                                        action && /*#__PURE__*/ jsxs(\"span\", {\n                                                            className: \"progress-action-item\",\n                                                            children: [\n                                                                action,\n                                                                /*#__PURE__*/ jsx(\"span\", {\n                                                                    className: `progress-status-icon ${shouldShowLoading ? 'loading' : (null == (_item_result = item.result) ? void 0 : _item_result.error) ? 'error' : 'completed'}`,\n                                                                    children: shouldShowLoading ? /*#__PURE__*/ jsx(LoadingOutlined, {\n                                                                        spin: true\n                                                                    }) : (null == (_item_result1 = item.result) ? void 0 : _item_result1.error) ? '' : ''\n                                                                })\n                                                            ]\n                                                        }),\n                                                        description && /*#__PURE__*/ jsx(\"div\", {\n                                                            children: /*#__PURE__*/ jsx(shiny_text, {\n                                                                text: description,\n                                                                className: \"progress-description\",\n                                                                disabled: !shouldShowLoading\n                                                            })\n                                                        }),\n                                                        (null == (_item_result2 = item.result) ? void 0 : _item_result2.error) && /*#__PURE__*/ jsx(ErrorMessage, {\n                                                            error: item.result.error\n                                                        })\n                                                    ]\n                                                });\n                                            })()\n                                        }) : 'separator' === item.type ? /*#__PURE__*/ jsxs(\"div\", {\n                                            className: \"new-conversation-separator\",\n                                            children: [\n                                                /*#__PURE__*/ jsx(\"div\", {\n                                                    className: \"separator-line\"\n                                                }),\n                                                /*#__PURE__*/ jsx(\"div\", {\n                                                    className: \"separator-text-container\",\n                                                    children: /*#__PURE__*/ jsx(Text, {\n                                                        type: \"secondary\",\n                                                        className: \"separator-text\",\n                                                        children: item.content\n                                                    })\n                                                })\n                                            ]\n                                        }) : /*#__PURE__*/ jsxs(\"div\", {\n                                            className: \"system-message-container\",\n                                            children: [\n                                                /*#__PURE__*/ jsxs(\"div\", {\n                                                    className: \"system-message-header\",\n                                                    children: [\n                                                        /*#__PURE__*/ jsx(icons, {\n                                                            component: branding.icon || avatar,\n                                                            style: {\n                                                                fontSize: 20\n                                                            }\n                                                        }),\n                                                        /*#__PURE__*/ jsx(\"span\", {\n                                                            className: \"system-message-title\",\n                                                            children: branding.title || 'Playground'\n                                                        })\n                                                    ]\n                                                }),\n                                                (item.content || item.result) && /*#__PURE__*/ jsx(\"div\", {\n                                                    className: \"system-message-content\",\n                                                    children: 'result' === item.type ? /*#__PURE__*/ jsx(PlaygroundResultView, {\n                                                        result: item.result || null,\n                                                        loading: item.loading || false,\n                                                        serverValid: true,\n                                                        serviceMode: serviceMode,\n                                                        replayScriptsInfo: item.replayScriptsInfo || null,\n                                                        replayCounter: item.replayCounter || 0,\n                                                        loadingProgressText: item.loadingProgressText || '',\n                                                        verticalMode: item.verticalMode || false,\n                                                        fitMode: \"width\",\n                                                        actionType: item.actionType\n                                                    }) : /*#__PURE__*/ jsxs(Fragment, {\n                                                        children: [\n                                                            /*#__PURE__*/ jsx(\"div\", {\n                                                                className: \"system-message-text\",\n                                                                children: item.content\n                                                            }),\n                                                            item.loading && item.loadingProgressText && /*#__PURE__*/ jsx(\"div\", {\n                                                                className: \"loading-progress-text\",\n                                                                children: /*#__PURE__*/ jsx(\"span\", {\n                                                                    children: item.loadingProgressText\n                                                                })\n                                                            })\n                                                        ]\n                                                    })\n                                                })\n                                            ]\n                                        })\n                                    }, item.id)\n                            })\n                        }),\n                        showScrollToBottomButton && false !== componentConfig.enableScrollToBottom && /*#__PURE__*/ jsx(Button, {\n                            className: \"scroll-to-bottom-button\",\n                            type: \"primary\",\n                            shape: \"circle\",\n                            icon: /*#__PURE__*/ jsx(ArrowDownOutlined, {}),\n                            onClick: handleScrollToBottom,\n                            size: \"large\"\n                        })\n                    ]\n                }),\n                /*#__PURE__*/ jsxs(\"div\", {\n                    className: \"bottom-input-section\",\n                    children: [\n                        componentConfig.showEnvConfigReminder ? /*#__PURE__*/ jsx(EnvConfigReminder, {}) : null,\n                        /*#__PURE__*/ jsx(PromptInput, {\n                            runButtonEnabled: runButtonEnabled,\n                            form: form,\n                            serviceMode: serviceMode,\n                            selectedType: selectedType,\n                            dryMode: dryMode,\n                            stoppable: canStop,\n                            loading: loading,\n                            onRun: handleFormRun,\n                            onStop: handleStop,\n                            actionSpace: actionSpace,\n                            deviceType: deviceType\n                        })\n                    ]\n                }),\n                showVersionInfo && branding.version && /*#__PURE__*/ jsx(\"div\", {\n                    className: \"version-info-section\",\n                    children: /*#__PURE__*/ jsxs(\"span\", {\n                        className: \"version-text\",\n                        children: [\n                            \"Midscene.js version: \",\n                            branding.version\n                        ]\n                    })\n                })\n            ]\n        })\n    });\n}\nconst universal_playground = UniversalPlayground;\nexport { UniversalPlayground, universal_playground as default };\n","import { jsx, jsxs } from \"react/jsx-runtime\";\nimport { InfoCircleOutlined, ReloadOutlined } from \"@ant-design/icons\";\nimport { Button, Spin, Tooltip } from \"antd\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport \"./index.css\";\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n    try {\n        var info = gen[key](arg);\n        var value = info.value;\n    } catch (error) {\n        reject(error);\n        return;\n    }\n    if (info.done) resolve(value);\n    else Promise.resolve(value).then(_next, _throw);\n}\nfunction _async_to_generator(fn) {\n    return function() {\n        var self = this, args = arguments;\n        return new Promise(function(resolve, reject) {\n            var gen = fn.apply(self, args);\n            function _next(value) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n            }\n            function _throw(err) {\n                asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n            }\n            _next(void 0);\n        });\n    };\n}\nfunction ScreenshotViewer({ getScreenshot, getInterfaceInfo, serverOnline, isUserOperating = false }) {\n    const [screenshot, setScreenshot] = useState(null);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState(null);\n    const [lastUpdateTime, setLastUpdateTime] = useState(0);\n    const [interfaceInfo, setInterfaceInfo] = useState(null);\n    const pollingIntervalRef = useRef(null);\n    const isPollingPausedRef = useRef(false);\n    const fetchScreenshot = useCallback((isManual = false)=>_async_to_generator(function*() {\n            if (!serverOnline) return;\n            setLoading(true);\n            if (isManual) setError(null);\n            try {\n                const result = yield getScreenshot();\n                console.log('Screenshot API response:', result);\n                if (null == result ? void 0 : result.screenshot) {\n                    const screenshotData = result.screenshot.toString().trim();\n                    if (screenshotData) {\n                        setScreenshot(screenshotData);\n                        setError(null);\n                        setLastUpdateTime(Date.now());\n                    } else setError('Empty screenshot data received');\n                } else setError('No screenshot data in response');\n            } catch (err) {\n                console.error('Screenshot fetch error:', err);\n                setError(err instanceof Error ? err.message : 'Failed to fetch screenshot');\n            } finally{\n                setLoading(false);\n            }\n        })(), [\n        getScreenshot,\n        serverOnline\n    ]);\n    const fetchInterfaceInfo = useCallback(()=>_async_to_generator(function*() {\n            if (!serverOnline || !getInterfaceInfo) return;\n            try {\n                const info = yield getInterfaceInfo();\n                if (info) setInterfaceInfo(info);\n            } catch (err) {\n                console.error('Interface info fetch error:', err);\n            }\n        })(), [\n        getInterfaceInfo,\n        serverOnline\n    ]);\n    const startPolling = useCallback(()=>{\n        if (pollingIntervalRef.current) clearInterval(pollingIntervalRef.current);\n        console.log('Starting screenshot polling (5s interval)');\n        pollingIntervalRef.current = setInterval(()=>{\n            if (!isPollingPausedRef.current && serverOnline) fetchScreenshot(false);\n        }, 5000);\n    }, [\n        fetchScreenshot,\n        serverOnline\n    ]);\n    const stopPolling = useCallback(()=>{\n        if (pollingIntervalRef.current) {\n            console.log('Stopping screenshot polling');\n            clearInterval(pollingIntervalRef.current);\n            pollingIntervalRef.current = null;\n        }\n    }, []);\n    const pausePolling = useCallback(()=>{\n        console.log('Pausing screenshot polling');\n        isPollingPausedRef.current = true;\n    }, []);\n    const resumePolling = useCallback(()=>{\n        console.log('Resuming screenshot polling');\n        isPollingPausedRef.current = false;\n    }, []);\n    const handleManualRefresh = useCallback(()=>{\n        fetchScreenshot(true);\n    }, [\n        fetchScreenshot\n    ]);\n    useEffect(()=>{\n        if (!serverOnline) {\n            setScreenshot(null);\n            setError(null);\n            setInterfaceInfo(null);\n            stopPolling();\n            return;\n        }\n        fetchScreenshot(false);\n        fetchInterfaceInfo();\n        startPolling();\n        return ()=>{\n            stopPolling();\n        };\n    }, [\n        serverOnline,\n        startPolling,\n        stopPolling,\n        fetchScreenshot,\n        fetchInterfaceInfo\n    ]);\n    useEffect(()=>{\n        if (!serverOnline) return;\n        if (isUserOperating) pausePolling();\n        else {\n            resumePolling();\n            fetchScreenshot(false);\n        }\n    }, [\n        isUserOperating,\n        pausePolling,\n        resumePolling,\n        fetchScreenshot,\n        serverOnline\n    ]);\n    useEffect(()=>()=>{\n            stopPolling();\n        }, [\n        stopPolling\n    ]);\n    if (!serverOnline) return /*#__PURE__*/ jsx(\"div\", {\n        className: \"screenshot-viewer offline\",\n        children: /*#__PURE__*/ jsxs(\"div\", {\n            className: \"screenshot-placeholder\",\n            children: [\n                /*#__PURE__*/ jsx(\"h3\", {\n                    children: \"\\uD83D\\uDCF1 Screen Preview\"\n                }),\n                /*#__PURE__*/ jsx(\"p\", {\n                    children: \"Start the playground server to see real-time screenshots\"\n                })\n            ]\n        })\n    });\n    if (loading && !screenshot) return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"screenshot-viewer loading\",\n        children: [\n            /*#__PURE__*/ jsx(Spin, {\n                size: \"large\"\n            }),\n            /*#__PURE__*/ jsx(\"p\", {\n                children: \"Loading screenshot...\"\n            })\n        ]\n    });\n    if (error && !screenshot) return /*#__PURE__*/ jsx(\"div\", {\n        className: \"screenshot-viewer error\",\n        children: /*#__PURE__*/ jsxs(\"div\", {\n            className: \"screenshot-placeholder\",\n            children: [\n                /*#__PURE__*/ jsx(\"h3\", {\n                    children: \"\\uD83D\\uDCF1 Screen Preview\"\n                }),\n                /*#__PURE__*/ jsx(\"p\", {\n                    className: \"error-message\",\n                    children: error\n                })\n            ]\n        })\n    });\n    const formatLastUpdateTime = (timestamp)=>{\n        if (!timestamp) return '';\n        const now = Date.now();\n        const diff = Math.floor((now - timestamp) / 1000);\n        if (diff < 60) return `${diff}s ago`;\n        if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;\n        return new Date(timestamp).toLocaleTimeString();\n    };\n    return /*#__PURE__*/ jsxs(\"div\", {\n        className: \"screenshot-viewer\",\n        children: [\n            /*#__PURE__*/ jsx(\"div\", {\n                className: \"screenshot-header\",\n                children: /*#__PURE__*/ jsx(\"div\", {\n                    className: \"screenshot-title\",\n                    children: /*#__PURE__*/ jsx(\"h3\", {\n                        children: (null == interfaceInfo ? void 0 : interfaceInfo.type) ? interfaceInfo.type : 'Device Name'\n                    })\n                })\n            }),\n            /*#__PURE__*/ jsxs(\"div\", {\n                className: \"screenshot-container\",\n                children: [\n                    /*#__PURE__*/ jsxs(\"div\", {\n                        className: \"screenshot-overlay\",\n                        children: [\n                            /*#__PURE__*/ jsxs(\"div\", {\n                                className: \"device-name-overlay\",\n                                children: [\n                                    \"Device Name\",\n                                    /*#__PURE__*/ jsx(Tooltip, {\n                                        title: null == interfaceInfo ? void 0 : interfaceInfo.description,\n                                        children: /*#__PURE__*/ jsx(InfoCircleOutlined, {\n                                            size: 16,\n                                            className: \"info-icon\"\n                                        })\n                                    })\n                                ]\n                            }),\n                            /*#__PURE__*/ jsxs(\"div\", {\n                                className: \"screenshot-controls\",\n                                children: [\n                                    lastUpdateTime > 0 && /*#__PURE__*/ jsxs(\"span\", {\n                                        className: \"last-update-time\",\n                                        children: [\n                                            \"Last updated \",\n                                            formatLastUpdateTime(lastUpdateTime)\n                                        ]\n                                    }),\n                                    /*#__PURE__*/ jsx(Tooltip, {\n                                        title: \"Refresh screenshot\",\n                                        children: /*#__PURE__*/ jsx(Button, {\n                                            icon: /*#__PURE__*/ jsx(ReloadOutlined, {}),\n                                            onClick: handleManualRefresh,\n                                            loading: loading,\n                                            size: \"small\"\n                                        })\n                                    }),\n                                    isUserOperating && /*#__PURE__*/ jsxs(\"span\", {\n                                        className: \"operation-indicator\",\n                                        children: [\n                                            /*#__PURE__*/ jsx(Spin, {\n                                                size: \"small\"\n                                            }),\n                                            \" Operating...\"\n                                        ]\n                                    })\n                                ]\n                            })\n                        ]\n                    }),\n                    /*#__PURE__*/ jsx(\"div\", {\n                        className: \"screenshot-content\",\n                        children: screenshot ? /*#__PURE__*/ jsx(\"img\", {\n                            src: screenshot.startsWith('data:image/') ? screenshot : `data:image/png;base64,${screenshot}`,\n                            alt: \"Device Screenshot\",\n                            className: \"screenshot-image\",\n                            onLoad: ()=>console.log('Screenshot image loaded successfully'),\n                            onError: (e)=>{\n                                console.error('Screenshot image load error:', e);\n                                console.error('Screenshot data preview:', screenshot.substring(0, 100));\n                                setError('Failed to load screenshot image');\n                            }\n                        }) : /*#__PURE__*/ jsx(\"div\", {\n                            className: \"screenshot-placeholder\",\n                            children: /*#__PURE__*/ jsx(\"p\", {\n                                children: \"No screenshot available\"\n                            })\n                        })\n                    })\n                ]\n            })\n        ]\n    });\n}\nexport { ScreenshotViewer as default };\n","import { PlaygroundSDK } from '@midscene/playground';\nimport {\n  Logo,\n  NavActions,\n  ScreenshotViewer,\n  UniversalPlayground,\n  globalThemeConfig,\n} from '@midscene/visualizer';\nimport { ConfigProvider, Layout } from 'antd';\nimport { useEffect, useMemo, useState } from 'react';\nimport { Panel, PanelGroup, PanelResizeHandle } from 'react-resizable-panels';\nimport serverOfflineBackground from './icons/server-offline-background.svg';\nimport serverOfflineForeground from './icons/server-offline-foreground.svg';\n\nimport './App.less';\n\ndeclare const __APP_VERSION__: string;\ndeclare const __SERVER_URL__: string;\n\nconst { Content } = Layout;\n\nexport default function App() {\n  const [serverOnline, setServerOnline] = useState(false);\n  const [isUserOperating, setIsUserOperating] = useState(false);\n  const [isNarrowScreen, setIsNarrowScreen] = useState(false);\n  const [deviceType, setDeviceType] = useState<'web' | 'android' | 'ios'>(\n    'web',\n  );\n\n  // Create PlaygroundSDK and storage provider\n  const playgroundSDK = useMemo(() => {\n    // Support environment variable for serverUrl, fallback to default\n    const serverUrl = __SERVER_URL__;\n    const sdk = new PlaygroundSDK({\n      type: 'remote-execution',\n      serverUrl,\n    });\n\n    console.log(' Connecting to playground server:', serverUrl);\n\n    // Set progress callback to monitor user operation status\n    sdk.onProgressUpdate((tip: string) => {\n      // When there's a progress tip, it means user is operating\n      setIsUserOperating(!!tip);\n    });\n\n    return sdk;\n  }, []);\n\n  // Check server status on mount\n  useEffect(() => {\n    const checkServer = async () => {\n      try {\n        const online = await playgroundSDK.checkStatus();\n        setServerOnline(online);\n\n        // Get device type from server if online\n        if (online) {\n          try {\n            const interfaceInfo = await playgroundSDK.getInterfaceInfo();\n            if (interfaceInfo?.type) {\n              const type = interfaceInfo.type.toLowerCase();\n              if (type === 'android' || type === 'ios' || type === 'web') {\n                setDeviceType(type as 'web' | 'android' | 'ios');\n              }\n            }\n          } catch (error) {\n            console.warn('Failed to get interface info:', error);\n          }\n        }\n      } catch (error) {\n        console.error('Failed to check server status:', error);\n        setServerOnline(false);\n      }\n    };\n\n    checkServer();\n\n    // Check server status periodically\n    const interval = setInterval(checkServer, 5000);\n    return () => clearInterval(interval);\n  }, [playgroundSDK]);\n\n  // Handle window resize to detect narrow screens\n  useEffect(() => {\n    const handleResize = () => {\n      setIsNarrowScreen(window.innerWidth <= 1024);\n    };\n\n    // Set initial value\n    handleResize();\n\n    // Add event listener\n    window.addEventListener('resize', handleResize);\n\n    // Cleanup\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  if (!serverOnline) {\n    return (\n      <ConfigProvider theme={globalThemeConfig()}>\n        <div className=\"server-offline-container\">\n          <div className=\"server-offline-message\">\n            <Logo />\n            <div className=\"server-offline-content\">\n              <div className=\"server-offline-icon\">\n                <img\n                  src={serverOfflineBackground}\n                  className=\"icon-background\"\n                  alt=\"\"\n                />\n                <img\n                  src={serverOfflineForeground}\n                  className=\"icon-foreground\"\n                  alt=\"\"\n                />\n              </div>\n              <h1>Midscene Playground</h1>\n              <p className=\"connection-status\">Server offline...</p>\n            </div>\n          </div>\n        </div>\n      </ConfigProvider>\n    );\n  }\n\n  return (\n    <ConfigProvider theme={globalThemeConfig()}>\n      <Layout className=\"app-container playground-container\">\n        <Content className=\"app-content\">\n          <PanelGroup\n            autoSaveId=\"playground-layout\"\n            direction={isNarrowScreen ? 'vertical' : 'horizontal'}\n          >\n            {/* Left panel: UniversalPlayground */}\n            <Panel\n              defaultSize={isNarrowScreen ? 67 : 32}\n              maxSize={isNarrowScreen ? 85 : 60}\n              minSize={isNarrowScreen ? 67 : 25}\n              className=\"app-panel left-panel\"\n            >\n              <div className=\"panel-content left-panel-content\">\n                {/* Header with Logo and Config */}\n                <div className=\"playground-panel-header\">\n                  <div className=\"header-row\">\n                    <Logo />\n                    <NavActions\n                      showTooltipWhenEmpty={false}\n                      showModelName={false}\n                    />\n                  </div>\n                </div>\n\n                {/* Main playground area */}\n                <div className=\"playground-panel-playground\">\n                  <UniversalPlayground\n                    playgroundSDK={playgroundSDK}\n                    config={{\n                      showContextPreview: false,\n                      layout: 'vertical',\n                      showVersionInfo: true,\n                      enableScrollToBottom: true,\n                      serverMode: true,\n                      showEnvConfigReminder: true,\n                      deviceType,\n                    }}\n                    branding={{\n                      title: 'Playground',\n                      version: __APP_VERSION__,\n                    }}\n                    className=\"playground-container\"\n                  />\n                </div>\n              </div>\n            </Panel>\n\n            <PanelResizeHandle\n              className={`panel-resize-handle ${isNarrowScreen ? 'vertical' : 'horizontal'}`}\n            />\n\n            {/* Right panel: Screenshot Viewer */}\n            <Panel className=\"app-panel right-panel\">\n              <div className=\"panel-content right-panel-content\">\n                <ScreenshotViewer\n                  getScreenshot={() => playgroundSDK.getScreenshot()}\n                  getInterfaceInfo={() => playgroundSDK.getInterfaceInfo()}\n                  serverOnline={serverOnline}\n                  isUserOperating={isUserOperating}\n                />\n              </div>\n            </Panel>\n          </PanelGroup>\n        </Content>\n      </Layout>\n    </ConfigProvider>\n  );\n}\n","import { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App';\n\nconst container = document.getElementById('root');\nif (!container) {\n  throw new Error('Root element not found');\n}\n\nconst root = createRoot(container);\nroot.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n);\n","// getDefaultExport function for compatibility with non-ESM modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};\n","__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(\n\t\tObject.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t\t__webpack_require__.f[key](chunkId, promises);\n\t\t\treturn promises;\n\t\t}, [])\n\t);\n};","// This function allow to reference chunks\n__webpack_require__.u = (chunkId) => {\n  // return url for filenames not based on template\n  \n  // return url for filenames based on template\n  return \"static/js/async/\" + chunkId + \".\" + {\"195\": \"0366f6e8\",\"199\": \"f31e52e7\",\"221\": \"591b048e\",\"271\": \"15d46ff8\",\"35\": \"2b64fb0f\",\"467\": \"710fa05a\",\"652\": \"b5a7c7b4\",\"856\": \"be9fd814\",\"860\": \"b56301d9\",\"990\": \"82a78a53\",}[chunkId] + \".js\"\n}","// This function allow to reference chunks\n__webpack_require__.miniCssF = (chunkId) => {\n  // return url for filenames not based on template\n  \n  // return url for filenames based on template\n  return \"\" + chunkId + \".css\"\n}","__webpack_require__.g = (() => {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.p = \"/\";"],"names":["Promise","e","Error","UITarsModelVersion","_process_versions","MIDSCENE_MODEL_INIT_CONFIG_JSON","MIDSCENE_MODEL_NAME","MIDSCENE_DEBUG_MODEL_PROFILE","MIDSCENE_DEBUG_MODEL_RESPONSE","MIDSCENE_MODEL_SOCKS_PROXY","MIDSCENE_MODEL_HTTP_PROXY","MIDSCENE_MODEL_API_KEY","MIDSCENE_MODEL_BASE_URL","MIDSCENE_MODEL_TIMEOUT","MIDSCENE_MODEL_TEMPERATURE","OPENAI_API_KEY","OPENAI_BASE_URL","MIDSCENE_OPENAI_INIT_CONFIG_JSON","MIDSCENE_OPENAI_HTTP_PROXY","MIDSCENE_OPENAI_SOCKS_PROXY","MIDSCENE_USE_VLM_UI_TARS","MIDSCENE_USE_QWEN_VL","MIDSCENE_USE_QWEN3_VL","MIDSCENE_USE_DOUBAO_VISION","MIDSCENE_USE_GEMINI","MATCH_BY_POSITION","MIDSCENE_RUN_DIR","MIDSCENE_INSIGHT_MODEL_NAME","MIDSCENE_INSIGHT_MODEL_SOCKS_PROXY","MIDSCENE_INSIGHT_MODEL_HTTP_PROXY","MIDSCENE_INSIGHT_MODEL_BASE_URL","MIDSCENE_INSIGHT_MODEL_API_KEY","MIDSCENE_INSIGHT_MODEL_INIT_CONFIG_JSON","MIDSCENE_INSIGHT_MODEL_TIMEOUT","MIDSCENE_INSIGHT_MODEL_TEMPERATURE","MIDSCENE_PLANNING_MODEL_NAME","MIDSCENE_PLANNING_MODEL_SOCKS_PROXY","MIDSCENE_PLANNING_MODEL_HTTP_PROXY","MIDSCENE_PLANNING_MODEL_BASE_URL","MIDSCENE_PLANNING_MODEL_API_KEY","MIDSCENE_PLANNING_MODEL_INIT_CONFIG_JSON","MIDSCENE_PLANNING_MODEL_TIMEOUT","MIDSCENE_PLANNING_MODEL_TEMPERATURE","MIDSCENE_MODEL_FAMILY","BASIC_ENV_KEYS","BOOLEAN_ENV_KEYS","NUMBER_ENV_KEYS","STRING_ENV_KEYS","GLOBAL_ENV_KEYS","MODEL_ENV_KEYS","ALL_ENV_KEYS","MODEL_FAMILY_VALUES","types_UITarsModelVersion","getBasicEnvValue","key","process","ifInNode","defaultRunDirName","topicPrefix","logStreams","Map","debugInstances","getDebug","topic","fullTopic","debugFn","debug","args","writeLogToFile","message","stream","getLogStream","topicFileName","logFile","node_path","getMidsceneRunSubDir","subdir","basePath","getMidsceneRunBaseDir","existsSync","mkdirSync","error","tmpdir","logPath","node_fs","now","Date","isoDate","isoTime","milliseconds","timezoneOffsetMinutes","hours","Math","minutes","timezoneString","localISOTime","node_util","initDebugConfig","shouldPrintTiming","debugConfig","console","_define_property","obj","value","Object","maskKey","maskChar","prefixLen","prefix","suffix","maskLength","mask","maskConfig","config","valueStr","JSON","KEYS_MAP","decideModelConfigFromIntentConfig","intent","configMap","debugLog","keysForFn","finalResult","parseOpenaiSdkConfig","keys","provider","useLegacyLogic","legacyAPIKey","legacyBaseURL","legacySocksProxy","legacyHttpProxy","legacyOpenaiExtraConfig","legacyModelFamily","legacyConfigToModelFamily","isDoubao","isQwen","isQwen3","isUiTars","isGemini","enabledModes","Boolean","modelFamilyRaw","openaiApiKey","openaiBaseURL","socksProxy","httpProxy","modelName","openaiExtraConfigStr","openaiExtraConfig","parseJson","temperature","Number","vlMode","uiTarsVersion","modelFamilyToVLConfig","modelFamily","modelDescription","getModelDescription","condition","globalModelConfigManager","_this_globalConfigManager","defaultConfig","insightConfig","planningConfig","acc","String","globalConfigManager","modelConfig","createOpenAIClientFn","envConfig","p","name","newConfig","extendMode","allConfig","_this_override","savedNewConfig","overrideAIConfig","PointSchema","z","SizeSchema","RectSchema","TMultimodalPromptSchema","TUserPromptSchema","locateFieldFlagName","MidsceneLocationInput","findAllMidsceneLocatorField","zodType","requiredOnly","zodObject","field","ifMidsceneLocatorField","actualField","shape","r","_keyDefinitions","definition","lowerKey","isMac","window","debugUtils","buildDetailedLocateParam","locatePrompt","opt","xpath","prompt","deepThink","cacheable","noReplayAPIs","parseStructuredParams","action","params","options","schema","_","optionsWithoutDeviceOptions","paramObj","undefined","locatorFieldKeys","locateKey","detailedLocateParam","executeAction","activeAgent","actionType","actionSpace","a","parsedParams","actionParams","pass","thought","BasePlaygroundAdapter","_context","paramsForValidation","needsStructuredParams","paramsList","excludeKeys","filtered","zodError","errorMessages","err","path","errorMsg","shapeKeys","paramValue","displayKey","formattedValue","str","isLocateField","LocalExecutionAdapter","callback","errorMessage","context","page","contextPage","aiConfig","groupedDump","removeListener","dump","executionDump","result","executionError","response","dumpString","_requestId","t","type","description","agent","v4","RemoteExecutionAdapter","missingFields","fieldDef","isOptional","androidError","androidErrors","keyword","payload","fetch","errorText","optionalParams","optionalFields","Array","actionSpaceMethod","res","data","jsonError","requestId","encodeURIComponent","setInterval","progressData","clearInterval","serverUrl","PlaygroundSDK","elementColor","highlightColorForType","globalThemeConfig","Logo","hideLogo","isDarkMode","useTheme","setIsDarkMode","useState","useEffect","checkTheme","_document_querySelector","document","observer","MutationObserver","target","jsx","__webpack_require__","exports","prop","Symbol","external_zustand_namespaceObject","create","store_create","AUTO_ZOOM_KEY","BACKGROUND_VISIBLE_KEY","ELEMENTS_VISIBLE_KEY","MODEL_CALL_DETAILS_KEY","DARK_MODE_KEY","getQueryPreference","paramName","searchParams","URLSearchParams","normalized","useGlobalPreference","set","savedAutoZoom","localStorage","savedBackgroundVisible","savedElementsVisible","savedModelCallDetails","savedDarkMode","autoZoomFromQuery","elementsVisibleFromQuery","darkModeFromQuery","initialDarkMode","visible","enabled","CONFIG_KEY","SERVICE_MODE_KEY","TRACKING_ACTIVE_TAB_KEY","DEEP_THINK_KEY","SCREENSHOT_INCLUDED_KEY","DOM_INCLUDED_KEY","IME_STRATEGY_KEY","AUTO_DISMISS_KEYBOARD_KEY","KEYBOARD_DISMISS_STRATEGY_KEY","ALWAYS_REFRESH_SCREEN_INFO_KEY","getConfigStringFromLocalStorage","configString","parseConfig","lines","line","trimmed","match","cleanLine","parsedValue","useEnvConfig","get","ifInExtension","savedServiceMode","savedForceSameTabNavigation","savedDeepThink","savedScreenshotIncluded","savedDomIncluded","serviceMode","latestConfigString","forceSameTabNavigation","screenshotIncluded","domIncluded","tab","imeStrategy","autoDismissKeyboard","keyboardDismissStrategy","alwaysRefreshScreenInfo","EnvConfig","param","showTooltipWhenEmpty","showModelName","tooltipPlacement","mode","loadConfig","syncFromStorage","isModalOpen","setIsModalOpen","tempConfigString","setTempConfigString","midsceneModelName","componentRef","useRef","showModal","jsxs","Tooltip","SettingOutlined","Modal","Input","NavActions","showEnvConfig","githubUrl","helpUrl","className","Typography","GithubOutlined","QuestionCircleOutlined","typeStr","task","locateParamStr","locate","paramStr","planTask","scrollParam","extractInsightParam","taskParam","extractImages","source","toContent","dataDemand","locateStr","scrollParamStr","pullParamStr","pullParam","parts","getMidsceneLocationSchema","val","CACHE_STRATEGIES","autoDismissKeyboardTip","apiMetadata","defaultMainButtons","WELCOME_MESSAGE_TEMPLATE","BLANK_RESULT","mousePointer","mouseLoading","cameraStateForRect","rect","imageWidth","imageHeight","rectWidthOnPage","cameraPaddingRatio","rectRatio","cameraWidth","left","top","asyncGeneratorStep","gen","resolve","reject","_next","_throw","arg","info","_async_to_generator","fn","self","arguments","_object_spread","i","ownKeys","sym","_object_spread_props","usePlaygroundExecution_ownKeys","object","enumerableOnly","symbols","formatError","_error_dump","IndexedDBManager","request","indexedDB","event","db","keyPath","store","storeNames","operation","transaction","storeName","sortByTimestamp","results","objectStore","b","dbName","version","storeConfigs","withErrorHandling","defaultValue","onQuotaExceeded","createCleanupFunction","dbManager","maxItems","toDelete","item","indexeddb_storage_provider_ownKeys","MESSAGES_STORE","RESULTS_STORE","IndexedDBStorageProvider","messages","messagesToSave","msg","index","lightMessage","restoredItem","fullResult","id","compressedResult","_result_result_dump","_result_result","compressedTasks","_task_recorder","_this_compressScreenshotIfNeeded","record","screenshot","sizeKB","messageCount","resultCount","namespace","storage_provider_ownKeys","LocalStorageProvider","testKey","testData","lightMessages","messageData","DOMException","lightRecentMessages","recentMessages","retryError","stored","resultKey","storedResult","resultItem","resultKeys","keysToRemove","playgroundKeys","additionalKeysToRemove","storage_provider_MemoryStorageProvider","storage_provider_NoOpStorageProvider","_messages","_id","_result","createStorageProvider","detectBestStorageType","usePlaygroundState_ownKeys","rectMarkForItem","themeColor","width","height","hashNumber","djb2Hash","hash","graphics","Graphics","DropShadowFilter","texts","Text","nameFontSize","blackboard","props","highlightElements","highlightRect","highlightPoints","size","screenshotBase64","screenWidth","screenHeight","domRef","app","useMemo","Application","appInitialed","setAppInitialed","highlightContainer","Container","elementMarkContainer","hoverElement","setHoverElement","pixiBgRef","animationFrameRef","highlightGraphicsRef","glowFiltersRef","canvasEl","clientWidth","targetHeight","ratio","cancelAnimationFrame","Rectangle","_props_onCanvasClick","x","y","_app_stage","img","Image","screenshotTexture","Texture","backgroundSprite","Sprite","highlightElementRects","element","content","items","glowFilter","GlowFilter","existingFilters","point","pointMarkForItem","graphicsToAnimate","glowFilters","startTime","performance","animate","normalizedSine","sineValue","progress","alpha","minAlpha","maxAlpha","glowStrength","minGlowStrength","maxGlowStrength","requestAnimationFrame","bottomTipA","shiny_text","text","disabled","speed","colorTheme","style","themeClass","errorMessageServerNotReady","serverLaunchTip","notReadyMessage","Alert","emptyResultTip","ContextPreview","uiContextPreview","setUiContextPreview","showContextPreview","iconForStatus","status","CheckOutlined","WarningOutlined","CloseOutlined","ClockCircleOutlined","LogoutOutlined","ArrowRightOutlined","MinusOutlined","Button","playground_demo_ui_context","EnvConfigReminder","ExclamationCircleFilled","global_perspective","global_perspective_ownKeys","player_setting","player_setting_ownKeys","globalTextureMap","loadTexture","Assets","texture","sleep","ms","setTimeout","ERROR_FRAME_CANCEL","RecordingSession","mediaRecorder","MediaRecorder","blob","Blob","url","URL","canvas","Player","_scripts_","statusIconElement","titleText","setTitleText","subTitleText","setSubTitleText","autoZoom","setAutoZoom","scripts","fitMode","currentImg","divContainerRef","pointerSprite","spinningPointerSprite","replayMark","setReplayMark","triggerReplay","windowContentContainer","insightMarkContainer","container","basicCameraState","animationProgress","setAnimationProgress","cancelFlag","cameraState","repaintImage","scriptWidth","scriptHeight","imgToUpdate","targetWidth","aspectRatio","newWidth","newHeight","sprite","mainImgLabel","child","spinningPointer","frame","_pointerSprite_current","_pointerSprite_current1","isCancelled","currentTime","rotation","elapsedTime","updatePointer","targetX","targetY","pointer","updateCamera","state","currentWidth","effectiveWidth","newScale","canvasPaddingLeft","canvasPaddingTop","cameraAnimation","targetState","duration","currentCanvasWidth","currentCanvasHeight","currentState","startPointerLeft","startPointerTop","player_ownKeys","startLeft","startTop","startScale","shouldMovePointer","pointerMoveDuration","cameraMoveDuration","nextState","mouseProgress","cameraProgress","cameraElapsedTime","progressScale","targetScale","progressWidth","progressLeft","progressTop","horizontalExceed","verticalExceed","fadeInGraphics","targetAlpha","fadeOutItem","insightElementsAnimation","elements","searchArea","elementsToAdd","totalLength","childrenCount","t2","elementsToAddNow","p0","p3","randomIndex","insightMarkGraphic","searchAreaGraphic","isRecording","setIsRecording","recorderSessionRef","cancelAnimationRef","playerContainer","cancelFn","cancel","timeout","allImages","totalDuration","updateProgress","stop","wasRecording","stopError","mouseOverStatusIcon","setMouseOverStatusIcon","mouseOverSettingsIcon","setMouseOverSettingsIcon","progressString","canReplayNow","listener","statusOnClick","Spin","LoadingOutlined","CaretRightOutlined","DownloadOutlined","ExportOutlined","Dropdown","menu","Switch","checked","_e_stopPropagation","PlaygroundResultView","loading","serverValid","replayScriptsInfo","replayCounter","loadingProgressText","verticalMode","canDownloadReport","resultWrapperClassName","resultDataToShow","shouldPrioritizeResult","errorNode","resultOutput","reportContent","avatar","avatar_ownKeys","history_create","HISTORY_KEY","LAST_SELECTED_TYPE_KEY","useHistoryStore","historyString","newHistory","historyItem","currentHistory","typeHistory","stringifiedNewItem","newTypeHistory","h","stringifiedOldItem","history_ownKeys","isZodObjectSchema","_field__def","_field__def1","_fieldWithRuntime__def","fieldWithRuntime","VALIDATION_CONSTANTS","desc","unwrapZodType","_actualField__def","_actualField__def1","_actualField__def2","_actualField__def3","_actualField__def4","hasDefault","actionNameForType","typeWithoutAi","fullName","words","setting","setting_ownKeys","ConfigSelector","showDeepThinkOption","enableTracking","showDataExtractionOptions","hideDomAndScreenshotOptions","deviceType","setForceSameTabNavigation","setDeepThink","setScreenshotIncluded","setDomIncluded","setImeStrategy","setAutoDismissKeyboard","setKeyboardDismissStrategy","setAlwaysRefreshScreenInfo","configItems","Checkbox","Radio","TextArea","renderLabel","label","TextField","isRequired","marginBottom","customPlaceholder","placeholder","Form","LocateField","EnumField","_fieldSchema__def","fieldSchema","selectOptions","enumValues","Select","NumberField","defaultPlaceholder","placeholderValue","max","min","InputNumber","BooleanField","icons_close","close_ownKeys","icons_history","magnifying_glass","magnifying_glass_ownKeys","HistorySelector","onSelect","history","currentType","searchText","setSearchText","clearHistory","modalRef","groupedHistory","sevenDaysAgo","oneYearAgo","filteredHistory","handleClickOutside","timer","clearTimeout","renderHistoryGroup","title","Fragment","PromptInput","hiddenAPIs","groupedItems","interactionAPIs","extractionAPIs","validationAPIs","deviceSpecificAPIs","runButtonEnabled","form","selectedType","dryMode","stoppable","onRun","onStop","clearPromptAfterRun","hoveringSettings","setHoveringSettings","promptValue","setPromptValue","textAreaRef","modeRadioGroupRef","lastHistoryRef","lastSelectedType","addHistory","setLastSelectedType","historyForSelectedType","needsAnyInput","dataExtractionMethods","hasConfigOptions","hasDataExtraction","hasDeviceOptions","hasTracking","availableDropdownMethods","metadataMethods","availableMethods","finalMethods","Set","method","methodInfo","getDefaultParams","useCallback","defaultParams","extractDefaultValue","_currentField__def","currentField","scrollToSelectedItem","targetElement","selectedRadioButton","dropdownButton","containerRect","targetRect","targetLeft","containerWidth","lastHistory","timeoutId","formPromptValue","handleSelectHistory","handlePromptChange","hasSingleStructuredParam","isRunButtonEnabled","playground_utils_mjs_isRunButtonEnabled","currentParams","handleRunWithHistory","values","historyPrompt","locateValue","otherValues","_values_params","mainPart","newHistoryItem","handleKeyDown","_textAreaRef_current_resizableTextArea","textarea","selectionStart","lastNewlineIndex","isAtLastLine","handleStructuredKeyDown","renderStructuredParams","schemaKeys","isLocateFieldFlag","placeholderText","_fieldDef__def","fields","sortedKeys","keyA","keyB","fieldSchemaA","fieldSchemaB","isOptionalA","isOptionalB","fieldProps","directionField","react","distanceField","otherFields","handleMouseEnter","handleMouseLeave","renderActionButton","runButton","SendOutlined","BorderOutlined","apiType","_apiMetadata_apiType","api","_apiMetadata_api","DownOutlined","ErrorMessage","cleanError","UniversalPlayground","playgroundSDK","storage","contextProvider","componentConfig","branding","sdkReady","setSdkReady","effectiveStorage","sdk","bestStorageType","setLoading","infoList","setInfoList","actionSpaceLoading","showScrollToBottomButton","setReplayCounter","infoListRef","currentRunningIdRef","interruptedFlagRef","clearInfoList","handleScrollToBottom","usePlaygroundState","setActionSpace","setActionSpaceLoading","setShowScrollToBottomButton","setVerticalMode","initializedRef","initializeMessages","welcomeMessage","storedMessages","oldStorage","oldMessages","hasWelcomeMessage","_contextProvider_getUIContext","space","handleResize","scrollToBottom","checkIfScrolledToBottom","scrollTop","scrollHeight","clientHeight","refreshContext","newContext","handleStop","canStop","usePlaygroundExecution","handleRun","thisRunningId","displayContent","userItem","prev","systemItem","_executionDump_tasks","progressItems","_task_timing","systemItemIndex","listWithoutCurrentProgress","resultObj","replayInfo","counter","modelBriefsSet","allScriptsFromDump","_normalizedDump_executions","_normalizedDump_executions1","_normalizedDump_modelBriefs","firstWidth","firstHeight","normalizedDump","dimensionsSet","sdkVersion","execution","_task_uiContext_size","_task_uiContext","w","allScripts","generateAnimationScripts","insightCameraState","tasksIncluded","startIndex","fullPageCameraState","insightOnTop","initSubTitle","errorStateFlag","_task_output","_planTask_output","_context_size","_context_size1","_planningTask_recorder_","_planningTask_recorder","_task_uiContext_size1","_task_uiContext1","_task_recorder_","_task_uiContext_size2","_task_uiContext2","_task_uiContext_size3","_task_uiContext3","_task_recorder_1","_task_recorder1","_task_uiContext_size4","_task_uiContext4","_task_uiContext_size5","_task_uiContext5","_task_uiContext_size6","_task_uiContext6","_task_uiContext_size7","_task_uiContext7","locateElements","actions","knownFields","locateTask","subTitle","_task_log_taskInfo","_task_log","replay_scripts_ownKeys","planningTask","errorTitle","errorSubTitle","model_name","model_description","allScriptsWithoutIntermediateDoneFrame","script","normalizedModelBriefs","modelBriefs","_list_","list","firstOneInfo","c","separatorItem","cancelResult","executionData","stopItem","handleFormRun","configAlreadySet","finalShowContextPreview","layout","showVersionInfo","ClearOutlined","List","_parts_","_item_result","_item_result1","_item_result2","currentIndex","laterProgressExists","shouldShowLoading","listItem","icons","ArrowDownOutlined","ScreenshotViewer","getScreenshot","getInterfaceInfo","serverOnline","isUserOperating","setScreenshot","setError","lastUpdateTime","setLastUpdateTime","interfaceInfo","setInterfaceInfo","pollingIntervalRef","isPollingPausedRef","fetchScreenshot","isManual","screenshotData","fetchInterfaceInfo","startPolling","stopPolling","pausePolling","resumePolling","handleManualRefresh","InfoCircleOutlined","formatLastUpdateTime","timestamp","diff","ReloadOutlined","Content","Layout","root","createRoot","StrictMode","setServerOnline","setIsUserOperating","isNarrowScreen","setIsNarrowScreen","setDeviceType","__SERVER_URL__","tip","checkServer","online","interval","ConfigProvider","PanelGroup","Panel","__APP_VERSION__","PanelResizeHandle","serverOfflineForeground","App","globalThis","Function"],"mappings":"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,IAAK,QACL,KAAM,IACV,EACA,KAAM,CACF,QAAS,GACT,KAAM,QACN,IAAK,QACL,KAAM,IACV,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,QACL,SAAU,CACd,EACA,WAAY,CACR,QAAS,GACT,KAAM,aACN,IAAK,QACL,SAAU,CACd,EACA,YAAa,CACT,QAAS,GACT,KAAM,cACN,IAAK,UACL,SAAU,CACd,EACA,aAAc,CACV,QAAS,GACT,KAAM,eACN,IAAK,UACL,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,KAAM,UACN,IAAK,MACL,SAAU,CACd,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,MACL,SAAU,CACd,EACA,MAAO,CACH,QAAS,GACT,KAAM,QACN,IAAK,OACT,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,UACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,QAAS,CACL,QAAS,GACT,KAAM,UACN,IAAK,SACT,EACA,WAAY,CACR,QAAS,GACT,KAAM,aACN,IAAK,YACT,EACA,MAAO,CACH,QAAS,GACT,KAAM,QACN,IAAK,GACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,SACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,WACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,UACT,EACA,IAAK,CACD,QAAS,GACT,KAAM,MACN,IAAK,KACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,MACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,IAAK,MACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,OACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,WACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,YACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,UACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,KAAM,UACN,IAAK,SACT,EACA,WAAY,CACR,QAAS,GACT,KAAM,aACN,IAAK,YACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,IACd,IAAK,aACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,YACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,WACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,IAAK,SACT,EACA,YAAa,CACT,QAAS,GACT,KAAM,cACN,IAAK,aACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,QAAS,CACL,QAAS,GACT,aAAc,GACd,IAAK,SACL,KAAM,UACN,SAAU,IACV,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,IAAK,QACT,EACA,cAAe,CACX,QAAS,GACT,aAAc,IACd,KAAM,gBACN,IAAK,KACL,SAAU,IACV,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,GACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,KAAM,CACF,QAAS,GACT,KAAM,OACN,SAAU,IACV,IAAK,GACT,EACA,SAAU,CACN,QAAS,GACT,KAAM,WACN,IAAK,OACL,SAAU,CACd,EACA,UAAW,CACP,QAAS,GACT,KAAM,YACN,IAAK,OACL,SAAU,CACd,EACA,YAAa,CACT,QAAS,GACT,KAAM,cACN,IAAK,aACT,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,IACL,SAAU,CACd,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,IAAK,IACL,SAAU,CACd,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,IACL,SAAU,CACd,EACA,aAAc,CACV,QAAS,IACT,KAAM,eACN,IAAK,IACL,SAAU,CACd,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,GAAI,CACA,QAAS,IACT,KAAM,KACN,IAAK,IACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,IAAK,CACD,QAAS,IACT,KAAM,MACN,IAAK,KACT,EACA,QAAS,CACL,QAAS,IACT,KAAM,UACN,IAAK,SACT,EACA,WAAY,CACR,QAAS,IACT,KAAM,aACN,IAAK,YACT,EACA,gBAAiB,CACb,QAAS,IACT,KAAM,kBACN,IAAK,iBACT,EACA,gBAAiB,CACb,QAAS,IACT,KAAM,kBACN,IAAK,iBACT,EACA,cAAe,CACX,QAAS,IACT,KAAM,gBACN,IAAK,eACT,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,gBACT,EACA,mBAAoB,CAChB,QAAS,IACT,KAAM,qBACN,IAAK,oBACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,IAAK,WACT,EACA,eAAgB,CACZ,QAAS,IACT,KAAM,iBACN,IAAK,gBACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,YAAa,CACT,QAAS,IACT,KAAM,cACN,IAAK,IACL,SAAU,CACd,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,OAAQ,CACJ,QAAS,IACT,KAAM,SACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,SAAU,IACV,IAAK,GACT,EACA,YAAa,CACT,QAAS,IACT,KAAM,cACN,SAAU,IACV,IAAK,GACT,EACA,UAAW,CACP,QAAS,IACT,KAAM,YACN,SAAU,IACV,IAAK,IACT,EACA,aAAc,CACV,QAAS,IACT,KAAM,eACN,SAAU,IACV,IAAK,GACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,SAAU,IACV,IAAK,GACT,EACA,SAAU,CACN,QAAS,IACT,KAAM,WACN,IAAK,UACT,EACA,MAAO,CACH,QAAS,IACT,KAAM,QACN,IAAK,OACT,EACA,OAAQ,CACJ,QAAS,EACT,IAAK,SACL,KAAM,OACV,EACA,MAAO,CACH,QAAS,GACT,IAAK,QACL,KAAM,UACN,SAAU,CACd,EACA,MAAO,CACH,QAAS,GACT,IAAK,QACL,KAAM,YACN,SAAU,CACd,EACA,QAAS,CACL,QAAS,GACT,IAAK,UACL,KAAM,cACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,GACT,IAAK,MACL,KAAM,UACN,SAAU,CACd,EACA,OAAQ,CACJ,QAAS,GACT,IAAK,QACT,EACA,WAAY,CACR,QAAS,GACT,IAAK,YACT,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,OACV,EACA,MAAO,CACH,QAAS,GACT,IAAK,OACT,EACA,QAAS,CACL,QAAS,GACT,IAAK,UACL,KAAM,MACV,EACA,KAAU,CACN,QAAS,GACT,IAAK,KACL,KAAM,gBACN,SAAU,CACd,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,KAAM,CACF,QAAS,GACT,IAAK,OACL,KAAM,WACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,iBACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,YACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,iBACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,eACN,SAAU,CACd,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,aACV,EACA,KAAM,CACF,QAAS,IACT,IAAK,KACL,KAAM,WACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,cACV,EACA,IAAK,CACD,QAAS,IACT,IAAK,IACL,KAAM,OACV,EACA,KAAM,CACF,QAAS,IACT,IAAK,MACT,EACA,MAAO,CACH,QAAS,IACT,IAAK,QACL,KAAM,OACV,EACA,MAAO,CACH,QAAS,IACT,IAAK,OACT,EACA,SAAU,CACN,QAAS,IACT,IAAK,UACT,EACA,KAAM,CACF,QAAS,IACT,IAAK,MACT,EACA,QAAS,CACL,QAAS,IACT,IAAK,SACT,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,IAAK,CACD,QAAS,GACT,IAAK,IACL,KAAM,QACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,EAAG,CACC,QAAS,GACT,IAAK,IACL,KAAM,MACV,EACA,IAAK,C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"}