{"version":3,"file":"puppeteer/index.mjs","sources":["../../../src/puppeteer/index.ts"],"sourcesContent":["import type { WebPageAgentOpt } from '@/web-element';\nimport { Agent as PageAgent } from '@midscene/core/agent';\nimport { getDebug } from '@midscene/shared/logger';\nimport type { Page as PuppeteerPage } from 'puppeteer';\nimport semver from 'semver';\nimport { getWebpackRequire } from '../utils';\nimport {\n  forceChromeSelectRendering as applyChromeSelectRendering,\n  forceClosePopup,\n} from './base-page';\nimport { PuppeteerWebPage } from './page';\n\nconst debug = getDebug('puppeteer:agent');\n\n/**\n * Get Puppeteer version from package.json\n */\nfunction getPuppeteerVersion(): string | null {\n  try {\n    const puppeteerPkg = getWebpackRequire()('puppeteer/package.json');\n    return puppeteerPkg.version || null;\n  } catch (error) {\n    console.error('[midscene:error] Failed to get Puppeteer version', error);\n    return null;\n  }\n}\n\nexport { PuppeteerWebPage } from './page';\nexport type { WebPageAgentOpt } from '@/web-element';\n\nexport class PuppeteerAgent extends PageAgent<PuppeteerWebPage> {\n  constructor(page: PuppeteerPage, opts?: WebPageAgentOpt) {\n    const webPage = new PuppeteerWebPage(page, opts);\n    super(webPage, opts);\n\n    const { forceSameTabNavigation = true, forceChromeSelectRendering } =\n      opts ?? {};\n\n    if (forceSameTabNavigation) {\n      forceClosePopup(page, debug);\n    }\n\n    if (forceChromeSelectRendering) {\n      const puppeteerVersion = getPuppeteerVersion();\n      if (puppeteerVersion && !semver.gte(puppeteerVersion, '24.6.0')) {\n        console.warn(\n          `[midscene:error] forceChromeSelectRendering requires Puppeteer > 24.6.0, but current version is ${puppeteerVersion}. This feature may not work correctly.`,\n        );\n      }\n      applyChromeSelectRendering(page);\n    }\n  }\n}\n\nexport { overrideAIConfig } from '@midscene/shared/env';\n\n// Do NOT export this since it requires puppeteer\n// export { puppeteerAgentForTarget } from './agent-launcher';\n"],"names":["debug","getDebug","getPuppeteerVersion","puppeteerPkg","getWebpackRequire","error","console","PuppeteerAgent","PageAgent","page","opts","webPage","PuppeteerWebPage","forceSameTabNavigation","forceChromeSelectRendering","forceClosePopup","puppeteerVersion","semver","applyChromeSelectRendering"],"mappings":";;;;;;;AAYA,MAAMA,QAAQC,SAAS;AAKvB,SAASC;IACP,IAAI;QACF,MAAMC,eAAeC,oBAAoB;QACzC,OAAOD,aAAa,OAAO,IAAI;IACjC,EAAE,OAAOE,OAAO;QACdC,QAAQ,KAAK,CAAC,oDAAoDD;QAClE,OAAO;IACT;AACF;AAKO,MAAME,uBAAuBC;IAClC,YAAYC,IAAmB,EAAEC,IAAsB,CAAE;QACvD,MAAMC,UAAU,IAAIC,iBAAiBH,MAAMC;QAC3C,KAAK,CAACC,SAASD;QAEf,MAAM,EAAEG,yBAAyB,IAAI,EAAEC,0BAA0B,EAAE,GACjEJ,QAAQ,CAAC;QAEX,IAAIG,wBACFE,gBAAgBN,MAAMT;QAGxB,IAAIc,4BAA4B;YAC9B,MAAME,mBAAmBd;YACzB,IAAIc,oBAAoB,CAACC,OAAO,GAAG,CAACD,kBAAkB,WACpDV,QAAQ,IAAI,CACV,CAAC,gGAAgG,EAAEU,iBAAiB,sCAAsC,CAAC;YAG/JE,kDAA2BT;QAC7B;IACF;AACF"}